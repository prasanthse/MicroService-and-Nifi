nf.Client={};nf.Client.version=-1;nf.Client.clientId=null;nf.Client.getRevision=function(){return{version:nf.Client.version,clientId:nf.Client.clientId}};nf.Client.setRevision=function(a){if(nf.Common.isDefinedAndNotNull(a.version)){if(nf.Common.isDefinedAndNotNull(nf.Client.version)){if(a.version>nf.Client.version){nf.Client.version=a.version}}else{nf.Client.version=a.version}}if(nf.Common.isDefinedAndNotNull(a.clientId)){nf.Client.clientId=a.clientId}};
$(document).ready(function(){var a="images/bg-error.png";$("<img/>").attr("src",a).on("load",function(){$("div.message-pane").css("background-image",a)});$(document).on("mouseenter","span.link",function(){$(this).addClass("link-over")}).on("mouseleave","span.link",function(){$(this).removeClass("link-over")});$(document).on("click","div.nf-checkbox",function(){var b=$(this);if(b.hasClass("checkbox-unchecked")){b.removeClass("checkbox-unchecked").addClass("checkbox-checked")}else{b.removeClass("checkbox-checked").addClass("checkbox-unchecked")}});$(document).ajaxStart(function(){$("div.loading-container").addClass("ajax-loading")}).ajaxStop(function(){$("div.loading-container").removeClass("ajax-loading")});$("img.setting-icon").qtip(nf.Common.config.tooltipConfig);if(nf.Storage.getItem("jwt")!==null){$("#user-logout-container").css("display","block");nf.Common.scheduleTokenRefresh()}$("#user-logout").on("click",function(){nf.Storage.removeItem("jwt");window.location="/nifi/login"});$("#user-home").on("click",function(){if(top!==window){parent.window.location="/nifi"}else{window.location="/nifi"}})});nf.Common=(function(){var a=null;return{ANONYMOUS_USER_TEXT:"Anonymous user",config:{sensitiveText:"Sensitive value set",tooltipConfig:{style:{classes:"nifi-tooltip"},show:{solo:true,effect:false},hide:{effect:false},position:{at:"top right",my:"bottom left"}}},SUPPORTS_SVG:!!document.createElementNS&&!!document.createElementNS("http://www.w3.org/2000/svg","svg").createSVGRect,authorities:undefined,setAuthorities:function(b){nf.Common.authorities=b},cachedScript:function(b){return $.ajax({dataType:"script",cache:true,url:b})},scheduleTokenRefresh:function(){if(a!==null){clearInterval(a)}var b=nf.Common.MILLIS_PER_MINUTE;var c=function(){var e=nf.Storage.getItemExpiration("jwt");if(e!==null){var g=new Date(e);var f=new Date();var d=g.valueOf()-f.valueOf()-(30*nf.Common.MILLIS_PER_SECOND);if(d<b){if($("#current-user").text()!==nf.Common.ANONYMOUS_USER_TEXT&&!$("#anonymous-user-alert").is(":visible")){$("#anonymous-user-alert").show().qtip($.extend({},nf.Common.config.tooltipConfig,{content:"Your session will expire soon. Please log in again to avoid being automatically logged out.",position:{my:"top right",at:"bottom left"}}))}}}};c();a=setInterval(c,b)},setAnonymousUserLabel:function(){var b=$("#anonymous-user-alert");if(b.data("qtip")){b.qtip("api").destroy(true)}b.show().qtip($.extend({},nf.Common.config.tooltipConfig,{content:"You are accessing with limited authority. Log in or request an account to access with additional authority granted to you by an administrator.",position:{my:"top right",at:"bottom left"}}));$("#current-user").text(nf.Common.ANONYMOUS_USER_TEXT).show()},getJwtPayload:function(c){if(nf.Common.isDefinedAndNotNull(c)){var b=c.split(/\./);if(b.length!==3){return""}var e=$.base64.atob(b[1]);var d=JSON.parse(e);if(nf.Common.isDefinedAndNotNull(d)){return d}else{return null}}return null},canAccessProvenance:function(){var b=false;if(nf.Common.isDefinedAndNotNull(nf.Common.authorities)){$.each(nf.Common.authorities,function(c,d){if(d==="ROLE_PROVENANCE"){b=true;return false}})}return b},isDFM:function(){var b=false;if(nf.Common.isDefinedAndNotNull(nf.Common.authorities)){$.each(nf.Common.authorities,function(c,d){if(d==="ROLE_DFM"){b=true;return false}})}return b},isAdmin:function(){var b=false;if(nf.Common.isDefinedAndNotNull(nf.Common.authorities)){$.each(nf.Common.authorities,function(c,d){if(d==="ROLE_ADMIN"){b=true;return false}})}return b},addHoverEffect:function(b,d,c){$(document).on("mouseenter",b,function(){$(this).removeClass(d).addClass(c)}).on("mouseleave",b,function(){$(this).removeClass(c).addClass(d)});return $(b).addClass(d)},handleAjaxError:function(e,b,c){if(b==="canceled"){if($("#splash").is(":visible")){$("#message-title").text("Session Expired");$("#message-content").text("Your session has expired. Please reload to log in again.");$("#message-pane").show()}else{nf.Dialog.showOkDialog({dialogContent:"Your session has expired. Please press Ok to log in again.",overlayBackground:false,okHandler:function(){window.location="/nifi"}})}nf.Common.closeCanvas();return}if($("#splash").is(":visible")){if(e.status===401){$("#message-title").text("Unauthorized")}else{if(e.status===403){$("#message-title").text("Access Denied")}else{$("#message-title").text("An unexpected error has occurred")}}if($.trim(e.responseText)===""){$("#message-content").text("Please check the logs.")}else{$("#message-content").text(e.responseText)}$("#message-pane").show();nf.Common.closeCanvas();return}if(e.status===400||e.status===404||e.status===409){nf.Dialog.showOkDialog({dialogContent:nf.Common.escapeHtml(e.responseText),overlayBackground:false})}else{if(e.status<99||e.status===12007||e.status===12029){var d="Please ensure the application is running and check the logs for any errors.";if(nf.Common.isDefinedAndNotNull(b)){if(b==="timeout"){d="Request has timed out. Please ensure the application is running and check the logs for any errors."}else{if(b==="abort"){d="Request has been aborted."}else{if(b==="No Transport"){d="Request transport mechanism failed. Please ensure the host where the application is running is accessible."}}}}$("#message-title").text("Unable to communicate with NiFi");$("#message-content").text(d)}else{if(e.status===401){$("#message-title").text("Unauthorized");if($.trim(e.responseText)===""){$("#message-content").text("Authorization is required to use this NiFi.")}else{$("#message-content").text(e.responseText)}}else{if(e.status===403){$("#message-title").text("Access Denied");if($.trim(e.responseText)===""){$("#message-content").text("Unable to authorize you to use this NiFi.")}else{$("#message-content").text(e.responseText)}}else{if(e.status===500){$("#message-title").text("An unexpected error has occurred");if($.trim(e.responseText)===""){$("#message-content").text("An error occurred communicating with the application core. Please check the logs and fix any configuration issues before restarting.")}else{$("#message-content").text(e.responseText)}}else{if(e.status===200||e.status===201){$("#message-title").text("Parse Error");if($.trim(e.responseText)===""){$("#message-content").text("Unable to interpret response from NiFi.")}else{$("#message-content").text(e.responseText)}}else{$("#message-title").text(e.status+": Unexpected Response");$("#message-content").text("An unexpected error has occurred. Please check the logs.")}}}}}$("#message-pane").show();nf.Common.closeCanvas()}},closeCanvas:function(){nf.Common.showLogoutLink();if(nf.Common.isDefinedAndNotNull(nf.Canvas)){if($("#splash").is(":visible")){nf.Canvas.hideSplash()}nf.ContextMenu.hide();nf.Canvas.stopRevisionPolling();nf.Canvas.stopStatusPolling()}},showLogoutLink:function(){if(nf.Storage.getItem("jwt")===null){$("#user-logout-container").css("display","none")}else{$("#user-logout-container").css("display","block")}},isContentViewConfigured:function(){var b=$("#nifi-content-viewer-url").text();return !nf.Common.isBlank(b)},populateField:function(c,b){if(nf.Common.isUndefined(b)||nf.Common.isNull(b)){return $("#"+c).addClass("unset").text("No value set")}else{if(b===""){return $("#"+c).addClass("blank").text("Empty string set")}else{return $("#"+c).text(b)}}},clearField:function(b){return $("#"+b).removeClass("unset blank").text("")},cleanUpTooltips:function(b,c){b.find(c).each(function(){var e=$(this);if(e.data("qtip")){var d=e.qtip("api");d.destroy(true)}})},formatPropertyTooltip:function(b,c){var d=[];if(nf.Common.isDefinedAndNotNull(b)){if(!nf.Common.isBlank(b.description)){d.push(nf.Common.escapeHtml(b.description))}if(!nf.Common.isBlank(b.defaultValue)){d.push("<b>Default value:</b> "+nf.Common.escapeHtml(b.defaultValue))}if(!nf.Common.isBlank(b.supportsEl)){d.push("<b>Supports expression language:</b> "+nf.Common.escapeHtml(b.supportsEl))}}if(nf.Common.isDefinedAndNotNull(c)){if(!nf.Common.isEmpty(c.previousValues)){var e=[];$.each(c.previousValues,function(g,f){e.push("<li>"+nf.Common.escapeHtml(f.previousValue)+" - "+nf.Common.escapeHtml(f.timestamp)+" ("+nf.Common.escapeHtml(f.userName)+")</li>")});d.push('<b>History:</b><ul class="property-info">'+e.join("")+"</ul>")}}if(d.length>0){return d.join("<br/><br/>")}else{return null}},formatProperty:function(b,c){return'<div><span class="label">'+nf.Common.formatValue(b)+": </span>"+nf.Common.formatValue(c)+"</div>"},formatValue:function(b){if(nf.Common.isDefinedAndNotNull(b)){if(b===""){return'<span class="blank">Empty string set</span>'}else{return nf.Common.escapeHtml(b)}}else{return'<span class="unset">No value set</span>'}},escapeHtml:(function(){var b={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2f;"};return function(c){if(nf.Common.isDefinedAndNotNull(c)){return String(c).replace(/[&<>"'\/]/g,function(d){return b[d]})}else{return""}}}()),isSensitiveProperty:function(b){if(nf.Common.isDefinedAndNotNull(b)){return b.sensitive===true}else{return false}},isRequiredProperty:function(b){if(nf.Common.isDefinedAndNotNull(b)){return b.required===true}else{return false}},isDynamicProperty:function(b){if(nf.Common.isDefinedAndNotNull(b)){return b.dynamic===true}else{return false}},getAllowableValues:function(b){if(nf.Common.isDefinedAndNotNull(b)){return b.allowableValues}else{return null}},supportsEl:function(b){if(nf.Common.isDefinedAndNotNull(b)){return b.supportsEl===true}else{return false}},post:function(b,e){var d=window.onbeforeunload;window.onbeforeunload=null;var c=$("<form></form>").attr({method:"POST",action:b,style:"display: none;"});if(nf.Common.isDefinedAndNotNull(e)){$.each(e,function(f,g){$("<textarea></textarea>").attr("name",f).val(g).appendTo(c)})}c.appendTo("body").submit().remove();if(d!==null){window.onbeforeunload=d}},formatUnorderedList:function(c){if($.isArray(c)){var b=$('<ul class="result"></ul>');$.each(c,function(e,f){var d=$("<li></li>").appendTo(b);if(f instanceof jQuery){d.append(f)}else{d.text(f)}});return b}else{return null}},substringAfterLast:function(f,e){var c="";var d=f.lastIndexOf(e);if(d>=0){var b=d+e.length;if(b<f.length){c=f.substr(b)}}return c},setCursor:function(c,b){if(b){$("#"+c).addClass("pointer")}else{$("#"+c).removeClass("pointer")}},getAccessToken:function(b){return $.Deferred(function(c){if(nf.Storage.hasItem("jwt")){$.ajax({type:"POST",url:b}).done(function(d){c.resolve(d)}).fail(function(){c.reject()})}else{c.resolve("")}}).promise()},MILLIS_PER_DAY:86400000,MILLIS_PER_HOUR:3600000,MILLIS_PER_MINUTE:60000,MILLIS_PER_SECOND:1000,formatDuration:function(e){e=e<1?0:e;var g=e/nf.Common.MILLIS_PER_DAY;g=g>=1?parseInt(g,10):0;e%=nf.Common.MILLIS_PER_DAY;var b=e/nf.Common.MILLIS_PER_HOUR;b=b>=1?parseInt(b,10):0;e%=nf.Common.MILLIS_PER_HOUR;var c=e/nf.Common.MILLIS_PER_MINUTE;c=c>=1?parseInt(c,10):0;e%=nf.Common.MILLIS_PER_MINUTE;var f=e/nf.Common.MILLIS_PER_SECOND;f=f>=1?parseInt(f,10):0;e=Math.floor(e%nf.Common.MILLIS_PER_SECOND);var d=nf.Common.pad(b,2,"0")+":"+nf.Common.pad(c,2,"0")+":"+nf.Common.pad(f,2,"0")+"."+nf.Common.pad(e,3,"0");if(g>0){return g+" days and "+d}else{return d}},BYTES_IN_KILOBYTE:1024,BYTES_IN_MEGABYTE:1048576,BYTES_IN_GIGABYTE:1073741824,BYTES_IN_TERABYTE:1099511627776,formatDataSize:function(c){var b=parseFloat(c/nf.Common.BYTES_IN_TERABYTE);if(b>1){return b.toFixed(2)+" TB"}b=parseFloat(c/nf.Common.BYTES_IN_GIGABYTE);if(b>1){return b.toFixed(2)+" GB"}b=parseFloat(c/nf.Common.BYTES_IN_MEGABYTE);if(b>1){return b.toFixed(2)+" MB"}b=parseFloat(c/nf.Common.BYTES_IN_KILOBYTE);if(b>1){return b.toFixed(2)+" KB"}return parseFloat(c).toFixed(2)+" bytes"},formatInteger:function(c){var b=c+"";var d=/(\d+)(\d{3})/;while(d.test(b)){b=b.replace(d,"$1,$2")}return b},formatFloat:function(b){if(nf.Common.isUndefinedOrNull(b)){return 0+""}return b.toFixed(2)+""},pad:function(e,c,d){var b=e+"";while(b.length<c){b=d+b}return b},formatDateTime:function(b){return nf.Common.pad(b.getMonth()+1,2,"0")+"/"+nf.Common.pad(b.getDate(),2,"0")+"/"+nf.Common.pad(b.getFullYear(),2,"0")+" "+nf.Common.pad(b.getHours(),2,"0")+":"+nf.Common.pad(b.getMinutes(),2,"0")+":"+nf.Common.pad(b.getSeconds(),2,"0")+"."+nf.Common.pad(b.getMilliseconds(),3,"0")},parseDateTime:function(b){if(!nf.Common.isDefinedAndNotNull(b)){return new Date()}if(b==="No value set"){return new Date()}if(b==="Empty string set"){return new Date()}var d=b.split(/ /);if(d.length!==3){return new Date()}var c=d[0].split(/\//);var e=d[1].split(/:/);if(c.length!==3||e.length!==3){return new Date()}var f=e[2].split(/\./);if(f.length===2){return new Date(parseInt(c[2],10),parseInt(c[0],10),parseInt(c[1],10),parseInt(e[0],10),parseInt(e[1],10),parseInt(f[0],10),parseInt(f[1],10))}else{return new Date(parseInt(c[2],10),parseInt(c[0],10),parseInt(c[1],10),parseInt(e[0],10),parseInt(e[1],10),parseInt(e[2],10),0)}},parseDuration:function(b){var c=b.split(/:/);if(c.length!==3){return 0}var d=c[2].split(/\./);if(d.length===2){return new Date(1970,0,1,parseInt(c[0],10),parseInt(c[1],10),parseInt(d[0],10),parseInt(d[1],10)).getTime()}else{return new Date(1970,0,1,parseInt(c[0],10),parseInt(c[1],10),parseInt(c[2],10),0).getTime()}},parseSize:function(d){var e=d.split(/ /);var c=parseFloat(e[0].replace(/,/g,""));var b=e[1];if(b==="KB"){return c*1024}else{if(b==="MB"){return c*1024*1024}else{if(b==="GB"){return c*1024*1024*1024}else{if(b==="TB"){return c*1024*1024*1024*1024}else{return c}}}}},parseCount:function(d){var c=d.split(/ /,1);if(c.length!==1){return 0}var b=parseInt(c[0].replace(/,/g,""),10);if(isNaN(b)){return 0}return b},isDefinedAndNotNull:function(b){return !nf.Common.isUndefined(b)&&!nf.Common.isNull(b)},isUndefinedOrNull:function(b){return nf.Common.isUndefined(b)||nf.Common.isNull(b)},isUndefined:function(b){return typeof b==="undefined"},isBlank:function(b){return nf.Common.isUndefined(b)||nf.Common.isNull(b)||$.trim(b)===""},isNull:function(b){return b===null},isEmpty:function(b){return $.isArray(b)?b.length===0:true},doBulletinsDiffer:function(c,d){if($.isArray(c)&&$.isArray(d)){if(c.length===d.length){for(var b=0;b<c.length;b++){if(c[b].id!==d[b].id){return true}}}else{return true}}else{if($.isArray(c)||$.isArray(d)){return true}}return false},getFormattedBulletins:function(c){var b=[];$.each(c,function(e,d){var h="";if(nf.Common.isDefinedAndNotNull(d.nodeAddress)){h="-&nbsp"+nf.Common.escapeHtml(d.nodeAddress)+"&nbsp;-&nbsp;"}var g=$("<pre></pre>").css({"white-space":"pre-wrap"}).text(d.message);var f=$("<div>"+nf.Common.escapeHtml(d.timestamp)+"&nbsp;"+h+"&nbsp;<b>"+nf.Common.escapeHtml(d.level)+"</b>&nbsp;</div>").append(g);b.push(f)});return b}}}());
$(document).ready(function(a){a(window).on("keydown",function(b){var g=b.ctrlKey||b.metaKey;if(!g&&b.keyCode===27){var e=a("div.value-combo");if(e.is(":visible")&&e.parent().hasClass("combo-editor")){return}if(a("div.property-detail").is(":visible")){nf.UniversalCapture.removeAllPropertyDetailDialogs();b.stopImmediatePropagation();b.preventDefault()}else{var f=a(b.target);if(f.length){var h=a(".cancellable");if(h.length){var c=null;var d=null;a.each(h,function(i,k){var j=a(k);var l=j.css("zIndex");if(j.is(":visible")&&(l!==null&&typeof l!=="undefined")){l=parseInt(l,10);if(c===null||l>c){c=l;d=j}}});if(d!==null){if(d.hasClass("modal")){d.modal("hide")}else{d.hide()}b.stopImmediatePropagation();b.preventDefault();return}}if(top!==window){if(typeof parent.nf!=="undefined"&&typeof parent.nf.Shell!=="undefined"){parent.$("#shell-close-button").click();b.stopImmediatePropagation();b.preventDefault();return}}}}}else{if(g){if(b.keyCode===82){b.preventDefault()}}else{if(!a("input, textarea").is(":focus")&&(b.keyCode==8||b.keyCode===46)){b.preventDefault()}}}})});nf.UniversalCapture=(function(){return{removeAllPropertyDetailDialogs:function(){var a=$("body").find("div.property-detail");a.find("div.nfel-editor").nfeditor("destroy");a.find("div.value-combo").combo("destroy");a.hide().remove()}}}());
nf.CanvasUtils=(function(){var b={storage:{namePrefix:"nifi-view-"},urls:{controller:"../nifi-api/controller"}};var c=2*Math.PI;var d=function(i,g){var f=0;var j=i-1;var h;var e=0;while(f<=j){h=~~((f+j)/2);e=g(h);if(e<0){j=h-1}else{if(e>0){f=h+1}else{break}}}return h};var a=function(f,e){return $.Deferred(function(g){nf.CanvasUtils.eligibleForMove(f,e).done(function(){var h=nf.Snippet.marshal(f,true);nf.Snippet.create(h).done(function(i){var j=i.snippet;nf.Snippet.move(j.id,e).done(function(){var l=d3.map();var k=function(m,n){if(!l.has(m)){l.set(m,[])}l.get(m).push(n)};f.each(function(m){k(m.type,m.component.id)});l.forEach(function(n,m){nf[n].remove(m)});nf.Birdseye.refresh();g.resolve()}).fail(nf.Common.handleAjaxError).fail(function(){g.reject()}).always(function(){nf.Snippet.unlink(j.id).done(function(){nf.Snippet.remove(j.id)})})}).fail(nf.Common.handleAjaxError).fail(function(){g.reject()})}).fail(function(){g.reject()})}).promise()};return{config:{systemTooltipConfig:{style:{classes:"nifi-tooltip"},show:{solo:true,effect:false},hide:{effect:false},position:{at:"bottom right",my:"top left",adjust:{method:"flipinvert flipinvert"}}}},getPerimeterPoint:function(e,n){var f=Math.atan2(n.height,n.width);var k=n.width/2;var j=n.height/2;var i=n.x+k;var g=n.y+j;var o=e.x-i;var m=e.y-g;var h=Math.atan2(m,o);h=h%c;if(h<0){h+=c}var l=(Math.PI/2)-h;if((h>=0&&h<f)||(h>=(c-f)&&h<c)){return{x:n.x+n.width,y:g+Math.tan(h)*k}}else{if(h>=f&&h<(Math.PI-f)){return{x:i+Math.tan(l)*j,y:n.y+n.height}}else{if(h>=(Math.PI-f)&&h<(Math.PI+f)){return{x:n.x,y:g-Math.tan(h)*k}}else{return{x:i-Math.tan(l)*j,y:n.y}}}}},showComponent:function(f,e){if(nf.Common.isDefinedAndNotNull(f)){var g=$.Deferred(function(h){if(f!==nf.Canvas.getGroupId()){nf.Canvas.setGroupId(f);nf.Canvas.reload().done(function(){h.resolve()}).fail(function(){nf.Dialog.showOkDialog({dialogContent:"Unable to load the group for the specified component.",overlayBackground:false});h.reject()})}else{h.resolve()}}).promise();g.done(function(){var h=d3.select("#id-"+e);if(!h.empty()){nf.Actions.show(h)}else{nf.Dialog.showOkDialog({dialogContent:"Unable to find the specified component.",overlayBackground:false})}})}},getSelection:function(){return d3.selectAll("g.component.selected, g.connection.selected")},centerBoundingBox:function(f){var h=nf.Canvas.View.scale();var j=$("#canvas-container");var g=j.width()/h;var i=j.height()/h;var e=[(g/2)-(f.width/2),(i/2)-(f.height/2)];nf.Canvas.View.translate([(e[0]-f.x)*h,(e[1]-f.y)*h])},position:function(e){if(e.empty()){return}e.attr("transform",function(f){return"translate("+f.component.position.x+", "+f.component.position.y+")"})},ellipsis:function(g,j){var f=parseInt(g.attr("width"),10);var h=g.node();g.text(j);if(j.length>0&&h.getSubStringLength(0,j.length-1)>f){f-=5;var e=d(j.length,function(i){var k=h.getSubStringLength(0,i);if(k>f){return -1}else{if(k<f){return 1}}return 0});g.text(j.substring(0,e)+String.fromCharCode(8230))}},multilineEllipsis:function(m,p,o){var g=1;var h=o.split(/\s+/).reverse();var l=parseInt(m.attr("x"),10);var k=parseInt(m.attr("y"),10);var f=parseInt(m.attr("width"),10);var q=[];var j=m.append("tspan").attr({x:l,y:k,width:f});var e=h.pop();while(nf.Common.isDefinedAndNotNull(e)){q.push(e);j.text(q.join(" "));if(j.node().getComputedTextLength()>f){q.pop();j.text(q.join(" "));j=m.append("tspan").attr({x:l,dy:"1.2em",width:f});if(++g>=p){var n=[e].concat(h.reverse());nf.CanvasUtils.ellipsis(j,n.join(" "));break}else{j.text(e);q=[e]}}e=h.pop()}},activeThreadCount:function(e,g,h){if(nf.Common.isDefinedAndNotNull(g.status)&&g.status.activeThreadCount>0){var f=e.select("text.active-thread-count").text(function(){return g.status.activeThreadCount}).style("display","block").each(function(){var i=this.getBBox();d3.select(this).attr("x",function(){return g.dimensions.width-i.width-4})});e.select("rect.active-thread-count-background").attr("width",function(){var i=f.node().getBBox();return i.width+8}).attr("x",function(){var i=f.node().getBBox();if(typeof h==="function"){h(i.width+6)}return g.dimensions.width-i.width-8}).attr("stroke-dasharray",function(){var l=d3.select(this);var k=parseFloat(l.attr("width"));var i=parseFloat(l.attr("height"));var j=[];j.push(0);j.push(k+i);j.push(k+i);return j.join(" ")}).style("display","block")}else{e.selectAll("text.active-thread-count, rect.active-thread-count-background").style("display","none")}},disableImageHref:function(e){e.on("click.disableImageHref",function(){if(d3.event.ctrlKey||d3.event.shiftKey){d3.event.preventDefault()}})},bulletins:function(e,h,i,g){g=nf.Common.isDefinedAndNotNull(g)?g:0;var f=d3.select("#bulletin-tip-"+h.component.id);if(!f.empty()){f.remove()}if(nf.Common.isDefinedAndNotNull(h.status)&&!nf.Common.isEmpty(h.status.bulletins)){e.select("image.bulletin-icon").style("display","block").each(function(){var j=this.getBBox();var k=d3.select(this);k.attr("x",function(){return h.dimensions.width-g-j.width-4});f=i().append("div").attr("id",function(){return"bulletin-tip-"+h.component.id}).attr("class","tooltip nifi-tooltip").html(function(){var m=nf.Common.getFormattedBulletins(h.status.bulletins);var l=nf.Common.formatUnorderedList(m);if(l===null||l.length===0){return""}else{return $("<div></div>").append(l).html()}});nf.CanvasUtils.canvasTooltip(f,k)})}else{e.selectAll("image.bulletin-icon").style("display","none")}},canvasTooltip:function(e,f){f.on("mouseenter",function(){e.style("top",(d3.event.pageY+15)+"px").style("left",(d3.event.pageX+15)+"px").style("display","block")}).on("mousemove",function(){e.style("top",(d3.event.pageY+15)+"px").style("left",(d3.event.pageX+15)+"px")}).on("mouseleave",function(){e.style("display","none")})},isColorable:function(g){if(g.empty()){return false}var f=g.filter(function(j){return nf.CanvasUtils.isProcessor(d3.select(this))});var i=g.filter(function(j){return nf.CanvasUtils.isLabel(d3.select(this))});var e=f.size()===g.size();var h=i.size()===g.size();return e||h},isConnection:function(e){return e.classed("connection")},isRemoteProcessGroup:function(e){return e.classed("remote-process-group")},isProcessor:function(e){return e.classed("processor")},isLabel:function(e){return e.classed("label")},isInputPort:function(e){return e.classed("input-port")},isOutputPort:function(e){return e.classed("output-port")},isProcessGroup:function(e){return e.classed("process-group")},isFunnel:function(e){return e.classed("funnel")},areRunnable:function(e){if(e.empty()){return false}var f=true;e.each(function(){if(!nf.CanvasUtils.isRunnable(d3.select(this))){f=false;return false}});return f},isRunnable:function(e){var g=false;var f=e.datum();if(nf.CanvasUtils.isProcessor(e)){g=nf.CanvasUtils.supportsModification(e)&&nf.Common.isEmpty(f.component.validationErrors)}else{if(nf.CanvasUtils.isInputPort(e)||nf.CanvasUtils.isOutputPort(e)){g=nf.CanvasUtils.supportsModification(e)}else{if(nf.CanvasUtils.isProcessGroup(e)){g=true}}}return g},areStoppable:function(e){if(e.empty()){return false}var f=true;e.each(function(){if(!nf.CanvasUtils.isStoppable(d3.select(this))){f=false;return false}});return f},isStoppable:function(e){var g=false;var f=e.datum();if(nf.CanvasUtils.isProcessor(e)||nf.CanvasUtils.isInputPort(e)||nf.CanvasUtils.isOutputPort(e)){g=f.component.state==="RUNNING"}else{if(nf.CanvasUtils.isProcessGroup(e)){g=true}}return g},filterEnable:function(e){return e.filter(function(h){var f=d3.select(this);var g=f.datum();return((nf.CanvasUtils.isProcessor(f)||nf.CanvasUtils.isInputPort(f)||nf.CanvasUtils.isOutputPort(f))&&nf.CanvasUtils.supportsModification(f)&&g.component.state==="DISABLED")})},canEnable:function(e){if(e.empty()){return false}return !nf.CanvasUtils.filterEnable(e).empty()},filterDisable:function(e){return e.filter(function(h){var f=d3.select(this);var g=f.datum();return((nf.CanvasUtils.isProcessor(f)||nf.CanvasUtils.isInputPort(f)||nf.CanvasUtils.isOutputPort(f))&&nf.CanvasUtils.supportsModification(f)&&g.component.state==="STOPPED")})},canDisable:function(e){if(e.empty()){return false}return !nf.CanvasUtils.filterDisable(e).empty()},canAllStartTransmitting:function(e){if(e.empty()){return false}var f=true;e.each(function(){if(!nf.CanvasUtils.canStartTransmitting(d3.select(this))){f=false}});return f},canStartTransmitting:function(e){return nf.CanvasUtils.isRemoteProcessGroup(e)},canAllStopTransmitting:function(e){if(e.empty()){return false}var f=true;e.each(function(){if(!nf.CanvasUtils.canStopTransmitting(d3.select(this))){f=false}});return f},canStopTransmitting:function(e){return nf.CanvasUtils.isRemoteProcessGroup(e)},isDeletable:function(e){if(e.empty()){return false}return nf.CanvasUtils.supportsModification(e)},supportsModification:function(l){var j=l.datum();var h=false;if(nf.CanvasUtils.isProcessor(l)||nf.CanvasUtils.isInputPort(l)||nf.CanvasUtils.isOutputPort(l)){if(nf.Common.isDefinedAndNotNull(j.status)){h=!(j.component.state==="RUNNING"||nf.Common.isDefinedAndNotNull(j.status.activeThreadCount)&&j.status.activeThreadCount>0)}else{h=j.component.state!=="RUNNING"}}else{if(nf.CanvasUtils.isRemoteProcessGroup(l)){if(nf.Common.isDefinedAndNotNull(j.status)){h=!(j.component.transmitting===true||nf.Common.isDefinedAndNotNull(j.status.activeThreadCount)&&j.status.activeThreadCount>0)}else{h=j.component.transmitting!==true}}else{if(nf.CanvasUtils.isProcessGroup(l)){h=true}else{if(nf.CanvasUtils.isFunnel(l)){h=true}else{if(nf.CanvasUtils.isLabel(l)){h=true}else{if(nf.CanvasUtils.isConnection(l)){var k=false;var f=false;var m=nf.CanvasUtils.getConnectionSourceComponentId(j.component);var e=d3.select("#id-"+m);if(!e.empty()){if(nf.CanvasUtils.isRemoteProcessGroup(e)||nf.CanvasUtils.isProcessGroup(e)){k=true}else{k=nf.CanvasUtils.supportsModification(e)}}var g=nf.CanvasUtils.getConnectionDestinationComponentId(j.component);var i=d3.select("#id-"+g);if(!i.empty()){if(nf.CanvasUtils.isRemoteProcessGroup(i)||nf.CanvasUtils.isProcessGroup(i)){f=true}else{f=nf.CanvasUtils.supportsModification(i)}}h=k&&f}}}}}}return h},getConnectableTypeForSource:function(f){var e;if(nf.CanvasUtils.isProcessor(f)){e="PROCESSOR"}else{if(nf.CanvasUtils.isRemoteProcessGroup(f)){e="REMOTE_OUTPUT_PORT"}else{if(nf.CanvasUtils.isProcessGroup(f)){e="OUTPUT_PORT"}else{if(nf.CanvasUtils.isInputPort(f)){e="INPUT_PORT"}else{if(nf.CanvasUtils.isFunnel(f)){e="FUNNEL"}}}}}return e},getConnectableTypeForDestination:function(f){var e;if(nf.CanvasUtils.isProcessor(f)){e="PROCESSOR"}else{if(nf.CanvasUtils.isRemoteProcessGroup(f)){e="REMOTE_INPUT_PORT"}else{if(nf.CanvasUtils.isProcessGroup(f)){e="INPUT_PORT"}else{if(nf.CanvasUtils.isOutputPort(f)){e="OUTPUT_PORT"}else{if(nf.CanvasUtils.isFunnel(f)){e="FUNNEL"}}}}}return e},isCopyable:function(f){if(f.empty()){return false}var e=f.filter(function(j){var h=d3.select(this);if(nf.CanvasUtils.isConnection(h)){var g=!f.filter(function(k){var l=nf.CanvasUtils.getConnectionSourceComponentId(j.component);return l===k.component.id}).empty();var i=!f.filter(function(k){var l=nf.CanvasUtils.getConnectionDestinationComponentId(j.component);return l===k.component.id}).empty();return g&&i}else{return nf.CanvasUtils.isProcessor(h)||nf.CanvasUtils.isFunnel(h)||nf.CanvasUtils.isLabel(h)||nf.CanvasUtils.isProcessGroup(h)||nf.CanvasUtils.isRemoteProcessGroup(h)||nf.CanvasUtils.isInputPort(h)||nf.CanvasUtils.isOutputPort(h)}});return f.size()===e.size()},isPastable:function(){return nf.Clipboard.isCopied()},persistUserView:function(){var e=b.storage.namePrefix+nf.Canvas.getGroupId();var g=nf.Canvas.View.translate();var f={scale:nf.Canvas.View.scale(),translateX:g[0],translateY:g[1]};nf.Storage.setItem(e,f)},formatConnectionName:function(e){if(!nf.Common.isBlank(e.name)){return e.name}else{if(nf.Common.isDefinedAndNotNull(e.selectedRelationships)){return e.selectedRelationships.join(", ")}}return""},reloadConnectionSourceAndDestination:function(j,i){if(nf.Common.isBlank(j)===false){var h=d3.select("#id-"+j);if(h.empty()===false){var g=h.datum();if(nf.CanvasUtils.isProcessor(h)){nf.Processor.reload(g.component)}else{if(nf.CanvasUtils.isInputPort(h)){nf.Port.reload(g.component)}else{if(nf.CanvasUtils.isRemoteProcessGroup(h)){nf.RemoteProcessGroup.reload(g.component)}}}}}if(nf.Common.isBlank(i)===false){var e=d3.select("#id-"+i);if(e.empty()===false){var f=e.datum();if(nf.CanvasUtils.isProcessor(e)){nf.Processor.reload(f.component)}else{if(nf.CanvasUtils.isRemoteProcessGroup(e)){nf.RemoteProcessGroup.reload(f.component)}}}}},getConnectionSourceComponentId:function(e){var f=e.source.id;if(e.source.groupId!==nf.Canvas.getGroupId()){f=e.source.groupId}return f},getConnectionDestinationComponentId:function(e){var f=e.destination.id;if(e.destination.groupId!==nf.Canvas.getGroupId()){f=e.destination.groupId}return f},restoreUserView:function(){var h=false;try{var f=b.storage.namePrefix+nf.Canvas.getGroupId();var g=nf.Storage.getItem(f);if(nf.Common.isDefinedAndNotNull(g)){if(isFinite(g.scale)&&isFinite(g.translateX)&&isFinite(g.translateY)){nf.Canvas.View.translate([g.translateX,g.translateY]);nf.Canvas.View.scale(g.scale);nf.Canvas.View.refresh({transition:true});h=true}}}catch(i){}return h},enterGroup:function(e){nf.Canvas.setGroupId(e);nf.Graph.removeAll();return nf.Canvas.reload().done(function(){var f=nf.CanvasUtils.restoreUserView();if(f===false){nf.Canvas.View.fit();nf.Canvas.View.refresh({transition:true})}}).fail(function(){nf.Dialog.showOkDialog({dialogContent:"Unable to enter the selected group.",overlayBackground:false})})},getOrigin:function(f){var e={};f.each(function(h){var g=d3.select(this);if(!nf.CanvasUtils.isConnection(g)){if(nf.Common.isUndefined(e.x)||h.component.position.x<e.x){e.x=h.component.position.x}if(nf.Common.isUndefined(e.y)||h.component.position.y<e.y){e.y=h.component.position.y}}});return e},moveComponentsToParent:function(f){var e=nf.Canvas.getParentGroupId();if(e===null){nf.Dialog.showOkDialog("Components are already in the topmost group.")}else{a(f,e)}},moveComponents:function(f,g){var e=g.datum();a(f,e.component.id).done(function(){nf.ProcessGroup.reload(e.component)})},trimDanglingEdges:function(e){var f=function(g){var k=nf.CanvasUtils.getConnectionSourceComponentId(g);var j=nf.CanvasUtils.getConnectionDestinationComponentId(g);var i=false;var h=false;e.each(function(l){if(l.component.id===k){i=true}if(l.component.id===j){h=true}});return i&&h};return e.filter(function(g){if(g.type==="Connection"){return f(g.component)}else{return true}})},isDisconnected:function(g){var f=d3.map();var h=d3.map();var e=true;g.filter(function(i){return i.type==="Connection"}).each(function(i){f.set(i.component.id,i.component)});g.filter(function(i){return i.type!=="Connection"}).each(function(i){h.set(i.component.id,i.component);$.each(nf.Connection.getComponentConnections(i.component.id),function(k,j){if(!f.has(j.id)){e=false;return false}})});if(e){f.forEach(function(j,i){if(e){e=h.has(nf.CanvasUtils.getConnectionSourceComponentId(i))&&h.has(nf.CanvasUtils.getConnectionDestinationComponentId(i))}})}return e},eligibleForMove:function(h,g){var e=[];var f=[];h.each(function(j){var i=d3.select(this);if(nf.CanvasUtils.isInputPort(i)){e.push(i.datum())}else{if(nf.CanvasUtils.isOutputPort(i)){f.push(i.datum())}}});return $.Deferred(function(i){if(e.length>0||f.length>0){var k=function(){return $.Deferred(function(l){if(nf.Canvas.getParentGroupId()===null){nf.Dialog.showOkDialog({dialogContent:"Cannot move Ports out of the root group",overlayBackground:false});l.reject()}else{$.ajax({type:"GET",url:b.urls.controller+"/process-groups/"+encodeURIComponent(nf.Canvas.getParentGroupId())+"/connections",dataType:"json"}).done(function(m){var o=m.connections;var n=[];if(!nf.Common.isEmpty(o)){$.each(e,function(q,p){$.each(o,function(s,r){if(p.component.id===r.destination.id){n.push(nf.Common.escapeHtml(p.component.name))}})});$.each(f,function(p,q){$.each(o,function(s,r){if(q.component.id===r.source.id){n.push(nf.Common.escapeHtml(q.component.name))}})})}if(n.length>0){nf.Dialog.showOkDialog({dialogContent:"The following ports are currently connected outside of this group: <b>"+n.join("</b>, <b>")+"</b>",overlayBackground:false});l.reject()}else{l.resolve()}}).fail(function(){l.reject()})}}).promise()};var j=function(){return $.Deferred(function(l){$.ajax({type:"GET",url:b.urls.controller+"/process-groups/"+encodeURIComponent(g),data:{verbose:true},dataType:"json"}).done(function(n){var p=n.processGroup;var q=p.contents;var o=[];var m=function(r,s){if(r.length>0&&!nf.Common.isEmpty(s)){$.each(r,function(u,t){$.each(s,function(w,v){if(t.component.name===v.name){o.push(nf.Common.escapeHtml(v.name))}})})}};m(e,q.inputPorts);m(f,q.outputPorts);if(o.length>0){nf.Dialog.showOkDialog({dialogContent:"The following ports already exist in the target process group: <b>"+o.join("</b>, <b>")+"</b>",overlayBackground:false});l.reject()}else{l.resolve()}}).fail(function(){l.reject()})}).promise()};k().done(function(){if(nf.Common.isDefinedAndNotNull(g)){$.when(j()).done(function(){i.resolve()}).fail(function(){i.reject()})}else{i.resolve()}}).fail(function(){i.reject()})}else{i.resolve()}}).promise()},isValidConnectionSource:function(e){if(e.size()!==1){return false}return nf.CanvasUtils.isProcessor(e)||nf.CanvasUtils.isProcessGroup(e)||nf.CanvasUtils.isRemoteProcessGroup(e)||nf.CanvasUtils.isInputPort(e)||nf.CanvasUtils.isFunnel(e)},isValidConnectionDestination:function(f){if(f.size()!==1){return false}if(nf.CanvasUtils.isProcessGroup(f)||nf.CanvasUtils.isRemoteProcessGroup(f)||nf.CanvasUtils.isOutputPort(f)||nf.CanvasUtils.isFunnel(f)){return true}if(nf.CanvasUtils.isProcessor(f)){var e=f.datum();return e.component.inputRequirement!=="INPUT_FORBIDDEN"}}}}());
$(document).ready(function(){nf.Common.addHoverEffect("div.button","button-normal","button-over");$("#nf-ok-dialog").modal({handler:{close:function(){$("#nf-ok-dialog-content").empty()}}}).draggable({containment:"parent",handle:".dialog-header"});$("#nf-yes-no-dialog").modal({handler:{close:function(){$("#nf-yes-no-dialog-content").empty();$("#nf-yes-no-dialog").modal("setButtonModel",[])}}}).draggable({containment:"parent",handle:".dialog-header"})});nf.Dialog=(function(){return{showOkDialog:function(a){a=$.extend({headerText:"",dialogContent:"",overlayBackground:true},a);var b=$("<p></p>").append(a.dialogContent);$("#nf-ok-dialog-content").append(b);$("#nf-ok-dialog").modal("setButtonModel",[{buttonText:"Ok",handler:{click:function(){$("#nf-ok-dialog").modal("hide");if(typeof a.okHandler==="function"){a.okHandler.call(this)}}}}]);$("#nf-ok-dialog").modal("setHeaderText",a.headerText).modal("setOverlayBackground",a.overlayBackground).modal("show")},showYesNoDialog:function(a){a=$.extend({headerText:"",dialogContent:"",overlayBackgrond:true,yesText:"Yes",noText:"No"},a);var b=$("<p></p>").append(a.dialogContent);$("#nf-yes-no-dialog-content").append(b);$("#nf-yes-no-dialog").modal("setButtonModel",[{buttonText:a.yesText,handler:{click:function(){$("#nf-yes-no-dialog").modal("hide");if(typeof a.yesHandler==="function"){a.yesHandler.call(this)}}}},{buttonText:a.noText,handler:{click:function(){$("#nf-yes-no-dialog").modal("hide");if(typeof a.noHandler==="function"){a.noHandler.call(this)}}}}]);$("#nf-yes-no-dialog").modal("setHeaderText",a.headerText).modal("setOverlayBackground",a.overlayBackground).modal("show")}}}());
$(document).ready(function(){$("#shell-dialog").modal({overlayBackground:true});$("#shell-close-button").click(function(){$("#shell-dialog").modal("hide")});$("#shell-undock-button").click(function(){var a=$("#shell-iframe").attr("src");if(!nf.Common.isBlank(a)){window.open(a);$("#shell-dialog").modal("hide")}});nf.Common.addHoverEffect("#shell-undock-button","undock-normal","undock-hover");nf.Common.addHoverEffect("#shell-close-button","close-normal","close-hover")});nf.Shell=(function(){return{showPage:function(a,b){if(nf.Common.isDefinedAndNotNull(nf.ContextMenu)){nf.ContextMenu.hide()}return $.Deferred(function(c){var d=$("#shell");if(nf.Common.isNull(b)||nf.Common.isUndefined(b)){b=true}d.empty();$("#shell-dialog").modal("setHandler",{close:function(){c.resolve()}});$("#shell-dialog").modal("show");if(b){$("#shell-undock-button").show()}else{$("#shell-undock-button").hide()}var e=$("<iframe/>",{id:"shell-iframe",frameBorder:"0",src:a}).css({width:d.width(),height:d.height()}).appendTo(d);$(window).resize(function(){e.css({width:d.width(),height:d.height()})})}).promise()},showContent:function(a){if(nf.Common.isDefinedAndNotNull(nf.ContextMenu)){nf.ContextMenu.hide()}return $.Deferred(function(b){var f=$(a);if(f.length){var c=$("#shell");c.empty();var e=f.parent();f.detach();$("#shell-dialog").modal("setHandler",{close:function(){b.resolve();f.hide().detach().appendTo(e)}});$("#shell-undock-button").hide();var d=$("<div>").css({width:c.width(),height:c.height()}).append(f).appendTo(c);$("#shell-dialog").modal("show");f.show();$(window).resize(function(){d.css({width:c.width(),height:c.height()})})}}).promise()}}}());
nf.Storage=(function(){var g=86400000;var f=g*2;var b=function(h){return typeof h==="undefined"};var e=function(h){return h===null};var d=function(h){return !b(h)&&!e(h)};var c=function(j){if(d(j.expires)){var h=new Date(j.expires);var i=new Date();return h.valueOf()<i.valueOf()}else{return false}};var a=function(h){try{var i=JSON.parse(localStorage.getItem(h));if(d(i)){return i}else{return null}}catch(j){return null}};return{init:function(){for(var j=0;j<localStorage.length;j++){try{var h=localStorage.key(j);nf.Storage.getItem(h)}catch(k){}}},setItem:function(i,k,h){h=d(h)?h:new Date().valueOf()+f;var j={expires:h,item:k};localStorage.setItem(i,JSON.stringify(j))},hasItem:function(h){return a(h)!==null},getItem:function(h){var i=a(h);if(i===null){return null}if(c(i)){nf.Storage.removeItem(h);return null}if(d(i.item)){return i.item}else{return null}},getItemExpiration:function(h){var i=a(h);if(i===null){return null}if(d(i.expires)){return i.expires}else{return null}},removeItem:function(h){localStorage.removeItem(h)}}}());
$(document).ready(function(a){a.ajaxSetup({beforeSend:function(d){var b=nf.Storage.hasItem("jwt");var c=nf.Storage.getItem("jwt");if(c!==null){d.setRequestHeader("Authorization","Bearer "+c)}else{if(b===true){return false}}}})});
nf.Snippet=(function(){var a={urls:{snippets:"../nifi-api/controller/snippets",processGroups:"../nifi-api/controller/process-groups"}};return{marshal:function(b,d){var c={parentGroupId:nf.Canvas.getGroupId(),linked:nf.Common.isDefinedAndNotNull(d)?d:false,processorIds:[],funnelIds:[],inputPortIds:[],outputPortIds:[],remoteProcessGroupIds:[],processGroupIds:[],connectionIds:[],labelIds:[]};b.each(function(f){var e=d3.select(this);if(nf.CanvasUtils.isProcessor(e)){c.processorIds.push(f.component.id)}else{if(nf.CanvasUtils.isFunnel(e)){c.funnelIds.push(f.component.id)}else{if(nf.CanvasUtils.isLabel(e)){c.labelIds.push(f.component.id)}else{if(nf.CanvasUtils.isInputPort(e)){c.inputPortIds.push(f.component.id)}else{if(nf.CanvasUtils.isOutputPort(e)){c.outputPortIds.push(f.component.id)}else{if(nf.CanvasUtils.isProcessGroup(e)){c.processGroupIds.push(f.component.id)}else{if(nf.CanvasUtils.isRemoteProcessGroup(e)){c.remoteProcessGroupIds.push(f.component.id)}else{if(nf.CanvasUtils.isConnection(e)){c.connectionIds.push(f.component.id)}}}}}}}}});return c},create:function(c){var b=nf.Client.getRevision();return $.ajax({type:"POST",url:a.urls.snippets,data:$.extend({version:b.version,clientId:b.clientId},c),dataType:"json"}).done(function(d){nf.Client.setRevision(d.revision)})},copy:function(e,d,b){var c=nf.Client.getRevision();return $.ajax({type:"POST",url:a.urls.processGroups+"/"+encodeURIComponent(d)+"/snippet-instance",data:{version:c.version,clientId:c.clientId,snippetId:e,originX:b.x,originY:b.y},dataType:"json"}).done(function(f){nf.Client.setRevision(f.revision)})},remove:function(c){var b=nf.Client.getRevision();return $.ajax({type:"DELETE",url:a.urls.snippets+"/"+encodeURIComponent(c)+"?"+$.param({version:b.version,clientId:b.clientId})}).done(function(d){nf.Client.setRevision(d.revision)})},move:function(c,d){var b=nf.Client.getRevision();return $.ajax({type:"PUT",url:a.urls.snippets+"/"+encodeURIComponent(c),data:{version:b.version,clientId:b.clientId,parentGroupId:d},dataType:"json"}).done(function(e){nf.Client.setRevision(e.revision)})},unlink:function(c){var b=nf.Client.getRevision();return $.ajax({type:"PUT",url:a.urls.snippets+"/"+encodeURIComponent(c),data:{version:b.version,clientId:b.clientId,linked:false},dataType:"json"}).done(function(d){nf.Client.setRevision(d.revision)})},link:function(c){var b=nf.Client.getRevision();return $.ajax({type:"PUT",url:a.urls.snippets+"/"+encodeURIComponent(c),data:{version:b.version,clientId:b.clientId,linked:true},dataType:"json"}).done(function(d){nf.Client.setRevision(d.revision)})}}}());
nf.CanvasToolbox=(function(){var s={filterText:"Filter",type:{processor:"Processor",inputPort:"Input Port",outputPort:"Output Port",processGroup:"Process Group",remoteProcessGroup:"Remote Process Group",connection:"Connection",funnel:"Funnel",template:"Template",label:"Label"},styles:{filterList:"filter-list"},urls:{controller:"../nifi-api/controller",processorTypes:"../nifi-api/controller/processor-types",templates:"../nifi-api/controller/templates"}};var d=function(B,C,y,x,w,A){var z=B+"-icon";$("<div/>").attr("id",z).attr("title",B).addClass(y).addClass("pointer").addClass("toolbox-icon").hover(function(){$(this).removeClass(y).addClass(x)},function(){$(this).removeClass(x).addClass(y)}).draggable({zIndex:1011,helper:function(){return $('<div class="toolbox-icon"></div>').addClass(w).appendTo("body")},containment:"body",start:function(E,D){nf.ContextMenu.hide()},stop:function(H,G){var J=nf.Canvas.View.translate();var I=nf.Canvas.View.scale();var F=H.originalEvent.pageX;var E=H.originalEvent.pageY-nf.Canvas.CANVAS_OFFSET;if(F>=0&&E>=0){var D=(F/I)-(J[0]/I);var K=(E/I)-(J[1]/I);A({x:D,y:K})}}}).appendTo(C)};var v=function(){var w=$("#processor-types-table").data("gridInstance");if(nf.Common.isDefinedAndNotNull(w)){var x=w.getData();x.setFilterArgs({searchString:q()});x.refresh();if(x.getLength()>0){w.setSelectedRows([0])}}};var u=function(y,x){if(x.searchString===""){return true}try{var B=new RegExp(x.searchString,"i")}catch(A){return false}var z=y.label.search(B)>=0;var w=y.tags.search(B)>=0;return z||w};var h=function(B,y){var x=u(B,y);var w=true;if(x){var z=$("#processor-tag-cloud").tagcloud("getSelectedTags");var A=z.length>0;if(A){w=i(z,B.tags)}}var C=x&&w;if(C===false&&$("#selected-processor-type").text()===B.type){$("#processor-type-description").text("");$("#processor-type-name").text("");$("#selected-processor-name").text("");$("#selected-processor-type").text("");var D=$("#processor-types-table").data("gridInstance");D.resetActiveCell()}return C};var i=function(y,w){var x=[];$.each(y,function(B,C){x.push(C)});var z=w.toLowerCase();var A=true;$.each(x,function(B,C){if(z.indexOf(C)===-1){A=false;return false}});return A};var r=function(w,y){var x=function(B,z){var A=nf.Common.isDefinedAndNotNull(B[w.columnId])?B[w.columnId]:"";var C=nf.Common.isDefinedAndNotNull(z[w.columnId])?z[w.columnId]:"";return A===C?0:A>C?1:-1};y.sort(x,w.sortAsc)};var q=function(){var x="";var w=$("#processor-type-filter");if(!w.hasClass(s.styles.filterList)){x=w.val()}return x};var f=function(){$("#processor-tag-cloud").tagcloud("clearSelectedTags");$("#processor-type-filter").addClass(s.styles.filterList).val(s.filterText);v();$("#processor-type-description").text("");$("#processor-type-name").text("");$("#selected-processor-name").text("");$("#selected-processor-type").text("");var w=$("#processor-types-table").data("gridInstance");w.setSelectedRows([]);w.resetActiveCell()};var k=function(z){var y=function(){var A=$("#selected-processor-name").text();var B=$("#selected-processor-type").text();if(A===""||B===""){nf.Dialog.showOkDialog({dialogContent:"The type of processor to create must be selected.",overlayBackground:false})}else{g(A,B,z)}$("#new-processor-dialog").modal("hide")};var x=$("#processor-types-table").data("gridInstance");var w=function(B,A){var C=x.getDataItem(A.row);$("#selected-processor-name").text(C.label);$("#selected-processor-type").text(C.type);y()};x.onDblClick.subscribe(w);$("#new-processor-dialog").modal("setButtonModel",[{buttonText:"Add",handler:{click:y}},{buttonText:"Cancel",handler:{click:function(){$("#new-processor-dialog").modal("hide")}}}]);$("#new-processor-dialog").modal("setHandler",{close:function(){x.onDblClick.unsubscribe(w);f()}});$("#new-processor-dialog").modal("show");$("#processor-type-filter").focus().off("keyup").on("keyup",function(B){var A=B.keyCode?B.keyCode:B.which;if(A===$.ui.keyCode.ENTER){y()}else{v()}});x.resizeCanvas();x.setSelectedRows([0])};var g=function(x,z,y){var w=nf.Client.getRevision();$.ajax({type:"POST",url:s.urls.controller+"/process-groups/"+encodeURIComponent(nf.Canvas.getGroupId())+"/processors",data:{version:w.version,clientId:w.clientId,name:x,type:z,x:y.x,y:y.y},dataType:"json"}).done(function(A){if(nf.Common.isDefinedAndNotNull(A.processor)){nf.Client.setRevision(A.revision);nf.Graph.add({processors:[A.processor]},true);nf.Canvas.View.updateVisibility();nf.Birdseye.refresh()}}).fail(nf.Common.handleAjaxError)};var b=function(x){var w=function(){var y=$("#new-port-name").val();$("#new-port-dialog").modal("hide");m(y,x)};$("#new-port-dialog").modal("setButtonModel",[{buttonText:"Add",handler:{click:w}},{buttonText:"Cancel",handler:{click:function(){$("#new-port-dialog").modal("hide")}}}]);$("#new-port-type").text("Input");$("#new-port-dialog").modal("show");$("#new-port-name").focus().off("keyup").on("keyup",function(z){var y=z.keyCode?z.keyCode:z.which;if(y===$.ui.keyCode.ENTER){w()}})};var m=function(y,x){var w=nf.Client.getRevision();$.ajax({type:"POST",url:s.urls.controller+"/process-groups/"+encodeURIComponent(nf.Canvas.getGroupId())+"/input-ports",data:{version:w.version,clientId:w.clientId,name:y,x:x.x,y:x.y},dataType:"json"}).done(function(z){if(nf.Common.isDefinedAndNotNull(z.inputPort)){nf.Client.setRevision(z.revision);nf.Graph.add({inputPorts:[z.inputPort]},true);nf.Canvas.View.updateVisibility();nf.Birdseye.refresh()}}).fail(nf.Common.handleAjaxError)};var a=function(x){var w=function(){var y=$("#new-port-name").val();$("#new-port-dialog").modal("hide");j(y,x)};$("#new-port-dialog").modal("setButtonModel",[{buttonText:"Add",handler:{click:w}},{buttonText:"Cancel",handler:{click:function(){$("#new-port-dialog").modal("hide")}}}]);$("#new-port-type").text("Output");$("#new-port-dialog").modal("show");$("#new-port-name").focus().off("keyup").on("keyup",function(z){var y=z.keyCode?z.keyCode:z.which;if(y===$.ui.keyCode.ENTER){w()}})};var j=function(y,x){var w=nf.Client.getRevision();$.ajax({type:"POST",url:s.urls.controller+"/process-groups/"+encodeURIComponent(nf.Canvas.getGroupId())+"/output-ports",data:{version:w.version,clientId:w.clientId,name:y,x:x.x,y:x.y},dataType:"json"}).done(function(z){if(nf.Common.isDefinedAndNotNull(z.outputPort)){nf.Client.setRevision(z.revision);nf.Graph.add({outputPorts:[z.outputPort]},true);nf.Canvas.View.updateVisibility();nf.Birdseye.refresh()}}).fail(nf.Common.handleAjaxError)};var p=function(y,x){var w=nf.Client.getRevision();return $.ajax({type:"POST",url:s.urls.controller+"/process-groups/"+encodeURIComponent(nf.Canvas.getGroupId())+"/process-group-references",data:{version:w.version,clientId:w.clientId,name:y,x:x.x,y:x.y},dataType:"json"}).done(function(z){if(nf.Common.isDefinedAndNotNull(z.processGroup)){nf.Client.setRevision(z.revision);nf.Graph.add({processGroups:[z.processGroup]},true);nf.Canvas.View.updateVisibility();nf.Birdseye.refresh()}}).fail(nf.Common.handleAjaxError)};var c=function(x){var w=function(){var y=$("#new-remote-process-group-uri").val();$("#new-remote-process-group-dialog").modal("hide");e(y,x)};$("#new-remote-process-group-dialog").modal("setButtonModel",[{buttonText:"Add",handler:{click:w}},{buttonText:"Cancel",handler:{click:function(){$("#new-remote-process-group-dialog").modal("hide")}}}]);$("#new-remote-process-group-dialog").modal("show");$("#new-remote-process-group-uri").focus().off("keyup").on("keyup",function(z){var y=z.keyCode?z.keyCode:z.which;if(y===$.ui.keyCode.ENTER){w()}})};var e=function(y,x){var w=nf.Client.getRevision();$.ajax({type:"POST",url:s.urls.controller+"/process-groups/"+encodeURIComponent(nf.Canvas.getGroupId())+"/remote-process-groups",data:{version:w.version,clientId:w.clientId,uri:y,x:x.x,y:x.y},dataType:"json"}).done(function(z){if(nf.Common.isDefinedAndNotNull(z.remoteProcessGroup)){nf.Client.setRevision(z.revision);nf.Graph.add({remoteProcessGroups:[z.remoteProcessGroup]},true);nf.Canvas.View.updateVisibility();nf.Birdseye.refresh()}}).fail(nf.Common.handleAjaxError)};var n=function(x){var w=nf.Client.getRevision();$.ajax({type:"POST",url:s.urls.controller+"/process-groups/"+encodeURIComponent(nf.Canvas.getGroupId())+"/funnels",data:{version:w.version,clientId:w.clientId,x:x.x,y:x.y},dataType:"json"}).done(function(y){if(nf.Common.isDefinedAndNotNull(y.funnel)){nf.Client.setRevision(y.revision);nf.Graph.add({funnels:[y.funnel]},true);nf.Birdseye.refresh()}}).fail(nf.Common.handleAjaxError)};var t=function(w){$.ajax({type:"GET",url:s.urls.templates,dataType:"json"}).done(function(x){var z=x.templates;if(nf.Common.isDefinedAndNotNull(z)&&z.length>0){var y=[];$.each(z,function(A,B){y.push({text:B.name,value:B.id,description:nf.Common.escapeHtml(B.description)})});$("#available-templates").combo({maxHeight:300,options:y});$("#instantiate-template-dialog").modal("setButtonModel",[{buttonText:"Add",handler:{click:function(){var B=$("#available-templates").combo("getSelectedOption");var A=B.value;$("#instantiate-template-dialog").modal("hide");l(A,w)}}},{buttonText:"Cancel",handler:{click:function(){$("#instantiate-template-dialog").modal("hide")}}}]);$("#instantiate-template-dialog").modal("show")}else{nf.Dialog.showOkDialog({headerText:"Instantiate Template",dialogContent:"No templates have been loaded into this NiFi.",overlayBackground:false})}}).fail(nf.Common.handleAjaxError)};var l=function(x,y){var w=nf.Client.getRevision();$.ajax({type:"POST",url:s.urls.controller+"/process-groups/"+encodeURIComponent(nf.Canvas.getGroupId())+"/template-instance",data:{version:w.version,clientId:w.clientId,templateId:x,originX:y.x,originY:y.y},dataType:"json"}).done(function(z){nf.Client.setRevision(z.revision);nf.Graph.add(z.contents,true);nf.Canvas.View.updateVisibility();nf.Birdseye.refresh()}).fail(nf.Common.handleAjaxError)};var o=function(x){var w=nf.Client.getRevision();$.ajax({type:"POST",url:s.urls.controller+"/process-groups/"+encodeURIComponent(nf.Canvas.getGroupId())+"/labels",data:{version:w.version,clientId:w.clientId,x:x.x,y:x.y,width:nf.Label.config.width,height:nf.Label.config.height},dataType:"json"}).done(function(y){if(nf.Common.isDefinedAndNotNull(y.label)){nf.Client.setRevision(y.revision);nf.Graph.add({labels:[y.label]},true);nf.Birdseye.refresh()}}).fail(nf.Common.handleAjaxError)};return{init:function(){var z=$("#toolbox");if(nf.Common.isDFM()){d(s.type.processor,z,"processor-icon","processor-icon-hover","processor-icon-drag",k);d(s.type.inputPort,z,"input-port-icon","input-port-icon-hover","input-port-icon-drag",b);d(s.type.outputPort,z,"output-port-icon","output-port-icon-hover","output-port-icon-drag",a);d(s.type.processGroup,z,"process-group-icon","process-group-icon-hover","process-group-icon-drag",nf.CanvasToolbox.promptForGroupName);d(s.type.remoteProcessGroup,z,"remote-process-group-icon","remote-process-group-icon-hover","remote-process-group-icon-drag",c);d(s.type.funnel,z,"funnel-icon","funnel-icon-hover","funnel-icon-drag",n);d(s.type.template,z,"template-icon","template-icon-hover","template-icon-drag",t);d(s.type.label,z,"label-icon","label-icon-hover","label-icon-drag",o);$("#processor-type-filter").focus(function(){if($(this).hasClass(s.styles.filterList)){$(this).removeClass(s.styles.filterList).val("")}}).blur(function(){if($(this).val()===""){$(this).addClass(s.styles.filterList).val(s.filterText)}}).addClass(s.styles.filterList).val(s.filterText);var x=[{id:"type",name:"Type",field:"label",sortable:true,resizable:true},{id:"tags",name:"Tags",field:"tags",sortable:true,resizable:true}];var A={forceFitColumns:true,enableTextSelectionOnCells:true,enableCellNavigation:true,enableColumnReorder:false,autoEdit:false,multiSelect:false};var y=new Slick.Data.DataView({inlineFilters:false});y.setItems([]);y.setFilterArgs({searchString:q()});y.setFilter(h);r({columnId:"type",sortAsc:true},y);var w=new Slick.Grid("#processor-types-table",y,x,A);w.setSelectionModel(new Slick.RowSelectionModel());w.registerPlugin(new Slick.AutoTooltips());w.setSortColumn("type",true);w.onSort.subscribe(function(C,B){r({columnId:B.sortCol.field,sortAsc:B.sortAsc},y)});w.onSelectedRowsChanged.subscribe(function(D,C){if($.isArray(C.rows)&&C.rows.length===1){var B=C.rows[0];var E=w.getDataItem(B);if(nf.Common.isDefinedAndNotNull(E)){if(nf.Common.isBlank(E.description)){$("#processor-type-description").attr("title","").html('<span class="unset">No description specified</span>')}else{$("#processor-type-description").html(E.description).ellipsis()}$("#processor-type-name").text(E.label).ellipsis();$("#selected-processor-name").text(E.label);$("#selected-processor-type").text(E.type)}}});y.onRowCountChanged.subscribe(function(C,B){w.updateRowCount();w.render();$("#displayed-processor-types").text(B.current)});y.onRowsChanged.subscribe(function(C,B){w.invalidateRows(B.rows);w.render()});y.syncGridSelection(w,false);$("#processor-types-table").data("gridInstance",w);$.ajax({type:"GET",url:s.urls.processorTypes,dataType:"json"}).done(function(B){var C=[];y.beginUpdate();$.each(B.processorTypes,function(D,F){var E=F.type;y.addItem({id:D,label:nf.Common.substringAfterLast(E,"."),type:E,description:nf.Common.escapeHtml(F.description),tags:F.tags.join(", ")});$.each(F.tags,function(H,G){C.push(G.toLowerCase())})});y.endUpdate();$("#total-processor-types, #displayed-processor-types").text(B.processorTypes.length);$("#processor-tag-cloud").tagcloud({tags:C,select:v,remove:v})}).fail(nf.Common.handleAjaxError);$("#new-processor-dialog").modal({headerText:"Add Processor",overlayBackground:false}).draggable({containment:"parent",handle:".dialog-header"});$("#new-port-dialog").modal({headerText:"Add Port",overlayBackground:false,handler:{close:function(){$("#new-port-name").val("")}}}).draggable({containment:"parent",handle:".dialog-header"});$("#new-process-group-dialog").modal({headerText:"Add Process Group",overlayBackground:false,handler:{close:function(){$("#new-process-group-name").val("")}}}).draggable({containment:"parent",handle:".dialog-header"});$("#new-remote-process-group-dialog").modal({headerText:"Add Remote Process Group",overlayBackground:false,handler:{close:function(){$("#new-remote-process-group-uri").val("")}}}).draggable({containment:"parent",handle:".dialog-header"});$("#instantiate-template-dialog").modal({headerText:"Instantiate Template",overlayBackgroud:false}).draggable({containment:"parent",handle:".dialog-header"})}else{$("<div/>").attr("title",s.type.processor).addClass("processor-icon-disable").addClass("toolbox-icon").appendTo(z);$("<div/>").attr("title",s.type.inputPort).addClass("input-port-icon-disable").addClass("toolbox-icon").appendTo(z);$("<div/>").attr("title",s.type.outputPort).addClass("output-port-icon-disable").addClass("toolbox-icon").appendTo(z);$("<div/>").attr("title",s.type.processGroup).addClass("process-group-icon-disable").addClass("toolbox-icon").appendTo(z);$("<div/>").attr("title",s.type.remoteProcessGroup).addClass("remote-process-group-icon-disable").addClass("toolbox-icon").appendTo(z);$("<div/>").attr("title",s.type.funnel).addClass("funnel-icon-disable").addClass("toolbox-icon").appendTo(z);$("<div/>").attr("title",s.type.template).addClass("template-icon-disable").addClass("toolbox-icon").appendTo(z);$("<div/>").attr("title",s.type.label).addClass("label-icon-disable").addClass("toolbox-icon").appendTo(z)}},promptForGroupName:function(w){return $.Deferred(function(x){var y=function(){var z=$("#new-process-group-name").val();$("#new-process-group-dialog").modal("hide");p(z,w).done(function(A){x.resolve(A.processGroup)}).fail(function(){x.reject()})};$("#new-process-group-dialog").modal("setButtonModel",[{buttonText:"Add",handler:{click:y}},{buttonText:"Cancel",handler:{click:function(){x.reject();$("#new-process-group-dialog").modal("hide")}}}]);$("#new-process-group-dialog").modal("show");$("#new-process-group-name").focus().off("keyup").on("keyup",function(A){var z=A.keyCode?A.keyCode:A.which;if(z===$.ui.keyCode.ENTER){y()}})}).promise()}}}());
nf.CustomUi={showCustomUi:function(c,b,a){return $.Deferred(function(d){nf.Common.getAccessToken("../nifi-api/access/ui-extension-token").done(function(f){$("#shell-close-button");var e=nf.Client.getRevision();var g={id:c,processorId:c,revision:e.version,clientId:e.clientId,editable:a};if(!nf.Common.isBlank(f)){g.access_token=f}nf.Shell.showPage(".."+b+"?"+$.param(g),false).done(function(){d.resolve()})}).fail(function(){nf.Dialog.showOkDialog({dialogContent:"Unable to generate access token for accessing the advanced configuration dialog.",overlayBackground:false});d.resolve()})}).promise()}};
nf.QueueListing=(function(){var b={urls:{uiExtensionToken:"../nifi-api/access/ui-extension-token",downloadToken:"../nifi-api/access/download-token"}};var h=function(){var i=$("#listing-request-percent-complete").progressbar();$("#listing-request-status-dialog").modal({overlayBackground:false,handler:{close:function(){i.find("div.progress-label").remove();var j=$('<div class="progress-label"></div>').text("0%");i.progressbar("value",0).append(j);$("#listing-request-status-dialog").modal("setButtonModel",[])}}}).draggable({containment:"parent",handle:".dialog-header"})};var a=function(){var i=$("#flowfile-uri").text()+"/content";nf.Common.getAccessToken(b.urls.downloadToken).done(function(k){var l={};if(!nf.Common.isBlank(k)){l.access_token=k}var j=$("#flowfile-cluster-node-id").text();if(!nf.Common.isBlank(j)){l.clusterNodeId=j}if($.isEmptyObject(l)){window.open(i)}else{window.open(i+"?"+$.param(l))}}).fail(function(){nf.Dialog.showOkDialog({dialogContent:"Unable to generate access token for downloading content.",overlayBackground:false})})};var e=function(){var i=$("#flowfile-uri").text()+"/content";var j=$.Deferred(function(k){if(nf.Storage.hasItem("jwt")){var m=$.ajax({type:"POST",url:b.urls.uiExtensionToken});var l=$.ajax({type:"POST",url:b.urls.downloadToken});$.when(m,l).done(function(q,p){var o=q[0];var n=p[0];k.resolve(o,n)}).fail(function(){nf.Dialog.showOkDialog({dialogContent:"Unable to generate access token for viewing content.",overlayBackground:false});k.reject()})}else{k.resolve("","")}}).promise();j.done(function(m,l){var o={};var k=$("#flowfile-cluster-node-id").text();if(!nf.Common.isBlank(k)){o.clusterNodeId=k}if(!nf.Common.isBlank(l)){o.access_token=l}if($.isEmptyObject(o)===false){i=i+"?"+$.param(o)}var n=$("#nifi-content-viewer-url").text();if(n.indexOf("?")===-1){n+="?"}else{n+="&"}var p={ref:i};if(!nf.Common.isBlank(m)){p.access_token=m}window.open(n+$.param(p))})};var d=function(){$("#content-download").on("click",a);if(nf.Common.isContentViewConfigured()){$("#content-view").show();$("#content-view").on("click",e)}$("#flowfile-details-tabs").tabbs({tabStyle:"tab",selectedTabStyle:"selected-tab",tabs:[{name:"Details",tabContentId:"flowfile-details-tab-content"},{name:"Attributes",tabContentId:"flowfile-attributes-tab-content"}]});$("#flowfile-details-dialog").modal({headerText:"FlowFile",overlayBackground:false,buttons:[{buttonText:"Ok",handler:{click:function(){$("#flowfile-details-dialog").modal("hide")}}}],handler:{close:function(){$("#flowfile-attributes-container").empty();$("#flowfile-cluster-node-id").text("");$("#additional-flowfile-details").empty()}}}).draggable({containment:"parent",handle:".dialog-header"})};var f=function(j){var k=4;var m=false;var l=null;var i=null;return $.Deferred(function(o){var r=function(t){var u=$("#listing-request-percent-complete");u.find("div.progress-label").remove();var s=$('<div class="progress-label"></div>').text(t+"%");if(t>0){s.css("margin-top","-19px")}u.progressbar("value",t).append(s)};$("#listing-request-status-dialog").modal("setButtonModel",[{buttonText:"Stop",handler:{click:function(){m=true;if(i!==null){clearTimeout(i);n()}}}}]);var n=function(){$("#listing-request-status-dialog").modal("hide");var u=m;if(nf.Common.isDefinedAndNotNull(l)){$.ajax({type:"DELETE",url:l.uri,dataType:"json"});if(nf.Common.isEmpty(l.flowFileSummaries)){if(m===false){u=true;nf.Dialog.showOkDialog({dialogContent:"The queue has no FlowFiles.",overlayBackground:false})}}else{$("#total-flowfiles-count").text(nf.Common.formatInteger(l.queueSize.objectCount));$("#total-flowfiles-size").text(nf.Common.formatDataSize(l.queueSize.byteCount));$("#queue-listing-last-refreshed").text(l.lastUpdated);var t=$("#queue-listing-table");var w=$("#queue-listing-message");if(l.sourceRunning===true||l.destinationRunning===true){if(l.souceRunning===true&&l.destinationRunning===true){w.text("The source and destination of this queue are currently running. This listing may no longer be accurate.").show()}else{if(l.sourceRunning===true){w.text("The source of this queue is currently running. This listing may no longer be accurate.").show()}else{if(l.destinationRunning===true){w.text("The destination of this queue is currently running. This listing may no longer be accurate.").show()}}}t.css("bottom","35px")}else{w.text("").hide();t.css("bottom","20px")}var v=$("#queue-listing-table").data("gridInstance");var s=v.getData();s.beginUpdate();s.setItems(l.flowFileSummaries,"uuid");s.endUpdate()}}else{u=true}if(u){o.reject()}else{o.resolve()}};var q=function(s){r(l.percentCompleted);$("#listing-request-status-message").text(l.state);if(l.finished===true||m===true){n()}else{i=setTimeout(function(){i=null;p(Math.min(k,s*2))},s*1000)}};var p=function(s){$.ajax({type:"GET",url:l.uri,dataType:"json"}).done(function(t){l=t.listingRequest;q(s)}).fail(n).fail(nf.Common.handleAjaxError)};$.ajax({type:"POST",url:j.component.uri+"/listing-requests",dataType:"json"}).done(function(s){r(0);$("#listing-request-status-dialog").modal("show");l=s.listingRequest;q(1)}).fail(n).fail(nf.Common.handleAjaxError)}).promise()};var g=function(i){var j=function(m,n){$('<div class="flowfile-detail"></div>').append($('<div class="detail-name"></div>').text(m)).append($('<div class="detail-value">'+nf.Common.formatValue(n)+"</div>").ellipsis()).append($('<div class="clear"></div>')).appendTo("#additional-flowfile-details")};var k=function(m,n){if(nf.Common.isDefinedAndNotNull(n)){m.removeClass("unset").text(n)}else{m.addClass("unset").text("No value set")}};var l={};if(nf.Common.isDefinedAndNotNull(i.clusterNodeId)){l.clusterNodeId=i.clusterNodeId}$.ajax({type:"GET",url:i.uri,data:l,dataType:"json"}).done(function(m){var o=m.flowFile;$("#flowfile-uri").text(o.uri);$("#flowfile-uuid").html(nf.Common.formatValue(o.uuid));$("#flowfile-filename").html(nf.Common.formatValue(o.filename));$("#flowfile-queue-position").html(nf.Common.formatValue(o.position));$("#flowfile-file-size").html(nf.Common.formatValue(o.contentClaimFileSize));$("#flowfile-queued-duration").text(nf.Common.formatDuration(o.queuedDuration));$("#flowfile-lineage-duration").text(nf.Common.formatDuration(o.lineageDuration));$("#flowfile-penalized").text(o.penalized===true?"Yes":"No");if(nf.Common.isDefinedAndNotNull(i.clusterNodeId)){$("#flowfile-cluster-node-id").text(i.clusterNodeId);j("Node Address",i.clusterNodeAddress)}if(nf.Common.isDefinedAndNotNull(o.contentClaimContainer)){k($("#content-container"),o.contentClaimContainer);k($("#content-section"),o.contentClaimSection);k($("#content-identifier"),o.contentClaimIdentifier);k($("#content-offset"),o.contentClaimOffset);k($("#content-bytes"),o.contentClaimFileSizeBytes);var p=$("#content-size");k(p,o.contentClaimFileSize);if(nf.Common.isDefinedAndNotNull(o.contentClaimFileSize)){p.attr("title",nf.Common.formatInteger(o.contentClaimFileSizeBytes)+" bytes")}$("#flowfile-content-details").show()}else{$("#flowfile-content-details").hide()}var n=$("#flowfile-attributes-container");$.each(o.attributes,function(q,r){var s=$('<div class="attribute-detail"></div>').append($('<div class="attribute-name">'+nf.Common.formatValue(q)+"</div>").ellipsis()).appendTo(n);s.append($('<div class="attribute-value">'+nf.Common.formatValue(r)+"</div>").ellipsis()).append('<div class="clear"></div>')});$("#flowfile-details-dialog").modal("show")}).fail(nf.Common.handleAjaxError)};var c=function(){var i=$("#queue-listing-table").data("gridInstance");if(nf.Common.isDefinedAndNotNull(i)){i.resizeCanvas()}};return{init:function(){h();d();$(window).resize(function(){c()});nf.Common.addHoverEffect("#queue-listing-refresh-button","button-refresh","button-refresh-hover").click(function(){var r=$("#queue-listing-table").data("connection");f(r)});var q=function(v,s,u,t,r){return'<img src="images/iconDetails.png" title="View Details" class="pointer show-flowfile-details" style="margin-top: 5px; float: left;"/>'};var k=function(v,s,u,t,r){return nf.Common.formatDataSize(u)};var i=function(v,s,u,t,r){return nf.Common.formatDuration(u)};var m=function(w,s,v,u,r){var t="";if(v===true){t+="Yes"}return t};var n=[{id:"moreDetails",field:"moreDetails",name:"&nbsp;",sortable:false,resizable:false,formatter:q,width:50,maxWidth:50},{id:"position",name:"Position",field:"position",sortable:false,resizable:false,width:75,maxWidth:75},{id:"uuid",name:"UUID",field:"uuid",sortable:false,resizable:true},{id:"filename",name:"Filename",field:"filename",sortable:false,resizable:true},{id:"size",name:"File Size",field:"size",sortable:false,resizable:true,defaultSortAsc:false,formatter:k},{id:"queuedDuration",name:"Queued Duration",field:"queuedDuration",sortable:false,resizable:true,formatter:i},{id:"lineageDuration",name:"Lineage Duration",field:"lineageDuration",sortable:false,resizable:true,formatter:i},{id:"penalized",name:"Penalized",field:"penalized",sortable:false,resizable:false,width:100,maxWidth:100,formatter:m}];if(nf.Canvas.isClustered()){n.push({id:"clusterNodeAddress",name:"Node",field:"clusterNodeAddress",sortable:false,resizable:true})}if(nf.Common.canAccessProvenance()){var p=function(){return'<div title="Provenance" class="pointer provenance-icon view-provenance"></div>'};n.push({id:"actions",name:"&nbsp;",resizable:false,formatter:p,sortable:false,width:50,maxWidth:50})}var l={forceFitColumns:true,enableTextSelectionOnCells:true,enableCellNavigation:false,enableColumnReorder:false,autoEdit:false};var j=new Slick.Data.DataView({inlineFilters:false});j.setItems([]);var o=new Slick.Grid("#queue-listing-table",j,n,l);o.setSelectionModel(new Slick.RowSelectionModel());o.registerPlugin(new Slick.AutoTooltips());o.onClick.subscribe(function(u,r){var t=$(u.target);var s=j.getItem(r.row);if(o.getColumns()[r.cell].id==="moreDetails"){if(t.hasClass("show-flowfile-details")){g(s)}}else{if(o.getColumns()[r.cell].id==="actions"){if(t.hasClass("view-provenance")){$("#shell-close-button").click();nf.Shell.showPage("provenance?"+$.param({flowFileUuid:s.uuid}))}}}});j.onRowCountChanged.subscribe(function(s,r){o.updateRowCount();o.render();$("#displayed-flowfiles").text(r.current)});j.onRowsChanged.subscribe(function(s,r){o.invalidateRows(r.rows);o.render()});$("#queue-listing-table").data("gridInstance",o);$("#displayed-flowfiles").text("0")},listQueue:function(i){f(i).done(function(){var j=nf.CanvasUtils.formatConnectionName(i.component);if(j===""){j="Connection"}$("#queue-listing-header-text").text(j);nf.Shell.showContent("#queue-listing-container").done(function(){$("#queue-listing-table").removeData("connection");var l=$("#queue-listing-table").data("gridInstance");var k=l.getData();k.beginUpdate();k.setItems([],"uuid");k.endUpdate();$("#displayed-flowfiles, #total-flowfiles-count").text("0");$("#total-flowfiles-size").text(nf.Common.formatDataSize(0))});c();$("#queue-listing-table").data("connection",i)})}}}());
nf.ComponentState=(function(){var d={filterText:"Filter",styles:{filterList:"filter-list"}};var c=function(){var i=$("#component-state-table").data("gridInstance");if(nf.Common.isDefinedAndNotNull(i)){var j=i.getData();j.setFilterArgs({searchString:g()});j.refresh()}};var h=function(k,j){if(j.searchString===""){return true}try{var o=new RegExp(j.searchString,"i")}catch(l){return false}var n=k.key.search(o)>=0;var i=k.value.search(o)>=0;var m=false;if(nf.Common.isDefinedAndNotNull(k.scope)){m=k.scope.search(o)>=0}return n||i||m};var f=function(i,k){var j=function(n,l){var m=nf.Common.isDefinedAndNotNull(n[i.columnId])?n[i.columnId]:"";var o=nf.Common.isDefinedAndNotNull(l[i.columnId])?l[i.columnId]:"";return m===o?0:m>o?1:-1};k.sort(j,i.sortAsc)};var g=function(){var j="";var i=$("#component-state-filter");if(!i.hasClass(d.styles.filterList)){j=i.val()}return j};var a=function(){var i=$("#component-state-table").data("gridInstance");var j=i.getData();j.setItems([]);$("#component-state-partial-results-container").hide();$("#displayed-component-state-entries").text("0");$("#total-component-state-entries").text("0")};var b=function(i,j){var k=0;var m=0;var n=false;var l=$("#component-state-table").data("gridInstance");var o=l.getData();o.beginUpdate();if(nf.Common.isDefinedAndNotNull(i)){$.each(i.state,function(p,q){o.addItem($.extend({id:k++,scope:q.clusterNodeAddress},q))});m+=i.totalEntryCount;if(nf.Common.isDefinedAndNotNull(i.state)&&i.totalEntryCount!==i.state.length){n=true}}if(nf.Common.isDefinedAndNotNull(j)){$.each(j.state,function(p,q){o.addItem($.extend({id:k++,scope:"Cluster"},q))});m+=j.totalEntryCount;if(nf.Common.isDefinedAndNotNull(j.state)&&j.totalEntryCount!==j.state.length){n=true}}o.endUpdate();o.reSort();if(n){$("#component-state-partial-results-container").show()}$("#total-component-state-entries").text(nf.Common.formatInteger(m))};var e=function(){$("#component-state-name").text("");$("#component-state-description").text("");$("#component-state-filter").addClass(d.styles.filterList).val(d.filterText);$("#clear-link").removeClass("disabled").attr("title","");a();$("#component-state-table").removeData("component")};return{init:function(){$("#component-state-filter").on("focus",function(){if($(this).hasClass(d.styles.filterList)){$(this).removeClass(d.styles.filterList).val("")}}).on("blur",function(){if($(this).val()===""){$(this).addClass(d.styles.filterList).val(d.filterText)}}).on("keyup",function(){c()}).addClass(d.styles.filterList).val(d.filterText);$("#component-state-dialog").modal({headerText:"Component State",overlayBackground:false,buttons:[{buttonText:"Close",handler:{click:function(){$(this).modal("hide")}}}],handler:{close:function(){e()}}}).draggable({containment:"parent",handle:".dialog-header"});$("#clear-link").on("click",function(){if($(this).hasClass("disabled")===false){var m=$("#component-state-table");var q=m.data("gridInstance");var p=q.getDataLength();if(p>0){var o=nf.Client.getRevision();var n=m.data("component");$.ajax({type:"POST",url:n.uri+"/state/clear-requests",data:{version:o.version,clientId:o.clientId},dataType:"json"}).done(function(r){nf.Client.setRevision(r.revision);a();b()}).fail(nf.Common.handleAjaxError)}else{nf.Dialog.showOkDialog({dialogContent:"This component has no state to clear.",overlayBackground:false})}}});var j=[{id:"key",field:"key",name:"Key",sortable:true,resizable:true},{id:"value",field:"value",name:"Value",sortable:true,resizable:true}];if(nf.Canvas.isClustered()){j.push({id:"scope",field:"scope",name:"Scope",sortable:true,resizable:true})}var i={forceFitColumns:true,enableTextSelectionOnCells:true,enableCellNavigation:false,enableColumnReorder:false,autoEdit:false};var l=new Slick.Data.DataView({inlineFilters:false});l.setItems([]);l.setFilterArgs({searchString:"",property:"key"});l.setFilter(h);f({columnId:"key",sortAsc:true},l);var k=new Slick.Grid("#component-state-table",l,j,i);k.setSelectionModel(new Slick.RowSelectionModel());k.registerPlugin(new Slick.AutoTooltips());k.setSortColumn("key",true);k.onSort.subscribe(function(n,m){f({columnId:m.sortCol.field,sortAsc:m.sortAsc},l)});l.onRowCountChanged.subscribe(function(n,m){k.updateRowCount();k.render();$("#displayed-component-state-entries").text(m.current)});l.onRowsChanged.subscribe(function(n,m){k.invalidateRows(m.rows);k.render()});$("#component-state-table").data("gridInstance",k);$("#displayed-component-state-entries").text("0");$("#total-component-state-entries").text("0")},showState:function(j,i){return $.ajax({type:"GET",url:j.uri+"/state",dataType:"json"}).done(function(l){var m=l.componentState;var k=$("#component-state-table");b(m.localState,m.clusterState);$("#component-state-name").text(j.name);$("#component-state-description").text(m.stateDescription).ellipsis();k.data("component",j);$("#component-state-dialog").modal("show");if(i===false){$("#clear-link").addClass("disabled").attr("title","Component state can only be cleared when the component is not actively running")}var n=k.data("gridInstance");n.resizeCanvas()}).fail(nf.Common.handleAjaxError)}}}());
nf.ControllerService=(function(){var D={edit:"edit",readOnly:"read-only",serviceOnly:"SERVICE_ONLY",serviceAndReferencingComponents:"SERVICE_AND_REFERENCING_COMPONENTS"};var w=function(L,I,J){if(L.status===400){var M=L.responseText.split("\n");var K;if(M.length===1){K=$("<span></span>").text(M[0])}else{K=nf.Common.formatUnorderedList(M)}nf.Dialog.showOkDialog({dialogContent:K,overlayBackground:false,headerText:"Configuration Error"})}else{nf.Common.handleAjaxError(L,I,J)}};var H=function(){var I=$("#controller-service-configuration").data("controllerServiceDetails");if($("#controller-service-name").val()!==I.name){return true}if($("#controller-service-comments").val()!==I.comments){return true}return $("#controller-service-properties").propertytable("isSaveRequired")};var o=function(){var J=$("#controller-service-properties").propertytable("marshalProperties");var K={};K.id=$("#controller-service-id").text();K.name=$("#controller-service-name").val();K.comments=$("#controller-service-comments").val();if($.isEmptyObject(J)===false){K.properties=J}var I={};I.revision=nf.Client.getRevision();I.controllerService=K;return I};var C=function(I){return true};var u=function(L){var J=$("#controller-services-table").data("gridInstance");var K=J.getData();var I=K.getItemById(L);if(nf.Common.isUndefined(I)){return $.Deferred(function(M){M.reject()}).promise()}return $.ajax({type:"GET",url:I.uri,dataType:"json"}).done(function(M){G(M.controllerService)}).fail(nf.Common.handleAjaxError)};var G=function(I){var K=$("#controller-services-table").data("gridInstance");var L=K.getData();var J=L.getItemById(I.id);L.updateItem(I.id,$.extend({bulletins:J.bulletins},I))};var x=function(I){u(I.id).done(function(J){r(J.controllerService)})};var r=function(I){$.each(I.referencingComponents,function(K,J){if(J.referenceType==="Processor"){if(nf.Canvas.getGroupId()===J.groupId){var M=nf.Processor.get(J.id);nf.Processor.reload(M.component)}$("div."+J.id+"-active-threads").text(J.activeThreadCount);var L=$("div."+J.id+"-state");if(L.length){e(L,J)}}else{if(J.referenceType==="ReportingTask"){nf.ReportingTask.reload(J.id);$("div."+J.id+"-active-threads").text(J.activeThreadCount);var L=$("div."+J.id+"-state");if(L.length){e(L,J)}}else{u(J.id);var L=$("div."+J.id+"-state");if(L.length){b(L,J)}if(J.referenceCycle===false){r(J)}}}});nf.ControllerService.reloadReferencedServices(I)};var j=function(I){var J=I.get(0).scrollHeight>I.innerHeight()||I.get(0).scrollWidth>I.innerWidth();if(I.is(":visible")&&J){I.css("border-width","1px")}else{I.css("border-width","0px")}};var p=function(L,J){var M=J.data("bulletins");if(nf.Common.doBulletinsDiffer(M,L)){J.data("bulletins",L);var I=nf.Common.getFormattedBulletins(L);if(L.length>0){var K=nf.Common.formatUnorderedList(I);if(J.data("qtip")){J.qtip("option","content.text",K)}else{J.addClass("has-bulletins").show().qtip($.extend({content:K},nf.CanvasUtils.config.systemTooltipConfig))}}else{if(J.data("qtip")){J.removeClass("has-bulletins").removeData("bulletins").hide().qtip("api").destroy(true)}}}};var e=function(I,J){I.removeClass("disabled stopped running invalid").addClass(function(){var K=$(this);var M=J.state.toLowerCase();if(M==="stopped"&&!nf.Common.isEmpty(J.validationErrors)){M="invalid";var L=nf.Common.formatUnorderedList(J.validationErrors);if(K.data("qtip")){K.qtip("option","content.text",L)}else{K.qtip($.extend({content:L},nf.CanvasUtils.config.systemTooltipConfig))}}else{if(K.data("qtip")){K.qtip("api").destroy(true)}}return M})};var b=function(J,I){J.removeClass("disabled enabled invalid").addClass(function(){var K=$(this);var M=I.state==="ENABLED"?"enabled":"disabled";if(M==="disabled"&&!nf.Common.isEmpty(I.validationErrors)){M="invalid";var L=nf.Common.formatUnorderedList(I.validationErrors);if(K.data("qtip")){K.qtip("option","content.text",L)}else{K.qtip($.extend({content:L},nf.CanvasUtils.config.systemTooltipConfig))}}else{if(K.data("qtip")){K.qtip("api").destroy(true)}}return M})};var q=function(J){var I=d3.nest().key(function(K){return K.sourceId}).map(J,d3.map);I.forEach(function(L,K){$("div."+L+"-bulletins").each(function(){p(K,$(this))})})};var F=function(L,K){if(nf.Common.isEmpty(K)){L.append('<div class="unset">No referencing components.</div>');return}var I=function(R,Q){if(R.hasClass("expanded")){R.removeClass("expanded").addClass("collapsed");Q.hide()}else{R.removeClass("collapsed").addClass("expanded");Q.show()}};var N=[];var J=$('<ul class="referencing-component-listing clear"></ul>');var M=$('<ul class="referencing-component-listing clear"></ul>');var P=$('<ul class="referencing-component-listing clear"></ul>');$.each(K,function(ak,ad){N.push(ad.id);if(ad.referenceType==="Processor"){var aj=$('<span class="referencing-component-name link"></span>').text(ad.name).on("click",function(){nf.CanvasUtils.showComponent(ad.groupId,ad.id);L.closest(".dialog").modal("hide");$("#shell-close-button").click()});var Z=$('<div class="referencing-component-state"></div>').addClass(ad.id+"-state");e(Z,ad);var ab=$('<div class="referencing-component-bulletins"></div>').addClass(ad.id+"-bulletins");var ae=$('<span class="referencing-component-type"></span>').text(nf.Common.substringAfterLast(ad.type,"."));var S=$('<span class="referencing-component-active-thread-count"></span>').addClass(ad.id+"-active-threads");if(nf.Common.isDefinedAndNotNull(ad.activeThreadCount)&&ad.activeThreadCount>0){S.text("("+ad.activeThreadCount+")")}var W=$("<li></li>").append(Z).append(ab).append(aj).append(ae).append(S);J.append(W)}else{if(ad.referenceType==="ControllerService"){var ag=$('<span class="referencing-component-name link"></span>').text(ad.name).on("click",function(){var al=$("#controller-services-table").data("gridInstance");var am=al.getData();var an=am.getRowById(ad.id);al.setSelectedRows([an]);al.scrollRowIntoView(an);L.closest(".dialog").modal("hide")});var ah=$('<div class="referencing-component-references hidden"></div>');var U=$('<div class="service expansion-button collapsed pointer"></div>').on("click",function(){if(U.hasClass("collapsed")){var al=$("#controller-services-table").data("gridInstance");var an=al.getData();var am=an.getItemById(ad.id);F(ah,am.referencingComponents)}else{ah.empty()}I(U,ah);j(L)});var X=$('<div class="referencing-component-state"></div>').addClass(ad.id+"-state");b(X,ad);var ai=$('<div class="referencing-component-bulletins"></div>').addClass(ad.id+"-bulletins");var ac=$('<span class="referencing-component-type"></span>').text(nf.Common.substringAfterLast(ad.type,"."));var V=$("<li></li>").append(U).append(X).append(ai).append(ag).append(ac).append(ah);M.append(V)}else{if(ad.referenceType==="ReportingTask"){var T=$('<span class="referencing-component-name link"></span>').text(ad.name).on("click",function(){var an=$("#reporting-tasks-table").data("gridInstance");var al=an.getData();var am=al.getRowById(ad.id);an.setSelectedRows([am]);an.scrollRowIntoView(am);$("#settings-tabs").find("li:last").click();L.closest(".dialog").modal("hide")});var aa=$('<div class="referencing-component-state"></div>').addClass(ad.id+"-state");e(aa,ad);var Q=$('<div class="referencing-component-bulletins"></div>').addClass(ad.id+"-bulletins");var R=$('<span class="referencing-component-type"></span>').text(nf.Common.substringAfterLast(ad.type,"."));var Y=$('<span class="referencing-component-active-thread-count"></span>').addClass(ad.id+"-active-threads");if(nf.Common.isDefinedAndNotNull(ad.activeThreadCount)&&ad.activeThreadCount>0){Y.text("("+ad.activeThreadCount+")")}var af=$("<li></li>").append(aa).append(Q).append(T).append(R).append(Y);P.append(af)}}}});z(N).done(function(Q){var R=Q.bulletinBoard.bulletins;q(R)});var O=function(Q,S){if(S.is(":empty")){S.remove();return}var U=$('<div class="expansion-button expanded"></div>');var T=$('<span class="referencing-component-title"></span>').text(Q);var R=$('<span class="referencing-component-count"></span>').text("("+S.children().length+")");$('<div class="referencing-component-block pointer unselectable"></div>').on("click",function(){I(U,S);j(L)}).append(U).append(T).append(R).appendTo(L);S.appendTo(L)};O("Processors",J);O("Reporting Tasks",P);O("Controller Services",M)};var z=function(J){var I=J.join("|");return $.ajax({type:"GET",url:"../nifi-api/controller/bulletin-board",data:{sourceId:I},dataType:"json"}).fail(nf.Common.handleAjaxError)};var c=function(J,L,M){var K=nf.Client.getRevision();var I=$.ajax({type:"PUT",url:J.uri,data:{clientId:K.clientId,version:K.version,state:L===true?"ENABLED":"DISABLED"},dataType:"json"}).done(function(N){nf.Client.setRevision(N.revision)}).fail(nf.Common.handleAjaxError);return $.Deferred(function(N){I.done(function(){var O=y(J,function(P,Q){if($.isArray(Q)){if(L){p(Q,$("#enable-controller-service-bulletins"))}else{p(Q,$("#disable-controller-service-bulletins"))}}if(L){return P.state==="ENABLING"||P.state==="ENABLED"}else{return P.state==="DISABLED"}},function(P){return z([P.id])},M);O.done(function(){N.resolve()}).fail(function(){N.reject()})}).fail(function(){N.reject()})}).promise()};var a=function(I){var J=d3.set();J.add(I.id);var K=function(L){$.each(L,function(M,N){if(N.referenceType==="ControllerService"){J.add(N.id);if(N.referenceCycle===false){K(N.referencingComponents)}}})};K(I.referencingComponents);return J};var f=function(J,K,M){var L=nf.Client.getRevision();var I=$.ajax({type:"PUT",url:J.uri+"/references",data:{clientId:L.clientId,version:L.version,state:K?"RUNNING":"STOPPED"},dataType:"json"}).done(function(N){nf.Client.setRevision(N.revision)}).fail(nf.Common.handleAjaxError);return $.Deferred(function(N){I.done(function(O){J.referencingComponents=O.controllerServiceReferencingComponents;if(K){N.resolve()}else{var P=a(J);var Q=$("#controller-services-table").data("gridInstance");var S=Q.getData();var R=[];P.forEach(function(T){var U=S.getItemById(T);R.push(n(U,M))});$.when.apply(window,R).done(function(){N.resolve()}).fail(function(){N.reject()})}}).fail(function(){N.reject()})}).promise()};var y=function(J,K,I,L){return $.Deferred(function(M){var P=2;var O=function(){var R=P;P=Math.min(P*2,4);return R*1000};var Q=function(){var S=I(J);var R=$.ajax({type:"GET",url:J.uri,dataType:"json"});$.when(S,R).done(function(W,V){var U=W[0];var T=V[0];N(T.controllerService,U.bulletinBoard.bulletins)}).fail(function(V,T,U){M.reject();nf.Common.handleAjaxError(V,T,U)})};var N=function(R,S){if(K(R,S)){M.resolve()}else{if(typeof L==="function"&&L()){setTimeout(Q,O())}else{M.reject()}}};I(J).done(function(R){N(J,R.bulletinBoard.bulletins)}).fail(function(T,R,S){M.reject();nf.Common.handleAjaxError(T,R,S)})}).promise()};var n=function(I,J){return y(I,function(K,N){var L=K.referencingComponents;var M=false;$.each(L,function(O,Q){if(Q.referenceType==="Processor"||Q.referenceType==="ReportingTask"){if(Q.state==="RUNNING"||Q.activeThreadCount>0){M=true}$("div."+Q.id+"-active-threads").text(Q.activeThreadCount);var P=$("div."+Q.id+"-state");e(P,Q)}});q(N);return M===false},function(K){var M=[];var L=K.referencingComponents;$.each(L,function(N,O){if(O.referenceType==="Processor"||O.referenceType==="ReportingTask"){M.push(O.id)}});return z(M)},J)};var k=function(I,J){return y(I,function(K,N){var L=K.referencingComponents;var M=false;$.each(L,function(O,P){if(P.referenceType==="ControllerService"){if(P.state!=="ENABLING"&&P.state!=="ENABLED"){M=true}var Q=$("div."+P.id+"-state");b(Q,P)}});q(N);return M===false},function(K){var M=[];var L=K.referencingComponents;$.each(L,function(N,O){if(O.referenceType==="ControllerService"){M.push(O.id)}});return z(M)},J)};var E=function(I,J){return y(I,function(K,M){var L=K.referencingComponents;var N=false;$.each(L,function(O,P){if(P.referenceType==="ControllerService"){if(P.state!=="DISABLED"){N=true}var Q=$("div."+P.id+"-state");b(Q,P)}});q(M);return N===false},function(K){var M=[];var L=K.referencingComponents;$.each(L,function(N,O){if(O.referenceType==="ControllerService"){M.push(O.id)}});return z(M)},J)};var m=function(J,L,M){var K=nf.Client.getRevision();var I=$.ajax({type:"PUT",url:J.uri+"/references",data:{clientId:K.clientId,version:K.version,state:L?"ENABLED":"DISABLED"},dataType:"json"}).done(function(N){nf.Client.setRevision(N.revision)}).fail(nf.Common.handleAjaxError);return $.Deferred(function(N){I.done(function(O){J.referencingComponents=O.controllerServiceReferencingComponents;var P=a(J);var Q=$("#controller-services-table").data("gridInstance");var S=Q.getData();var R=[];P.forEach(function(T){var U=S.getItemById(T);if(L){R.push(k(U,M))}else{R.push(E(U,M))}});$.when.apply(window,R).done(function(){N.resolve()}).fail(function(){N.reject()})}).fail(function(){N.reject()})}).promise()};var i=function(J){$("#disable-controller-service-id").text(J.id);$("#disable-controller-service-name").text(J.name);var I=$("#disable-controller-service-referencing-components");F(I,J.referencingComponents);$("#disable-controller-service-dialog").modal("show");z([J.id]).done(function(K){p(K.bulletinBoard.bulletins,$("#disable-controller-service-bulletins"))});j(I)};var d=function(J){$("#enable-controller-service-id").text(J.id);$("#enable-controller-service-name").text(J.name);var I=$("#enable-controller-service-referencing-components");F(I,J.referencingComponents);$("#enable-controller-service-dialog").modal("show");z([J.id]).done(function(K){p(K.bulletinBoard.bulletins,$("#enable-controller-service-bulletins"))});j(I)};var h=function(){$(this).modal("hide")};var B=function(){var K=$(this);var J=false;K.modal("setButtonModel",[{buttonText:"Cancel",handler:{click:function(){J=true;K.modal("setButtonModel",[]);$("#disable-controller-service-dialog div.controller-service-canceling").show()}}}]);$("#disable-controller-service-scope-container").hide();$("#disable-controller-service-progress-container").show();var P=$("#disable-controller-service-id").text();var I=$("#controller-services-table").data("gridInstance");var L=I.getData();var M=L.getItemById(P);var Q=function(){return J===false};var O=function(){$("#disable-controller-service-dialog div.controller-service-canceling").hide();K.modal("setButtonModel",[{buttonText:"Close",handler:{click:h}}])};$("#disable-progress-label").text("Steps to disable "+M.name);var N=$("#disable-referencing-schedulable").addClass("ajax-loading");$.Deferred(function(R){var S=f(M,false,Q);S.done(function(){N.removeClass("ajax-loading").addClass("ajax-complete");var T=$("#disable-referencing-services").addClass("ajax-loading");var U=m(M,false,Q);U.done(function(){T.removeClass("ajax-loading").addClass("ajax-complete");var V=$("#disable-controller-service").addClass("ajax-loading");c(M,false,Q).done(function(){R.resolve();V.removeClass("ajax-loading").addClass("ajax-complete")}).fail(function(){R.reject();V.removeClass("ajax-loading").addClass("ajax-error")})}).fail(function(){R.reject();T.removeClass("ajax-loading").addClass("ajax-error")})}).fail(function(){R.reject();N.removeClass("ajax-loading").addClass("ajax-error")})}).always(function(){x(M);O();if(J===true&&$("#nf-ok-dialog").not(":visible")){nf.Dialog.showOkDialog({overlayBackground:false,headerText:"Action Canceled",dialogContent:"The request to disable has been canceled. Parts of this request may have already completed. Please verify the state of this service and all referencing components."})}})};var t=function(){var I=$(this);var K=false;I.modal("setButtonModel",[{buttonText:"Cancel",handler:{click:function(){K=true;I.modal("setButtonModel",[]);$("#enable-controller-service-dialog div.controller-service-canceling").show()}}}]);var Q=$("#enable-controller-service-scope").combo("getSelectedOption").value;if(Q===D.serviceOnly){$("#enable-controller-service-progress li.referencing-component").hide()}$("#enable-controller-service-scope-container").hide();$("#enable-controller-service-progress-container").show();var P=$("#enable-controller-service-id").text();var J=$("#controller-services-table").data("gridInstance");var L=J.getData();var M=L.getItemById(P);var R=function(){return K===false};var O=function(){$("#enable-controller-service-dialog div.controller-service-canceling").hide();I.modal("setButtonModel",[{buttonText:"Close",handler:{click:h}}])};$("#enable-progress-label").text("Steps to enable "+M.name);var N=$("#enable-controller-service").addClass("ajax-loading");$.Deferred(function(S){var T=c(M,true,R);if(Q===D.serviceAndReferencingComponents){T.done(function(){N.removeClass("ajax-loading").addClass("ajax-complete");var U=$("#enable-referencing-services").addClass("ajax-loading");var V=m(M,true,R);V.done(function(){U.removeClass("ajax-loading").addClass("ajax-complete");var W=$("#enable-referencing-schedulable").addClass("ajax-loading");f(M,true,R).done(function(){S.resolve();W.removeClass("ajax-loading").addClass("ajax-complete")}).fail(function(){S.reject();W.removeClass("ajax-loading").addClass("ajax-error")})}).fail(function(){S.reject();U.removeClass("ajax-loading").addClass("ajax-error")})}).fail(function(){S.reject();N.removeClass("ajax-loading").addClass("ajax-error")})}else{T.done(function(){S.resolve();N.removeClass("ajax-loading").addClass("ajax-complete")}).fail(function(){S.reject();N.removeClass("ajax-loading").addClass("ajax-error")})}}).always(function(){x(M);O();if(K===true&&$("#nf-ok-dialog").not(":visible")){nf.Dialog.showOkDialog({overlayBackground:false,headerText:"Action Canceled",dialogContent:"The request to enable has been canceled. Parts of this request may have already completed. Please verify the state of this service and all referencing components."})}})};var l=function(I){var J=$("#controller-service-configuration").data("controllerServiceDetails");return $.ajax({type:"GET",url:J.uri+"/descriptors",data:{propertyName:I},dataType:"json"}).fail(nf.Common.handleAjaxError)};var s=function(){return $.Deferred(function(I){$("#controller-service-properties").propertytable("saveRow");if(H()){nf.Dialog.showYesNoDialog({dialogContent:"Save changes before going to this Controller Service?",overlayBackground:false,noHandler:function(){I.resolve()},yesHandler:function(){var J=$("#controller-service-configuration").data("controllerServiceDetails");v(J).done(function(){I.resolve()}).fail(function(){I.reject()})}})}else{I.resolve()}}).promise()};var v=function(I){var K=o();if(C(K)){var J=[];$.each(A(I),function(M,O){var L=!nf.Common.isUndefined(K.controllerService.properties)&&!nf.Common.isUndefined(K.controllerService.properties[O.name]);var N=nf.Common.isDefinedAndNotNull(I.properties[O.name]);if(L&&N){J.push(I.properties[O.name])}});return $.ajax({type:"PUT",data:JSON.stringify(K),url:I.uri,dataType:"json",processData:false,contentType:"application/json"}).done(function(L){if(nf.Common.isDefinedAndNotNull(L.controllerService)){nf.Client.setRevision(L.revision);$.each(J,function(M,N){u(N)})}}).fail(w)}else{return $.Deferred(function(L){L.reject()}).promise()}};var A=function(J){var I=[];$.each(J.descriptors,function(K,L){if(nf.Common.isDefinedAndNotNull(L.identifiesControllerService)){I.push(L)}});return I};var g=function(J){var I=[];$.each(A(J),function(K,L){var M=J.properties[L.name];if(nf.Common.isDefinedAndNotNull(M)&&$.trim(M).length>0){I.push(M)}});return I};return{init:function(){$("#controller-service-configuration-tabs").tabbs({tabStyle:"tab",selectedTabStyle:"selected-tab",tabs:[{name:"Settings",tabContentId:"controller-service-standard-settings-tab-content"},{name:"Properties",tabContentId:"controller-service-properties-tab-content"},{name:"Comments",tabContentId:"controller-service-comments-tab-content"}],select:function(){nf.UniversalCapture.removeAllPropertyDetailDialogs();if($(this).text()==="Properties"){$("#controller-service-properties").propertytable("resetTableSize")}$("#controller-service-properties").propertytable("saveRow");var I=$("#controller-service-referencing-components");j(I)}});if(nf.Canvas.isClustered()){$("#controller-service-availability-setting-container").show()}$("#controller-service-configuration").data("mode",D.edit).modal({headerText:"Configure Controller Service",overlayBackground:false,handler:{close:function(){var I=$("#controller-service-referencing-components");nf.Common.cleanUpTooltips(I,"div.referencing-component-state");nf.Common.cleanUpTooltips(I,"div.referencing-component-bulletins");I.css("border-width","0").empty();$("#controller-service-properties").propertytable("cancelEdit");$("#controller-service-properties").propertytable("clear");nf.Common.clearField("read-only-controller-service-comments");$("#controller-service-configuration").removeData("controllerServiceDetails")}}}).draggable({containment:"parent",handle:".dialog-header"});$("#controller-service-properties").propertytable({readOnly:false,dialogContainer:"#new-controller-service-property-container",descriptorDeferred:l,goToServiceDeferred:s});$("#disable-controller-service-dialog").modal({headerText:"Disable Controller Service",overlayBackground:false,buttons:[{buttonText:"Disable",handler:{click:B}},{buttonText:"Cancel",handler:{click:h}}],handler:{close:function(){var J=$(this);$("#disable-controller-service-scope-container").show();$("#disable-controller-service-progress-container").hide();$("#disable-controller-service-id").text("");$("#disable-controller-service-name").text("");$("#disable-controller-service-bulletins").removeClass("has-bulletins").removeData("bulletins").hide();nf.Common.cleanUpTooltips($("#disable-controller-service-service-container"),"#disable-controller-service-bulletins");$("div.disable-referencing-components").removeClass("ajax-loading ajax-complete ajax-error");var I=$("#disable-controller-service-referencing-components");nf.Common.cleanUpTooltips(I,"div.referencing-component-state");nf.Common.cleanUpTooltips(I,"div.referencing-component-bulletins");I.css("border-width","0").empty();J.modal("setButtonModel",[{buttonText:"Disable",handler:{click:B}},{buttonText:"Cancel",handler:{click:h}}])}}}).draggable({containment:"parent",handle:".dialog-header"});$("#enable-controller-service-scope").combo({options:[{text:"Service only",value:D.serviceOnly,description:"Enable only this controller service"},{text:"Service and referencing components",value:D.serviceAndReferencingComponents,description:"Enable this controller service and enable/start all referencing components"}]});$("#enable-controller-service-dialog").modal({headerText:"Enable Controller Service",overlayBackground:false,buttons:[{buttonText:"Enable",handler:{click:t}},{buttonText:"Cancel",handler:{click:h}}],handler:{close:function(){var J=$(this);$("#enable-controller-service-scope-container").show();$("#enable-controller-service-progress-container").hide();$("#enable-controller-service-progress li.referencing-component").show();$("#enable-controller-service-id").text("");$("#enable-controller-service-name").text("");$("#enable-controller-service-bulletins").removeClass("has-bulletins").removeData("bulletins").hide();nf.Common.cleanUpTooltips($("#enable-controller-service-service-container"),"#enable-controller-service-bulletins");$("div.enable-referencing-components").removeClass("ajax-loading ajax-complete ajax-error");var I=$("#enable-controller-service-referencing-components");nf.Common.cleanUpTooltips(I,"div.referencing-component-state");nf.Common.cleanUpTooltips(I,"div.referencing-component-bulletins");I.css("border-width","0").empty();J.modal("setButtonModel",[{buttonText:"Enable",handler:{click:t}},{buttonText:"Cancel",handler:{click:h}}])}}}).draggable({containment:"parent",handle:".dialog-header"})},showConfiguration:function(J){var K=$("#controller-service-configuration");if(K.data("mode")===D.readOnly){$("#controller-service-configuration .controller-service-read-only").hide();$("#controller-service-configuration .controller-service-editable").show();$("#controller-service-properties").propertytable("destroy").propertytable({readOnly:false,dialogContainer:"#new-controller-service-property-container",descriptorDeferred:l,goToServiceDeferred:s});K.data("mode",D.edit)}var L=$.ajax({type:"GET",url:J.uri,dataType:"json"});var I=$.ajax({type:"GET",url:"../nifi-api/controller/history/controller-services/"+encodeURIComponent(J.id),dataType:"json"});$.when(L,I).done(function(O,N){J=O[0].controllerService;var P=N[0].componentHistory;K.data("controllerServiceDetails",J);nf.Common.populateField("controller-service-id",J.id);nf.Common.populateField("controller-service-type",nf.Common.substringAfterLast(J.type,"."));$("#controller-service-name").val(J.name);$("#controller-service-comments").val(J.comments);if(nf.Canvas.isClustered()){if(J.availability==="node"){$("#controller-service-availability").text("Node")}else{$("#controller-service-availability").text("Cluster Manager")}}var M=$("#controller-service-referencing-components");F(M,J.referencingComponents);var Q=[{buttonText:"Apply",handler:{click:function(){$("#controller-service-properties").propertytable("saveRow");v(J).done(function(R){G(R.controllerService);r(R.controllerService);K.modal("hide")})}}},{buttonText:"Cancel",handler:{click:function(){K.modal("hide")}}}];if(nf.Common.isDefinedAndNotNull(J.customUiUrl)&&J.customUiUrl!==""){Q.push({buttonText:"Advanced",handler:{click:function(){var R=function(){K.modal("hide");$("#shell-close-button").click();nf.CustomUi.showCustomUi($("#controller-service-id").text(),J.customUiUrl,true).done(function(){x(J);nf.Settings.showSettings()})};$("#controller-service-properties").propertytable("saveRow");if(H()){nf.Dialog.showYesNoDialog({dialogContent:"Save changes before opening the advanced configuration?",overlayBackground:false,noHandler:R,yesHandler:function(){v(J).done(function(){R()})}})}else{R()}}}})}K.modal("setButtonModel",Q);$("#controller-service-properties").propertytable("loadProperties",J.properties,J.descriptors,P.propertyHistory);K.modal("show");j(M)}).fail(nf.Common.handleAjaxError)},showDetails:function(J){var K=$("#controller-service-configuration");if(K.data("mode")===D.edit){$("#controller-service-configuration .controller-service-read-only").show();$("#controller-service-configuration .controller-service-editable").hide();$("#controller-service-properties").propertytable("destroy").propertytable({readOnly:true});K.data("mode",D.readOnly)}var L=$.ajax({type:"GET",url:J.uri,dataType:"json"});var I=$.ajax({type:"GET",url:"../nifi-api/controller/history/controller-services/"+encodeURIComponent(J.id),dataType:"json"});$.when(L,I).done(function(O,N){J=O[0].controllerService;var P=N[0].componentHistory;K.data("controllerServiceDetails",J);nf.Common.populateField("controller-service-id",J.id);nf.Common.populateField("controller-service-type",nf.Common.substringAfterLast(J.type,"."));nf.Common.populateField("read-only-controller-service-name",J.name);nf.Common.populateField("read-only-controller-service-comments",J.comments);if(nf.Canvas.isClustered()){if(J.availability==="node"){$("#controller-service-availability").text("Node")}else{$("#controller-service-availability").text("Cluster Manager")}}var M=$("#controller-service-referencing-components");F(M,J.referencingComponents);var Q=[{buttonText:"Ok",handler:{click:function(){K.modal("hide")}}}];if(nf.Common.isDefinedAndNotNull(nf.CustomUi)&&nf.Common.isDefinedAndNotNull(J.customUiUrl)&&J.customUiUrl!==""){Q.push({buttonText:"Advanced",handler:{click:function(){K.modal("hide");$("#shell-close-button").click();nf.CustomUi.showCustomUi(J.id,J.customUiUrl,false).done(function(){nf.Settings.showSettings()})}}})}K.modal("setButtonModel",Q);$("#controller-service-properties").propertytable("loadProperties",J.properties,J.descriptors,P.propertyHistory);K.modal("show");j(M)})},enable:function(I){d(I)},disable:function(I){i(I)},reloadReferencedServices:function(I){$.each(g(I),function(J,K){u(K)})},remove:function(I){var J=nf.Client.getRevision();$.ajax({type:"DELETE",url:I.uri+"?"+$.param({version:J.version,clientId:J.clientId}),dataType:"json"}).done(function(K){nf.Client.setRevision(K.revision);var L=$("#controller-services-table").data("gridInstance");var M=L.getData();M.deleteItem(I.id);r(I)}).fail(nf.Common.handleAjaxError)}}}());
nf.ReportingTask=(function(){var c={edit:"edit",readOnly:"read-only"};var i=function(n,k,l){if(n.status===400){var o=n.responseText.split("\n");var m;if(o.length===1){m=$("<span></span>").text(o[0])}else{m=nf.Common.formatUnorderedList(o)}nf.Dialog.showOkDialog({dialogContent:m,overlayBackground:false,headerText:"Configuration Error"})}else{nf.Common.handleAjaxError(n,k,l)}};var f=function(){var l=$("#reporting-task-configuration").data("reportingTaskDetails");if($("#reporting-task-name").val()!==l.name){return true}if($("#reporting-task-comments").val()!==l.comments){return true}if($("#reporting-task-enabled").hasClass("checkbox-checked")&&l.state==="DISABLED"){return true}else{if($("#reporting-task-enabled").hasClass("checkbox-unchecked")&&(l.state==="RUNNING"||l.state==="STOPPED")){return true}}var m=$("#reporting-task-scheduling-strategy-combo").combo("getSelectedOption").value;if(m!==(l.schedulingStrategy+"")){return true}var k;if(m==="CRON_DRIVEN"){k=$("#reporting-task-cron-driven-scheduling-period")}else{k=$("#reporting-task-timer-driven-scheduling-period")}if(nf.Common.isDefinedAndNotNull(k)&&k.val()!==(l.schedulingPeriod+"")){return true}return $("#reporting-task-properties").propertytable("isSaveRequired")};var e=function(){var l=$("#reporting-task-properties").propertytable("marshalProperties");var o=$("#reporting-task-scheduling-strategy-combo").combo("getSelectedOption").value;var k;if(o==="CRON_DRIVEN"){k=$("#reporting-task-cron-driven-scheduling-period")}else{k=$("#reporting-task-timer-driven-scheduling-period")}var n={};n.id=$("#reporting-task-id").text();n.name=$("#reporting-task-name").val();n.schedulingStrategy=o;n.schedulingPeriod=k.val();n.comments=$("#reporting-task-comments").val();if($("#reporting-task-enabled").hasClass("checkbox-unchecked")){n.state="DISABLED"}else{if($("#reporting-task-enabled").hasClass("checkbox-checked")){n.state="STOPPED"}}if($.isEmptyObject(l)===false){n.properties=l}var m={};m.revision=nf.Client.getRevision();m.reportingTask=n;return m};var b=function(k){var m=[];var l=k.reportingTask;if(nf.Common.isBlank(l.schedulingPeriod)){m.push("Run schedule must be specified")}if(m.length>0){nf.Dialog.showOkDialog({dialogContent:nf.Common.formatUnorderedList(m),overlayBackground:false,headerText:"Configuration Error"});return false}else{return true}};var h=function(m){var n=$("#reporting-tasks-table").data("gridInstance");var k=n.getData();var l=k.getItemById(m.id);k.updateItem(m.id,$.extend({bulletins:l.bulletins},m))};var g=function(m,k){var l=nf.Client.getRevision();return $.ajax({type:"PUT",url:m.uri,data:{clientId:l.clientId,version:l.version,state:k===true?"RUNNING":"STOPPED"},dataType:"json"}).done(function(n){nf.Client.setRevision(n.revision);h(n.reportingTask);nf.ControllerService.reloadReferencedServices(n.reportingTask)}).fail(nf.Common.handleAjaxError)};var j=function(){return $.Deferred(function(k){$("#reporting-task-properties").propertytable("saveRow");if(f()){nf.Dialog.showYesNoDialog({dialogContent:"Save changes before going to this Controller Service?",overlayBackground:false,noHandler:function(){k.resolve()},yesHandler:function(){var l=$("#reporting-task-configuration").data("reportingTaskDetails");d(l).done(function(){k.resolve()}).fail(function(){k.reject()})}})}else{k.resolve()}}).promise()};var d=function(l){var k=e();if(b(k)){return $.ajax({type:"PUT",data:JSON.stringify(k),url:l.uri,dataType:"json",processData:false,contentType:"application/json"}).done(function(m){if(nf.Common.isDefinedAndNotNull(m.reportingTask)){nf.Client.setRevision(m.revision)}}).fail(i)}else{return $.Deferred(function(m){m.reject()}).promise()}};var a=function(k){var l=$("#reporting-task-configuration").data("reportingTaskDetails");return $.ajax({type:"GET",url:l.uri+"/descriptors",data:{propertyName:k},dataType:"json"}).fail(nf.Common.handleAjaxError)};return{init:function(){$("#reporting-task-configuration-tabs").tabbs({tabStyle:"tab",selectedTabStyle:"selected-tab",tabs:[{name:"Settings",tabContentId:"reporting-task-standard-settings-tab-content"},{name:"Properties",tabContentId:"reporting-task-properties-tab-content"},{name:"Comments",tabContentId:"reporting-task-comments-tab-content"}],select:function(){nf.UniversalCapture.removeAllPropertyDetailDialogs();if($(this).text()==="Properties"){$("#reporting-task-properties").propertytable("resetTableSize")}$("#reporting-task-properties").propertytable("saveRow")}});if(nf.Canvas.isClustered()){$("#reporting-task-availability-setting-container").show()}$("#reporting-task-configuration").data("mode",c.edit).modal({headerText:"Configure Reporting Task",overlayBackground:false,handler:{close:function(){$("#reporting-task-properties").propertytable("cancelEdit");$("#reporting-task-properties").propertytable("clear");nf.Common.clearField("read-only-reporting-task-comments");$("#reporting-task-configuration").removeData("reportingTaskDetails")}}}).draggable({containment:"parent",handle:".dialog-header"});$("#reporting-task-properties").propertytable({readOnly:false,dialogContainer:"#new-reporting-task-property-container",descriptorDeferred:a,goToServiceDeferred:j})},showConfiguration:function(n){var l=$("#reporting-task-configuration");if(l.data("mode")===c.readOnly){$("#reporting-task-configuration .reporting-task-read-only").hide();$("#reporting-task-configuration .reporting-task-editable").show();$("#reporting-task-properties").propertytable("destroy").propertytable({readOnly:false,dialogContainer:"#new-reporting-task-property-container",descriptorDeferred:a,goToServiceDeferred:j});l.data("mode",c.edit)}var m=$.ajax({type:"GET",url:n.uri,dataType:"json"});var k=$.ajax({type:"GET",url:"../nifi-api/controller/history/reporting-tasks/"+encodeURIComponent(n.id),dataType:"json"});$.when(m,k).done(function(o,p){n=o[0].reportingTask;var q=p[0].componentHistory;$("#reporting-task-configuration").data("reportingTaskDetails",n);var t="checkbox-checked";if(n.state==="DISABLED"){t="checkbox-unchecked"}nf.Common.populateField("reporting-task-id",n.id);nf.Common.populateField("reporting-task-type",nf.Common.substringAfterLast(n.type,"."));$("#reporting-task-name").val(n.name);$("#reporting-task-enabled").removeClass("checkbox-unchecked checkbox-checked").addClass(t);$("#reporting-task-comments").val(n.comments);if(nf.Canvas.isClustered()){if(n.availability==="node"){$("#reporting-task-availability").text("Node")}else{$("#reporting-task-availability").text("Cluster Manager")}}var u=n.defaultSchedulingPeriod;var v=$("#reporting-task-cron-driven-scheduling-period").val(u.CRON_DRIVEN);var r=$("#reporting-task-timer-driven-scheduling-period").val(u.TIMER_DRIVEN);if(n.schedulingStrategy==="CRON_DRIVEN"){v.val(n.schedulingPeriod)}else{r.val(n.schedulingPeriod)}$("#reporting-task-scheduling-strategy-combo").combo({options:[{text:"Timer driven",value:"TIMER_DRIVEN",description:"Reporting task will be scheduled to run on an interval defined by the run schedule."},{text:"CRON driven",value:"CRON_DRIVEN",description:"Reporting task will be scheduled to run on at specific times based on the specified CRON string."}],selectedOption:{value:n.schedulingStrategy},select:function(w){if(w.value==="CRON_DRIVEN"){r.hide();v.show()}else{r.show();v.hide()}}});var s=[{buttonText:"Apply",handler:{click:function(){$("#reporting-task-properties").propertytable("saveRow");d(n).done(function(w){h(w.reportingTask);nf.ControllerService.reloadReferencedServices(w.reportingTask);$("#reporting-task-configuration").modal("hide")})}}},{buttonText:"Cancel",handler:{click:function(){$("#reporting-task-configuration").modal("hide")}}}];if(nf.Common.isDefinedAndNotNull(n.customUiUrl)&&n.customUiUrl!==""){s.push({buttonText:"Advanced",handler:{click:function(){var w=function(){$("#reporting-task-configuration").modal("hide");$("#shell-close-button").click();nf.CustomUi.showCustomUi($("#reporting-task-id").text(),n.customUiUrl,true).done(function(){nf.ReportingTask.reload(n.id).done(function(x){nf.ControllerService.reloadReferencedServices(x.reportingTask)});nf.Settings.showSettings()})};$("#reporting-task-properties").propertytable("saveRow");if(f()){nf.Dialog.showYesNoDialog({dialogContent:"Save changes before opening the advanced configuration?",overlayBackground:false,noHandler:w,yesHandler:function(){d(n).done(function(){w()})}})}else{w()}}}})}$("#reporting-task-configuration").modal("setButtonModel",s);$("#reporting-task-properties").propertytable("loadProperties",n.properties,n.descriptors,q.propertyHistory);$("#reporting-task-configuration").modal("show")}).fail(nf.Common.handleAjaxError)},showDetails:function(n){var l=$("#reporting-task-configuration");if(l.data("mode")===c.edit){$("#reporting-task-configuration .reporting-task-read-only").show();$("#reporting-task-configuration .reporting-task-editable").hide();$("#reporting-task-properties").propertytable("destroy").propertytable({readOnly:true});l.data("mode",c.readOnly)}var m=$.ajax({type:"GET",url:n.uri,dataType:"json"});var k=$.ajax({type:"GET",url:"../nifi-api/controller/history/reporting-tasks/"+encodeURIComponent(n.id),dataType:"json"});$.when(m,k).done(function(o,p){n=o[0].reportingTask;var q=p[0].componentHistory;nf.Common.populateField("reporting-task-id",n.id);nf.Common.populateField("reporting-task-type",nf.Common.substringAfterLast(n.type,"."));nf.Common.populateField("read-only-reporting-task-name",n.name);nf.Common.populateField("read-only-reporting-task-comments",n.comments);if(nf.Canvas.isClustered()){if(n.availability==="node"){$("#reporting-task-availability").text("Node")}else{$("#reporting-task-availability").text("Cluster Manager")}}var s=n.schedulingStrategy;if(s==="CRON_DRIVEN"){s="CRON driven"}else{s="Timer driven"}nf.Common.populateField("read-only-reporting-task-scheduling-strategy",s);nf.Common.populateField("read-only-reporting-task-scheduling-period",n.schedulingPeriod);var r=[{buttonText:"Ok",handler:{click:function(){l.modal("hide")}}}];if(nf.Common.isDefinedAndNotNull(nf.CustomUi)&&nf.Common.isDefinedAndNotNull(n.customUiUrl)&&n.customUiUrl!==""){r.push({buttonText:"Advanced",handler:{click:function(){l.modal("hide");$("#shell-close-button").click();nf.CustomUi.showCustomUi(n.id,n.customUiUrl,false).done(function(){nf.Settings.showSettings()})}}})}l.modal("setButtonModel",r).modal("show");$("#reporting-task-properties").propertytable("loadProperties",n.properties,n.descriptors,q.propertyHistory);l.modal("show")})},start:function(k){g(k,true)},stop:function(k){g(k,false)},reload:function(n){var m=$("#reporting-tasks-table").data("gridInstance");var k=m.getData();var l=k.getItemById(n);return $.ajax({type:"GET",url:l.uri,dataType:"json"}).done(function(o){h(o.reportingTask)}).fail(nf.Common.handleAjaxError)},remove:function(l){var k=nf.Client.getRevision();$.ajax({type:"DELETE",url:l.uri+"?"+$.param({version:k.version,clientId:k.clientId}),dataType:"json"}).done(function(n){nf.Client.setRevision(n.revision);var o=$("#reporting-tasks-table").data("gridInstance");var m=o.getData();m.deleteItem(l.id)}).fail(nf.Common.handleAjaxError)}}}());
nf.ProcessorConfiguration=(function(){var k=[0,25,50,100,250,500,1000,2000];var j=function(l){var m=[{text:"Timer driven",value:"TIMER_DRIVEN",description:"Processor will be scheduled to run on an interval defined by the run schedule."}];if(l.supportsEventDriven===true){m.push({text:"Event driven",value:"EVENT_DRIVEN",description:"Processor will be scheduled to run when triggered by an event (e.g. a FlowFile enters an incoming queue). This scheduling strategy is experimental."})}else{if(l.config.schedulingStrategy==="EVENT_DRIVEN"){m.push({text:"Event driven",value:"EVENT_DRIVEN",description:"Processor will be scheduled to run when triggered by an event (e.g. a FlowFile enters an incoming queue). This scheduling strategy is experimental.",disabled:true})}}if(nf.Canvas.isClustered()){m.push({text:"On primary node",value:"PRIMARY_NODE_ONLY",description:"Processor will be scheduled on the primary node on an interval defined by the run schedule."})}else{if(l.config.schedulingStrategy==="PRIMARY_NODE_ONLY"){m.push({text:"On primary node",value:"PRIMARY_NODE_ONLY",description:"Processor will be scheduled on the primary node on an interval defined by the run schedule.",disabled:true})}}m.push({text:"CRON driven",value:"CRON_DRIVEN",description:"Processor will be scheduled to run on at specific times based on the specified CRON string."});return m};var b=function(o,l,m){if(o.status===400){var p=o.responseText.split("\n");var n;if(p.length===1){n=$("<span></span>").text(p[0])}else{n=nf.Common.formatUnorderedList(p)}nf.Dialog.showOkDialog({dialogContent:n,overlayBackground:false,headerText:"Configuration Error"})}else{nf.Common.handleAjaxError(o,l,m)}};var g=function(q){var l=$('<div class="relationship-name ellipsis"></div>').text(q.name);var n=$('<span class="relationship-name-value hidden"></span>').text(q.name);var o=$('<div class="processor-relationship nf-checkbox"></div>');if(q.autoTerminate===true){o.addClass("checkbox-checked")}else{o.addClass("checkbox-unchecked")}var p=$('<div class="processor-relationship-container"></div>').append(o).append(l).append(n).appendTo("#auto-terminate-relationship-names");if(!nf.Common.isBlank(q.description)){var m=$('<div class="relationship-description"></div>').text(q.description);p.append(m)}return p};var d=function(){var n=$("#processor-configuration").data("processorDetails");var o=false;var p=f();$.each(n.relationships,function(r,s){if(s.autoTerminate===true){if($.inArray(s.name,p)===-1){o=true;return false}}else{if(s.autoTerminate===false){if($.inArray(s.name,p)>=0){o=true;return false}}}});if(o){return true}var q=$("#scheduling-strategy-combo").combo("getSelectedOption").value;if(q!==(n.config.schedulingStrategy+"")){return true}if(n.supportsParallelProcessing===true){var l;if(q==="EVENT_DRIVEN"){l=$("#event-driven-concurrently-schedulable-tasks")}else{if(q==="CRON_DRIVEN"){l=$("#cron-driven-concurrently-schedulable-tasks")}else{l=$("#timer-driven-concurrently-schedulable-tasks")}}if(l.val()!==(n.config.concurrentlySchedulableTaskCount+"")){return true}}var m;if(q==="CRON_DRIVEN"){m=$("#cron-driven-scheduling-period")}else{if(q!=="EVENT_DRIVEN"){m=$("#timer-driven-scheduling-period")}}if(nf.Common.isDefinedAndNotNull(m)&&m.val()!==(n.config.schedulingPeriod+"")){return true}if($("#processor-name").val()!==n.name){return true}if($("#processor-enabled").hasClass("checkbox-checked")&&n.state==="DISABLED"){return true}else{if($("#processor-enabled").hasClass("checkbox-unchecked")&&(n.state==="RUNNING"||n.state==="STOPPED")){return true}}if($("#penalty-duration").val()!==(n.config.penaltyDuration+"")){return true}if($("#yield-duration").val()!==(n.config.yieldDuration+"")){return true}if($("#bulletin-level-combo").combo("getSelectedOption").value!==(n.config.bulletinLevel+"")){return true}if($("#processor-comments").val()!==n.config.comments){return true}return $("#processor-properties").propertytable("isSaveRequired")};var c=function(){var n={};var r=$("#scheduling-strategy-combo").combo("getSelectedOption").value;var l;if(r==="EVENT_DRIVEN"){l=$("#event-driven-concurrently-schedulable-tasks")}else{if(r==="CRON_DRIVEN"){l=$("#cron-driven-concurrently-schedulable-tasks")}else{l=$("#timer-driven-concurrently-schedulable-tasks")}}if(!l.is(":disabled")){n.concurrentlySchedulableTaskCount=l.val()}var m;if(r==="CRON_DRIVEN"){m=$("#cron-driven-scheduling-period")}else{if(r!=="EVENT_DRIVEN"){m=$("#timer-driven-scheduling-period")}}if(nf.Common.isDefinedAndNotNull(m)){n.schedulingPeriod=m.val()}n.penaltyDuration=$("#penalty-duration").val();n.yieldDuration=$("#yield-duration").val();n.bulletinLevel=$("#bulletin-level-combo").combo("getSelectedOption").value;n.schedulingStrategy=r;n.comments=$("#processor-comments").val();if($("#run-duration-setting-container").is(":visible")){var p=$("#run-duration-slider").slider("value");n.runDurationMillis=k[p]}n.autoTerminatedRelationships=f();var o=$("#processor-properties").propertytable("marshalProperties");if($.isEmptyObject(o)===false){n.properties=o}var s={};s.id=$("#processor-id").text();s.name=$("#processor-name").val();s.config=n;if($("#processor-enabled").hasClass("checkbox-unchecked")){s.state="DISABLED"}else{if($("#processor-enabled").hasClass("checkbox-checked")){s.state="STOPPED"}}var q={};q.revision=nf.Client.getRevision();q.processor=s;return q};var f=function(){var m=$("#auto-terminate-relationship-names");var l=[];$.each(m.children(),function(n,q){var p=$(q);var o=p.children("div.processor-relationship");if(o.hasClass("checkbox-checked")){l.push(p.children("span.relationship-name-value").text())}});return l};var a=function(m){var o=[];var n=m.processor;var l=n.config;if(nf.Common.isDefinedAndNotNull(l.concurrentlySchedulableTaskCount)&&!$.isNumeric(l.concurrentlySchedulableTaskCount)){o.push("Concurrent tasks must be an integer value")}if(nf.Common.isDefinedAndNotNull(l.schedulingPeriod)&&nf.Common.isBlank(l.schedulingPeriod)){o.push("Run schedule must be specified")}if(nf.Common.isBlank(l.penaltyDuration)){o.push("Penalty duration must be specified")}if(nf.Common.isBlank(l.yieldDuration)){o.push("Yield duration must be specified")}if(o.length>0){nf.Dialog.showOkDialog({dialogContent:nf.Common.formatUnorderedList(o),overlayBackground:false,headerText:"Configuration Error"});return false}else{return true}};var e=function(m){var l=nf.Connection.getComponentConnections(m.id);$.each(l,function(o,n){if(n.source.id===m.id){nf.Connection.reload(n)}})};var h=function(){return $.Deferred(function(l){$("#processor-properties").propertytable("saveRow");if(d()){nf.Dialog.showYesNoDialog({dialogContent:"Save changes before going to this Controller Service?",overlayBackground:false,noHandler:function(){l.resolve()},yesHandler:function(){var m=$("#processor-configuration").data("processorDetails");i(m).done(function(){l.resolve()}).fail(function(){l.reject()})}})}else{l.resolve()}}).promise()};var i=function(l){var m=c();if(a(m)){return $.ajax({type:"PUT",data:JSON.stringify(m),url:l.uri,dataType:"json",processData:false,contentType:"application/json"}).done(function(n){if(nf.Common.isDefinedAndNotNull(n.processor)){nf.Client.setRevision(n.revision)}}).fail(b)}else{return $.Deferred(function(n){n.reject()}).promise()}};return{init:function(){$("#processor-configuration-tabs").tabbs({tabStyle:"tab",selectedTabStyle:"selected-tab",tabs:[{name:"Settings",tabContentId:"processor-standard-settings-tab-content"},{name:"Scheduling",tabContentId:"processor-scheduling-tab-content"},{name:"Properties",tabContentId:"processor-properties-tab-content"},{name:"Comments",tabContentId:"processor-comments-tab-content"}],select:function(){nf.UniversalCapture.removeAllPropertyDetailDialogs();if($(this).text()==="Properties"){$("#processor-properties").propertytable("resetTableSize")}$("#processor-properties").propertytable("saveRow");var l=$("#auto-terminate-relationship-names");if(l.is(":visible")&&l.get(0).scrollHeight>l.innerHeight()){l.css("border-width","1px")}}});$("#processor-configuration").modal({headerText:"Configure Processor",overlayBackground:true,handler:{close:function(){$("#auto-terminate-relationship-names").css("border-width","0").empty();$("#processor-properties").propertytable("cancelEdit").propertytable("clear");$("#processor-configuration").removeData("processorDetails")}}}).draggable({containment:"parent",handle:".dialog-header"});$("#bulletin-level-combo").combo({options:[{text:"DEBUG",value:"DEBUG"},{text:"INFO",value:"INFO"},{text:"WARN",value:"WARN"},{text:"ERROR",value:"ERROR"}]});$("#run-duration-slider").slider({min:0,max:k.length-1,change:function(m,n){var l=$("#processor-configuration").data("processorDetails");if(n.value>0&&(l.inputRequirement==="INPUT_FORBIDDEN"||l.inputRequirement==="INPUT_ALLOWED")){$("#run-duration-data-loss").show()}else{$("#run-duration-data-loss").hide()}}});$("#processor-properties").propertytable({readOnly:false,dialogContainer:"#new-processor-property-container",descriptorDeferred:function(l){var m=$("#processor-configuration").data("processorDetails");return $.ajax({type:"GET",url:m.uri+"/descriptors",data:{propertyName:l},dataType:"json"}).fail(nf.Common.handleAjaxError)},goToServiceDeferred:h})},showConfiguration:function(m){if(nf.CanvasUtils.isProcessor(m)){var n=m.datum();var l=n.component;var o=[];o.push(nf.Processor.reload(l));o.push($.ajax({type:"GET",url:"../nifi-api/controller/history/processors/"+encodeURIComponent(l.id),dataType:"json"}));if(nf.Common.isDFM()){o.push()}$.when.apply(window,o).done(function(v,w){l=v[0].processor;var s=w[0].componentHistory;$("#processor-configuration").data("processorDetails",l);var r="checkbox-checked";if(l.state==="DISABLED"){r="checkbox-unchecked"}$("#processor-id").text(l.id);$("#processor-type").text(nf.Common.substringAfterLast(l.type,"."));$("#processor-name").val(l.name);$("#processor-enabled").removeClass("checkbox-unchecked checkbox-checked").addClass(r);$("#penalty-duration").val(l.config.penaltyDuration);$("#yield-duration").val(l.config.yieldDuration);$("#processor-comments").val(l.config.comments);if(l.supportsBatching===true){$("#run-duration-setting-container").show();var x=k.indexOf(l.config.runDurationMillis);$("#run-duration-slider").slider("value",x)}else{$("#run-duration-setting-container").hide()}$("#bulletin-level-combo").combo("setSelectedOption",{value:l.config.bulletinLevel});$("#scheduling-strategy-combo").combo({options:j(l),selectedOption:{value:l.config.schedulingStrategy},select:function(z){if(z.value==="EVENT_DRIVEN"){$("#event-driven-warning").show();$("#timer-driven-options").hide();$("#event-driven-options").show();$("#cron-driven-options").hide()}else{$("#event-driven-warning").hide();if(z.value==="CRON_DRIVEN"){$("#timer-driven-options").hide();$("#event-driven-options").hide();$("#cron-driven-options").show()}else{$("#timer-driven-options").show();$("#event-driven-options").hide();$("#cron-driven-options").hide()}}}});var y=l.config.defaultConcurrentTasks;$("#timer-driven-concurrently-schedulable-tasks").val(y.TIMER_DRIVEN);$("#event-driven-concurrently-schedulable-tasks").val(y.EVENT_DRIVEN);$("#cron-driven-concurrently-schedulable-tasks").val(y.CRON_DRIVEN);var u;if(l.config.schedulingStrategy==="EVENT_DRIVEN"){u=$("#event-driven-concurrently-schedulable-tasks").val(l.config.concurrentlySchedulableTaskCount)}else{if(l.config.schedulingStrategy==="CRON_DRIVEN"){u=$("#cron-driven-concurrently-schedulable-tasks").val(l.config.concurrentlySchedulableTaskCount)}else{u=$("#timer-driven-concurrently-schedulable-tasks").val(l.config.concurrentlySchedulableTaskCount)}}if(nf.Common.isDefinedAndNotNull(u)){if(l.supportsParallelProcessing===true){u.prop("disabled",false)}else{u.prop("disabled",true)}}var q=l.config.defaultSchedulingPeriod;$("#cron-driven-scheduling-period").val(q.CRON_DRIVEN);$("#timer-driven-scheduling-period").val(q.TIMER_DRIVEN);if(l.config.schedulingStrategy==="CRON_DRIVEN"){$("#cron-driven-scheduling-period").val(l.config.schedulingPeriod)}else{if(l.config.schedulingStrategy!=="EVENT_DRIVEN"){$("#timer-driven-scheduling-period").val(l.config.schedulingPeriod)}}if(!nf.Common.isEmpty(l.relationships)){$.each(l.relationships,function(z,A){g(A)})}else{$("#auto-terminate-relationship-names").append('<div class="unset">This processor has no relationships.</div>')}var t=[{buttonText:"Apply",handler:{click:function(){$("#processor-properties").propertytable("saveRow");i(l).done(function(z){nf.Processor.set(z.processor);e(l);$("#processor-configuration").modal("hide")})}}},{buttonText:"Cancel",handler:{click:function(){$("#processor-configuration").modal("hide")}}}];if(nf.Common.isDefinedAndNotNull(l.config.customUiUrl)&&l.config.customUiUrl!==""){t.push({buttonText:"Advanced",handler:{click:function(){var z=function(){$("#processor-configuration").modal("hide");nf.CustomUi.showCustomUi($("#processor-id").text(),l.config.customUiUrl,true).done(function(){nf.Processor.reload(l);e(l)})};$("#processor-properties").propertytable("saveRow");if(d()){nf.Dialog.showYesNoDialog({dialogContent:"Save changes before opening the advanced configuration?",overlayBackground:false,noHandler:z,yesHandler:function(){i(l).done(function(A){z()})}})}else{z()}}}})}$("#processor-configuration").modal("setButtonModel",t);$("#processor-properties").propertytable("loadProperties",l.config.properties,l.config.descriptors,s.propertyHistory);$("#processor-configuration").modal("show");$("#processor-configuration div.relationship-name").ellipsis();var p=$("#auto-terminate-relationship-names");if(p.is(":visible")&&p.get(0).scrollHeight>p.innerHeight()){p.css("border-width","1px")}}).fail(nf.Common.handleAjaxError)}}}}());
nf.ProcessorDetails=(function(){var a=function(e){var b=$('<div class="relationship-name ellipsis"></div>').text(e.name);if(e.autoTerminate===true){b.css("font-weight","bold")}var d=$('<div class="processor-relationship-container"></div>').append(b).appendTo("#read-only-auto-terminate-relationship-names");if(!nf.Common.isBlank(e.description)){var c=$('<div class="relationship-description"></div>').text(e.description);d.append(c)}return d};return{init:function(b){b=nf.Common.isDefinedAndNotNull(b)?b:true;$("#processor-details-tabs").tabbs({tabStyle:"tab",selectedTabStyle:"selected-tab",tabs:[{name:"Settings",tabContentId:"details-standard-settings-tab-content"},{name:"Scheduling",tabContentId:"details-scheduling-tab-content"},{name:"Properties",tabContentId:"details-processor-properties-tab-content"},{name:"Comments",tabContentId:"details-processor-comments-tab-content"}],select:function(){nf.UniversalCapture.removeAllPropertyDetailDialogs();if($(this).text()==="Properties"){$("#read-only-processor-properties").propertytable("resetTableSize")}var c=$("#read-only-auto-terminate-relationship-names");if(c.is(":visible")&&c.get(0).scrollHeight>c.innerHeight()){c.css("border-width","1px")}}});$("#processor-details").modal({headerText:"Processor Details",overlayBackground:b,handler:{close:function(){$("#read-only-auto-terminate-relationship-names").css("border-width","0").empty();$("#read-only-processor-properties").propertytable("clear");nf.Common.clearField("read-only-processor-id");nf.Common.clearField("read-only-processor-type");nf.Common.clearField("read-only-processor-name");nf.Common.clearField("read-only-concurrently-schedulable-tasks");nf.Common.clearField("read-only-scheduling-period");nf.Common.clearField("read-only-penalty-duration");nf.Common.clearField("read-only-yield-duration");nf.Common.clearField("read-only-run-duration");nf.Common.clearField("read-only-bulletin-level");nf.Common.clearField("read-only-execution-status");nf.Common.clearField("read-only-processor-comments");$("#processor-details").removeData("processorDetails");$("#processor-details").removeData("processorHistory")}}});if(b){$("#processor-details").draggable({containment:"parent",handle:".dialog-header"})}$("#read-only-processor-properties").propertytable({readOnly:true})},showDetails:function(d,e){var c=$.ajax({type:"GET",url:"../nifi-api/controller/process-groups/"+encodeURIComponent(d)+"/processors/"+encodeURIComponent(e),dataType:"json"}).done(function(g){if(nf.Common.isDefinedAndNotNull(g.processor)){var h=g.processor;$("#processor-details").data("processorDetails",h);nf.Common.populateField("read-only-processor-id",h.id);nf.Common.populateField("read-only-processor-type",nf.Common.substringAfterLast(h.type,"."));nf.Common.populateField("read-only-processor-name",h.name);nf.Common.populateField("read-only-concurrently-schedulable-tasks",h.config.concurrentlySchedulableTaskCount);nf.Common.populateField("read-only-scheduling-period",h.config.schedulingPeriod);nf.Common.populateField("read-only-penalty-duration",h.config.penaltyDuration);nf.Common.populateField("read-only-yield-duration",h.config.yieldDuration);nf.Common.populateField("read-only-run-duration",nf.Common.formatDuration(h.config.runDurationMillis));nf.Common.populateField("read-only-bulletin-level",h.config.bulletinLevel);nf.Common.populateField("read-only-processor-comments",h.config.comments);var f=true;var i=h.config.schedulingStrategy;if(i==="EVENT_DRIVEN"){f=false;i="Event driven"}else{if(i==="CRON_DRIVEN"){i="CRON driven"}else{if(i==="TIMER_DRIVEN"){i="Timer driven"}else{i="On primary node"}}}nf.Common.populateField("read-only-scheduling-strategy",i);if(f===true){$("#read-only-run-schedule").show()}else{$("#read-only-run-schedule").hide()}if(!nf.Common.isEmpty(h.relationships)){$.each(h.relationships,function(j,k){a(k)})}else{$("#read-only-auto-terminate-relationship-names").append('<div class="unset">This processor has no relationships.</div>')}}});var b=$.ajax({type:"GET",url:"../nifi-api/controller/history/processors/"+encodeURIComponent(e),dataType:"json"}).done(function(f){var g=f.componentHistory;$("#processor-details").data("processorHistory",g)});$.when(c,b).done(function(i,f){var i=i[0];var g=i.processor;var f=f[0];var k=f.componentHistory;$("#read-only-processor-properties").propertytable("loadProperties",g.config.properties,g.config.descriptors,k.propertyHistory);var h=[{buttonText:"Ok",handler:{click:function(){$("#processor-details").modal("hide")}}}];if(nf.Common.isDefinedAndNotNull(nf.CustomUi)&&nf.Common.isDefinedAndNotNull(g.config.customUiUrl)&&g.config.customUiUrl!==""){h.push({buttonText:"Advanced",handler:{click:function(){$("#processor-details").modal("hide");nf.CustomUi.showCustomUi(g.id,g.config.customUiUrl,false)}}})}$("#processor-details").modal("setButtonModel",h).modal("show");$("#processor-details div.relationship-name").ellipsis();var j=$("#read-only-auto-terminate-relationship-names");if(j.is(":visible")&&j.get(0).scrollHeight>j.innerHeight()){j.css("border-width","1px")}}).fail(function(h,f,g){if(h.status===400||h.status===404||h.status===409){nf.Dialog.showOkDialog({dialogContent:nf.Common.escapeHtml(h.responseText),overlayBackground:false})}else{nf.Common.handleAjaxError(h,f,g)}})}}}());
nf.ProcessGroupConfiguration=(function(){return{init:function(){$("#process-group-configuration").modal({headerText:"Configure Process Group",overlayBackground:true,buttons:[{buttonText:"Apply",handler:{click:function(){var b=nf.Client.getRevision();var a=$("#process-group-id").text();var c=d3.select("#id-"+a).datum();$.ajax({type:"PUT",data:{version:b.version,clientId:b.clientId,name:$("#process-group-name").val(),comments:$("#process-group-comments").val()},url:c.component.uri,dataType:"json"}).done(function(d){if(nf.Common.isDefinedAndNotNull(d.processGroup)){nf.Client.setRevision(d.revision);nf.ProcessGroup.set(d.processGroup);$("#process-group-configuration").modal("hide")}}).fail(function(f,d,e){$("#process-group-configuration").modal("hide");nf.Common.handleAjaxError(f,d,e)})}}},{buttonText:"Cancel",handler:{click:function(){$("#process-group-configuration").modal("hide")}}}],handler:{close:function(){$("#process-group-id").text("");$("#process-group-name").val("");$("#process-group-comments").val("")}}}).draggable({containment:"parent",handle:".dialog-header"})},showConfiguration:function(a){if(nf.CanvasUtils.isProcessGroup(a)){var b=a.datum();$("#process-group-id").text(b.component.id);$("#process-group-name").val(b.component.name);$("#process-group-comments").val(b.component.comments);$("#process-group-configuration").modal("show")}}}}());
nf.ProcessGroupDetails=(function(){return{init:function(){$("#process-group-details").modal({headerText:"Process Group Details",overlayBackground:true,buttons:[{buttonText:"Ok",handler:{click:function(){$("#process-group-details").modal("hide")}}}],handler:{close:function(){nf.Common.clearField("read-only-process-group-id");nf.Common.clearField("read-only-process-group-name");nf.Common.clearField("read-only-process-group-comments")}}}).draggable({containment:"parent",handle:".dialog-header"})},showDetails:function(a){if(nf.CanvasUtils.isProcessGroup(a)){var b=a.datum();nf.Common.populateField("read-only-process-group-id",b.component.id);nf.Common.populateField("read-only-process-group-name",b.component.name);nf.Common.populateField("read-only-process-group-comments",b.component.comments);$("#process-group-details").modal("show")}}}}());
nf.RemoteProcessGroupConfiguration=(function(){return{init:function(){$("#remote-process-group-configuration").modal({headerText:"Configure Remote Process Group",overlayBackground:true,buttons:[{buttonText:"Apply",handler:{click:function(){var a=$("#remote-process-group-id").text();var b=d3.select("#id-"+a).datum();var c={revision:nf.Client.getRevision(),remoteProcessGroup:{id:a,communicationsTimeout:$("#remote-process-group-timeout").val(),yieldDuration:$("#remote-process-group-yield-duration").val()}};$.ajax({type:"PUT",data:JSON.stringify(c),url:b.component.uri,dataType:"json",processData:false,contentType:"application/json"}).done(function(d){nf.Client.setRevision(d.revision);nf.RemoteProcessGroup.set(d.remoteProcessGroup);$("#remote-process-group-configuration").modal("hide")}).fail(function(g,d,e){if(g.status===400){var h=g.responseText.split("\n");var f;if(h.length===1){f=$("<span></span>").text(h[0])}else{f=nf.Common.formatUnorderedList(h)}nf.Dialog.showOkDialog({dialogContent:f,overlayBackground:false,headerText:"Configuration Error"})}else{nf.Common.handleAjaxError(g,d,e)}})}}},{buttonText:"Cancel",handler:{click:function(){$("#remote-process-group-configuration").modal("hide")}}}],handler:{close:function(){$("#remote-process-group-id").text("");$("#remote-process-group-name").text("");$("#remote-process-group-url").text("");$("#remote-process-group-timeout").val("");$("#remote-process-group-yield-duration").val("")}}}).draggable({containment:"parent",handle:".dialog-header"})},showConfiguration:function(a){if(nf.CanvasUtils.isRemoteProcessGroup(a)){var b=a.datum();$("#remote-process-group-id").text(b.component.id);$("#remote-process-group-name").text(b.component.name);$("#remote-process-group-url").text(b.component.targetUri);$("#remote-process-group-timeout").val(b.component.communicationsTimeout);$("#remote-process-group-yield-duration").val(b.component.yieldDuration);$("#remote-process-group-configuration").modal("show")}}}}());
nf.RemoteProcessGroupDetails=(function(){return{init:function(){$("#remote-process-group-details").modal({headerText:"Remote Process Group Details",overlayBackground:true,buttons:[{buttonText:"Ok",handler:{click:function(){$("#remote-process-group-details").modal("hide")}}}],handler:{close:function(){nf.Common.clearField("read-only-remote-process-group-id");nf.Common.clearField("read-only-remote-process-group-name");nf.Common.clearField("read-only-remote-process-group-url");nf.Common.clearField("read-only-remote-process-group-timeout");nf.Common.clearField("read-only-remote-process-group-yield-duration")}}}).draggable({containment:"parent",handle:".dialog-header"})},showDetails:function(a){if(nf.CanvasUtils.isRemoteProcessGroup(a)){var b=a.datum();nf.Common.populateField("read-only-remote-process-group-id",b.component.id);nf.Common.populateField("read-only-remote-process-group-name",b.component.name);nf.Common.populateField("read-only-remote-process-group-url",b.component.targetUri);nf.Common.populateField("read-only-remote-process-group-timeout",b.component.communicationsTimeout);nf.Common.populateField("read-only-remote-process-group-yield-duration",b.component.yieldDuration);$("#remote-process-group-details").modal("show")}}}}());
nf.RemoteProcessGroupPorts=(function(){var b=function(){$("#remote-port-configuration").modal({headerText:"Configure Remote Port",overlayBackground:false,buttons:[{buttonText:"Apply",handler:{click:function(){var f=$("#remote-port-concurrent-tasks").val();if($.isNumeric(f)){var e=$("#remote-process-group-ports-id").text();var j=d3.select("#id-"+e).datum();var i=$("#remote-port-id").text();var h={revision:nf.Client.getRevision(),remoteProcessGroupPort:{id:i,useCompression:$("#remote-port-use-compression").hasClass("checkbox-checked"),concurrentlySchedulableTaskCount:f}};var g="/output-ports/";if($("#remote-port-type").text()==="input"){g="/input-ports/"}$.ajax({type:"PUT",data:JSON.stringify(h),url:j.component.uri+g+encodeURIComponent(i),dataType:"json",processData:false,contentType:"application/json"}).done(function(k){nf.Client.setRevision(k.revision);var l=k.remoteProcessGroupPort;var m="No";if(l.useCompression===true){m="Yes"}$("#"+i+"-concurrent-tasks").text(l.concurrentlySchedulableTaskCount);$("#"+i+"-compression").text(m)}).fail(function(n,k,l){if(n.status===400){var o=n.responseText.split("\n");var m;if(o.length===1){m=$("<span></span>").text(o[0])}else{m=nf.Common.formatUnorderedList(o)}nf.Dialog.showOkDialog({dialogContent:m,overlayBackground:false,headerText:"Configuration Error"})}else{nf.Common.handleAjaxError(n,k,l)}}).always(function(){$("#remote-port-configuration").modal("hide")})}else{nf.Dialog.showOkDialog({dialogContent:"Concurrent tasks must be an integer value.",overlayBackground:false});$("#remote-port-configuration").modal("hide")}}}},{buttonText:"Cancel",handler:{click:function(){$("#remote-port-configuration").modal("hide")}}}],handler:{close:function(){$("#remote-port-id").text("");$("#remote-port-name").text("");$("#remote-port-concurrent-tasks").val("");$("#remote-port-use-compression").removeClass("checkbox-checked checkbox-unchecked")}}})};var a=function(){$("#remote-process-group-ports").modal({headerText:"Remote Process Group Ports",overlayBackground:true,buttons:[{buttonText:"Close",handler:{click:function(){if(nf.Common.isDFM()){var e=$("#remote-process-group-ports-id").text();var f=d3.select("#id-"+e).datum();nf.RemoteProcessGroup.reload(f.component)}$("#remote-process-group-ports").modal("hide")}}}],handler:{close:function(){$("#remote-process-group-ports-id").text("");$("#remote-process-group-ports-name").text("");$("#remote-process-group-ports-url").text("");var e=$("#remote-process-group-ports");nf.Common.cleanUpTooltips(e,"div.remote-port-removed");nf.Common.cleanUpTooltips(e,"img.concurrent-tasks-info");$("#remote-process-group-input-ports-container").empty();$("#remote-process-group-output-ports-container").empty()}}}).draggable({containment:"parent",handle:".dialog-header"})};var c=function(h,k,i){var l=nf.Common.escapeHtml(k.id);var f=$('<div class="remote-port-container"></div>').appendTo(h);var q=$('<div class="remote-port-edit-container"></div>').appendTo(f);var g=$('<div class="remote-port-details-container"></div>').appendTo(f);if(nf.Common.isDFM()){var e;if(k.connected===true){if(k.transmitting===true){e=$('<div class="enabled-transmission-switch enabled-active-transmission"></div>').appendTo(q)}else{if(k.exists===true){e=$('<div class="enabled-transmission-switch enabled-inactive-transmission"></div>').appendTo(q)}else{$('<div class="disabled-transmission-switch disabled-inactive-transmission"></div>').appendTo(q)}}}else{if(k.transmitting===true){$('<div class="disabled-transmission-switch disabled-active-transmission"></div>').appendTo(q)}else{$('<div class="disabled-transmission-switch disabled-inactive-transmission"></div>').appendTo(q)}}if(k.exists===true&&k.connected===true){var j=$('<div class="edit-button edit-remote-port"></div>').on("mouseenter",function(){$(this).removeClass("edit-remote-port").addClass("edit-remote-port-hover")}).on("mouseleave",function(){$(this).removeClass("edit-remote-port-hover").addClass("edit-remote-port")}).click(function(){var t=$("#"+l+"-name").text();var s=$("#"+l+"-concurrent-tasks").text();var r=$("#"+l+"-compression").text()==="Yes";d(k.id,t,s,r,i)}).appendTo(q);if(k.transmitting===true){j.hide()}else{j.show()}}else{if(k.exists===false){$('<div class="remote-port-removed"/>').appendTo(q).qtip($.extend({content:"This port has been removed."},nf.Common.config.tooltipConfig))}}if(nf.Common.isDefinedAndNotNull(e)){e.click(function(){var r=$("#remote-process-group-ports-id").text();var u=d3.select("#id-"+r).datum();var v=false;if(e.hasClass("enabled-inactive-transmission")){v=true}var t={revision:nf.Client.getRevision(),remoteProcessGroupPort:{id:k.id,transmitting:v}};var s="/output-ports/";if(i==="input"){s="/input-ports/"}$.ajax({type:"PUT",data:JSON.stringify(t),url:u.component.uri+s+encodeURIComponent(k.id),dataType:"json",processData:false,contentType:"application/json"}).done(function(w){nf.Client.setRevision(w.revision);var x=w.remoteProcessGroupPort;if(x.exists===false){e.removeClass("enabled-active-transmission enabled-inactive-transmission enabled-transmission-switch").addClass("disabled-transmission-switch disabled-inactive-transmission").off("click");if(nf.Common.isDefinedAndNotNull(j)){j.hide()}}else{if(x.transmitting===true){e.removeClass("enabled-active-transmission enabled-inactive-transmission").addClass("enabled-active-transmission");if(nf.Common.isDefinedAndNotNull(j)){j.hide()}}else{e.removeClass("enabled-active-transmission enabled-inactive-transmission").addClass("enabled-inactive-transmission");if(nf.Common.isDefinedAndNotNull(j)){j.show()}}}}).fail(function(z,w,x){if(z.status===400){var A=z.responseText.split("\n");var y;if(A.length===1){y=$("<span></span>").text(A[0])}else{y=nf.Common.formatUnorderedList(A)}nf.Dialog.showOkDialog({dialogContent:y,overlayBackground:false,headerText:"Configuration Error"})}else{nf.Common.handleAjaxError(z,w,x)}})})}}else{if(k.transmitting===true){$('<div class="disabled-transmission-switch disabled-active-transmission"></div>').appendTo(q)}else{$('<div class="disabled-transmission-switch disabled-inactive-transmission"></div>').appendTo(q)}}$('<div id="'+l+'-id" class="remote-port-id hidden"></div>').text(k.id).appendTo(g);$('<div id="'+l+'-name" class="remote-port-name ellipsis"></div>').text(k.name).appendTo(g);$('<div class="clear"></div>').appendTo(g);if(nf.Common.isBlank(k.comments)){$('<div class="remote-port-description unset">No description specified.</div>').appendTo(g)}else{$('<div class="remote-port-description"></div>').text(k.comments).appendTo(g)}$('<div class="clear"></div>').appendTo(g);var m=$('<div class="concurrent-task-container"></div>').appendTo(g);var n=$('<div class="setting-value"></div>').append($('<div id="'+l+'-concurrent-tasks"></div>').text(k.concurrentlySchedulableTaskCount));$('<div><div class="setting-name">Concurrent tasks<img class="processor-setting concurrent-tasks-info" src="images/iconInfo.png" alt="Info"/></div></div>').append(n).appendTo(m).find("img.concurrent-tasks-info").qtip($.extend({content:"The number of tasks that should be concurrently scheduled for this port."},nf.Common.config.tooltipConfig));var o=$('<div class="compression-container"></div>').appendTo(g);var p="No";if(k.useCompression===true){p="Yes"}$('<div><div class="setting-name">Compressed</div><div class="setting-value"><div id="'+l+'-compression">'+p+"</div></div></div>").appendTo(o);$('<div class="clear"></div>').appendTo(f);f.find(".ellipsis").ellipsis()};var d=function(g,j,i,f,e){$("#remote-port-id").text(g);$("#remote-port-type").text(e);var h="checkbox-unchecked";if(f===true){h="checkbox-checked"}$("#remote-port-use-compression").addClass(h);$("#remote-port-concurrent-tasks").val(i);$("#remote-port-name").text(j).ellipsis();$("#remote-port-configuration").modal("show")};return{init:function(){b();a()},showPorts:function(e){if(nf.CanvasUtils.isRemoteProcessGroup(e)){var f=e.datum();$.ajax({type:"GET",url:f.component.uri,data:{verbose:true},dataType:"json"}).done(function(h){var k=h.remoteProcessGroup;nf.RemoteProcessGroup.set(k);$("#remote-process-group-ports-id").text(k.id);$("#remote-process-group-ports-name").text(k.name);$("#remote-process-group-ports-url").text(k.targetUri);var g=k.contents;if(nf.Common.isDefinedAndNotNull(g)){var n=[];var i=[];var m=$("#remote-process-group-input-ports-container");$.each(g.inputPorts,function(q,p){if(p.connected===true){n.push(p)}else{i.push(p)}});$.each(n,function(q,p){c(m,p,"input")});$.each(i,function(q,p){c(m,p,"input")});var j=[];var o=[];var l=$("#remote-process-group-output-ports-container");$.each(g.outputPorts,function(p,q){if(q.connected===true){j.push(q)}else{o.push(q)}});$.each(j,function(p,q){c(l,q,"output")});$.each(o,function(p,q){c(l,q,"output")})}$("#remote-process-group-ports").modal("show")}).fail(nf.Common.handleAjaxError)}}}}());
nf.PortConfiguration=(function(){var a=function(){$("#port-configuration").modal({headerText:"Configure Port",overlayBackground:true,buttons:[{buttonText:"Apply",handler:{click:function(){var c=nf.Client.getRevision();var d=$("#port-id").text();var b=d3.select("#id-"+d).datum();var e={version:c.version,clientId:c.clientId,name:$("#port-name").val(),comments:$("#port-comments").val()};if($("#port-concurrent-task-container").is(":visible")){e.concurrentlySchedulableTaskCount=$("#port-concurrent-tasks").val()}if($("#port-enabled").hasClass("checkbox-unchecked")){e.state="DISABLED"}else{if($("#port-enabled").hasClass("checkbox-checked")){e.state="STOPPED"}}$.ajax({type:"PUT",data:e,url:b.component.uri,dataType:"json"}).done(function(g){nf.Client.setRevision(g.revision);var f;if(nf.Common.isDefinedAndNotNull(g.inputPort)){f=g.inputPort}else{f=g.outputPort}nf.Port.set(f);$("#port-configuration").modal("hide")}).fail(function(i,f,g){if(i.status===400){var j=i.responseText.split("\n");var h;if(j.length===1){h=$("<span></span>").text(j[0])}else{h=nf.Common.formatUnorderedList(j)}nf.Dialog.showOkDialog({dialogContent:h,overlayBackground:false,headerText:"Configuration Error"})}else{$("#port-configuration").modal("hide");nf.Common.handleAjaxError(i,f,g)}})}}},{buttonText:"Cancel",handler:{click:function(){$("#port-configuration").modal("hide")}}}],handler:{close:function(){$("#port-id").text("");$("#port-name").val("");$("#port-enabled").removeClass("checkbox-unchecked checkbox-checked");$("#port-concurrent-tasks").val("");$("#port-comments").val("")}}}).draggable({containment:"parent",handle:".dialog-header"})};return{init:function(){a()},showConfiguration:function(c){if(nf.CanvasUtils.isInputPort(c)||nf.CanvasUtils.isOutputPort(c)){var d=c.datum();var b="checkbox-checked";if(d.component.state==="DISABLED"){b="checkbox-unchecked"}if(nf.Canvas.getParentGroupId()===null){$("#port-concurrent-task-container").show()}else{$("#port-concurrent-task-container").hide()}$("#port-id").text(d.component.id);$("#port-name").val(d.component.name);$("#port-enabled").removeClass("checkbox-unchecked checkbox-checked").addClass(b);$("#port-concurrent-tasks").val(d.component.concurrentlySchedulableTaskCount);$("#port-comments").val(d.component.comments);$("#port-configuration").modal("show")}}}}());
nf.PortDetails=(function(){return{init:function(){$("#port-details").modal({headerText:"Port Details",overlayBackground:true,buttons:[{buttonText:"Ok",handler:{click:function(){$("#port-details").modal("hide")}}}],handler:{close:function(){nf.Common.clearField("read-only-port-name");nf.Common.clearField("read-only-port-id");nf.Common.clearField("read-only-port-comments")}}}).draggable({containment:"parent",handle:".dialog-header"})},showDetails:function(a){if(nf.CanvasUtils.isInputPort(a)||nf.CanvasUtils.isOutputPort(a)){var b=a.datum();nf.Common.populateField("read-only-port-name",b.component.name);nf.Common.populateField("read-only-port-id",b.component.id);nf.Common.populateField("read-only-port-comments",b.component.comments);$("#port-details").modal("show")}}}}());
nf.SecurePortConfiguration=(function(){var f="";var b={search:"User DNs, groups, etc"};var g=function(){$("#secure-port-configuration-tabs").tabbs({tabStyle:"tab",selectedTabStyle:"selected-tab",tabs:[{name:"Settings",tabContentId:"secure-port-settings-tab-content"},{name:"Access Control",tabContentId:"secure-port-access-control-tab-content"}]});$("#secure-port-configuration").modal({headerText:"Configure Secure Port",overlayBackground:true,buttons:[{buttonText:"Apply",handler:{click:function(){var j=$("#secure-port-id").text();var h=$("#secure-port-type").text();var k={};k.id=j;k.name=$("#secure-port-name").val();k.comments=$("#secure-port-comments").val();k.groupAccessControl=a();k.userAccessControl=c();if($("#secure-port-concurrent-task-container").is(":visible")){k.concurrentlySchedulableTaskCount=$("#secure-port-concurrent-tasks").val()}if($("#secure-port-enabled").hasClass("checkbox-unchecked")){k.state="DISABLED"}else{if($("#secure-port-enabled").hasClass("checkbox-checked")){k.state="STOPPED"}}var i={};i.revision=nf.Client.getRevision();i[h]=k;$.ajax({type:"PUT",data:JSON.stringify(i),contentType:"application/json",url:f,dataType:"json"}).done(function(m){nf.Client.setRevision(m.revision);var l;if(nf.Common.isDefinedAndNotNull(m.inputPort)){l=m.inputPort}else{l=m.outputPort}nf.Port.set(l);$("#secure-port-configuration").modal("hide")}).fail(function(n,l,m){$("#secure-port-configuration").modal("hide");nf.Common.handleAjaxError(n,l,m)})}}},{buttonText:"Cancel",handler:{click:function(){$("#secure-port-configuration").modal("hide")}}}],handler:{close:function(){f="";$("#secure-port-id").text("");$("#secure-port-type").text("");$("#secure-port-name").val("");$("#secure-port-enabled").removeClass("checkbox-unchecked checkbox-checked");$("#secure-port-concurrent-tasks").val("");$("#secure-port-comments").val("");$("#allowed-users").empty();$("#allowed-groups").empty()}}}).draggable({containment:"parent",handle:".dialog-header"});$(document).on("click","div.remove-allowed-entity",function(){$(this).closest("li").remove();$(this).closest("ul").sortable("refresh")});$.widget("nf.userSearchAutocomplete",$.ui.autocomplete,{_normalize:function(i){var h=[];h.push(i);return h},_resizeMenu:function(){var h=this.menu.element;h.width(700)},_renderMenu:function(m,i){var h=this;var l=i[0];if(!nf.Common.isEmpty(l.userGroupResults)){var k=a();var j=false;$.each(l.userGroupResults,function(p,q){if($.inArray(q.group,k)===-1){if(!j){m.append('<li class="search-users-header">Groups</li>');j=true}h._renderGroupItem(m,q)}})}if(!nf.Common.isEmpty(l.userResults)){var n=c();var o=false;$.each(l.userResults,function(p,q){if($.inArray(q.userDn,n)===-1){if(!o){m.append('<li class="search-users-header">Users</li>');o=true}h._renderUserItem(m,q)}})}if(m.children().length===0){m.append('<li class="unset search-users-no-matches">No users or groups match</li>')}},_renderGroupItem:function(h,j){var i=$("<a></a>").append($('<div class="search-users-match-header"></div>').text(j.group));return $("<li></li>").data("ui-autocomplete-item",j).append(i).appendTo(h)},_renderUserItem:function(i,j){var h=$("<a></a>").append($('<div class="search-users-match-header"></div>').text(j.userDn));return $("<li></li>").data("ui-autocomplete-item",j).append(h).appendTo(i)}});$("#secure-port-access-control").userSearchAutocomplete({minLength:0,appendTo:"#search-users-results",position:{my:"left top",at:"left bottom",offset:"0 1"},source:function(i,h){$.ajax({type:"GET",data:{q:i.term},dataType:"json",url:"../nifi-api/controller/users/search-results"}).done(function(j){h(j)})},select:function(i,j){var h=j.item;if(nf.Common.isDefinedAndNotNull(h.group)){d(h.group)}else{e(h.userDn)}$(this).blur();return false}}).focus(function(){if($(this).val()===b.search){$(this).val("").removeClass("search-users")}}).blur(function(){$(this).val(b.search).addClass("search-users")}).val(b.search).addClass("search-users")};var e=function(k){var i=$("#allowed-users");var h=$("<span></span>").addClass("allowed-entity ellipsis").text(k).ellipsis();var j=$("<div></div>").addClass("remove-allowed-entity");$("<li></li>").data("user",k).append(h).append(j).appendTo(i)};var d=function(j){var i=$("#allowed-groups");var k=$("<span></span>").addClass("allowed-entity ellipsis").text(j).ellipsis();var h=$("<div></div>").addClass("remove-allowed-entity");$("<li></li>").data("group",j).append(k).append(h).appendTo(i)};var c=function(){var h=[];$("#allowed-users").children("li").each(function(j,k){var i=$(k).data("user");if(nf.Common.isDefinedAndNotNull(i)){h.push(i)}});return h};var a=function(){var h=[];$("#allowed-groups").children("li").each(function(j,i){var k=$(i).data("group");if(nf.Common.isDefinedAndNotNull(k)){h.push(k)}});return h};return{init:function(){g()},showConfiguration:function(i){if(nf.CanvasUtils.isInputPort(i)||nf.CanvasUtils.isOutputPort(i)){var j=i.datum();if(j.component.type==="INPUT_PORT"){$("#secure-port-type").text("inputPort")}else{$("#secure-port-type").text("outputPort")}f=j.component.uri;if(nf.Canvas.getParentGroupId()===null){$("#secure-port-concurrent-task-container").show()}else{$("#secure-port-concurrent-task-container").hide()}var h="checkbox-checked";if(j.component.state==="DISABLED"){h="checkbox-unchecked"}$("#secure-port-id").text(j.component.id);$("#secure-port-name").val(j.component.name);$("#secure-port-enabled").removeClass("checkbox-unchecked checkbox-checked").addClass(h);$("#secure-port-concurrent-tasks").val(j.component.concurrentlySchedulableTaskCount);$("#secure-port-comments").val(j.component.comments);$.each(j.component.userAccessControl,function(k,l){e(l)});$.each(j.component.groupAccessControl,function(l,k){d(k)});$("#secure-port-configuration").modal("show")}}}}());
nf.SecurePortDetails=(function(){var b=function(e){var d=$("#read-only-allowed-users");var c=$("<span></span>").addClass("allowed-entity ellipsis").text(e).ellipsis();$("<li></li>").data("user",e).append(c).appendTo(d)};var a=function(d){var c=$("#read-only-allowed-groups");var e=$("<span></span>").addClass("allowed-entity ellipsis").text(d).ellipsis();$("<li></li>").data("group",d).append(e).appendTo(c)};return{init:function(){$("#secure-port-details-tabs").tabbs({tabStyle:"tab",selectedTabStyle:"selected-tab",tabs:[{name:"Settings",tabContentId:"read-only-secure-port-settings-tab-content"},{name:"Access Control",tabContentId:"read-only-secure-port-access-control-tab-content"}]});$("#secure-port-details").modal({headerText:"Secure Port Details",overlayBackground:true,buttons:[{buttonText:"Ok",handler:{click:function(){$("#secure-port-details").modal("hide")}}}],handler:{close:function(){nf.Common.clearField("read-only-secure-port-name");nf.Common.clearField("read-only-secure-port-id");nf.Common.clearField("read-only-secure-port-comments");nf.Common.clearField("read-only-secure-port-concurrent-tasks");$("#read-only-allowed-users").empty();$("#read-only-allowed-groups").empty()}}}).draggable({containment:"parent",handle:".dialog-header"})},showDetails:function(c){if(nf.CanvasUtils.isInputPort(c)||nf.CanvasUtils.isOutputPort(c)){var d=c.datum();nf.Common.populateField("read-only-secure-port-name",d.component.name);nf.Common.populateField("read-only-secure-port-id",d.component.id);nf.Common.populateField("read-only-secure-port-concurrent-tasks",d.component.concurrentlySchedulableTaskCount);nf.Common.populateField("read-only-secure-port-comments",d.component.comments);$.each(d.component.userAccessControl,function(e,f){b(f)});$.each(d.component.groupAccessControl,function(f,e){a(e)});$("#secure-port-details").modal("show")}}}}());
nf.LabelConfiguration=(function(){var a="";return{init:function(){$("#label-configuration").modal({overlayBackground:true,buttons:[{buttonText:"Apply",handler:{click:function(){var e=nf.Client.getRevision();var d=$("#label-value").val();var f=$("#label-font-size").combo("getSelectedOption");$.ajax({type:"PUT",url:a,data:{version:e.version,clientId:e.clientId,label:d,"style[font-size]":f.value},dataType:"json"}).done(function(g){nf.Client.setRevision(g.revision);nf.Label.set(g.label)}).fail(nf.Common.handleAjaxError);this.modal("hide")}}},{buttonText:"Cancel",handler:{click:function(){this.modal("hide")}}}],handler:{close:function(){a=""}}}).draggable({containment:"parent",cancel:"textarea, .button, .combo"});var c=[];for(var b=12;b<=24;b+=2){c.push({text:b+"px",value:b+"px"})}$("#label-font-size").combo({options:c,selectedOption:{value:"12px"},select:function(e){var d=$("#label-value");d.css({"font-size":e.value,"line-height":e.value}).val(d.val())}})},showConfiguration:function(c){if(nf.CanvasUtils.isLabel(c)){var e=c.datum();var b="";if(nf.Common.isDefinedAndNotNull(e.component.label)){b=e.component.label}var d="12px";if(nf.Common.isDefinedAndNotNull(e.component.style["font-size"])){d=e.component.style["font-size"]}a=e.component.uri;$("#label-value").val(b);$("#label-font-size").combo("setSelectedOption",{value:d});$("#label-configuration").modal("show")}}}}());
nf.ConnectionConfiguration=(function(){var u=75;var f=200;var w={urls:{controller:"../nifi-api/controller",prioritizers:"../nifi-api/controller/prioritizers"}};var j=function(){d3.select("path.connector").remove()};var b=function(z){if(nf.CanvasUtils.isProcessor(z)){return $.Deferred(function(A){i(z).done(function(C){if(!nf.Common.isEmpty(C.relationships)){$.each(C.relationships,function(D,E){r(E.name)});var B=$("#relationship-names").children("div");if(B.length===1){B.children("div.available-relationship").removeClass("checkbox-unchecked").addClass("checkbox-checked")}$("#connection-configuration").modal("setButtonModel",[{buttonText:"Add",handler:{click:function(){var D=l();if(D.length>0){o(D)}else{nf.Dialog.showOkDialog({dialogContent:"The connection must have at least one relationship selected.",overlayBackground:false})}$("#connection-configuration").modal("hide")}}},{buttonText:"Cancel",handler:{click:function(){$("#connection-configuration").modal("hide")}}}]);A.resolve()}else{nf.Dialog.showOkDialog({dialogContent:"'"+nf.Common.escapeHtml(C.name)+"' does not support any relationships."});e();A.reject()}}).fail(function(){A.reject()})}).promise()}else{return $.Deferred(function(B){var A;if(nf.CanvasUtils.isInputPort(z)){A=c(z)}else{if(nf.CanvasUtils.isRemoteProcessGroup(z)){A=k(z)}else{if(nf.CanvasUtils.isProcessGroup(z)){A=s(z)}else{A=g(z)}}}A.done(function(){$("#connection-configuration").modal("setButtonModel",[{buttonText:"Add",handler:{click:function(){o();$("#connection-configuration").modal("hide")}}},{buttonText:"Cancel",handler:{click:function(){$("#connection-configuration").modal("hide")}}}]);B.resolve()}).fail(function(){B.reject()})}).promise()}};var c=function(z){return $.Deferred(function(B){var A=z.datum();$("#input-port-source").show();$("#input-port-source-name").text(A.component.name);$("#connection-source-id").val(A.component.id);$("#connection-source-component-id").val(A.component.id);$("#connection-source-group-id").val(nf.Canvas.getGroupId());$("#connection-source-group-name").text(nf.Canvas.getGroupName());B.resolve()}).promise()};var g=function(z){return $.Deferred(function(B){var A=z.datum();$("#funnel-source").show();$("#connection-source-id").val(A.component.id);$("#connection-source-component-id").val(A.component.id);$("#connection-source-group-id").val(nf.Canvas.getGroupId());$("#connection-source-group-name").text(nf.Canvas.getGroupName());B.resolve()}).promise()};var i=function(z){return $.Deferred(function(B){var A=z.datum();$("#processor-source").show();$("#processor-source-name").text(A.component.name);$("#processor-source-type").text(nf.Common.substringAfterLast(A.component.type,"."));$("#connection-source-id").val(A.component.id);$("#connection-source-component-id").val(A.component.id);$("#connection-source-group-id").val(nf.Canvas.getGroupId());$("#connection-source-group-name").text(nf.Canvas.getGroupName());$("#relationship-names-container").show();B.resolve(A.component)})};var s=function(z){return $.Deferred(function(A){var B=z.datum();$.ajax({type:"GET",url:w.urls.controller+"/process-groups/"+encodeURIComponent(B.component.id),data:{verbose:true},dataType:"json"}).done(function(C){var E=C.processGroup;var F=E.contents;if(!nf.Common.isEmpty(F.outputPorts)){$("#output-port-source").show();var D=[];$.each(F.outputPorts,function(G,H){D.push({text:H.name,value:H.id,description:nf.Common.escapeHtml(H.comments)})});D.sort(function(H,G){return H.text.localeCompare(G.text)});$("#output-port-options").combo({options:D,maxHeight:300,select:function(G){$("#connection-source-id").val(G.value)}});$("#connection-source-component-id").val(E.id);$("#connection-source-group-id").val(E.id);$("#connection-source-group-name").text(E.name);A.resolve()}else{nf.Dialog.showOkDialog({dialogContent:"'"+nf.Common.escapeHtml(E.name)+"' does not have any output ports."});e();A.reject()}}).fail(function(E,C,D){nf.Common.handleAjaxError(E,C,D);A.reject()})}).promise()};var k=function(z){return $.Deferred(function(A){var B=z.datum();$.ajax({type:"GET",url:B.component.uri,data:{verbose:true},dataType:"json"}).done(function(C){var E=C.remoteProcessGroup;var F=E.contents;if(!nf.Common.isEmpty(F.outputPorts)){$("#output-port-source").show();var D=[];$.each(F.outputPorts,function(G,H){D.push({text:H.name,value:H.id,disabled:H.exists===false,description:nf.Common.escapeHtml(H.comments)})});D.sort(function(H,G){return H.text.localeCompare(G.text)});$("#output-port-options").combo({options:D,maxHeight:300,select:function(G){$("#connection-source-id").val(G.value)}});$("#connection-source-component-id").val(E.id);$("#connection-source-group-id").val(E.id);$("#connection-source-group-name").text(E.name);A.resolve()}else{nf.Dialog.showOkDialog({dialogContent:"'"+nf.Common.escapeHtml(E.name)+"' does not have any output ports."});e();A.reject()}}).fail(function(E,C,D){nf.Common.handleAjaxError(E,C,D);A.reject()})}).promise()};var q=function(z){if(nf.CanvasUtils.isOutputPort(z)){return n(z)}else{if(nf.CanvasUtils.isProcessor(z)){return v(z)}else{if(nf.CanvasUtils.isRemoteProcessGroup(z)){return t(z)}else{if(nf.CanvasUtils.isFunnel(z)){return d(z)}else{return m(z)}}}}};var n=function(z){return $.Deferred(function(A){var B=z.datum();$("#output-port-destination").show();$("#output-port-destination-name").text(B.component.name);$("#connection-destination-id").val(B.component.id);$("#connection-destination-component-id").val(B.component.id);$("#connection-destination-group-id").val(nf.Canvas.getGroupId());$("#connection-destination-group-name").text(nf.Canvas.getGroupName());A.resolve()}).promise()};var d=function(z){return $.Deferred(function(B){var A=z.datum();$("#funnel-destination").show();$("#connection-destination-id").val(A.component.id);$("#connection-destination-component-id").val(A.component.id);$("#connection-destination-group-id").val(nf.Canvas.getGroupId());$("#connection-destination-group-name").text(nf.Canvas.getGroupName());B.resolve()}).promise()};var v=function(z){return $.Deferred(function(B){var A=z.datum();$("#processor-destination").show();$("#processor-destination-name").text(A.component.name);$("#processor-destination-type").text(nf.Common.substringAfterLast(A.component.type,"."));$("#connection-destination-id").val(A.component.id);$("#connection-destination-component-id").val(A.component.id);$("#connection-destination-group-id").val(nf.Canvas.getGroupId());$("#connection-destination-group-name").text(nf.Canvas.getGroupName());B.resolve()}).promise()};var m=function(z){return $.Deferred(function(A){var B=z.datum();$.ajax({type:"GET",url:w.urls.controller+"/process-groups/"+encodeURIComponent(B.component.id),data:{verbose:true},dataType:"json"}).done(function(C){var E=C.processGroup;var F=E.contents;if(!nf.Common.isEmpty(F.inputPorts)){$("#input-port-destination").show();var D=[];$.each(F.inputPorts,function(H,G){D.push({text:G.name,value:G.id,description:nf.Common.escapeHtml(G.comments)})});D.sort(function(H,G){return H.text.localeCompare(G.text)});$("#input-port-options").combo({options:D,maxHeight:300,select:function(G){$("#connection-destination-id").val(G.value)}});$("#connection-destination-component-id").val(E.id);$("#connection-destination-group-id").val(E.id);$("#connection-destination-group-name").text(E.name);A.resolve()}else{nf.Dialog.showOkDialog({dialogContent:"'"+nf.Common.escapeHtml(E.name)+"' does not have any input ports."});e();A.reject()}}).fail(function(E,C,D){nf.Common.handleAjaxError(E,C,D);A.reject()})}).promise()};var t=function(z){return $.Deferred(function(A){var B=z.datum();$.ajax({type:"GET",url:B.component.uri,data:{verbose:true},dataType:"json"}).done(function(C){var E=C.remoteProcessGroup;var F=E.contents;if(!nf.Common.isEmpty(F.inputPorts)){$("#input-port-destination").show();var D=[];$.each(F.inputPorts,function(H,G){D.push({text:G.name,value:G.id,disabled:G.exists===false,description:nf.Common.escapeHtml(G.comments)})});D.sort(function(H,G){return H.text.localeCompare(G.text)});$("#input-port-options").combo({options:D,maxHeight:300,select:function(G){$("#connection-destination-id").val(G.value)}});$("#connection-destination-component-id").val(E.id);$("#connection-destination-group-id").val(E.id);$("#connection-destination-group-name").text(E.name);A.resolve()}else{nf.Dialog.showOkDialog({dialogContent:"'"+nf.Common.escapeHtml(E.name)+"' does not have any input ports."});e();A.reject()}}).fail(function(E,C,D){nf.Common.handleAjaxError(E,C,D);A.reject()})}).promise()};var a=function(z){return $.Deferred(function(A){var B=z.datum();$("#read-only-output-port-source").show();$("#connection-source-component-id").val(B.component.id);$("#connection-source-group-id").val(B.component.id);$("#connection-source-group-name").text(B.component.name);A.resolve()}).promise()};var p=function(z){if(nf.CanvasUtils.isProcessor(z)){return i(z)}else{if(nf.CanvasUtils.isInputPort(z)){return c(z)}else{if(nf.CanvasUtils.isFunnel(z)){return g(z)}else{return a(z)}}}};var h=function(z){if(nf.CanvasUtils.isProcessor(z)){return v(z)}else{if(nf.CanvasUtils.isOutputPort(z)){return n(z)}else{if(nf.CanvasUtils.isRemoteProcessGroup(z)){return t(z)}else{if(nf.CanvasUtils.isFunnel(z)){return d(z)}else{return m(z)}}}}};var r=function(A){var z=$('<div class="relationship-name ellipsis"></div>').text(A);var B=$('<span class="relationship-name-value hidden"></span>').text(A);return $('<div class="available-relationship-container"><div class="available-relationship nf-checkbox checkbox-unchecked"></div></div>').append(z).append(B).appendTo("#relationship-names")};var o=function(B){var V=$("#connection-source-id").val();var S=$("#connection-destination-id").val();var Z=$("#connection-source-component-id").val();var P=d3.select("#id-"+Z);var T=$("#connection-destination-component-id").val();var I=d3.select("#id-"+T);var af=P.datum();var J=I.datum();var C=[];if(Z===T){var O={x:af.component.position.x+(af.dimensions.width),y:af.component.position.y+(af.dimensions.height/2)};var U=nf.Connection.config.selfLoopXOffset;var W=nf.Connection.config.selfLoopYOffset;C.push((O.x+U)+","+(O.y-W));C.push((O.x+U)+","+(O.y+W))}else{var ad=[];var Y=nf.Connection.getComponentConnections(Z);$.each(Y,function(aj,am){var ak=nf.CanvasUtils.getConnectionSourceComponentId(am);var al=nf.CanvasUtils.getConnectionDestinationComponentId(am);if((ak===Z&&al===T)||(al===Z&&ak===T)){ad.push(am)}});if(ad.length>0){var D=false;$.each(ad,function(aj,ak){if(nf.Common.isEmpty(ak.bends)){D=true;return false}});if(D===true){var Q=[af.component.position.x+(af.dimensions.width/2),af.component.position.y+(af.dimensions.height/2)];var A=[J.component.position.x+(J.dimensions.width/2),J.component.position.y+(J.dimensions.height/2)];var N=((Q[1]-A[1])/(Q[0]-A[0]));var ab=N<=1&&N>=-1;var X=function(aj,al){var ak=false;$.each(ad,function(am,an){if(!nf.Common.isEmpty(an.bends)){if(ab){if(an.bends[0].y===al){ak=true;return false}}else{if(an.bends[0].x===aj){ak=true;return false}}}});return ak};var G=(Q[0]+A[0])/2;var K=(Q[1]+A[1])/2;var aa=ab?0:f;var M=ab?u:0;var ac=false;while(ac===false){if(X(G-aa,K-M)===false){C.push((G-aa)+","+(K-M));ac=true}else{if(X(G+aa,K+M)===false){C.push((G+aa)+","+(K+M));ac=true}}if(ab){M+=u}else{aa+=f}}}}}var F=$("#connection-source-group-id").val();var z=$("#connection-destination-group-id").val();var ag=nf.CanvasUtils.getConnectableTypeForSource(P);var L=nf.CanvasUtils.getConnectableTypeForDestination(I);var H=$("#connection-name").val();var E=$("#flow-file-expiration").val();var ae=$("#back-pressure-object-threshold").val();var ai=$("#back-pressure-data-size-threshold").val();var R=$("#prioritizer-selected").sortable("toArray");if(x()){var ah=nf.Client.getRevision();$.ajax({type:"POST",url:w.urls.controller+"/process-groups/"+encodeURIComponent(nf.Canvas.getGroupId())+"/connections",data:{version:ah.version,clientId:ah.clientId,sourceId:V,sourceGroupId:F,sourceType:ag,relationships:B,bends:C,name:H,flowFileExpiration:E,backPressureObjectThreshold:ae,backPressureDataSizeThreshold:ai,prioritizers:R,destinationId:S,destinationGroupId:z,destinationType:L},dataType:"json"}).done(function(aj){nf.Client.setRevision(aj.revision);nf.Graph.add({connections:[aj.connection]},true);nf.CanvasUtils.reloadConnectionSourceAndDestination(Z,T);nf.Canvas.View.updateVisibility();nf.Birdseye.refresh()}).fail(function(al,aj,ak){nf.Common.handleAjaxError(al,aj,ak)})}};var y=function(E){var A=$("#connection-uri").val();var M=$("#connection-source-component-id").val();var G=$("#connection-destination-component-id").val();var J=d3.select("#id-"+G);var F=nf.CanvasUtils.getConnectableTypeForDestination(J);var z=$("#connection-destination-id").val();var H=$("#connection-destination-group-id").val();var D=$("#connection-name").val();var B=$("#flow-file-expiration").val();var L=$("#back-pressure-object-threshold").val();var C=$("#back-pressure-data-size-threshold").val();var K=$("#prioritizer-selected").sortable("toArray");if(x()){var I=nf.Client.getRevision();return $.ajax({type:"PUT",url:A,data:{version:I.version,clientId:I.clientId,relationships:E,name:D,flowFileExpiration:B,backPressureObjectThreshold:L,backPressureDataSizeThreshold:C,prioritizers:K,destinationId:z,destinationType:F,destinationGroupId:H},dataType:"json"}).done(function(O){if(nf.Common.isDefinedAndNotNull(O.connection)){var N=O.connection;nf.Client.setRevision(O.revision);nf.Connection.set(N);nf.CanvasUtils.reloadConnectionSourceAndDestination(M,G)}}).fail(function(P,N,O){if(P.status===400||P.status===404||P.status===409){nf.Dialog.showOkDialog({dialogContent:nf.Common.escapeHtml(P.responseText),overlayBackground:true})}else{nf.Common.handleAjaxError(P,N,O)}})}else{return $.Deferred(function(N){N.reject()}).promise()}};var l=function(){var A=$("#relationship-names");var z=[];$.each(A.children(),function(B,E){var D=$(E);var C=D.children("div.available-relationship");if(C.hasClass("checkbox-checked")){z.push(D.children("span.relationship-name-value").text())}});return z};var x=function(){var z=[];if(nf.Common.isBlank($("#flow-file-expiration").val())){z.push("File expiration must be specified")}if(!$.isNumeric($("#back-pressure-object-threshold").val())){z.push("Back pressure object threshold must be an integer value")}if(nf.Common.isBlank($("#back-pressure-data-size-threshold").val())){z.push("Back pressure data size threshold must be specified")}if(z.length>0){nf.Dialog.showOkDialog({dialogContent:nf.Common.formatUnorderedList(z),overlayBackground:false,headerText:"Configuration Error"});return false}else{return true}};var e=function(){var B=$("#prioritizer-selected");var z=$("#prioritizer-available");B.children().detach().appendTo(z);var A=z.children("li").get();A.sort(function(D,C){var F=$(D).text().toUpperCase();var E=$(C).text().toUpperCase();return(F<E)?-1:(F>E)?1:0});$.each(A,function(){$(this).detach()});$.each(A,function(){$(this).appendTo(z)});$("#connection-name").val("");$("#relationship-names").css("border-width","0").empty();$("#relationship-names-container").hide();nf.Common.clearField("connection-id");$("#processor-source").hide();$("#input-port-source").hide();$("#output-port-source").hide();$("#read-only-output-port-source").hide();$("#funnel-source").hide();$("#processor-destination").hide();$("#input-port-destination").hide();$("#output-port-destination").hide();$("#funnel-destination").hide();$("#connection-source-id").val("");$("#connection-source-component-id").val("");$("#connection-source-group-id").val("");$("#connection-destination-id").val("");$("#connection-destination-component-id").val("");$("#connection-destination-group-id").val("");$("#output-port-options").empty();$("#input-port-options").empty();j()};return{init:function(){$("#relationship-names-container").hide();$("#connection-configuration").modal({headerText:"Configure Connection",overlayBackground:true,handler:{close:function(){e()}}}).draggable({containment:"parent",handle:".dialog-header"});$("#connection-configuration-tabs").tabbs({tabStyle:"tab",selectedTabStyle:"selected-tab",tabs:[{name:"Details",tabContentId:"connection-details-tab-content"},{name:"Settings",tabContentId:"connection-settings-tab-content"}]});$.ajax({type:"GET",url:w.urls.prioritizers,dataType:"json"}).done(function(z){$.each(z.prioritizerTypes,function(A,B){nf.ConnectionConfiguration.addAvailablePrioritizer("#prioritizer-available",B)});$("#prioritizer-available, #prioritizer-selected").sortable({connectWith:"ul",placeholder:"ui-state-highlight",scroll:true,opacity:0.6});$("#prioritizer-available, #prioritizer-selected").disableSelection()}).fail(nf.Common.handleAjaxError)},addAvailablePrioritizer:function(E,C){var B=C.type;var A=nf.Common.substringAfterLast(B,".");var D=$(E);var z=$("<li></li>").append($('<span style="float: left;"></span>').text(A)).attr("id",B).addClass("ui-state-default").appendTo(D);if(nf.Common.isDefinedAndNotNull(C.description)){$('<img class="icon-info" style="float: right; margin-right: 5px;" src="images/iconInfo.png"></img>').appendTo(z).qtip($.extend({content:nf.Common.escapeHtml(C.description)},nf.Common.config.tooltipConfig))}},createConnection:function(B,C){var A=d3.select("#id-"+B);var z=d3.select("#id-"+C);if(A.empty()||z.empty()){return}$.when(b(A),q(z)).done(function(){$("#flow-file-expiration").val("0 sec");$("#back-pressure-object-threshold").val("0");$("#back-pressure-data-size-threshold").val("0 MB");$("#connection-configuration-tabs").find("li:first").click();$("#connection-configuration").modal("setHeaderText","Create Connection").modal("show");$("#connection-configuration div.relationship-name").ellipsis();nf.Common.populateField("connection-id",null);var D=$("#relationship-names");if(D.is(":visible")&&D.get(0).scrollHeight>D.innerHeight()){D.css("border-width","1px")}}).fail(function(){j()})},showConfiguration:function(A,z){return $.Deferred(function(C){var E=A.datum();var B=E.component;var G=nf.CanvasUtils.getConnectionSourceComponentId(B);var D=d3.select("#id-"+G);if(nf.Common.isUndefinedOrNull(z)){var F=nf.CanvasUtils.getConnectionDestinationComponentId(B);z=d3.select("#id-"+F)}$.when(p(D),h(z)).done(function(){var J=B.availableRelationships;var I=B.selectedRelationships;if(nf.Common.isDefinedAndNotNull(J)||nf.Common.isDefinedAndNotNull(I)){$.each(J,function(M,L){r(L)});$.each(I,function(N,L){if($.inArray(L,J)===-1){var O=r(L);$(O).children("div.relationship-name").addClass("undefined")}var M=$("#relationship-names").children("div");$.each(M,function(P,R){var Q=$(R).children("span.relationship-name-value");if(Q.text()===L){$(R).children("div.available-relationship").removeClass("checkbox-unchecked").addClass("checkbox-checked")}})})}if(nf.CanvasUtils.isProcessGroup(D)||nf.CanvasUtils.isRemoteProcessGroup(D)){$("#connection-source-id").val(B.source.id);$("#read-only-output-port-name").text(B.source.name)}if(nf.CanvasUtils.isProcessGroup(z)||nf.CanvasUtils.isRemoteProcessGroup(z)){var H=z.datum();if(B.destination.groupId===H.component.id){$("#input-port-options").combo("setSelectedOption",{value:B.destination.id})}}$("#connection-name").val(B.name);$("#flow-file-expiration").val(B.flowFileExpiration);$("#back-pressure-object-threshold").val(B.backPressureObjectThreshold);$("#back-pressure-data-size-threshold").val(B.backPressureDataSizeThreshold);nf.Common.populateField("connection-id",B.id);$.each(B.prioritizers,function(L,M){$("#prioritizer-available").children('li[id="'+M+'"]').detach().appendTo("#prioritizer-selected")});$("#connection-uri").val(B.uri);$("#connection-configuration").modal("setButtonModel",[{buttonText:"Apply",handler:{click:function(){var L=l();if(nf.CanvasUtils.isProcessor(D)){if(L.length>0){y(L).done(function(){C.resolve()}).fail(function(){C.reject()})}else{nf.Dialog.showOkDialog({dialogContent:"The connection must have at least one relationship selected.",overlayBackground:false});C.reject()}}else{y(undefined).done(function(){C.resolve()}).fail(function(){C.reject()})}$("#connection-configuration").modal("hide")}}},{buttonText:"Cancel",handler:{click:function(){$("#connection-configuration").modal("hide");C.reject()}}}]);$("#connection-configuration-tabs").find("li:first").click();$("#connection-configuration").modal("setHeaderText","Configure Connection").modal("show");$("#connection-configuration div.relationship-name").ellipsis();var K=$("#relationship-names");if(K.is(":visible")&&K.get(0).scrollHeight>K.innerHeight()){K.css("border-width","1px")}}).fail(function(){C.reject()})}).promise()}}}());
nf.ConnectionDetails=(function(){var g=function(l,n,m){if(m.type==="PROCESSOR"){return h(l,n,m)}else{if(m.type==="FUNNEL"){return i(l,n,m)}else{if(m.type==="REMOTE_OUTPUT_PORT"){return d(l,n,m)}else{return k(l,n,m)}}}};var h=function(l,n,m){return $.ajax({type:"GET",url:"../nifi-api/controller/process-groups/"+encodeURIComponent(l)+"/processors/"+encodeURIComponent(m.id),dataType:"json"}).done(function(o){var p=o.processor;var q=$('<div class="label"></div>').text(p.name);var r=$("<div></div>").text(nf.Common.substringAfterLast(p.type,"."));$("#read-only-connection-source-label").text("From processor");$("#read-only-connection-source").append(q).append(r);$("#read-only-connection-source-group-name").text(n)})};var i=function(l,n,m){return $.Deferred(function(o){$("#read-only-connection-source-label").text("From funnel");$("#read-only-connection-source").append("funnel");$("#read-only-connection-source-group-name").text(n);o.resolve()}).promise()};var d=function(l,n,m){return $.ajax({type:"GET",url:"../nifi-api/controller/process-groups/"+encodeURIComponent(l)+"/remote-process-groups/"+encodeURIComponent(m.groupId),data:{verbose:true},dataType:"json"}).done(function(o){var p=o.remoteProcessGroup;$("#read-only-connection-source-label").text("From output");$("#read-only-connection-source").text(m.name);$("#read-only-connection-source-group-name").text(p.name)})};var k=function(l,n,m){return $.Deferred(function(o){if(l===m.groupId){$("#read-only-connection-source-label").text("From input");$("#read-only-connection-source").text(m.name);$("#read-only-connection-source-group-name").text(n);o.resolve()}else{$.ajax({type:"GET",url:"../nifi-api/controller/process-groups/"+encodeURIComponent(m.groupId),data:{verbose:true},dataType:"json"}).done(function(p){var q=p.processGroup;$("#read-only-connection-source-label").text("From output");$("#read-only-connection-source").text(m.name);$("#read-only-connection-source-group-name").text(q.name);o.resolve()}).fail(function(){o.reject()})}}).promise()};var c=function(m,n,l){if(l.type==="PROCESSOR"){return a(m,n,l)}else{if(l.type==="FUNNEL"){return j(m,n,l)}else{if(l.type==="REMOTE_INPUT_PORT"){return f(m,n,l)}else{return b(m,n,l)}}}};var a=function(m,n,l){return $.Deferred(function(o){$.ajax({type:"GET",url:"../nifi-api/controller/process-groups/"+encodeURIComponent(m)+"/processors/"+encodeURIComponent(l.id),dataType:"json"}).done(function(p){var q=p.processor;var r=$('<div class="label"></div>').text(q.name);var s=$("<div></div>").text(nf.Common.substringAfterLast(q.type,"."));$("#read-only-connection-target-label").text("To processor");$("#read-only-connection-target").append(r).append(s);$("#read-only-connection-target-group-name").text(n);o.resolve()}).fail(function(){o.reject()})}).promise()};var j=function(m,n,l){return $.Deferred(function(o){$("#read-only-connection-target-label").text("To funnel");$("#read-only-connection-target").append("funnel");$("#read-only-connection-target-group-name").text(n);o.resolve()}).promise()};var f=function(m,n,l){return $.ajax({type:"GET",url:"../nifi-api/controller/process-groups/"+encodeURIComponent(m)+"/remote-process-groups/"+encodeURIComponent(l.groupId),data:{verbose:true},dataType:"json"}).done(function(o){var p=o.remoteProcessGroup;$("#read-only-connection-target-label").text("To input");$("#read-only-connection-target").text(l.name);$("#read-only-connection-target-group-name").text(p.name)})};var b=function(m,n,l){return $.Deferred(function(o){if(m===l.groupId){$("#read-only-connection-target-label").text("To output");$("#read-only-connection-target").text(l.name);$("#read-only-connection-target-group-name").text(n);o.resolve()}else{$.ajax({type:"GET",url:"../nifi-api/controller/process-groups/"+encodeURIComponent(l.groupId),data:{verbose:true},dataType:"json"}).done(function(p){var q=p.processGroup;$("#read-only-connection-target-label").text("To input");$("#read-only-connection-target").text(l.name);$("#read-only-connection-target-group-name").text(q.name);o.resolve()}).fail(function(){o.reject()})}}).promise()};var e=function(l){$('<div class="available-relationship-container"></div>').append($('<div class="relationship-name"></div>').text(l)).appendTo("#read-only-relationship-names")};return{init:function(l){l=nf.Common.isDefinedAndNotNull(l)?l:true;$("#connection-details-tabs").tabbs({tabStyle:"tab",selectedTabStyle:"selected-tab",tabs:[{name:"Details",tabContentId:"read-only-connection-details-tab-content"},{name:"Settings",tabContentId:"read-only-connection-settings-tab-content"}]});$("#connection-details").modal({headerText:"Connection Details",overlayBackground:l,buttons:[{buttonText:"Ok",handler:{click:function(){$("#connection-details").modal("hide")}}}],handler:{close:function(){$("#read-only-relationship-names").empty();nf.Common.clearField("read-only-connection-name");nf.Common.clearField("read-only-connection-id");$("#read-only-connection-source-label").text("");$("#read-only-connection-source").empty();$("#read-only-connection-source-group-name").text("");$("#read-only-connection-target-label").text("");$("#read-only-connection-target").empty();$("#read-only-connection-target-group-name").text("");$("#read-only-relationship-names").css("border-width","0").empty();$("#read-only-flow-file-expiration").text("");$("#read-only-back-pressure-object-threshold").text("");$("#read-only-back-pressure-data-size-threshold").text("");$("#read-only-prioritizers").empty()}}});if(l){$("#connection-details").draggable({containment:"parent",handle:".dialog-header"})}},showDetails:function(m,o){var n=$.ajax({type:"GET",url:"../nifi-api/controller/process-groups/"+encodeURIComponent(m),dataType:"json"});var l=$.ajax({type:"GET",url:"../nifi-api/controller/process-groups/"+encodeURIComponent(m)+"/connections/"+encodeURIComponent(o),dataType:"json"});$.when(n,l).done(function(t,r){var s=t[0];var u=r[0];if(nf.Common.isDefinedAndNotNull(s.processGroup)&&nf.Common.isDefinedAndNotNull(u.connection)){var v=s.processGroup;var q=u.connection;var w=g(v.id,v.name,q.source);var p=c(v.id,v.name,q.destination);$.when(w,p).done(function(){var y=q.availableRelationships;var x=q.selectedRelationships;if(nf.Common.isDefinedAndNotNull(y)||nf.Common.isDefinedAndNotNull(x)){$.each(y,function(D,C){e(C)});$.each(x,function(E,C){if($.inArray(C,y)===-1){var F=e(C);$(F).children("div.relationship-name").addClass("undefined")}var D=$("#read-only-relationship-names").children("div");$.each(D.children("div.relationship-name"),function(H,G){var I=$(G);if(I.text()===C){I.css("font-weight","bold")}})});$("#selected-relationship-text").show();$("#read-only-relationship-names-container").show()}else{$("#selected-relationship-text").hide();$("#read-only-relationship-names-container").hide()}nf.Common.populateField("read-only-connection-name",q.name);nf.Common.populateField("read-only-connection-id",q.id);nf.Common.populateField("read-only-flow-file-expiration",q.flowFileExpiration);nf.Common.populateField("read-only-back-pressure-object-threshold",q.backPressureObjectThreshold);nf.Common.populateField("read-only-back-pressure-data-size-threshold",q.backPressureDataSizeThreshold);if(nf.Common.isDefinedAndNotNull(q.prioritizers)&&q.prioritizers.length>0){var B=$("<ol></ol>").css("list-style","decimal inside none");$.each(q.prioritizers,function(C,D){B.append($("<li></li>").text(nf.Common.substringAfterLast(D,".")))});$("#read-only-prioritizers").append(B)}else{var z=$('<span class="unset">No value set</span>');$("#read-only-prioritizers").append(z)}$("#connection-details-tabs").find("li:first").click();$("#connection-details").modal("show");var A=$("#read-only-relationship-names");if(A.is(":visible")&&A.get(0).scrollHeight>A.innerHeight()){A.css("border-width","1px")}})}}).fail(nf.Common.handleAjaxError)}}}());
nf.Graph=(function(){var b=function(c){if(nf.Common.isDefinedAndNotNull(c.inputPorts)&&nf.Common.isDefinedAndNotNull(c.outputPorts)){return c.inputPorts.concat(c.outputPorts)}else{if(nf.Common.isDefinedAndNotNull(c.inputPorts)){return c.inputPorts}else{if(nf.Common.isDefinedAndNotNull(c.outputPorts)){return c.outputPorts}else{return[]}}}};var a=function(c){if(nf.Common.isDefinedAndNotNull(c.inputPortStatus)&&nf.Common.isDefinedAndNotNull(c.outputPortStatus)){return c.inputPortStatus.concat(c.outputPortStatus)}else{if(nf.Common.isDefinedAndNotNull(c.inputPortStatus)){return c.inputPortStatus}else{if(nf.Common.isDefinedAndNotNull(c.outputPortStatus)){return c.outputPortStatus}else{return[]}}}};return{init:function(){nf.Label.init();nf.Funnel.init();nf.Port.init();nf.RemoteProcessGroup.init();nf.ProcessGroup.init();nf.Processor.init();nf.Connection.init();return nf.CanvasUtils.enterGroup(nf.Canvas.getGroupId())},add:function(d,c){c=nf.Common.isDefinedAndNotNull(c)?c:false;if(c){nf.CanvasUtils.getSelection().classed("selected",false)}var e=b(d);if(!nf.Common.isEmpty(d.labels)){nf.Label.add(d.labels,c)}if(!nf.Common.isEmpty(d.funnels)){nf.Funnel.add(d.funnels,c)}if(!nf.Common.isEmpty(d.remoteProcessGroups)){nf.RemoteProcessGroup.add(d.remoteProcessGroups,c)}if(!nf.Common.isEmpty(e)){nf.Port.add(e,c)}if(!nf.Common.isEmpty(d.processGroups)){nf.ProcessGroup.add(d.processGroups,c)}if(!nf.Common.isEmpty(d.processors)){nf.Processor.add(d.processors,c)}if(!nf.Common.isEmpty(d.connections)){nf.Connection.add(d.connections,c)}if(c){nf.CanvasToolbar.refresh()}},get:function(){return{labels:nf.Label.get(),funnels:nf.Funnel.get(),ports:nf.Port.get(),remoteProcessGroups:nf.RemoteProcessGroup.get(),processGroups:nf.ProcessGroup.get(),processors:nf.Processor.get(),connections:nf.Connection.get()}},set:function(c){var d=b(c);if(!nf.Common.isEmpty(c.labels)){nf.Label.set(c.labels)}if(!nf.Common.isEmpty(c.funnels)){nf.Funnel.set(c.funnels)}if(!nf.Common.isEmpty(d)){nf.Port.set(d)}if(!nf.Common.isEmpty(c.remoteProcessGroups)){nf.RemoteProcessGroup.set(c.remoteProcessGroups)}if(!nf.Common.isEmpty(c.processGroups)){nf.ProcessGroup.set(c.processGroups)}if(!nf.Common.isEmpty(c.processors)){nf.Processor.set(c.processors)}if(!nf.Common.isEmpty(c.connections)){nf.Connection.set(c.connections)}},setStatus:function(d){var c=a(d);nf.Port.setStatus(c);nf.RemoteProcessGroup.setStatus(d.remoteProcessGroupStatus);nf.ProcessGroup.setStatus(d.processGroupStatus);nf.Processor.setStatus(d.processorStatus);nf.Connection.setStatus(d.connectionStatus)},removeAll:function(){nf.Label.removeAll();nf.Funnel.removeAll();nf.Port.removeAll();nf.RemoteProcessGroup.removeAll();nf.ProcessGroup.removeAll();nf.Processor.removeAll();nf.Connection.removeAll()},pan:function(){nf.Port.pan();nf.RemoteProcessGroup.pan();nf.ProcessGroup.pan();nf.Processor.pan();nf.Connection.pan()}}}());
nf.Processor=(function(){var h=25;var a={width:310,height:100};var i;var b;var f=function(){return b.selectAll("g.processor").data(i.values(),function(k){return k.component.id})};var d=function(m,l){if(m.empty()){return}var k=m.append("g").attr({id:function(n){return"id-"+n.component.id},"class":"processor component"}).classed("selected",l).call(nf.CanvasUtils.position);k.append("rect").attr({"class":"border",width:function(n){return n.dimensions.width},height:function(n){return n.dimensions.height},fill:"transparent","stroke-opacity":0.8,"stroke-width":1});k.append("rect").attr({"class":"body",width:function(n){return n.dimensions.width},height:function(n){return n.dimensions.height},"fill-opacity":0.8,"stroke-opacity":0.8,"stroke-width":0});k.append("text").attr({x:25,y:18,width:220,height:16,"font-size":"10pt","font-weight":"bold",fill:"black","class":"processor-name"});k.append("image").call(nf.CanvasUtils.disableImageHref).attr({"xlink:href":"images/iconProcessor.png",width:28,height:26,x:276,y:5});k.append("image").call(nf.CanvasUtils.disableImageHref).attr({"xlink:href":"images/bgProcessorStatArea.png",width:294,height:58,x:8,y:35,"class":"processor-stats-preview"});k.call(nf.Selectable.activate).call(nf.ContextMenu.activate);if(nf.Common.isDFM()){k.call(nf.Draggable.activate).call(nf.Connectable.activate)}k.call(e)};var e=function(l){if(l.empty()){return}l.each(function(){var p=d3.select(this);var n=p.select("g.processor-details");if(p.classed("visible")){if(n.empty()){n=p.append("g").attr("class","processor-details");n.append("image").call(nf.CanvasUtils.disableImageHref).attr({"class":"run-status-icon",width:16,height:16,x:5,y:5});n.append("text").attr({x:25,y:30,width:246,height:16,"font-size":"8pt","font-weight":"normal",fill:"black"}).each(function(s){var r=d3.select(this);r.text(null).selectAll("title").remove();nf.CanvasUtils.ellipsis(r,nf.Common.substringAfterLast(s.component.type,"."))}).append("title").text(function(r){return nf.Common.substringAfterLast(r.component.type,".")});n.append("rect").attr({width:294,height:59,x:8,y:35,fill:"#ffffff","stroke-width":1,stroke:"#6f97ac","stroke-opacity":0.8});n.append("rect").attr({width:73,height:59,x:8,y:35,fill:"url(#processor-stats-background)","stroke-width":0});var q=n.append("g").attr({transform:"translate(8, 45)"});q.append("text").attr({width:73,height:10,x:4,y:4,"class":"processor-stats-label"}).text("In");q.append("text").attr({width:73,height:10,x:4,y:17,"class":"processor-stats-label"}).text("Read/Write");q.append("text").attr({width:73,height:10,x:4,y:30,"class":"processor-stats-label"}).text("Out");q.append("text").attr({width:73,height:10,x:4,y:43,"class":"processor-stats-label"}).text("Tasks/Time");var m=n.append("g").attr({transform:"translate(80, 45)"});m.append("text").attr({width:180,height:10,x:4,y:4,"class":"processor-in processor-stats-value"});m.append("text").attr({width:180,height:10,x:4,y:17,"class":"processor-read-write processor-stats-value"});m.append("text").attr({width:180,height:10,x:4,y:30,"class":"processor-out processor-stats-value"});m.append("text").attr({width:180,height:10,x:4,y:43,"class":"processor-tasks-time processor-stats-value"});var o=n.append("g").attr("transform","translate(258, 45)");o.append("text").attr({width:25,height:10,x:4,y:4,"class":"processor-stats-info"}).text("(5 min)");o.append("text").attr({width:25,height:10,x:4,y:17,"class":"processor-stats-info"}).text("(5 min)");o.append("text").attr({width:25,height:10,x:4,y:30,"class":"processor-stats-info"}).text("(5 min)");o.append("text").attr({width:25,height:10,x:4,y:43,"class":"processor-stats-info"}).text("(5 min)");n.append("rect").attr({"class":"active-thread-count-background",height:13,y:0,fill:"#fff","fill-opacity":"0.65",stroke:"#aaa","stroke-width":"1"});n.append("text").attr({"class":"active-thread-count",height:13,y:10,fill:"#000"});n.append("image").call(nf.CanvasUtils.disableImageHref).attr({"class":"bulletin-icon","xlink:href":"images/iconBulletin.png",width:12,height:12,x:8,y:20})}n.select("image.run-status-icon").attr("xlink:href",function(s){var r="";if(s.component.state==="DISABLED"){r="images/iconDisable.png"}else{if(!nf.Common.isEmpty(s.component.validationErrors)){r="images/iconAlert.png"}else{if(s.component.state==="RUNNING"){r="images/iconRun.png"}else{if(s.component.state==="STOPPED"){r="images/iconStop.png"}}}}return r}).each(function(s){var r=d3.select("#run-status-tip-"+s.component.id);if(!r.empty()){r.remove()}if(!nf.Common.isEmpty(s.component.validationErrors)){r=d3.select("#processor-tooltips").append("div").attr("id",function(){return"run-status-tip-"+s.component.id}).attr("class","tooltip nifi-tooltip").html(function(){var t=nf.Common.formatUnorderedList(s.component.validationErrors);if(t===null||t.length===0){return""}else{return $("<div></div>").append(t).html()}});nf.CanvasUtils.canvasTooltip(r,d3.select(this))}});p.select("text.processor-name").each(function(s){var r=d3.select(this);r.text(null).selectAll("title").remove();nf.CanvasUtils.ellipsis(r,s.component.name)}).append("title").text(function(r){return r.component.name});p.select("image.processor-stats-preview").style("display","none");p.call(c)}else{p.select("text.processor-name").text(function(s){var r=s.component.name;if(r.length>h){return r.substring(0,h)+String.fromCharCode(8230)}else{return r}});p.select("image.processor-stats-preview").style("display","block");p.call(g);if(!n.empty()){n.remove()}}});var k=d3.set();k.add(nf.Common.substringAfterLast(nf.Processor.defaultColor(),"#"));i.forEach(function(o,n){var m=n.component.style["background-color"];if(nf.Common.isDefinedAndNotNull(m)){k.add(nf.Common.substringAfterLast(m,"#"))}});nf.Canvas.defineProcessorColors(k.values());l.select("rect.border").attr("stroke",function(n){var m=nf.Processor.defaultColor();if(nf.Common.isDefinedAndNotNull(n.component.style["background-color"])){m=n.component.style["background-color"]}return m});l.select("rect.body").attr("fill",function(n){var m=nf.Processor.defaultColor();if(nf.Common.isDefinedAndNotNull(n.component.style["background-color"])){m=n.component.style["background-color"]}m=nf.Common.substringAfterLast(m,"#");return"url(#processor-background-"+m+")"})};var c=function(k){if(k.empty()){return}k.select("text.processor-in").text(function(l){if(nf.Common.isDefinedAndNotNull(l.status)){return l.status.input}else{return"- / -"}});k.select("text.processor-read-write").text(function(l){if(nf.Common.isDefinedAndNotNull(l.status)){return l.status.read+" / "+l.status.written}else{return"- / -"}});k.select("text.processor-out").text(function(l){if(nf.Common.isDefinedAndNotNull(l.status)){return l.status.output}else{return"- / -"}});k.select("text.processor-tasks-time").text(function(l){if(nf.Common.isDefinedAndNotNull(l.status)){return l.status.tasks+" / "+l.status.tasksDuration}else{return"- / -"}});k.each(function(m){var l=d3.select(this);nf.CanvasUtils.activeThreadCount(l,m);nf.CanvasUtils.bulletins(l,m,function(){return d3.select("#processor-tooltips")},286)})};var j=function(k){if(k.empty()){return}k.call(g).remove()};var g=function(k){k.each(function(l){$("#run-status-tip-"+l.component.id).remove();$("#bulletin-tip-"+l.component.id).remove()})};return{init:function(){i=d3.map();b=d3.select("#canvas").append("g").attr({"pointer-events":"all","class":"processors"})},add:function(k,l){l=nf.Common.isDefinedAndNotNull(l)?l:false;var m=function(n){i.set(n.id,{type:"Processor",component:n,dimensions:a})};if($.isArray(k)){$.each(k,function(n,o){m(o)})}else{m(k)}f().enter().call(d,l)},get:function(k){if(nf.Common.isUndefined(k)){return i.values()}else{return i.get(k)}},refresh:function(k){if(nf.Common.isDefinedAndNotNull(k)){d3.select("#id-"+k).call(e)}else{d3.selectAll("g.processor").call(e)}},position:function(k){d3.select("#id-"+k).call(nf.CanvasUtils.position)},pan:function(){d3.selectAll("g.processor.entering, g.processor.leaving").call(e)},reload:function(k){if(i.has(k.id)){return $.ajax({type:"GET",url:k.uri,dataType:"json"}).done(function(l){nf.Processor.set(l.processor)})}},set:function(k){var l=function(n){if(i.has(n.id)){var m=i.get(n.id);m.component=n;d3.select("#id-"+n.id).call(e)}};if($.isArray(k)){$.each(k,function(m,n){l(n)})}else{l(k)}},remove:function(k){if($.isArray(k)){$.each(k,function(l,m){i.remove(m)})}else{i.remove(k)}f().exit().call(j)},removeAll:function(){nf.Processor.remove(i.keys())},setStatus:function(k){if(nf.Common.isEmpty(k)){return}$.each(k,function(m,l){if(i.has(l.id)){var n=i.get(l.id);n.status=l}});d3.selectAll("g.processor.visible").call(c)},defaultColor:function(){return"#aaaaaa"}}}());
nf.Label=(function(){var a={width:150,height:150};var g=20;var b=64;var f;var j;var h;var i=function(){return j.selectAll("g.label").data(f.values(),function(l){return l.component.id})};var c=function(n,m){if(n.empty()){return}var l=n.append("g").attr({id:function(o){return"id-"+o.component.id},"class":"label component"}).classed("selected",m).call(d);l.append("rect").attr({"class":"border",fill:"transparent","stroke-opacity":0.8,"stroke-width":1});l.append("rect").attr({"class":"body","fill-opacity":0.8,"stroke-opacity":0.8,"stroke-width":0});l.append("text").attr({"xml:space":"preserve","font-weight":"bold",fill:"black","class":"label-value"});l.call(nf.Selectable.activate).call(nf.ContextMenu.activate);if(nf.Common.isDFM()){l.call(nf.Draggable.activate)}l.call(k)};var d=function(l){if(l.empty()){return}l.attr("transform",function(m){return"translate("+m.component.position.x+", "+m.component.position.y+")"})};var k=function(m){if(m.empty()){return}var l=d3.set();l.add(nf.Common.substringAfterLast(nf.Label.defaultColor(),"#"));f.forEach(function(p,o){var n=o.component.style["background-color"];if(nf.Common.isDefinedAndNotNull(n)){l.add(nf.Common.substringAfterLast(n,"#"))}});nf.Canvas.defineLabelColors(l.values());m.select("rect.border").attr({stroke:function(o){var n=nf.Label.defaultColor();if(nf.Common.isDefinedAndNotNull(o.component.style["background-color"])){n=o.component.style["background-color"]}return n},width:function(n){return n.dimensions.width},height:function(n){return n.dimensions.height}});m.select("rect.body").attr({fill:function(o){var n=nf.Label.defaultColor();if(nf.Common.isDefinedAndNotNull(o.component.style["background-color"])){n=o.component.style["background-color"]}n=nf.Common.substringAfterLast(n,"#");return"url(#label-background-"+n+")"},width:function(n){return n.dimensions.width},height:function(n){return n.dimensions.height}});m.each(function(r){var s=d3.select(this);var p=s.select("text.label-value");p.attr("font-size",function(){var t="12px";if(nf.Common.isDefinedAndNotNull(r.component.style["font-size"])){t=r.component.style["font-size"]}return t});p.selectAll("tspan").remove();var o=[];if(nf.Common.isDefinedAndNotNull(r.component.label)){o=r.component.label.split("\n")}else{o.push("")}$.each(o,function(u,t){p.append("tspan").attr("x","0.4em").attr("dy","1.2em").text(function(){return t})});if(nf.Common.isDFM()){var n=[{x:r.dimensions.width,y:r.dimensions.height}];var q=s.selectAll("rect.labelpoint").data(n);q.enter().append("rect").attr({"class":"labelpoint",width:10,height:10}).call(h);q.attr("transform",function(t){return"translate("+(t.x-10)+", "+(t.y-10)+")"});q.exit().remove()}})};var e=function(l){l.remove()};return{config:{width:a.width,height:a.height},init:function(){f=d3.map();j=d3.select("#canvas").append("g").attr({"pointer-events":"all","class":"labels"});h=d3.behavior.drag().on("dragstart",function(){d3.event.sourceEvent.stopPropagation()}).on("drag",function(){var l=d3.select(this.parentNode);var m=l.datum();m.dimensions.width=Math.max(b,d3.event.x);m.dimensions.height=Math.max(g,d3.event.y);k(l)}).on("dragend",function(){var m=d3.select(this.parentNode);var n=m.datum();var o=false;if(nf.Common.isDefinedAndNotNull(n.component.width)||n.dimensions.width!==n.component.width){o=true}if(!o&&nf.Common.isDefinedAndNotNull(n.component.height)||n.dimensions.height!==n.component.height){o=true}if(o){var l=nf.Client.getRevision();$.ajax({type:"PUT",url:n.component.uri,data:{version:l.version,clientId:l.clientId,width:n.dimensions.width,height:n.dimensions.height},dataType:"json"}).done(function(p){nf.Client.setRevision(p.revision);nf.Label.set(p.label)}).fail(function(){var q=a.width;if(nf.Common.isDefinedAndNotNull(n.component.width)){q=n.component.width}var p=a.height;if(nf.Common.isDefinedAndNotNull(n.component.height)){p=n.component.height}n.dimensions={width:q,height:p};m.call(k)})}d3.event.sourceEvent.stopPropagation()})},add:function(n,l){l=nf.Common.isDefinedAndNotNull(l)?l:false;var m=function(p){var q=a.width;if(nf.Common.isDefinedAndNotNull(p.width)){q=p.width}var o=a.height;if(nf.Common.isDefinedAndNotNull(p.height)){o=p.height}f.set(p.id,{type:"Label",component:p,dimensions:{width:q,height:o}})};if($.isArray(n)){$.each(n,function(p,o){m(o)})}else{m(n)}i().enter().call(c,l)},get:function(l){if(nf.Common.isUndefined(l)){return f.values()}else{return f.get(l)}},refresh:function(l){if(nf.Common.isDefinedAndNotNull(l)){d3.select("#id-"+l).call(k)}else{d3.selectAll("g.label").call(k)}},reload:function(l){if(f.has(l.id)){return $.ajax({type:"GET",url:l.uri,dataType:"json"}).done(function(m){nf.Label.set(m.label)})}},position:function(l){d3.select("#id-"+l).call(d)},set:function(m){var l=function(p){if(f.has(p.id)){var q=a.width;if(nf.Common.isDefinedAndNotNull(p.width)){q=p.width}var n=a.height;if(nf.Common.isDefinedAndNotNull(p.height)){n=p.height}var o=f.get(p.id);o.component=p;o.dimensions={width:q,height:n};d3.select("#id-"+p.id).call(k)}};if($.isArray(m)){$.each(m,function(o,n){l(n)})}else{l(m)}},remove:function(l){if($.isArray(l)){$.each(l,function(n,m){f.remove(m)})}else{f.remove(l)}i().exit().call(e)},removeAll:function(){nf.Label.remove(f.keys())},defaultColor:function(){return"#ffde93"}}}());
nf.Port=(function(){var k=15;var l=12;var d={width:160,height:40};var h={width:160,height:56};var g;var a;var i=function(){return a.selectAll("g.input-port, g.output-port").data(g.values(),function(m){return m.component.id})};var f=function(o,n){if(o.empty()){return}var m=o.append("g").attr({id:function(q){return"id-"+q.component.id},"class":function(q){if(q.component.type==="INPUT_PORT"){return"input-port component"}else{return"output-port component"}}}).classed("selected",n).call(nf.CanvasUtils.position);m.append("rect").attr({"class":"border",width:function(q){return q.dimensions.width},height:function(q){return q.dimensions.height},fill:"transparent","stroke-opacity":0.8,"stroke-width":1,stroke:"#aaaaaa"});var p=0;if(nf.Canvas.getParentGroupId()===null){p=l;m.append("rect").attr({"class":"remote-banner",width:function(q){return q.dimensions.width},height:p,fill:"#294c58","fill-opacity":0.95})}m.append("rect").attr({x:0,y:p,"class":"port-body",width:function(q){return q.dimensions.width},height:function(q){return q.dimensions.height-p},fill:"url(#port-background)","fill-opacity":0.8,"stroke-opacity":0.8,"stroke-width":0,stroke:"#aaaaaa"});m.append("image").call(nf.CanvasUtils.disableImageHref).attr({"xlink:href":function(q){if(q.component.type==="INPUT_PORT"){return"images/iconInputPort.png"}else{return"images/iconOutputPort.png"}},width:46,height:31,x:function(q){if(q.component.type==="INPUT_PORT"){return 0}else{return 114}},y:5+p});m.append("text").attr({x:function(q){if(q.component.type==="INPUT_PORT"){return 52}else{return 5}},y:18+p,width:95,height:30,"font-size":"10px","font-weight":"bold",fill:"#294c58","class":"port-name"});m.call(nf.Selectable.activate).call(nf.ContextMenu.activate);if(nf.Common.isDFM()){m.call(nf.Draggable.activate).call(nf.Connectable.activate)}m.call(e)};var e=function(m){if(m.empty()){return}m.each(function(){var n=d3.select(this);var o=n.select("g.port-details");if(n.classed("visible")){if(o.empty()){o=n.append("g").attr("class","port-details");var p=0;if(nf.Canvas.getParentGroupId()===null){p=l;o.append("image").call(nf.CanvasUtils.disableImageHref).attr({"class":"port-transmission-icon",width:10,height:10,x:3,y:1});o.append("image").call(nf.CanvasUtils.disableImageHref).attr({"class":"bulletin-icon","xlink:href":"images/iconBulletin.png",width:12,height:12,x:147,y:0})}o.append("image").call(nf.CanvasUtils.disableImageHref).attr({"class":"port-run-status-icon",width:16,height:16,x:function(q){if(q.component.type==="INPUT_PORT"){return 33}else{return 107}},y:function(){return 24+p}});o.append("rect").attr({"class":"active-thread-count-background",height:11,y:0,fill:"#fff","fill-opacity":"0.65",stroke:"#aaa","stroke-width":"1"});o.append("text").attr({"class":"active-thread-count",height:11,y:9,fill:"#000"})}o.select("image.port-run-status-icon").attr("xlink:href",function(r){var q="";if(r.component.state==="DISABLED"){q="images/iconDisable.png"}else{if(!nf.Common.isEmpty(r.component.validationErrors)){q="images/iconAlert.png"}else{if(r.component.state==="RUNNING"){q="images/iconRun.png"}else{if(r.component.state==="STOPPED"){q="images/iconStop.png"}}}}return q}).each(function(r){var q=d3.select("#run-status-tip-"+r.component.id);if(!q.empty()){q.remove()}if(!nf.Common.isEmpty(r.component.validationErrors)){q=d3.select("#port-tooltips").append("div").attr("id",function(){return"run-status-tip-"+r.component.id}).attr("class","tooltip nifi-tooltip").html(function(){var s=nf.Common.formatUnorderedList(r.component.validationErrors);if(s===null||s.length===0){return""}else{return $("<div></div>").append(s).html()}});nf.CanvasUtils.canvasTooltip(q,d3.select(this))}});n.select("text.port-name").each(function(t){var s=d3.select(this);var q=t.component.name;var r=q.split(/\s+/);s.text(null).selectAll("tspan, title").remove();if(r.length===1){nf.CanvasUtils.ellipsis(s,q)}else{nf.CanvasUtils.multilineEllipsis(s,2,q)}}).append("title").text(function(q){return q.component.name});n.call(b)}else{n.select("text.port-name").text(function(r){var q=r.component.name;if(q.length>k){return q.substring(0,k)+String.fromCharCode(8230)}else{return q}});n.call(j);if(!o.empty()){o.remove()}}})};var b=function(m){if(m.empty()){return}m.select("image.port-transmission-icon").attr("xlink:href",function(n){if(n.status.transmitting===true){return"images/iconPortTransmitting.png"}else{return"images/iconPortNotTransmitting.png"}});m.each(function(p){var n=d3.select(this);var o=0;nf.CanvasUtils.activeThreadCount(n,p,function(q){o=q});nf.CanvasUtils.bulletins(n,p,function(){return d3.select("#port-tooltips")},o)})};var c=function(m){if(m.empty()){return}m.call(j).remove()};var j=function(m){m.each(function(n){$("#run-status-tip-"+n.component.id).remove();$("#bulletin-tip-"+n.component.id).remove()})};return{init:function(){g=d3.map();a=d3.select("#canvas").append("g").attr({"pointer-events":"all","class":"ports"})},add:function(p,n){n=nf.Common.isDefinedAndNotNull(n)?n:false;var m=d;if(nf.Canvas.getParentGroupId()===null){m=h}var o=function(q){g.set(q.id,{type:"Port",component:q,dimensions:m,status:{activeThreadCount:0}})};if($.isArray(p)){$.each(p,function(r,q){o(q)})}else{o(p)}i().enter().call(f,n)},get:function(m){if(nf.Common.isUndefined(m)){return g.values()}else{return g.get(m)}},refresh:function(m){if(nf.Common.isDefinedAndNotNull(m)){d3.select("#id-"+m).call(e)}else{d3.selectAll("g.input-port, g.output-port").call(e)}},pan:function(){d3.selectAll("g.input-port.entering, g.output-port.entering, g.input-port.leaving, g.output-port.leaving").call(e)},reload:function(m){if(g.has(m.id)){return $.ajax({type:"GET",url:m.uri,dataType:"json"}).done(function(n){if(nf.Common.isDefinedAndNotNull(n.inputPort)){nf.Port.set(n.inputPort)}else{nf.Port.set(n.outputPort)}})}},position:function(m){d3.select("#id-"+m).call(nf.CanvasUtils.position)},set:function(n){var m=function(o){if(g.has(o.id)){var p=g.get(o.id);p.component=o;d3.select("#id-"+o.id).call(e)}};if($.isArray(n)){$.each(n,function(p,o){m(o)})}else{m(n)}},setStatus:function(m){if(nf.Common.isEmpty(m)){return}$.each(m,function(p,n){if(g.has(n.id)){var o=g.get(n.id);o.status=n}});d3.selectAll("g.input-port.visible, g.output-port.visible").call(b)},remove:function(m){if($.isArray(m)){$.each(m,function(o,n){g.remove(n)})}else{g.remove(m)}i().exit().call(c)},removeAll:function(){nf.Port.remove(g.keys())}}}());
nf.ProcessGroup=(function(){var l=30;var a={width:365,height:142};var g;var f;var i=function(m){if(nf.Common.isBlank(m.component.comments)){return"No comments specified"}else{return m.component.comments}};var j=function(){return f.selectAll("g.process-group").data(g.values(),function(m){return m.component.id})};var h=function(o,m){if(o.empty()){return}var n=o.append("g").attr({id:function(p){return"id-"+p.component.id},"class":"process-group component"}).classed("selected",m).call(nf.CanvasUtils.position);n.append("rect").attr({rx:6,ry:6,"class":"border",width:function(p){return p.dimensions.width},height:function(p){return p.dimensions.height},fill:"transparent","stroke-opacity":0.8,"stroke-width":2,stroke:"#294c58"});n.append("rect").attr({rx:6,ry:6,"class":"body",width:function(p){return p.dimensions.width},height:function(p){return p.dimensions.height},fill:"#294c58","fill-opacity":0.8,"stroke-width":0});n.append("text").attr({x:10,y:15,width:316,height:16,"font-size":"10pt","font-weight":"bold",fill:"#ffffff","class":"process-group-name"});n.append("image").call(nf.CanvasUtils.disableImageHref).attr({"xlink:href":"images/bgProcessGroupDetailsArea.png",width:352,height:113,x:6,y:22,"class":"process-group-preview"});n.on("dblclick",function(p){nf.CanvasUtils.enterGroup(p.component.id)}).call(nf.Selectable.activate).call(nf.ContextMenu.activate);if(nf.Common.isDFM()){n.on("mouseover.drop",function(t){var r=d3.select(this);if(!r.classed("drop")){var s=r.datum();var q=d3.select("rect.drag-selection");if(!q.empty()){var p=nf.CanvasUtils.getSelection().filter(function(u){return s.component.id===u.component.id});if(p.empty()){r.classed("drop",function(){return nf.CanvasUtils.isDisconnected(nf.CanvasUtils.getSelection())})}}}}).on("mouseout.drop",function(p){d3.select(this).classed("drop",false)}).call(nf.Draggable.activate).call(nf.Connectable.activate)}n.call(c)};var e=5;var c=function(m){if(m.empty()){return}m.each(function(){var C=d3.select(this);var z=C.select("g.process-group-details");if(C.classed("visible")){if(z.empty()){z=C.append("g").attr("class","process-group-details");z.append("rect").attr({x:6,y:22,width:352,height:113,"stroke-width":1,stroke:"#6f97ac",fill:"#ffffff"});z.append("rect").attr({x:6,y:22,width:352,height:22,"stroke-width":1,stroke:"#6f97ac",fill:"url(#process-group-stats-background)","class":"process-group-contents-container"});z.append("rect").attr({x:6,y:104,width:352,height:33,"stroke-width":1,stroke:"#6f97ac",fill:"url(#process-group-stats-background)"});z.append("image").call(nf.CanvasUtils.disableImageHref).attr({"xlink:href":"images/iconInputPortSmall.png",width:16,height:16,x:10,y:25});z.append("text").attr({x:29,y:37,"class":"process-group-input-port-count process-group-contents-count"});z.append("image").call(nf.CanvasUtils.disableImageHref).attr({"xlink:href":"images/iconOutputPortSmall.png",width:16,height:16,y:25,"class":"process-group-output-port"});z.append("text").attr({y:37,"class":"process-group-output-port-count process-group-contents-count"});z.append("image").call(nf.CanvasUtils.disableImageHref).attr({"xlink:href":"images/iconTransmissionActive.png",width:16,height:16,y:25,"class":"process-group-transmitting"});z.append("text").attr({y:37,"class":"process-group-transmitting-count process-group-contents-count"});z.append("image").call(nf.CanvasUtils.disableImageHref).attr({"xlink:href":"images/iconTransmissionInactive.png",width:16,height:16,y:25,"class":"process-group-not-transmitting"});z.append("text").attr({y:37,"class":"process-group-not-transmitting-count process-group-contents-count"});z.append("image").call(nf.CanvasUtils.disableImageHref).attr({"xlink:href":"images/iconRun.png",width:16,height:16,y:25,"class":"process-group-running"});z.append("text").attr({y:37,"class":"process-group-running-count process-group-contents-count"});z.append("image").call(nf.CanvasUtils.disableImageHref).attr({"xlink:href":"images/iconStop.png",width:16,height:16,y:25,"class":"process-group-stopped"});z.append("text").attr({y:37,"class":"process-group-stopped-count process-group-contents-count"});z.append("image").call(nf.CanvasUtils.disableImageHref).attr({"xlink:href":"images/iconAlert.png",width:16,height:16,y:25,"class":"process-group-invalid"});z.append("text").attr({y:37,"class":"process-group-invalid-count process-group-contents-count"});z.append("image").call(nf.CanvasUtils.disableImageHref).attr({"xlink:href":"images/iconDisable.png",width:16,height:16,y:25,"class":"process-group-disabled"});z.append("text").attr({y:37,"class":"process-group-disabled-count process-group-contents-count"});var y=z.append("g").attr({transform:"translate(6, 54)"});y.append("text").attr({width:73,height:10,x:4,y:4,"class":"process-group-stats-label"}).text("Queued");y.append("text").attr({width:73,height:10,x:4,y:17,"class":"process-group-stats-label"}).text("In");y.append("text").attr({width:73,height:10,x:4,y:30,"class":"process-group-stats-label"}).text("Read/Write");y.append("text").attr({width:73,height:10,x:4,y:43,"class":"process-group-stats-label"}).text("Out");var o=z.append("g").attr({transform:"translate(95, 54)"});o.append("text").attr({width:180,height:10,x:4,y:4,"class":"process-group-queued process-group-stats-value"});o.append("text").attr({width:180,height:10,x:4,y:17,"class":"process-group-in process-group-stats-value"});o.append("text").attr({width:180,height:10,x:4,y:30,"class":"process-group-read-write process-group-stats-value"});o.append("text").attr({width:180,height:10,x:4,y:43,"class":"process-group-out process-group-stats-value"});var u=z.append("g").attr({transform:"translate(314, 54)"});u.append("text").attr({width:25,height:10,x:4,y:17,"class":"process-group-stats-info"}).text("(5 min)");u.append("text").attr({width:25,height:10,x:4,y:30,"class":"process-group-stats-info"}).text("(5 min)");u.append("text").attr({width:25,height:10,x:4,y:43,"class":"process-group-stats-info"}).text("(5 min)");z.append("text").attr({x:10,y:118,width:342,height:22,"class":"process-group-comments"});z.append("rect").attr({"class":"active-thread-count-background",height:13,y:0,fill:"#fff","fill-opacity":"0.4",stroke:"#aaa","stroke-width":"1"});z.append("text").attr({"class":"active-thread-count",height:13,y:10,fill:"#000"});z.append("image").call(nf.CanvasUtils.disableImageHref).attr({"class":"bulletin-icon","xlink:href":"images/iconBulletin.png",width:12,height:12,y:2})}var q=z.select("text.process-group-input-port-count").text(function(G){return G.component.inputPortCount});var v=z.select("image.process-group-output-port").attr("x",function(){var G=parseInt(q.attr("x"),10);return G+q.node().getComputedTextLength()+e});z.select("text.process-group-output-port-count").attr("x",function(){var H=parseInt(v.attr("x"),10);var G=parseInt(v.attr("width"),10);return H+G+e}).text(function(G){return G.component.outputPortCount});var x=z.select("rect.process-group-contents-container");var A=z.select("text.process-group-disabled-count").text(function(G){return G.component.disabledCount}).attr("x",function(){var G=parseInt(x.attr("x"),10);var H=parseInt(x.attr("width"),10);return G+H-this.getComputedTextLength()-e});var s=z.select("image.process-group-disabled").attr("x",function(){var H=parseInt(A.attr("x"),10);var G=parseInt(d3.select(this).attr("width"),10);return H-G-e});var w=z.select("text.process-group-invalid-count").text(function(G){return G.component.invalidCount}).attr("x",function(){var G=parseInt(s.attr("x"),10);return G-this.getComputedTextLength()-e});var B=z.select("image.process-group-invalid").attr("x",function(){var G=parseInt(w.attr("x"),10);var H=parseInt(d3.select(this).attr("width"),10);return G-H-e});var E=z.select("text.process-group-stopped-count").text(function(G){return G.component.stoppedCount}).attr("x",function(){var G=parseInt(B.attr("x"),10);return G-this.getComputedTextLength()-e});var r=z.select("image.process-group-stopped").attr("x",function(){var H=parseInt(E.attr("x"),10);var G=parseInt(d3.select(this).attr("width"),10);return H-G-e});var t=z.select("text.process-group-running-count").text(function(G){return G.component.runningCount}).attr("x",function(){var G=parseInt(r.attr("x"),10);return G-this.getComputedTextLength()-e});var p=z.select("image.process-group-running").attr("x",function(){var H=parseInt(t.attr("x"),10);var G=parseInt(d3.select(this).attr("width"),10);return H-G-e});var D=z.select("text.process-group-not-transmitting-count").text(function(G){return G.component.inactiveRemotePortCount}).attr("x",function(){var G=parseInt(p.attr("x"),10);return G-this.getComputedTextLength()-e});var n=z.select("image.process-group-not-transmitting").attr("x",function(){var H=parseInt(D.attr("x"),10);var G=parseInt(d3.select(this).attr("width"),10);return H-G-e});var F=z.select("text.process-group-transmitting-count").text(function(G){return G.component.activeRemotePortCount}).attr("x",function(){var G=parseInt(n.attr("x"),10);return G-this.getComputedTextLength()-e});z.select("image.process-group-transmitting").attr("x",function(){var H=parseInt(F.attr("x"),10);var G=parseInt(d3.select(this).attr("width"),10);return H-G-e});z.select("text.process-group-comments").each(function(H){var G=d3.select(this);G.text(null).selectAll("tspan, title").remove();nf.CanvasUtils.multilineEllipsis(G,2,i(H))}).classed("unset",function(G){return nf.Common.isBlank(G.component.comments)}).append("title").text(function(G){return i(G)});C.select("text.process-group-name").each(function(H){var G=d3.select(this);G.text(null).selectAll("title").remove();nf.CanvasUtils.ellipsis(G,H.component.name)}).append("title").text(function(G){return G.component.name});C.select("image.process-group-preview").style("display","none");C.call(d)}else{C.select("text.process-group-name").text(function(H){var G=H.component.name;if(G.length>l){return G.substring(0,l)+String.fromCharCode(8230)}else{return G}});C.select("image.process-group-preview").style("display","block");C.call(k);if(!z.empty()){z.remove()}}})};var d=function(m){if(m.empty()){return}m.select("text.process-group-queued").text(function(n){if(nf.Common.isDefinedAndNotNull(n.status)){return n.status.queued}else{return"- / -"}});m.select("text.process-group-in").text(function(n){if(nf.Common.isDefinedAndNotNull(n.status)){return n.status.input}else{return"- / -"}});m.select("text.process-group-read-write").text(function(n){if(nf.Common.isDefinedAndNotNull(n.status)){return n.status.read+" / "+n.status.written}else{return"- / -"}});m.select("text.process-group-out").text(function(n){if(nf.Common.isDefinedAndNotNull(n.status)){return n.status.output}else{return"- / -"}});m.each(function(p){var n=d3.select(this);var o=0;nf.CanvasUtils.activeThreadCount(n,p,function(q){o=q});nf.CanvasUtils.bulletins(n,p,function(){return d3.select("#process-group-tooltips")},o)})};var b=function(m){if(m.empty()){return}m.call(k).remove()};var k=function(m){m.each(function(n){$("#bulletin-tip-"+n.component.id).remove()})};return{init:function(){g=d3.map();f=d3.select("#canvas").append("g").attr({"pointer-events":"all","class":"process-groups"})},add:function(m,n){n=nf.Common.isDefinedAndNotNull(n)?n:false;var o=function(p){g.set(p.id,{type:"ProcessGroup",component:p,dimensions:a})};if($.isArray(m)){$.each(m,function(p,q){o(q)})}else{o(m)}j().enter().call(h,n)},get:function(m){if(nf.Common.isUndefined(m)){return g.values()}else{return g.get(m)}},refresh:function(m){if(nf.Common.isDefinedAndNotNull(m)){d3.select("#id-"+m).call(c)}else{d3.selectAll("g.process-group").call(c)}},pan:function(){d3.selectAll("g.process-group.entering, g.process-group.leaving").call(c)},reload:function(m){if(g.has(m.id)){return $.ajax({type:"GET",url:m.uri,dataType:"json"}).done(function(n){nf.ProcessGroup.set(n.processGroup)})}},position:function(m){d3.select("#id-"+m).call(nf.CanvasUtils.position)},set:function(m){var n=function(o){if(g.has(o.id)){var p=g.get(o.id);p.component=o;d3.select("#id-"+o.id).call(c)}};if($.isArray(m)){$.each(m,function(o,p){n(p)})}else{n(m)}},setStatus:function(m){if(nf.Common.isEmpty(m)){return}$.each(m,function(o,n){if(g.has(n.id)){var p=g.get(n.id);p.status=n}});d3.selectAll("g.process-group.visible").call(d)},remove:function(m){if($.isArray(m)){$.each(m,function(n,o){g.remove(o)})}else{g.remove(m)}j().exit().call(b)},removeAll:function(){nf.ProcessGroup.remove(g.keys())}}}());
nf.RemoteProcessGroup=(function(){var l=30;var a={width:365,height:140};var j;var b;var g=function(m){if(nf.Common.isBlank(m.component.comments)){return"No comments specified"}else{return m.component.comments}};var h=function(){return b.selectAll("g.remote-process-group").data(j.values(),function(m){return m.component.id})};var k=function(o,m){if(o.empty()){return}var n=o.append("g").attr({id:function(p){return"id-"+p.component.id},"class":"remote-process-group component"}).classed("selected",m).call(nf.CanvasUtils.position);n.append("rect").attr({rx:6,ry:6,"class":"border",width:function(p){return p.dimensions.width},height:function(p){return p.dimensions.height},fill:"transparent","stroke-opacity":0.8,"stroke-width":2,stroke:"#294c58"});n.append("rect").attr({rx:6,ry:6,"class":"body",width:function(p){return p.dimensions.width},height:function(p){return p.dimensions.height},fill:"#294c58","fill-opacity":0.8,"stroke-width":0});n.append("text").attr({x:25,y:17,width:305,height:16,"font-size":"10pt","font-weight":"bold",fill:"#ffffff","class":"remote-process-group-name"});n.append("image").call(nf.CanvasUtils.disableImageHref).attr({"xlink:href":"images/bgRemoteProcessGroupDetailsArea.png",width:352,height:89,x:6,y:38,"class":"remote-process-group-preview"});n.call(nf.Selectable.activate).call(nf.ContextMenu.activate);if(nf.Common.isDFM()){n.call(nf.Draggable.activate).call(nf.Connectable.activate)}n.call(f)};var d=5;var f=function(m){if(m.empty()){return}m.each(function(){var t=d3.select(this);var n=t.select("g.remote-process-group-details");if(t.classed("visible")){if(n.empty()){n=t.append("g").attr("class","remote-process-group-details");n.append("image").call(nf.CanvasUtils.disableImageHref).attr({"class":"remote-process-group-transmission-status",width:16,height:16,x:5,y:5});n.append("image").call(nf.CanvasUtils.disableImageHref).attr({"class":"remote-process-group-transmission-secure",width:14,height:12,x:7,y:23});n.append("text").attr({x:25,y:32,width:305,height:12,"font-size":"8pt",fill:"#91b9ce","class":"remote-process-group-uri"}).each(function(B){var A=d3.select(this);A.text(null).selectAll("title").remove();nf.CanvasUtils.ellipsis(A,B.component.targetUri)}).append("title").text(function(A){return A.component.name});n.append("rect").attr({x:6,y:38,width:352,height:89,"stroke-width":1,stroke:"#6f97ac",fill:"#ffffff"});n.append("rect").attr({x:6,y:38,width:176,height:22,"stroke-width":1,stroke:"#6f97ac",fill:"url(#process-group-stats-background)","class":"remote-process-group-input-container"});n.append("rect").attr({x:182,y:38,width:176,height:22,"stroke-width":1,stroke:"#6f97ac",fill:"url(#process-group-stats-background)","class":"remote-process-group-output-container"});n.append("rect").attr({x:6,y:94,width:352,height:33,"stroke-width":1,stroke:"#6f97ac",fill:"url(#process-group-stats-background)"});n.append("image").call(nf.CanvasUtils.disableImageHref).attr({"xlink:href":"images/iconInputPortSmall.png",width:16,height:16,x:10,y:41});n.append("text").attr({x:30,y:53,"class":"remote-process-group-input-port-count process-group-contents-count"});n.append("image").call(nf.CanvasUtils.disableImageHref).attr({"xlink:href":"images/iconTransmissionActive.png",width:16,height:16,y:41,"class":"remote-process-group-input-transmitting"});n.append("text").attr({y:53,"class":"remote-process-group-input-transmitting-count process-group-contents-count"});n.append("image").call(nf.CanvasUtils.disableImageHref).attr({"xlink:href":"images/iconTransmissionInactive.png",width:16,height:16,y:41,"class":"remote-process-group-input-not-transmitting"});n.append("text").attr({y:53,"class":"remote-process-group-input-not-transmitting-count process-group-contents-count"});n.append("image").call(nf.CanvasUtils.disableImageHref).attr({"xlink:href":"images/iconOutputPortSmall.png",width:16,height:16,x:186,y:41,"class":"remote-process-group-output-port"});n.append("text").attr({x:206,y:53,"class":"remote-process-group-output-port-count process-group-contents-count"});n.append("image").call(nf.CanvasUtils.disableImageHref).attr({"xlink:href":"images/iconTransmissionActive.png",width:16,height:16,y:41,"class":"remote-process-group-output-transmitting"});n.append("text").attr({y:53,"class":"remote-process-group-output-transmitting-count process-group-contents-count"});n.append("image").call(nf.CanvasUtils.disableImageHref).attr({"xlink:href":"images/iconTransmissionInactive.png",width:16,height:16,y:41,"class":"remote-process-group-output-not-transmitting"});n.append("text").attr({y:53,"class":"remote-process-group-output-not-transmitting-count process-group-contents-count"});var o=n.append("g").attr({transform:"translate(6, 70)"});o.append("text").attr({width:73,height:10,x:4,y:4,"class":"process-group-stats-label"}).text("Sent");o.append("text").attr({width:73,height:10,x:4,y:17,"class":"process-group-stats-label"}).text("Received");var p=n.append("g").attr({transform:"translate(95, 70)"});p.append("text").attr({width:180,height:10,x:4,y:4,"class":"remote-process-group-sent process-group-stats-value"});p.append("text").attr({width:180,height:10,x:4,y:17,"class":"remote-process-group-received process-group-stats-value"});var z=n.append("g").attr({transform:"translate(315, 70)"});z.append("text").attr({width:25,height:10,x:4,y:4,"class":"process-group-stats-info"}).text("(5 min)");z.append("text").attr({width:25,height:10,x:4,y:17,"class":"process-group-stats-info"}).text("(5 min)");n.append("text").attr({x:10,y:108,width:342,height:22,"class":"remote-process-group-comments"});n.append("text").attr({x:358,y:137,"class":"remote-process-group-last-refresh"});n.append("rect").attr({"class":"active-thread-count-background",height:13,y:0,fill:"#fff","fill-opacity":"0.4",stroke:"#aaa","stroke-width":"1"});n.append("text").attr({"class":"active-thread-count",height:13,y:10,fill:"#000"});n.append("image").call(nf.CanvasUtils.disableImageHref).attr({"class":"bulletin-icon","xlink:href":"images/iconBulletin.png",width:12,height:12,y:2})}n.select("image.remote-process-group-transmission-secure").attr("xlink:href",function(B){var A="";if(B.component.targetSecure===true){A="images/iconSecure.png"}else{A="images/iconNotSecure.png"}return A}).each(function(B){var A=d3.select("#transmission-secure-"+B.component.id);if(!A.empty()){A.remove()}A=d3.select("#remote-process-group-tooltips").append("div").attr("id",function(){return"transmission-secure-"+B.component.id}).attr("class","tooltip nifi-tooltip").text(function(){if(B.component.targetSecure===true){return"Site-to-Site is secure."}else{return"Site-to-Site is NOT secure."}});nf.CanvasUtils.canvasTooltip(A,d3.select(this))});n.select("text.remote-process-group-input-port-count").text(function(A){return A.component.inputPortCount});var y=n.select("rect.remote-process-group-input-container");var w=n.select("text.remote-process-group-input-not-transmitting-count").text(function(A){return A.component.inactiveRemoteInputPortCount}).attr("x",function(){var A=parseInt(y.attr("x"),10);var B=parseInt(y.attr("width"),10);return A+B-this.getComputedTextLength()-d});var s=n.select("image.remote-process-group-input-not-transmitting").attr("x",function(){var B=parseInt(w.attr("x"),10);var A=parseInt(d3.select(this).attr("width"),10);return B-A-d});var u=n.select("text.remote-process-group-input-transmitting-count").text(function(A){return A.component.activeRemoteInputPortCount}).attr("x",function(){var A=parseInt(s.attr("x"),10);return A-this.getComputedTextLength()-d});n.select("image.remote-process-group-input-transmitting").attr("x",function(){var B=parseInt(u.attr("x"),10);var A=parseInt(d3.select(this).attr("width"),10);return B-A-d});n.select("text.remote-process-group-output-port-count").text(function(A){return A.component.outputPortCount});var v=n.select("rect.remote-process-group-output-container");var q=n.select("text.remote-process-group-output-not-transmitting-count").text(function(A){return A.component.inactiveRemoteOutputPortCount}).attr("x",function(){var A=parseInt(v.attr("x"),10);var B=parseInt(v.attr("width"),10);return A+B-this.getComputedTextLength()-d});var x=n.select("image.remote-process-group-output-not-transmitting").attr("x",function(){var A=parseInt(q.attr("x"),10);var B=parseInt(d3.select(this).attr("width"),10);return A-B-d});var r=n.select("text.remote-process-group-output-transmitting-count").text(function(A){return A.component.activeRemoteOutputPortCount}).attr("x",function(){var A=parseInt(x.attr("x"),10);return A-this.getComputedTextLength()-d});n.select("image.remote-process-group-output-transmitting").attr("x",function(){var B=parseInt(r.attr("x"),10);var A=parseInt(d3.select(this).attr("width"),10);return B-A-d});n.select("text.remote-process-group-comments").each(function(B){var A=d3.select(this);A.text(null).selectAll("tspan, title").remove();nf.CanvasUtils.multilineEllipsis(A,2,g(B))}).classed("unset",function(A){return nf.Common.isBlank(A.component.comments)}).append("title").text(function(A){return g(A)});n.select("text.remote-process-group-last-refresh").text(function(A){if(nf.Common.isDefinedAndNotNull(A.component.flowRefreshed)){return A.component.flowRefreshed}else{return"Remote flow not current"}});t.select("text.remote-process-group-name").each(function(B){var A=d3.select(this);A.text(null).selectAll("title").remove();nf.CanvasUtils.ellipsis(A,B.component.name)}).append("title").text(function(A){return A.component.name});t.select("image.remote-process-group-preview").style("display","none");t.call(c)}else{t.select("text.remote-process-group-name").text(function(B){var A=B.component.name;if(A.length>l){return A.substring(0,l)+String.fromCharCode(8230)}else{return A}});t.select("image.remote-process-group-preview").style("display","block");t.call(i);if(!n.empty()){n.remove()}}})};var c=function(m){if(m.empty()){return}m.select("text.remote-process-group-sent").text(function(n){if(nf.Common.isDefinedAndNotNull(n.status)){return n.status.sent}else{return"- / -"}});m.select("text.remote-process-group-received").text(function(n){if(nf.Common.isDefinedAndNotNull(n.status)){return n.status.received}else{return"- / -"}});m.select("image.remote-process-group-transmission-status").attr("xlink:href",function(o){var n="";if(nf.Common.isDefinedAndNotNull(o.status)&&!nf.Common.isEmpty(o.status.authorizationIssues)){n="images/iconAlert.png"}else{if(o.component.transmitting===true){n="images/iconTransmissionActive.png"}else{n="images/iconTransmissionInactive.png"}}return n}).each(function(o){var n=d3.select("#authorization-issues-"+o.component.id);if(!n.empty()){n.remove()}if(nf.Common.isDefinedAndNotNull(o.status)&&!nf.Common.isEmpty(o.status.authorizationIssues)){n=d3.select("#remote-process-group-tooltips").append("div").attr("id",function(){return"authorization-issues-"+o.component.id}).attr("class","tooltip nifi-tooltip").html(function(){var p=nf.Common.formatUnorderedList(o.status.authorizationIssues);if(p===null||p.length===0){return""}else{return $("<div></div>").append(p).html()}});nf.CanvasUtils.canvasTooltip(n,d3.select(this))}});m.each(function(p){var n=d3.select(this);var o=0;nf.CanvasUtils.activeThreadCount(n,p,function(q){o=q});nf.CanvasUtils.bulletins(n,p,function(){return d3.select("#remote-process-group-tooltips")},o)})};var e=function(m){if(m.empty()){return}m.call(i).remove()};var i=function(m){m.each(function(n){$("#bulletin-tip-"+n.component.id).remove();$("#authorization-issues-"+n.component.id).remove();$("#transmission-secure-"+n.component.id).remove()})};return{init:function(){j=d3.map();b=d3.select("#canvas").append("g").attr({"pointer-events":"all","class":"remote-process-groups"})},add:function(m,n){n=nf.Common.isDefinedAndNotNull(n)?n:false;var o=function(p){j.set(p.id,{type:"RemoteProcessGroup",component:p,dimensions:a})};if($.isArray(m)){$.each(m,function(p,q){o(q)})}else{o(m)}h().enter().call(k,n)},get:function(m){if(nf.Common.isUndefined(m)){return j.values()}else{return j.get(m)}},refresh:function(m){if(nf.Common.isDefinedAndNotNull(m)){d3.select("#id-"+m).call(f)}else{d3.selectAll("g.remote-process-group").call(f)}},pan:function(){d3.selectAll("g.remote-process-group.entering, g.remote-process-group.leaving").call(f)},reload:function(m){if(j.has(m.id)){return $.ajax({type:"GET",url:m.uri,dataType:"json"}).done(function(n){nf.RemoteProcessGroup.set(n.remoteProcessGroup);var o=nf.Connection.getComponentConnections(m.id);$.each(o,function(q,p){nf.Connection.reload(p)})})}},position:function(m){d3.select("#id-"+m).call(nf.CanvasUtils.position)},set:function(m){var n=function(o){if(j.has(o.id)){var p=j.get(o.id);p.component=o;d3.select("#id-"+o.id).call(f)}};if($.isArray(m)){$.each(m,function(o,p){n(p)})}else{n(m)}},setStatus:function(m){if(nf.Common.isEmpty(m)){return}$.each(m,function(o,n){if(j.has(n.id)){var p=j.get(n.id);p.status=n}});d3.selectAll("g.remote-process-group.visible").call(c)},remove:function(m){if($.isArray(m)){$.each(m,function(n,o){j.remove(o)})}else{j.remove(m)}h().exit().call(e)},removeAll:function(){nf.RemoteProcessGroup.remove(j.keys())}}}());
nf.Funnel=(function(){var e={width:61,height:61};var c;var f;var b=function(){return f.selectAll("g.funnel").data(c.values(),function(h){return h.component.id})};var a=function(j,i){if(j.empty()){return j}var h=j.append("g").attr({id:function(k){return"id-"+k.component.id},"class":"funnel component"}).classed("selected",i).call(nf.CanvasUtils.position);h.append("rect").attr({"class":"border",width:function(k){return k.dimensions.width},height:function(k){return k.dimensions.height},fill:"transparent","stroke-opacity":0.8,"stroke-width":1});h.append("image").call(nf.CanvasUtils.disableImageHref).attr({"xlink:href":"images/iconFunnel.png",width:41,height:41,x:10,y:10});h.call(nf.Selectable.activate).call(nf.ContextMenu.activate);if(nf.Common.isDFM()){h.call(nf.Draggable.activate).call(nf.Connectable.activate)}return h};var d=function(h){};var g=function(h){h.remove()};return{init:function(){c=d3.map();f=d3.select("#canvas").append("g").attr({"pointer-events":"all","class":"funnels"})},add:function(h,i){i=nf.Common.isDefinedAndNotNull(i)?i:false;var j=function(k){c.set(k.id,{type:"Funnel",component:k,dimensions:e})};if($.isArray(h)){$.each(h,function(l,k){j(k)})}else{j(h)}b().enter().call(a,i)},get:function(h){if(nf.Common.isUndefined(h)){return c.values()}else{return c.get(h)}},refresh:function(h){if(nf.Common.isDefinedAndNotNull(h)){d3.select("#id-"+h).call(d)}else{d3.selectAll("g.funnel").call(d)}},reload:function(h){if(c.has(h.id)){return $.ajax({type:"GET",url:h.uri,dataType:"json"}).done(function(i){nf.Funnel.set(i.funnel)})}},position:function(h){d3.select("#id-"+h).call(nf.CanvasUtils.position)},set:function(h){var i=function(j){if(c.has(j.id)){var k=c.get(j.id);k.component=j;d3.select("#id-"+j.id).call(d)}};if($.isArray(h)){$.each(h,function(k,j){i(j)})}else{i(h)}},remove:function(h){if($.isArray(h)){$.each(h,function(j,i){c.remove(i)})}else{c.remove(h)}b().exit().call(g)},removeAll:function(){nf.Funnel.remove(c.keys())}}}());
nf.Connection=(function(){var e={width:188};var j=function(A){var C=A.datum();var z,D;if(C.bends.length>0){var B=Math.min(Math.max(0,C.labelIndex),C.bends.length-1);z=C.bends[B].x;D=C.bends[B].y}else{z=(C.start.x+C.end.x)/2;D=(C.start.y+C.end.y)/2}z-=(e.width/2);D-=(A.attr("height")/2);return{x:z,y:D}};var r;var b;var w;var x;var n;var d;var m=function(z,y){return Math.pow(z.x-y.x,2)+Math.pow(z.y-y.y,2)};var i=function(z,y){return Math.sqrt(m(z,y))};var c=function(C,B,z){var y=m(B,z);if(y===0){return Math.sqrt(m(C,B))}var A=((C.x-B.x)*(z.x-B.x)+(C.y-B.y)*(z.y-B.y))/y;if(A<0){return Math.sqrt(m(C,B))}if(A>1){return Math.sqrt(m(C,z))}return Math.sqrt(m(C,{x:B.x+A*(z.x-B.x),y:B.y+A*(z.y-B.y)}))};var u=function(C,E){if(E.bends.length===0){return 0}var A;var z;var y=[E.start].concat(E.bends,[E.end]);for(var B=0;B<y.length;B++){if(B+1<y.length){var D=c(C,y[B],y[B+1]);if(nf.Common.isUndefined(A)||D<A){A=D;z=B}}}return z};var o=function(y){return y.indexOf("INPUT_PORT")>=0};var a=function(y){return y.indexOf("OUTPUT_PORT")>=0};var l=function(y){return y.groupId!==nf.Canvas.getGroupId()&&(o(y.type)||a(y.type))};var g=function(y){if(nf.Common.isDefinedAndNotNull(y.flowFileExpiration)){var z=y.flowFileExpiration.match(/^(\d+).*/);if(z!==null&&z.length>0){if(parseInt(z[0],10)>0){return true}}}return false};var t=function(y){y.sort(function(A,z){return A.component.zIndex===z.component.zIndex?0:A.component.zIndex>z.component.zIndex?1:-1})};var p=function(){return b.selectAll("g.connection").data(r.values(),function(y){return y.component.id})};var v=function(B,A){if(B.empty()){return}var z=B.append("g").attr({id:function(C){return"id-"+C.component.id},"class":"connection"}).classed("selected",A);z.append("path").attr({"class":"connection-path","pointer-events":"none"});z.append("path").attr({"class":"connection-selection-path","pointer-events":"none"});var y=z.append("path").attr({"class":"connection-path-selectable","pointer-events":"stroke"}).on("mousedown.selection",function(){nf.Selectable.select(d3.select(this.parentNode))}).call(nf.ContextMenu.activate);if(nf.Common.isDFM()){y.on("dblclick",function(H){var C=d3.mouse(this.parentNode);var F=u({x:C[0],y:C[1]},H);var E=H.component.bends.slice();E.splice(F,0,{x:C[0],y:C[1]});var D={id:H.component.id,bends:E};var G=H.component.labelIndex;if(E.length===1){D.labelIndex=0}else{if(F<=G){D.labelIndex=G+1}}s(H,D);d3.event.stopPropagation()})}z.call(q,true,false)};var h=function(z){var y=false;if(nf.Common.isDefinedAndNotNull(z.component.selectedRelationships)&&nf.Common.isDefinedAndNotNull(z.component.availableRelationships)){$.each(z.component.selectedRelationships,function(A,B){if($.inArray(B,z.component.availableRelationships)===-1){y=true;return false}})}return y};var q=function(y,z,A){if(y.empty()){return}if(z===true){y.classed("grouped",function(C){var B=false;if(nf.Common.isDefinedAndNotNull(C.component.selectedRelationships)&&C.component.selectedRelationships.length>1){B=true}return B}).classed("ghost",function(C){var B=false;if(h(C)){B=true}return B})}y.each(function(V){var O=d3.select(this);if(z===true){var U=nf.CanvasUtils.getConnectionSourceComponentId(V.component);var F=d3.select("#id-"+U).datum();var G;var L;if(V.bends.length>0){L=V.bends[V.bends.length-1]}else{L={x:F.component.position.x+(F.dimensions.width/2),y:F.component.position.y+(F.dimensions.height/2)}}if(nf.Common.isDefinedAndNotNull(V.end)&&V.end.dragging===true){G=V.end;var W=d3.select("g.hover.connectable-destination");if(!W.empty()){var S=W.datum();var B=nf.CanvasUtils.getPerimeterPoint(L,{x:S.component.position.x,y:S.component.position.y,width:S.dimensions.width,height:S.dimensions.height});G.x=B.x;G.y=B.y}}else{var D=nf.CanvasUtils.getConnectionDestinationComponentId(V.component);var Y=d3.select("#id-"+D).datum();G=nf.CanvasUtils.getPerimeterPoint(L,{x:Y.component.position.x,y:Y.component.position.y,width:Y.dimensions.width,height:Y.dimensions.height})}var M;if(V.bends.length>0){M=V.bends[0]}else{M=G}var I=nf.CanvasUtils.getPerimeterPoint(M,{x:F.component.position.x,y:F.component.position.y,width:F.dimensions.width,height:F.dimensions.height});V.start=I;V.end=G;O.select("path.connection-path").attr({d:function(){var Z=[V.start].concat(V.bends,[V.end]);return d(Z)},"marker-end":function(){var Z="normal";if(h(V)){Z="ghost"}return"url(#"+Z+")"}});O.select("path.connection-selection-path").attr({d:function(){var Z=[V.start].concat(V.bends,[V.end]);return d(Z)}});O.select("path.connection-path-selectable").attr({d:function(){var Z=[V.start].concat(V.bends,[V.end]);return d(Z)}});if(nf.Common.isDFM()){var K=O.selectAll("rect.startpoint").data([V.start]);K.enter().append("rect").attr({"class":"startpoint linepoint","pointer-events":"all",width:8,height:8}).on("mousedown.selection",function(){nf.Selectable.select(d3.select(this.parentNode))}).call(nf.ContextMenu.activate);K.attr("transform",function(Z){return"translate("+(Z.x-4)+", "+(Z.y-4)+")"});K.exit().remove();var J=O.selectAll("rect.endpoint").data([V.end]);J.enter().append("rect").call(x).attr({"class":"endpoint linepoint","pointer-events":"all",width:8,height:8}).on("mousedown.selection",function(){nf.Selectable.select(d3.select(this.parentNode))}).call(nf.ContextMenu.activate);J.attr("transform",function(Z){return"translate("+(Z.x-4)+", "+(Z.y-4)+")"});J.exit().remove();var Q=O.selectAll("rect.midpoint").data(V.bends);Q.enter().append("rect").attr({"class":"midpoint linepoint","pointer-events":"all",width:8,height:8}).call(w).on("dblclick",function(ac){d3.event.stopPropagation();var af=nf.CanvasUtils.getConnectionSourceComponentId(V.component);var ae=nf.CanvasUtils.getConnectionDestinationComponentId(V.component);if(af===ae&&V.component.bends.length<=2){nf.Dialog.showOkDialog({dialogContent:"Looping connections must have at least two bend points.",overlayBackground:false});return}var ab=[];var aa=-1;$.each(V.component.bends,function(ah,ag){if(ac.x!==ag.x&&ac.y!==ag.y){ab.push(ag)}else{aa=ah}});if(aa<0){return}var Z={id:V.component.id,bends:ab};var ad=V.component.labelIndex;if(ab.length<=1){Z.labelIndex=0}else{if(aa<=ad){Z.labelIndex=Math.max(0,ad-1)}}s(V,Z)}).on("mousedown.selection",function(){nf.Selectable.select(d3.select(this.parentNode))}).call(nf.ContextMenu.activate);Q.attr("transform",function(Z){return"translate("+(Z.x-4)+", "+(Z.y-4)+")"});Q.exit().remove()}}if(A===true){var H=O.select("g.connection-label-container");if(O.classed("visible")){if(H.empty()){H=O.insert("g","rect.startpoint").attr({"class":"connection-label-container","pointer-events":"all"}).on("mousedown.selection",function(){nf.Selectable.select(d3.select(this.parentNode))}).call(nf.ContextMenu.activate);H.append("rect").attr({"class":"connection-label",width:e.width,x:0,y:0})}var P=0;var N=H.select("g.connection-from-container");if(l(V.component.source)){if(N.empty()){N=H.append("g").attr({"class":"connection-from-container"});N.append("text").attr({"class":"connection-stats-label",x:0,y:10}).text("From");N.append("text").attr({"class":"connection-stats-value connection-from",x:33,y:10,width:130});N.append("image").call(nf.CanvasUtils.disableImageHref).attr({"class":"connection-from-run-status",width:10,height:10,x:167,y:1})}N.attr("transform",function(){var Z=5+(15*P++);return"translate(5, "+Z+")"});N.select("text.connection-from").each(function(){var Z=d3.select(this);Z.text(null).selectAll("title").remove();nf.CanvasUtils.ellipsis(Z,V.component.source.name)}).append("title").text(function(){return V.component.source.name});N.select("image.connection-from-run-status").attr("xlink:href",function(){if(V.component.source.exists===false){return"images/portRemoved.png"}else{if(V.component.source.running===true){return"images/portRunning.png"}else{return"images/portStopped.png"}}})}else{if(!N.empty()){N.remove()}}var X=H.select("g.connection-to-container");if(l(V.component.destination)){if(X.empty()){X=H.append("g").attr({"class":"connection-to-container"});X.append("text").attr({"class":"connection-stats-label",x:0,y:10}).text("To");X.append("text").attr({"class":"connection-stats-value connection-to",x:18,y:10,width:145});X.append("image").call(nf.CanvasUtils.disableImageHref).attr({"class":"connection-to-run-status",width:10,height:10,x:167,y:1})}X.attr("transform",function(){var Z=5+(15*P++);return"translate(5, "+Z+")"});X.select("text.connection-to").each(function(aa){var Z=d3.select(this);Z.text(null).selectAll("title").remove();nf.CanvasUtils.ellipsis(Z,aa.component.destination.name)}).append("title").text(function(Z){return Z.component.destination.name});X.select("image.connection-to-run-status").attr("xlink:href",function(){if(V.component.destination.exists===false){return"images/portRemoved.png"}else{if(V.component.destination.running===true){return"images/portRunning.png"}else{return"images/portStopped.png"}}})}else{if(!X.empty()){X.remove()}}var E=nf.CanvasUtils.formatConnectionName(V.component);var R=H.select("g.connection-name-container");if(!nf.Common.isBlank(E)){if(R.empty()){R=H.append("g").attr({"class":"connection-name-container"});R.append("text").attr({"class":"connection-stats-label",x:0,y:10}).text("Name");R.append("text").attr({"class":"connection-stats-value connection-name",x:35,y:10,width:142})}R.attr("transform",function(){var Z=5+(15*P++);return"translate(5, "+Z+")"});R.select("text.connection-name").each(function(){var Z=d3.select(this);Z.text(null).selectAll("title").remove();nf.CanvasUtils.ellipsis(Z,E)}).append("title").text(function(){return E})}else{if(!R.empty()){R.remove()}}var C=H.select("g.queued-container");if(C.empty()){C=H.append("g").attr({"class":"queued-container"});C.append("text").attr({"class":"connection-stats-label",x:0,y:10}).text("Queued");C.append("text").attr({"class":"connection-stats-value queued",x:46,y:10});var T=C.append("g").attr({"class":"expiration-icon",transform:"translate(167, 2)"});T.append("circle").attr({cx:5,cy:5,r:4.75,"stroke-width":0.5,stroke:"#87888a",fill:"url(#expiration)"});T.append("line").attr({x1:6,y1:5,x2:3,y2:4,stroke:"#fff","stroke-width":1});T.append("line").attr({x1:6,y1:5,x2:3,y2:7,stroke:"#fff","stroke-width":1});T.append("title")}C.attr("transform",function(){var Z=5+(15*P++);return"translate(5, "+Z+")"});H.select("rect.connection-label").attr("height",function(){return 5+(15*P)+3});H.select("g.expiration-icon").classed("hidden",function(){return !g(V.component)}).select("title").text(function(){return"Expires FlowFiles older than "+V.component.flowFileExpiration});if(nf.Common.isDFM()){H.call(n)}O.call(k)}else{if(!H.empty()){H.remove()}}}O.select("g.connection-label-container").attr("transform",function(){var aa=d3.select(this).select("rect.connection-label");var Z=j(aa);return"translate("+Z.x+", "+Z.y+")"})})};var k=function(y){if(y.empty()){return}y.select("text.queued").text(function(z){if(nf.Common.isDefinedAndNotNull(z.status)){return z.status.queued}else{return"- / -"}})};var s=function(B,z){var A=nf.Client.getRevision();var y={revision:A,connection:z};return $.ajax({type:"PUT",url:B.component.uri,data:JSON.stringify(y),dataType:"json",contentType:"application/json"}).done(function(C){nf.Client.setRevision(C.revision);nf.Connection.set(C.connection)}).fail(function(E,C,D){if(E.status===400||E.status===404||E.status===409){nf.Dialog.showOkDialog({dialogContent:nf.Common.escapeHtml(E.responseText),overlayBackground:true})}else{nf.Common.handleAjaxError(E,C,D)}})};var f=function(y){y.each(function(z){nf.CanvasUtils.reloadConnectionSourceAndDestination(z.component.source.id,z.component.destination.id)});y.remove()};return{config:{selfLoopXOffset:(e.width/2)+5,selfLoopYOffset:25},init:function(){r=d3.map();b=d3.select("#canvas").append("g").attr({"pointer-events":"stroke","class":"connections"});d=d3.svg.line().x(function(y){return y.x}).y(function(y){return y.y}).interpolate("linear");w=d3.behavior.drag().on("dragstart",function(){d3.event.sourceEvent.stopPropagation()}).on("drag",function(y){y.x=d3.event.x;y.y=d3.event.y;d3.select(this.parentNode).call(q,true,false)}).on("dragend",function(){var y=d3.select(this.parentNode);var C=y.datum();var A=y.selectAll("rect.midpoint").data();if(A.length===C.component.bends.length){var B=false;for(var z=0;z<A.length&&!B;z++){if(A[z].x!==C.component.bends[z].x||A[z].y!==C.component.bends[z].y){B=true}}if(B){s(C,{id:C.component.id,bends:A}).fail(function(){C.bends=$.map(C.component.bends,function(D){return{x:D.x,y:D.y}});y.call(q,true,false)})}}d3.event.sourceEvent.stopPropagation()});x=d3.behavior.drag().on("dragstart",function(y){y.dragging=true;d3.event.sourceEvent.stopPropagation()}).on("drag",function(y){y.x=d3.event.x-8;y.y=d3.event.y-8;d3.select("g.hover").classed("connectable-destination",function(){return nf.CanvasUtils.isValidConnectionDestination(d3.select(this))});d3.select(this.parentNode).call(q,true,false)}).on("dragend",function(G){G.dragging=false;var z=d3.select(this.parentNode);var J=z.datum();var y=J.component.destination.id;var I=d3.select("g.connectable-destination");if(I.empty()){z.call(q,true,false)}else{if(nf.CanvasUtils.isProcessGroup(I)||nf.CanvasUtils.isRemoteProcessGroup(I)){nf.ConnectionConfiguration.showConfiguration(z,I).done(function(){nf.CanvasUtils.reloadConnectionSourceAndDestination(null,y)}).fail(function(){z.call(q,true,false)})}else{var H=nf.Client.getRevision();var C=I.datum();var E=nf.CanvasUtils.getConnectableTypeForDestination(I);var D={version:H.version,clientId:H.clientId,destinationId:C.component.id,destinationType:E,destinationGroupId:nf.Canvas.getGroupId()};if(J.bends.length<2&&J.component.source.id===C.component.id){var A={x:C.component.position.x+(C.dimensions.width),y:C.component.position.y+(C.dimensions.height/2)};var F=nf.Connection.config.selfLoopXOffset;var B=nf.Connection.config.selfLoopYOffset;D.bends=[];D.bends.push((A.x+F)+","+(A.y-B));D.bends.push((A.x+F)+","+(A.y+B))}$.ajax({type:"PUT",url:J.component.uri,data:D,dataType:"json"}).done(function(L){var K=L.connection;nf.Client.setRevision(L.revision);nf.Connection.set(K);nf.CanvasUtils.reloadConnectionSourceAndDestination(null,y);nf.CanvasUtils.reloadConnectionSourceAndDestination(K.source.id,K.destination.id)}).fail(function(M,K,L){if(M.status===400||M.status===404||M.status===409){nf.Dialog.showOkDialog({dialogContent:nf.Common.escapeHtml(M.responseText),overlayBackground:true});z.call(q,true,false)}else{nf.Common.handleAjaxError(M,K,L)}})}}d3.event.sourceEvent.stopPropagation()});n=d3.behavior.drag().on("dragstart",function(y){d3.event.sourceEvent.stopPropagation()}).on("drag",function(D){if(D.bends.length>1){var A=d3.select("rect.label-drag");if(A.empty()){var C=d3.select(this).select("rect.connection-label");var B=j(C);var y=e.width;var H=C.attr("height");A=d3.select("#canvas").append("rect").attr("rx",6).attr("ry",6).attr("x",B.x).attr("y",B.y).attr("class","label-drag").attr("width",y).attr("height",H).attr("stroke-width",function(){return 1/nf.Canvas.View.scale()}).attr("stroke-dasharray",function(){return 4/nf.Canvas.View.scale()}).datum({x:B.x,y:B.y,width:y,height:H})}else{A.attr("x",function(I){I.x+=d3.event.dx;return I.x}).attr("y",function(I){I.y+=d3.event.dy;return I.y})}var E=A.datum();var G={x:E.x+(E.width/2),y:E.y+(E.height/2)};var z=-1;var F;$.each(D.bends,function(K,J){var I={x:J.x,y:J.y};var L=i(G,I);if(z===-1||L<F){z=K;F=L}});D.labelIndex=z;d3.select(this.parentNode).call(q,true,false)}}).on("dragend",function(A){if(A.bends.length>1){var z=d3.select("rect.label-drag");if(!z.empty()){z.remove()}if(A.labelIndex!==A.component.labelIndex){var y=d3.select(this.parentNode);s(A,{id:A.component.id,labelIndex:A.labelIndex}).fail(function(){A.labelIndex=A.component.labelIndex;y.call(q,true,false)})}}d3.event.sourceEvent.stopPropagation()})},add:function(y,z){z=nf.Common.isDefinedAndNotNull(z)?z:false;var A=function(B){r.set(B.id,{type:"Connection",component:B,bends:$.map(B.bends,function(C){return{x:C.x,y:C.y}}),labelIndex:B.labelIndex})};if($.isArray(y)){$.each(y,function(C,B){A(B)})}else{A(y)}p().enter().call(v,z)},reorder:function(){d3.selectAll("g.connection").call(t)},set:function(y){var z=function(B){if(r.has(B.id)){var A=r.get(B.id);A.component=B;A.bends=$.map(B.bends,function(C){return{x:C.x,y:C.y}});A.labelIndex=B.labelIndex;d3.select("#id-"+B.id).call(q,true,true)}};if($.isArray(y)){$.each(y,function(A,B){z(B)})}else{z(y)}},setStatus:function(y){if(nf.Common.isEmpty(y)){return}$.each(y,function(B,z){if(r.has(z.id)){var A=r.get(z.id);A.status=z}});d3.selectAll("g.connection.visible").call(k)},refresh:function(y){if(nf.Common.isDefinedAndNotNull(y)){d3.select("#id-"+y).call(q,true,true)}else{d3.selectAll("g.connection").call(q,true,true)}},pan:function(){d3.selectAll("g.connection.entering, g.connection.leaving").call(q,false,true)},remove:function(y){if($.isArray(y)){$.each(y,function(A,z){r.remove(z)})}else{r.remove(y)}p().exit().call(f)},removeAll:function(){nf.Connection.remove(r.keys())},reload:function(y){if(r.has(y.id)){return $.ajax({type:"GET",url:y.uri,dataType:"json"}).done(function(z){nf.Connection.set(z.connection)})}},getComponentConnections:function(z){var y=[];r.forEach(function(B,C){var A=C.component;if(nf.CanvasUtils.getConnectionSourceComponentId(A)===z||nf.CanvasUtils.getConnectionDestinationComponentId(A)===z){y.push(A)}});return y},get:function(y){if(nf.Common.isUndefined(y)){return r.values()}else{return r.get(y)}}}}());
nf.Draggable=(function(){var a;var b=function(e){var f=nf.Client.getRevision();var h=d3.map();var g=e.datum();var j={x:g.x-g.original.x,y:g.y-g.original.y};if(j.x===0&&j.y===0){return}var i=function(l){var k={x:l.component.position.x+j.x,y:l.component.position.y+j.y};return $.Deferred(function(m){$.ajax({type:"PUT",url:l.component.uri,data:{version:f.version,clientId:f.clientId,x:k.x,y:k.y},dataType:"json"}).done(function(n){nf.Client.setRevision(n.revision);l.component.position=k;m.resolve({type:l.type,id:l.component.id})}).fail(function(p,n,o){if(p.status===400||p.status===404||p.status===409){nf.Dialog.showOkDialog({dialogContent:nf.Common.escapeHtml(p.responseText),overlayBackground:true})}else{nf.Common.handleAjaxError(p,n,o)}m.reject()})}).promise()};var d=function(m){if(m.component.bends.length===0){return null}var l=$.map(m.component.bends,function(n){return{x:n.x+j.x,y:n.y+j.y}});var k={revision:f,connection:{id:m.component.id,bends:l}};return $.Deferred(function(n){$.ajax({type:"PUT",url:m.component.uri,data:JSON.stringify(k),dataType:"json",contentType:"application/json"}).done(function(o){nf.Client.setRevision(o.revision);m.component.bends=o.connection.bends;m.bends=$.map(m.component.bends,function(p){return{x:p.x,y:p.y}});n.resolve({type:m.type,id:m.component.id})}).fail(function(q,o,p){if(q.status===400||q.status===404||q.status===409){nf.Dialog.showOkDialog({dialogContent:nf.Common.escapeHtml(q.responseText),overlayBackground:true})}else{nf.Common.handleAjaxError(q,o,p)}n.reject()})}).promise()};d3.selectAll("g.connection.selected").each(function(l){var k=d(l);if(k!==null){h.set(l.component.id,k)}});d3.selectAll("g.component.selected").each(function(l){var k=nf.Connection.getComponentConnections(l.component.id);$.each(k,function(o,n){if(!h.has(n.id)&&nf.CanvasUtils.getConnectionSourceComponentId(n)===nf.CanvasUtils.getConnectionDestinationComponentId(n)){var m=d(nf.Connection.get(n.id));if(m!==null){h.set(n.id,m)}}});h.set(l.component.id,i(l))});$.when.apply(window,h.values()).done(function(){var k=$.makeArray(arguments);var l=d3.set();$.each(k,function(o,n){if(n.type==="Connection"){l.add(n.id)}else{var m=nf.Connection.getComponentConnections(n.id);$.each(m,function(q,p){l.add(p.id)});nf[n.type].position(n.id)}});l.forEach(function(m){nf.Connection.refresh(m)})})};var c=function(){var d=d3.selectAll("g.component.selected, g.connection.selected");var e=d3.select("g.drop");nf.CanvasUtils.moveComponents(d,e)};return{init:function(){a=d3.behavior.drag().on("dragstart",function(){d3.event.sourceEvent.stopPropagation()}).on("drag",function(){var e=d3.select("rect.drag-selection");if(e.empty()){var f=d3.selectAll("g.component.selected");var d=null,h=null,i=null,g=null;f.each(function(l){if(d===null||l.component.position.x<d){d=l.component.position.x}if(i===null||l.component.position.y<i){i=l.component.position.y}var k=l.component.position.x+l.dimensions.width;var j=l.component.position.y+l.dimensions.height;if(h===null||k>h){h=k}if(g===null||j>g){g=j}});d3.select("#canvas").append("rect").attr("rx",6).attr("ry",6).attr("x",d).attr("y",i).attr("class","drag-selection").attr("pointer-events","none").attr("width",h-d).attr("height",g-i).attr("stroke-width",function(){return 1/nf.Canvas.View.scale()}).attr("stroke-dasharray",function(){return 4/nf.Canvas.View.scale()}).datum({original:{x:d,y:i},x:d,y:i})}else{e.attr("x",function(j){j.x+=d3.event.dx;return j.x}).attr("y",function(j){j.y+=d3.event.dy;return j.y})}}).on("dragend",function(){d3.event.sourceEvent.stopPropagation();var d=d3.select("rect.drag-selection");if(d.empty()){return}if(d3.select("g.drop").empty()){b(d)}else{c()}d.remove()})},activate:function(d){d.classed("moveable",true).call(a)}}}());
nf.Selectable=(function(){return{init:function(){},select:function(a){nf.ContextMenu.hide();if(!a.classed("selected")){if(!d3.event.shiftKey){d3.selectAll("g.selected").classed("selected",false)}a.classed("selected",true)}else{if(d3.event.shiftKey){a.classed("selected",false)}}nf.CanvasToolbar.refresh();d3.event.stopPropagation()},activate:function(a){a.on("mousedown.selection",function(){nf.Selectable.select(d3.select(this))})}}}());
nf.Connectable=(function(){var c;var d;var b;var a=function(){return !d3.event.shiftKey&&d3.select("rect.drag-selection").empty()&&d3.select("rect.selection").empty()};return{init:function(){d=d3.select("#canvas");c=d3.behavior.drag().origin(function(e){b=d3.mouse(d.node());return{x:b[0],y:b[1]}}).on("dragstart",function(h){d3.event.sourceEvent.stopPropagation();nf.CanvasUtils.getSelection().classed("selected",false);var g=d3.select(this.parentNode).classed("selected",true);d3.select(this).classed("dragging",true);var f=g.datum();var e=d3.mouse(d.node());d.insert("path",":first-child").datum({sourceId:f.component.id,sourceWidth:f.dimensions.width,x:e[0],y:e[1]}).attr({"class":"connector",d:function(i){return"M"+i.x+" "+i.y+"L"+i.x+" "+i.y}});d3.select(this).attr("transform",function(){return"translate("+e[0]+", "+(e[1]+20)+")"});d.node().appendChild(this)}).on("drag",function(f){d3.select(this).attr("transform",function(){return"translate("+d3.event.x+", "+(d3.event.y+20)+")"});var e=d3.select("g.hover").classed("connectable-destination",function(){return(Math.abs(b[0]-d3.event.x)>10||Math.abs(b[1]-d3.event.y)>10)&&nf.CanvasUtils.isValidConnectionDestination(d3.select(this))});d3.select("path.connector").classed("connectable",function(){if(e.empty()){return false}return e.classed("connectable-destination")}).attr("d",function(n){if(!e.empty()&&e.classed("connectable-destination")){var i=e.datum();if(n.sourceId===i.component.id){var g=n.x;var m=n.y;var k=n.sourceWidth/2;var j=nf.Connection.config.selfLoopXOffset;var l=nf.Connection.config.selfLoopYOffset;return"M"+g+" "+m+"L"+(g+k+j)+" "+(m-l)+"L"+(g+k+j)+" "+(m+l)+"Z"}else{var h=nf.CanvasUtils.getPerimeterPoint(n,{x:i.component.position.x,y:i.component.position.y,width:i.dimensions.width,height:i.dimensions.height});return"M"+n.x+" "+n.y+"L"+h.x+" "+h.y}}else{return"M"+n.x+" "+n.y+"L"+d3.event.x+" "+d3.event.y}})}).on("dragend",function(k){d3.event.sourceEvent.stopPropagation();var m=d3.select(this);var h=d3.select("path.connector");var f=h.datum();var l=d3.select("g.connectable-destination");if(l.empty()){var e=d3.select("#id-"+f.sourceId);var i=e.datum();var j=d3.mouse(e.node());if(j[0]<0||j[0]>i.dimensions.width||j[1]<0||j[1]>i.dimensions.height){m.remove()}else{m.classed("dragging",false).attr("transform",function(){return"translate("+k.origX+", "+k.origY+")"});e.node().appendChild(this)}h.remove()}else{m.remove();var g=l.datum();nf.ConnectionConfiguration.createConnection(f.sourceId,g.component.id)}})},activate:function(e){e.on("mouseenter.connectable",function(i){if(a()){var g=d3.select(this);if(nf.CanvasUtils.isValidConnectionSource(g)){var h=d3.select("image.add-connect");if(h.empty()){var f=(i.dimensions.width/2)-14;var j=(i.dimensions.height/2)-14;g.append("image").datum({origX:f,origY:j}).call(c).call(nf.CanvasUtils.disableImageHref).attr({"class":"add-connect","xlink:href":"images/addConnect.png",width:28,height:28,transform:"translate("+f+", "+j+")"})}}}}).on("mouseleave.connectable",function(){var f=d3.select(this).select("image.add-connect");if(!f.empty()&&!f.classed("dragging")){f.remove()}}).on("mouseover.connectable",function(){d3.select(this).classed("hover",function(){return a()})}).on("mouseout.connection",function(){d3.select(this).classed("hover connectable-destination",false)})}}}());
nf.Birdseye=(function(){var d;var b;var a=function(x){var v=nf.Canvas.View.translate();var M=nf.Canvas.View.scale();v=[v[0]/M,v[1]/M];var p=d3.select("#canvas").node().getBoundingClientRect();var e=(p.left/M)-v[0];var r=((p.top-nf.Canvas.CANVAS_OFFSET)/M)-v[1];var w=(p.right/M)-v[0];var k=(p.bottom/M)-v[1];var z=$("#canvas-container");var A=z.width()/M;var K=z.height()/M;var q=-v[0];var E=-v[1];var L=q+A;var n=E+K;var C=Math.min(e,q);var F=Math.min(r,E);var h=Math.max(w,L);var I=Math.max(k,n);var J=h-C;var f=I-F;var u=$("#birdseye");var t=u.width();var m=u.height();var D=t/J;var l=m/f;var B=Math.min(D,l);var j=[0,0];var g=[0,0];if(v[0]<0&&v[1]<0){j=[0,0];g=[-v[0],-v[1]]}else{if(v[0]>=0&&v[1]<0){j=[v[0],0];g=[0,-v[1]]}else{if(v[0]<0&&v[1]>=0){j=[0,v[1]];g=[-v[0],0]}else{j=[v[0],v[1]];g=[0,0]}}}var H=0;var o=-e;if(v[0]<0){if(v[0]<o){H=o}else{H=o-(o-v[0])}}else{if(v[0]<o){H=o-v[0]}}var G=0;var y=-r;if(v[1]<0){if(v[1]<y){G=y}else{G=y-(y-v[1])}}else{if(v[1]<y){G=y-v[1]}}j=[j[0]+H,j[1]+G];g=[g[0]+H,g[1]+G];d.attr("transform","scale("+B+")");b.attr("transform","translate("+j+")");d3.select("rect.birdseye-brush").attr({width:A,height:K,"stroke-width":(2/B),transform:function(N){N.x=g[0];N.y=g[1];return"translate("+g+")"}});var s=d3.select("#birdseye-canvas").node();var i=s.getContext("2d");i.save();i.setTransform(1,0,0,1,0,0);i.clearRect(0,0,s.width,s.height);i.restore();i.save();i.translate(j[0]*B,j[1]*B);i.scale(B,B);$.each(x.labels,function(O,P){var N=nf.Label.defaultColor();if(nf.Common.isDefinedAndNotNull(P.component.style["background-color"])){N=P.component.style["background-color"]}i.fillStyle=N;i.fillRect(P.component.position.x,P.component.position.y,P.dimensions.width,P.dimensions.height)});i.fillStyle="#9f6000";$.each(x.funnels,function(N,O){i.fillRect(O.component.position.x,O.component.position.y,O.dimensions.width,O.dimensions.height)});i.fillStyle="#aaa";$.each(x.ports,function(N,O){i.fillRect(O.component.position.x,O.component.position.y,O.dimensions.width,O.dimensions.height)});i.fillStyle="#294c58";$.each(x.remoteProcessGroups,function(N,O){i.fillRect(O.component.position.x,O.component.position.y,O.dimensions.width,O.dimensions.height)});i.fillStyle="#294c58";$.each(x.processGroups,function(N,O){i.fillRect(O.component.position.x,O.component.position.y,O.dimensions.width,O.dimensions.height)});$.each(x.processors,function(O,P){var N=nf.Processor.defaultColor();if(nf.Common.isDefinedAndNotNull(P.component.style["background-color"])){N=P.component.style["background-color"]}i.fillStyle=N;i.fillRect(P.component.position.x,P.component.position.y,P.dimensions.width,P.dimensions.height)});i.restore()};var c=true;return{init:function(){var h=$("#birdseye");var g=$("#birdseye-container");$("#birdseye-collapse").click(function(){if(h.is(":visible")){$(this).removeClass("birdseye-expanded-hover").addClass("birdseye-collapsed-hover");h.hide();g.hide();c=false;$("#controller-counts").css("margin-right","-13px")}else{$(this).removeClass("birdseye-collapsed-hover").addClass("birdseye-expanded-hover");$("#controller-counts").css("margin-right","195px");h.show();g.show();c=true;a(nf.Graph.get())}}).mouseover(function(){if(h.is(":visible")){$(this).removeClass("birdseye-expanded").addClass("birdseye-expanded-hover")}else{$(this).removeClass("birdseye-collapsed").addClass("birdseye-collapsed-hover")}}).mouseout(function(){if(h.is(":visible")){$(this).removeClass("birdseye-expanded-hover").addClass("birdseye-expanded")}else{$(this).removeClass("birdseye-collapsed-hover").addClass("birdseye-collapsed")}});d3.select("#birdseye").append("canvas").attr("id","birdseye-canvas").attr("width",h.width()).attr("height",h.height());var f=d3.select("#birdseye").append("svg").attr("width",h.width()).attr("height",h.height());d=f.append("g").attr("class","birdseye");b=d.append("g").attr("pointer-events","none");var e=d3.behavior.drag().origin(function(i){return{x:i.x,y:i.y}}).on("dragstart",function(){nf.ContextMenu.hide()}).on("drag",function(k){k.x+=d3.event.dx;k.y+=d3.event.dy;d3.select(this).attr("transform",function(){return"translate("+k.x+", "+k.y+")"});var j=nf.Canvas.View.scale();var i=nf.Canvas.View.translate();i=[(-d3.event.dx*j)+i[0],(-d3.event.dy*j)+i[1]];nf.Canvas.View.translate(i);nf.Canvas.View.refresh({persist:false,transition:false,refreshComponents:false,refreshBirdseye:false})}).on("dragend",function(){nf.Canvas.View.updateVisibility();nf.CanvasUtils.persistUserView();nf.Birdseye.refresh()});d.append("g").attr({"pointer-events":"all","class":"birdseye-brush-container"}).append("rect").attr("class","birdseye-brush moveable").datum({x:0,y:0}).call(e)},refresh:function(){if(c){a(nf.Graph.get())}}}}());
nf.ToolbarAction=function(d,f,h,c,b,e,g,a){this.container=d;this.action=f;this.id=h;this.cls=c;this.hoverCls=b;this.disableCls=e;this.title=g;this.secondary=a;this.initAction()};nf.ToolbarAction.prototype.container=null;nf.ToolbarAction.prototype.action=null;nf.ToolbarAction.prototype.id=null;nf.ToolbarAction.prototype.cls=null;nf.ToolbarAction.prototype.hoverCls=null;nf.ToolbarAction.prototype.disableCls=null;nf.ToolbarAction.prototype.title=null;nf.ToolbarAction.prototype.secondary=null;nf.ToolbarAction.prototype.initAction=function(){var b=this;var a="toolbar-icon";if(this.secondary===true){a+=" secondary"}$("<div/>").addClass(a).attr("id",this.id).attr("title",this.title).mouseover(function(){if(!$(this).hasClass(b.disableCls)){$(this).removeClass(b.cls).addClass(b.hoverCls)}}).mouseout(function(){if(!$(this).hasClass(b.disableCls)){$(this).addClass(b.cls).removeClass(b.hoverCls)}}).click(function(){if(!$(this).hasClass(b.disableCls)){nf.ContextMenu.hide();nf.Actions[b.action](nf.CanvasUtils.getSelection())}}).appendTo(this.container)};nf.ToolbarAction.prototype.enable=function(){$("#"+this.id).removeClass(this.disableCls).addClass(this.cls).addClass("pointer")};nf.ToolbarAction.prototype.disable=function(){$("#"+this.id).removeClass(this.cls).addClass(this.disableCls).removeClass("pointer")};
nf.CanvasToolbar=(function(){var a;return{init:function(){a={};var d=$("<div/>").addClass("control-separator");var b=$("<div/>").addClass("control-border");var c=$("#global-controls")[0];b.clone().appendTo(c);a.enable=new nf.ToolbarAction(c,"enable","action-enable","enable-all","enable-all-hover","enable-all-disable","Enable");b.clone().appendTo(c);a.disable=new nf.ToolbarAction(c,"disable","action-disable","disable-all","disable-all-hover","disable-all-disable","Disable");b.clone().appendTo(c);d.clone().appendTo(c);b.clone().appendTo(c);a.start=new nf.ToolbarAction(c,"start","action-start","start-all","start-all-hover","start-all-disable","Start");b.clone().appendTo(c);a.stop=new nf.ToolbarAction(c,"stop","action-stop","stop-all","stop-all-hover","stop-all-disable","Stop");b.clone().appendTo(c);d.clone().appendTo(c);b.clone().appendTo(c);a.template=new nf.ToolbarAction(c,"template","action-template","template","template-hover","template-disable","Create Template");b.clone().appendTo(c);d.clone().appendTo(c);b.clone().addClass("secondary").appendTo(c);a.copy=new nf.ToolbarAction(c,"copy","action-copy","copy","copy-hover","copy-disable","Copy",true);b.clone().addClass("secondary").appendTo(c);a.paste=new nf.ToolbarAction(c,"paste","action-paste","paste","paste-hover","paste-disable","Paste",true);b.clone().addClass("secondary").appendTo(c);d.clone().addClass("secondary").appendTo(c);b.clone().addClass("secondary").appendTo(c);a.group=new nf.ToolbarAction(c,"group","action-group","group","group-hover","group-disable","Group",true);b.clone().addClass("secondary").appendTo(c);d.clone().addClass("secondary").appendTo(c);b.clone().addClass("secondary").appendTo(c);a.fill=new nf.ToolbarAction(c,"fillColor","action-fill","fill","fill-hover","fill-disable","Change Color",true);b.clone().addClass("secondary").appendTo(c);d.clone().addClass("secondary").appendTo(c);b.clone().addClass("secondary").appendTo(c);a["delete"]=new nf.ToolbarAction(c,"delete","action-delete","delete","delete-hover","delete-disable","Delete",true);b.addClass("secondary").appendTo(c);d.addClass("secondary").appendTo(c);if(nf.Common.isDFM()){a.start.enable();a.stop.enable();a.template.enable()}else{a.start.disable();a.stop.disable();a.template.disable()}a.enable.disable();a.disable.disable();a.copy.disable();a.paste.disable();a.fill.disable();a["delete"].disable();a.group.disable();if(nf.Common.isDFM()){nf.Clipboard.addListener(this,function(f,e){if(nf.Clipboard.isCopied()){a.paste.enable()}else{a.paste.disable()}})}},refresh:function(){if(nf.Common.isUndefined(a)){return}if(nf.Common.isDFM()){var c=nf.CanvasUtils.getSelection();if(!c.empty()){var b=true;c.each(function(e){if(!nf.CanvasUtils.isDeletable(d3.select(this))){b=false;return false}});if(b){a["delete"].enable()}else{a["delete"].disable()}}else{a["delete"].disable()}if(nf.CanvasUtils.isCopyable(c)){a.copy.enable()}else{a.copy.disable()}if(!c.empty()&&nf.CanvasUtils.isDisconnected(c)){a.group.enable()}else{a.group.disable()}if(nf.CanvasUtils.isColorable(c)){a.fill.enable()}else{a.fill.disable()}if(nf.CanvasUtils.canEnable(c)){a.enable.enable()}else{a.enable.disable()}if(nf.CanvasUtils.canDisable(c)){a.disable.enable()}else{a.disable.disable()}}}}}());
nf.GraphControl=(function(){var a={translateIncrement:20};return{init:function(){nf.Common.addHoverEffect("#pan-up-button","pan-up","pan-up-hover").on("click",function(){var b=nf.Canvas.View.translate();nf.Canvas.View.translate([b[0],b[1]+a.translateIncrement]);nf.ContextMenu.hide();nf.Canvas.View.refresh({transition:true})});nf.Common.addHoverEffect("#pan-down-button","pan-down","pan-down-hover").on("click",function(){var b=nf.Canvas.View.translate();nf.Canvas.View.translate([b[0],b[1]-a.translateIncrement]);nf.ContextMenu.hide();nf.Canvas.View.refresh({transition:true})});nf.Common.addHoverEffect("#pan-left-button","pan-left","pan-left-hover").on("click",function(){var b=nf.Canvas.View.translate();nf.Canvas.View.translate([b[0]+a.translateIncrement,b[1]]);nf.ContextMenu.hide();nf.Canvas.View.refresh({transition:true})});nf.Common.addHoverEffect("#pan-right-button","pan-right","pan-right-hover").on("click",function(){var b=nf.Canvas.View.translate();nf.Canvas.View.translate([b[0]-a.translateIncrement,b[1]]);nf.ContextMenu.hide();nf.Canvas.View.refresh({transition:true})});nf.Common.addHoverEffect("#zoom-in-button","zoom-in","zoom-in-hover").on("click",function(){nf.Canvas.View.zoomIn();nf.ContextMenu.hide();nf.Canvas.View.refresh({transition:true})});nf.Common.addHoverEffect("#zoom-out-button","zoom-out","zoom-out-hover").on("click",function(){nf.Canvas.View.zoomOut();nf.ContextMenu.hide();nf.Canvas.View.refresh({transition:true})});nf.Common.addHoverEffect("#zoom-fit-button","fit-image","fit-image-hover").on("click",function(){nf.Canvas.View.fit();nf.ContextMenu.hide();nf.Canvas.View.refresh({transition:true})});nf.Common.addHoverEffect("#zoom-actual-button","actual-size","actual-size-hover").on("click",function(){nf.Canvas.View.actualSize();nf.ContextMenu.hide();nf.Canvas.View.refresh({transition:true})})}}}());
nf.CanvasHeader=(function(){var b=640;var a={urls:{helpDocument:"../nifi-docs/documentation",controllerAbout:"../nifi-api/controller/about"}};return{init:function(f){nf.Common.addHoverEffect("#reporting-link","reporting-link","reporting-link-hover").click(function(){nf.Shell.showPage("summary")});nf.Common.addHoverEffect("#counters-link","counters-link","counters-link-hover").click(function(){nf.Shell.showPage("counters")});nf.Common.addHoverEffect("#history-link","history-link","history-link-hover").click(function(){nf.Shell.showPage("history")});if(nf.Common.canAccessProvenance()){nf.Common.addHoverEffect("#provenance-link","provenance-link","provenance-link-hover").click(function(){nf.Shell.showPage("provenance")})}else{$("#provenance-link").addClass("provenance-link-disabled")}nf.Common.addHoverEffect("#templates-link","templates-link","templates-link-hover").click(function(){nf.Shell.showPage("templates")});nf.Common.addHoverEffect("#flow-settings-link","flow-settings-link","flow-settings-link-hover").click(function(){nf.Settings.loadSettings().done(function(){nf.Settings.showSettings()})});if(nf.Common.isAdmin()){nf.Common.addHoverEffect("#users-link","users-link","users-link-hover").click(function(){nf.Shell.showPage("users")})}else{$("#users-link").addClass("users-link-disabled")}if(nf.Canvas.isClustered()){nf.Common.addHoverEffect("#cluster-link","cluster-link","cluster-link-hover").click(function(){nf.Shell.showPage("cluster")});$("#connected-nodes-element").show();$("#cluster-indicator").show();$("#data-flow-title-viewport").css("left","113px")}else{$("#cluster-link").hide()}nf.Common.addHoverEffect("#bulletin-board-link","bulletin-board-link","bulletin-board-hover").click(function(){nf.Shell.showPage("bulletin-board")});$("#refresh-required-link").click(function(){nf.CanvasHeader.reloadAndClearWarnings()});$.ajax({type:"GET",url:a.urls.controllerAbout,dataType:"json"}).done(function(h){var g=h.about;document.title=g.title;$("#nf-version").text(g.version)}).fail(nf.Common.handleAjaxError);$("#nf-about").modal({overlayBackground:true,buttons:[{buttonText:"Ok",handler:{click:function(){$("#nf-about").modal("hide")}}}]});$("#about-link").click(function(){$("#nf-about").modal("show")});$("#help-link").click(function(){nf.Shell.showPage(a.urls.helpDocument)});$("#login-link").click(function(){nf.Shell.showPage("login",false)});$("#logout-link").click(function(){nf.Storage.removeItem("jwt");window.location="/nifi"});if($("#current-user").text()!==nf.Common.ANONYMOUS_USER_TEXT||location.protocol==="http:"){$("#login-link-container").css("display","none")}if(location.protocol==="http:"){$("#current-user-container").css("display","none")}$("#new-template-dialog").modal({headerText:"Create Template",overlayBackground:false});$("#fill-color-dialog").modal({headerText:"Fill",overlayBackground:false,buttons:[{buttonText:"Apply",handler:{click:function(){var g=nf.CanvasUtils.getSelection();g.each(function(l){var j=d3.select(this);var i=nf.Client.getRevision();var k=j.datum();var h=$("#fill-color").minicolors("value");if(h!==k.component.style["background-color"]){$.ajax({type:"PUT",url:k.component.uri,data:{version:i.version,clientId:i.clientId,"style[background-color]":h},dataType:"json"}).done(function(m){nf.Client.setRevision(m.revision);if(nf.CanvasUtils.isProcessor(j)){nf.Processor.set(m.processor)}else{nf.Label.set(m.label)}}).fail(function(o,m,n){if(o.status===400||o.status===404||o.status===409){nf.Dialog.showOkDialog({dialogContent:nf.Common.escapeHtml(o.responseText),overlayBackground:true})}})}});$("#fill-color-dialog").modal("hide")}}},{buttonText:"Cancel",handler:{click:function(){$("#fill-color-dialog").modal("hide")}}}],handler:{close:function(){$("#fill-color-value").val("");$("#fill-color").minicolors("value","")}}}).draggable({containment:"parent",handle:".dialog-header"});$("#fill-color").minicolors({inline:true,change:function(h,g){$("#fill-color-value").val(h);$("#fill-color-processor-preview, #fill-color-label-preview").css({"border-color":h,background:"linear-gradient(to bottom, #ffffff, "+h+")",filter:"progid:DXImageTransform.Microsoft.gradient(gradientType=0, startColorstr=#ffffff, endColorstr="+h+")"})}});var d=function(){var g=$("#fill-color-value").val();if(/(^#[0-9A-F]{6}$)|(^#[0-9A-F]{3}$)/i.test(g)){$("#fill-color").minicolors("value",g)}};$("#fill-color-value").on("blur",d).on("keyup",function(h){var g=h.keyCode?h.keyCode:h.which;if(g===$.ui.keyCode.ENTER){d()}});$("#data-flow-title-viewport").on("DOMMouseScroll mousewheel",function(s,l){if(nf.Common.isUndefinedOrNull(s.originalEvent)){return}var m=$("#data-flow-title-container");var g=m.position();var q=m.outerWidth();var j=g.left+q;var n=$("#breadcrumbs-right-border").width();var k=$("#data-flow-title-viewport");var i=k.width();var h=i-n;if(q>i){var p=false;var r=0;if(nf.Common.isDefinedAndNotNull(s.originalEvent.detail)){r=-s.originalEvent.detail}else{if(nf.Common.isDefinedAndNotNull(s.originalEvent.wheelDelta)){r=s.originalEvent.wheelDelta}}if(r>0&&j>h){var o=-25;p=true}else{if(r<0&&(g.left-n)<0){o=25;if(g.left+o>n){o=n-g.left}p=true}}if(p){m.css("left",(g.left+o)+"px")}}});var c=$("#toolbar");var e=$("#action-group");$(window).on("resize",function(){if(c.width()<b&&e.is(":visible")){c.find(".secondary").hide()}else{if(c.width()>b&&e.is(":hidden")){c.find(".secondary").show()}}});if(c.width()<b){c.find(".secondary").hide()}},reloadAndClearWarnings:function(){nf.Canvas.reload().done(function(){nf.Canvas.View.updateVisibility();nf.Birdseye.refresh();$("#stats-last-refreshed").removeClass("alert");$("#refresh-required-container").hide();$("#settings-last-refreshed").removeClass("alert");$("#settings-refresh-required-icon").hide()}).fail(function(){nf.Dialog.showOkDialog({dialogContent:"Unable to refresh the current group.",overlayBackground:true})})}}}());
nf.Search=(function(){var a={search:"Search",urls:{search:"../nifi-api/controller/search-results"}};return{init:function(){$.widget("nf.searchAutocomplete",$.ui.autocomplete,{reset:function(){this.term=null},_resizeMenu:function(){var b=this.menu.element;b.width(399)},_normalize:function(c){var b=[];b.push(c);return b},_renderMenu:function(d,c){var b=this;var e=c[0];if(!nf.Common.isEmpty(e.processorResults)){d.append('<li class="search-header"><div class="search-result-icon processor-small-icon"></div>Processors</li>');$.each(e.processorResults,function(g,f){b._renderItem(d,f)})}if(!nf.Common.isEmpty(e.processGroupResults)){d.append('<li class="search-header"><div class="search-result-icon process-group-small-icon"></div>Process Groups</li>');$.each(e.processGroupResults,function(g,f){b._renderItem(d,f)})}if(!nf.Common.isEmpty(e.remoteProcessGroupResults)){d.append('<li class="search-header"><div class="search-result-icon remote-process-group-small-icon"></div>Remote Process Groups</li>');$.each(e.remoteProcessGroupResults,function(f,g){b._renderItem(d,g)})}if(!nf.Common.isEmpty(e.connectionResults)){d.append('<li class="search-header"><div class="search-result-icon connection-small-icon"></div>Connections</li>');$.each(e.connectionResults,function(g,f){b._renderItem(d,f)})}if(!nf.Common.isEmpty(e.inputPortResults)){d.append('<li class="search-header"><div class="search-result-icon input-port-small-icon"></div>Input Ports</li>');$.each(e.inputPortResults,function(f,g){b._renderItem(d,g)})}if(!nf.Common.isEmpty(e.outputPortResults)){d.append('<li class="search-header"><div class="search-result-icon output-port-small-icon"></div>Output Ports</li>');$.each(e.outputPortResults,function(f,g){b._renderItem(d,g)})}if(!nf.Common.isEmpty(e.funnelResults)){d.append('<li class="search-header"><div class="search-result-icon funnel-small-icon"></div>Funnels</li>');$.each(e.funnelResults,function(g,f){b._renderItem(d,f)})}if(d.children().length===0){d.append('<li class="unset search-no-matches">No results matched the search terms</li>')}},_renderItem:function(c,b){var d=$("<a></a>").append($('<div class="search-match-header"></div>').text(b.name));$.each(b.matches,function(f,e){d.append($('<div class="search-match"></div>').text(e))});return $("<li></li>").data("ui-autocomplete-item",b).append(d).appendTo(c)}});$("#search-field").zIndex(1250).searchAutocomplete({appendTo:"#search-flow-results",position:{my:"right top",at:"right bottom",offset:"1 1"},source:function(c,b){$.ajax({type:"GET",data:{q:c.term},dataType:"json",url:a.urls.search}).done(function(d){b(d.searchResultsDTO)})},select:function(c,d){var b=d.item;nf.CanvasUtils.showComponent(b.groupId,b.id);$(this).blur();return false},open:function(b,c){var d=$(this);$('<div class="search-glass-pane"></div>').one("click",function(){d.blur()}).appendTo("body")},close:function(b,c){$(this).searchAutocomplete("reset");$("div.search-glass-pane").remove()}}).focus(function(){nf.ContextMenu.hide();$(this).val("").removeClass("search-flow")}).blur(function(){$(this).val(a.search).addClass("search-flow")}).val(a.search).addClass("search-flow")}}}());
nf.Settings=(function(){var B={node:"node",ncm:"ncm",filterText:"Filter",styles:{filterList:"filter-list"},urls:{controllerConfig:"../nifi-api/controller/config",controllerArchive:"../nifi-api/controller/archive",controllerServiceTypes:"../nifi-api/controller/controller-service-types",controllerServices:"../nifi-api/controller/controller-services",reportingTaskTypes:"../nifi-api/controller/reporting-task-types",reportingTasks:"../nifi-api/controller/reporting-tasks"}};var p={forceFitColumns:true,enableTextSelectionOnCells:true,enableCellNavigation:true,enableColumnReorder:false,autoEdit:false,multiSelect:false};var o=function(){if(nf.Common.isDFM()){$("#general-settings div.editable").show();$("#general-settings div.read-only").hide();$("#archive-flow-link").click(function(){var D=nf.Client.getRevision();$.ajax({type:"POST",url:B.urls.controllerArchive,data:{version:D.version,clientId:D.clientId},dataType:"json"}).done(function(E){nf.Client.setRevision(E.revision);nf.Dialog.showOkDialog({dialogContent:"A new flow archive was successfully created.",overlayBackground:false})}).fail(nf.Common.handleAjaxError)});$("#settings-save").click(function(){var D=nf.Client.getRevision();var E=A();E.version=D.version;E.clientId=D.clientId;$.ajax({type:"PUT",url:B.urls.controllerConfig,data:E,dataType:"json"}).done(function(F){nf.Client.setRevision(F.revision);document.title=F.config.name;$("#data-flow-title-container").children("span.link:first-child").text(F.config.name);nf.Dialog.showOkDialog({dialogContent:"Settings successfully applied.",overlayBackground:false})}).fail(nf.Common.handleAjaxError)})}else{$("#general-settings div.editable").hide();$("#general-settings div.read-only").show()}};var A=function(){var D={};D.name=$("#data-flow-title-field").val();D.comments=$("#data-flow-comments-field").val();D.maxTimerDrivenThreadCount=$("#maximum-timer-driven-thread-count-field").val();D.maxEventDrivenThreadCount=$("#maximum-event-driven-thread-count-field").val();return D};var s=function(){var E="";var D=$("#controller-service-type-filter");if(!D.hasClass(B.styles.filterList)){E=D.val()}return E};var a=function(){var D=$("#controller-service-types-table").data("gridInstance");if(nf.Common.isDefinedAndNotNull(D)){var E=D.getData();E.setFilterArgs({searchString:s()});E.refresh();if(E.getLength()>0){D.setSelectedRows([0])}}};var m=function(){$("#controller-service-type-description").text("");$("#controller-service-type-name").text("");$("#selected-controller-service-name").text("");$("#selected-controller-service-type").text("");$("#controller-service-description-container").hide()};var l=function(){m();var D=$("#controller-service-types-table").data("gridInstance");D.resetActiveCell()};var d=function(I,F){var E=C(I,F);var D=true;if(E){var G=$("#controller-service-tag-cloud").tagcloud("getSelectedTags");var H=G.length>0;if(H){D=i(G,I.tags)}}var J=E&&D;if(J===false&&$("#selected-controller-service-type").text()===I.type){l()}return J};var C=function(F,E){if(E.searchString===""){return true}try{var I=new RegExp(E.searchString,"i")}catch(H){return false}var G=F.label.search(I)>=0;var D=F.tags.search(I)>=0;return G||D};var i=function(F,D){var E=[];$.each(F,function(I,J){E.push(J)});var G=D.toLowerCase();var H=true;$.each(E,function(I,J){if(G.indexOf(J)===-1){H=false;return false}});return H};var r=function(){var D=$("#selected-controller-service-type").text();if(D===""){nf.Dialog.showOkDialog({dialogContent:"The type of controller service to create must be selected.",overlayBackground:false})}else{c(D)}};var c=function(F){var D=nf.Client.getRevision();var G;if(nf.Canvas.isClustered()){G=$("#controller-service-availability-combo").combo("getSelectedOption").value}else{G=B.node}var E=$.ajax({type:"POST",url:B.urls.controllerServices+"/"+encodeURIComponent(G),data:{version:D.version,clientId:D.clientId,type:F},dataType:"json"}).done(function(I){nf.Client.setRevision(I.revision);var H=I.controllerService;var J=$("#controller-services-table").data("gridInstance");var L=J.getData();L.addItem(H);L.reSort();J.invalidate();var K=L.getRowById(H.id);J.setSelectedRows([K]);J.scrollRowIntoView(K)}).fail(nf.Common.handleAjaxError);$("#new-controller-service-dialog").modal("hide");return E};var n=function(){if(nf.Canvas.isClustered()){$("#controller-service-availability-combo").combo({options:[{text:"Node",value:B.node,description:"This controller service will be available on the nodes only."},{text:"Cluster Manager",value:B.ncm,description:"This controller service will be available on the cluster manager only."}]});$("#controller-service-availability-container").show()}$("#controller-service-type-filter").on("keyup",function(H){var G=H.keyCode?H.keyCode:H.which;if(G===$.ui.keyCode.ENTER){r()}else{a()}}).focus(function(){if($(this).hasClass(B.styles.filterList)){$(this).removeClass(B.styles.filterList).val("")}}).blur(function(){if($(this).val()===""){$(this).addClass(B.styles.filterList).val(B.filterText)}}).addClass(B.styles.filterList).val(B.filterText);var F=[{id:"type",name:"Type",field:"label",sortable:false,resizable:true},{id:"tags",name:"Tags",field:"tags",sortable:false,resizable:true}];var E=new Slick.Data.DataView({inlineFilters:false});E.setItems([]);E.setFilterArgs({searchString:s()});E.setFilter(d);var D=new Slick.Grid("#controller-service-types-table",E,F,p);D.setSelectionModel(new Slick.RowSelectionModel());D.registerPlugin(new Slick.AutoTooltips());D.setSortColumn("type",true);D.onSelectedRowsChanged.subscribe(function(J,H){if($.isArray(H.rows)&&H.rows.length===1){var G=H.rows[0];var I=D.getDataItem(G);if(nf.Common.isDefinedAndNotNull(I)){if(nf.Common.isBlank(I.description)){$("#controller-service-type-description").attr("title","").html('<span class="unset">No description specified</span>')}else{$("#controller-service-type-description").html(I.description).ellipsis()}$("#controller-service-type-name").text(I.label).ellipsis();$("#selected-controller-service-name").text(I.label);$("#selected-controller-service-type").text(I.type);$("#controller-service-description-container").show()}}});D.onDblClick.subscribe(function(I,G){var H=D.getDataItem(G.row);c(H.type)});E.onRowCountChanged.subscribe(function(H,G){D.updateRowCount();D.render();$("#displayed-controller-service-types").text(G.current)});E.onRowsChanged.subscribe(function(H,G){D.invalidateRows(G.rows);D.render()});E.syncGridSelection(D,true);$("#controller-service-types-table").data("gridInstance",D);$.ajax({type:"GET",url:B.urls.controllerServiceTypes,dataType:"json"}).done(function(G){var I=0;var H=[];E.beginUpdate();$.each(G.controllerServiceTypes,function(J,K){E.addItem({id:I++,label:nf.Common.substringAfterLast(K.type,"."),type:K.type,description:nf.Common.escapeHtml(K.description),tags:K.tags.join(", ")});$.each(K.tags,function(M,L){H.push(L.toLowerCase())})});E.endUpdate();$("#total-controller-service-types, #displayed-controller-service-types").text(G.controllerServiceTypes.length);$("#controller-service-tag-cloud").tagcloud({tags:H,select:a,remove:a})}).fail(nf.Common.handleAjaxError);$("#new-controller-service-dialog").modal({headerText:"Add Controller Service",overlayBackground:false,buttons:[{buttonText:"Add",handler:{click:function(){r()}}},{buttonText:"Cancel",handler:{click:function(){$(this).modal("hide")}}}],handler:{close:function(){if(nf.Canvas.isClustered()){$("#controller-service-availability-combo").combo("setSelectedOption",{value:B.node})}m();$("#controller-service-type-filter").addClass(B.styles.filterList).val(B.filterText);$("#controller-service-tag-cloud").tagcloud("clearSelectedTags");a();var G=$("#controller-service-types-table").data("gridInstance");G.setSelectedRows([]);G.resetActiveCell()}}}).draggable({containment:"parent",handle:".dialog-header"})};var z=function(H,E,G,F,D){return nf.Common.substringAfterLast(G,".")};var x=function(H,E,G,F,D){if(G===B.node){return"Node"}else{return"Cluster Manager"}};var y=function(D,F){var E=function(N,M){if(D.columnId==="moreDetails"){var J=0;if(!nf.Common.isEmpty(N.bulletins)){J=N.bulletins.length}var G=0;if(!nf.Common.isEmpty(M.bulletins)){G=M.bulletins.length}return J-G}else{if(D.columnId==="type"){var K=nf.Common.isDefinedAndNotNull(N[D.columnId])?nf.Common.substringAfterLast(N[D.columnId],"."):"";var I=nf.Common.isDefinedAndNotNull(M[D.columnId])?nf.Common.substringAfterLast(M[D.columnId],"."):"";return K===I?0:K>I?1:-1}else{if(D.columnId==="state"){var L="Invalid";if(nf.Common.isEmpty(N.validationErrors)){L=nf.Common.isDefinedAndNotNull(N[D.columnId])?N[D.columnId]:""}var P="Invalid";if(nf.Common.isEmpty(M.validationErrors)){P=nf.Common.isDefinedAndNotNull(M[D.columnId])?M[D.columnId]:""}return L===P?0:L>P?1:-1}else{var H=nf.Common.isDefinedAndNotNull(N[D.columnId])?N[D.columnId]:"";var O=nf.Common.isDefinedAndNotNull(M[D.columnId])?M[D.columnId]:"";return H===O?0:H>O?1:-1}}}};F.sort(E,D.sortAsc)};var v=function(){n();var H=function(Q,K,P,M,J){var L='<img src="images/iconDetails.png" title="View Details" class="pointer view-controller-service" style="margin-top: 5px; float: left;" />';L+='<img src="images/iconUsage.png" title="Usage" class="pointer controller-service-usage" style="margin-left: 6px; margin-top: 3px; float: left;" />';var N=!nf.Common.isEmpty(J.validationErrors);var O=!nf.Common.isEmpty(J.bulletins);if(N){L+='<img src="images/iconAlert.png" class="has-errors" style="margin-top: 4px; margin-left: 3px; float: left;" />'}if(O){L+='<img src="images/iconBulletin.png" class="has-bulletins" style="margin-top: 5px; margin-left: 5px; float: left;"/>'}if(N||O){L+='<span class="hidden row-id">'+nf.Common.escapeHtml(J.id)+"</span>"}return L};var D=function(Q,K,P,L,J){var O="",M="";if(!nf.Common.isEmpty(J.validationErrors)){O="invalid";M="Invalid"}else{if(P==="DISABLED"){O="disabled";M="Disabled"}else{if(P==="DISABLING"){O="disabled";M="Disabling"}else{if(P==="ENABLED"){O="enabled";M="Enabled"}else{if(P==="ENABLING"){O="enabled";M="Enabling"}}}}}var N='<div class="'+O+'" style="margin-top: 3px;"></div>';return N+'<div class="status-text" style="margin-top: 2px; margin-left: 4px; float: left;">'+M+"</div>"};var G=function(O,K,N,M,J){var L="";if(nf.Common.isDFM()){if(J.state==="ENABLED"||J.state==="ENABLING"){L+='<img src="images/iconDisable.png" title="Disable" class="pointer disable-controller-service" style="margin-top: 2px;" />'}else{if(J.state==="DISABLED"){L+='<img src="images/iconEdit.png" title="Edit" class="pointer edit-controller-service" style="margin-top: 2px;" />';if(nf.Common.isEmpty(J.validationErrors)){L+='<img src="images/iconEnable.png" title="Enable" class="pointer enable-controller-service" style="margin-top: 2px; margin-left: 3px;"/>'}L+='<img src="images/iconDelete.png" title="Remove" class="pointer delete-controller-service" style="margin-top: 2px; margin-left: 3px;" />'}}if(J.persistsState===true){L+='<img src="images/iconViewState.png" title="View State" class="pointer view-state-controller-service" style="margin-top: 2px; margin-left: 3px;" />'}}return L};var F=[{id:"moreDetails",field:"moreDetails",name:"&nbsp;",resizable:false,formatter:H,sortable:true,width:90,maxWidth:90,toolTip:"Sorts based on presence of bulletins"},{id:"name",field:"name",name:"Name",sortable:true,resizable:true},{id:"type",field:"type",name:"Type",formatter:z,sortable:true,resizable:true},{id:"state",field:"state",name:"State",formatter:D,sortable:true,resizeable:true}];if(nf.Canvas.isClustered()){F.push({id:"availability",field:"availability",name:"Availability",formatter:x,sortable:true,resizeable:true})}F.push({id:"actions",name:"&nbsp;",resizable:false,formatter:G,sortable:false,width:90,maxWidth:90});var I=new Slick.Data.DataView({inlineFilters:false});I.setItems([]);y({columnId:"name",sortAsc:true},I);var E=new Slick.Grid("#controller-services-table",I,F,p);E.setSelectionModel(new Slick.RowSelectionModel());E.registerPlugin(new Slick.AutoTooltips());E.setSortColumn("name",true);E.onSort.subscribe(function(K,J){y({columnId:J.sortCol.field,sortAsc:J.sortAsc},I)});E.onClick.subscribe(function(M,K){var L=$(M.target);var J=I.getItem(K.row);if(E.getColumns()[K.cell].id==="actions"){if(L.hasClass("edit-controller-service")){nf.ControllerService.showConfiguration(J)}else{if(L.hasClass("enable-controller-service")){nf.ControllerService.enable(J)}else{if(L.hasClass("disable-controller-service")){nf.ControllerService.disable(J)}else{if(L.hasClass("delete-controller-service")){nf.ControllerService.remove(J)}else{if(L.hasClass("view-state-controller-service")){nf.ComponentState.showState(J,J.state==="DISABLED")}}}}}}else{if(E.getColumns()[K.cell].id==="moreDetails"){if(L.hasClass("view-controller-service")){nf.ControllerService.showDetails(J)}else{if(L.hasClass("controller-service-usage")){$("#shell-close-button").click();nf.Shell.showPage("../nifi-docs/documentation?"+$.param({select:nf.Common.substringAfterLast(J.type,".")})).done(function(){nf.Settings.showSettings()})}}}}});I.onRowCountChanged.subscribe(function(K,J){E.updateRowCount();E.render()});I.onRowsChanged.subscribe(function(K,J){E.invalidateRows(J.rows);E.render()});I.syncGridSelection(E,true);$("#controller-services-table").data("gridInstance",E).on("mouseenter","div.slick-cell",function(Q){var N=$(this).find("img.has-errors");if(N.length&&!N.data("qtip")){var P=$(this).find("span.row-id").text();var L=I.getItemById(P);var M=nf.Common.formatUnorderedList(L.validationErrors);if(nf.Common.isDefinedAndNotNull(M)){N.qtip($.extend({content:M,position:{target:"mouse",viewport:$(window),adjust:{x:8,y:8,method:"flipinvert flipinvert"}}},nf.Common.config.tooltipConfig))}}var K=$(this).find("img.has-bulletins");if(K.length&&!K.data("qtip")){var J=$(this).find("span.row-id").text();var L=I.getItemById(J);var O=nf.Common.getFormattedBulletins(L.bulletins);var M=nf.Common.formatUnorderedList(O);if(nf.Common.isDefinedAndNotNull(M)){K.qtip($.extend({},nf.Common.config.tooltipConfig,{content:M,position:{target:"mouse",viewport:$(window),adjust:{x:8,y:8,method:"flipinvert flipinvert"}}}))}}})};var h=function(){var E=[];var D=$.ajax({type:"GET",url:B.urls.controllerServices+"/"+encodeURIComponent(B.node),dataType:"json"}).done(function(G){var H=G.controllerServices;if(nf.Common.isDefinedAndNotNull(H)){$.each(H,function(I,J){E.push($.extend({bulletins:[]},J))})}});var F=$.Deferred(function(G){if(nf.Canvas.isClustered()){$.ajax({type:"GET",url:B.urls.controllerServices+"/"+encodeURIComponent(B.ncm),dataType:"json"}).done(function(H){var I=H.controllerServices;if(nf.Common.isDefinedAndNotNull(I)){$.each(I,function(K,J){E.push($.extend({bulletins:[]},J))})}G.resolve()}).fail(function(){G.reject()})}else{G.resolve()}}).promise();return $.when(D,F).done(function(){var G=$("#controller-services-table");nf.Common.cleanUpTooltips(G,"img.has-errors");nf.Common.cleanUpTooltips(G,"img.has-bulletins");var H=G.data("gridInstance");var I=H.getData();I.setItems(E);I.reSort();H.invalidate()})};var b=function(){var E="";var D=$("#reporting-task-type-filter");if(!D.hasClass(B.styles.filterList)){E=D.val()}return E};var j=function(){var E=$("#reporting-task-types-table").data("gridInstance");if(nf.Common.isDefinedAndNotNull(E)){var D=E.getData();D.setFilterArgs({searchString:b()});D.refresh();if(D.getLength()>0){E.setSelectedRows([0])}}};var e=function(){$("#reporting-task-type-description").text("");$("#reporting-task-type-name").text("");$("#selected-reporting-task-name").text("");$("#selected-reporting-task-type").text("");$("#reporting-task-description-container").hide()};var q=function(){e();var D=$("#reporting-task-types-table").data("gridInstance");D.resetActiveCell()};var u=function(I,F){var E=C(I,F);var D=true;if(E){var G=$("#reporting-task-tag-cloud").tagcloud("getSelectedTags");var H=G.length>0;if(H){D=i(G,I.tags)}}var J=E&&D;if(J===false&&$("#selected-reporting-task-type").text()===I.type){q()}return J};var w=function(){var D=$("#selected-reporting-task-type").text();if(D===""){nf.Dialog.showOkDialog({dialogContent:"The type of reporting task to create must be selected.",overlayBackground:false})}else{k(D)}};var k=function(D){var E=nf.Client.getRevision();var G;if(nf.Canvas.isClustered()){G=$("#reporting-task-availability-combo").combo("getSelectedOption").value}else{G=B.node}var F=$.ajax({type:"POST",url:B.urls.reportingTasks+"/"+encodeURIComponent(G),data:{version:E.version,clientId:E.clientId,type:D},dataType:"json"}).done(function(I){nf.Client.setRevision(I.revision);var K=I.reportingTask;var L=$("#reporting-tasks-table").data("gridInstance");var H=L.getData();H.addItem(K);H.reSort();L.invalidate();var J=H.getRowById(K.id);L.setSelectedRows([J]);L.scrollRowIntoView(J)}).fail(nf.Common.handleAjaxError);$("#new-reporting-task-dialog").modal("hide");return F};var g=function(){if(nf.Canvas.isClustered()){$("#reporting-task-availability-combo").combo({options:[{text:"Node",value:B.node,description:"This reporting task will be available on the nodes only."},{text:"Cluster Manager",value:B.ncm,description:"This reporting task will be available on the cluster manager only."}]});$("#reporting-task-availability-container").show()}$("#reporting-task-type-filter").on("keyup",function(H){var G=H.keyCode?H.keyCode:H.which;if(G===$.ui.keyCode.ENTER){w()}else{j()}}).focus(function(){if($(this).hasClass(B.styles.filterList)){$(this).removeClass(B.styles.filterList).val("")}}).blur(function(){if($(this).val()===""){$(this).addClass(B.styles.filterList).val(B.filterText)}}).addClass(B.styles.filterList).val(B.filterText);var E=[{id:"type",name:"Type",field:"label",sortable:false,resizable:true},{id:"tags",name:"Tags",field:"tags",sortable:false,resizable:true}];var D=new Slick.Data.DataView({inlineFilters:false});D.setItems([]);D.setFilterArgs({searchString:b()});D.setFilter(u);var F=new Slick.Grid("#reporting-task-types-table",D,E,p);F.setSelectionModel(new Slick.RowSelectionModel());F.registerPlugin(new Slick.AutoTooltips());F.setSortColumn("type",true);F.onSelectedRowsChanged.subscribe(function(J,H){if($.isArray(H.rows)&&H.rows.length===1){var I=H.rows[0];var G=F.getDataItem(I);if(nf.Common.isDefinedAndNotNull(G)){if(nf.Common.isBlank(G.description)){$("#reporting-task-type-description").attr("title","").html('<span class="unset">No description specified</span>')}else{$("#reporting-task-type-description").html(G.description).ellipsis()}$("#reporting-task-type-name").text(G.label).ellipsis();$("#selected-reporting-task-name").text(G.label);$("#selected-reporting-task-type").text(G.type);$("#reporting-task-description-container").show()}}});F.onDblClick.subscribe(function(I,H){var G=F.getDataItem(H.row);k(G.type)});D.onRowCountChanged.subscribe(function(H,G){F.updateRowCount();F.render();$("#displayed-reporting-task-types").text(G.current)});D.onRowsChanged.subscribe(function(H,G){F.invalidateRows(G.rows);F.render()});D.syncGridSelection(F,true);$("#reporting-task-types-table").data("gridInstance",F);$.ajax({type:"GET",url:B.urls.reportingTaskTypes,dataType:"json"}).done(function(G){var I=0;var H=[];D.beginUpdate();$.each(G.reportingTaskTypes,function(J,K){D.addItem({id:I++,label:nf.Common.substringAfterLast(K.type,"."),type:K.type,description:nf.Common.escapeHtml(K.description),tags:K.tags.join(", ")});$.each(K.tags,function(M,L){H.push(L.toLowerCase())})});D.endUpdate();$("#total-reporting-task-types, #displayed-reporting-task-types").text(G.reportingTaskTypes.length);$("#reporting-task-tag-cloud").tagcloud({tags:H,select:j,remove:j})}).fail(nf.Common.handleAjaxError);$("#new-reporting-task-dialog").modal({headerText:"Add Reporting Task",overlayBackground:false,buttons:[{buttonText:"Add",handler:{click:function(){w()}}},{buttonText:"Cancel",handler:{click:function(){$(this).modal("hide")}}}],handler:{close:function(){if(nf.Canvas.isClustered()){$("#reporting-task-availability-combo").combo("setSelectedOption",{value:B.node})}e();$("#reporting-task-type-filter").addClass(B.styles.filterList).val(B.filterText);$("#reporting-task-tag-cloud").tagcloud("clearSelectedTags");j();var G=$("#reporting-task-types-table").data("gridInstance");G.setSelectedRows([]);G.resetActiveCell()}}}).draggable({containment:"parent",handle:".dialog-header"})};var f=function(){g();var H=function(Q,K,P,M,J){var L='<img src="images/iconDetails.png" title="View Details" class="pointer view-reporting-task" style="margin-top: 5px; float: left;" />';L+='<img src="images/iconUsage.png" title="Usage" class="pointer reporting-task-usage" style="margin-left: 6px; margin-top: 3px;"/>';var N=!nf.Common.isEmpty(J.validationErrors);var O=!nf.Common.isEmpty(J.bulletins);if(N){L+='<img src="images/iconAlert.png" class="has-errors" style="margin-top: 4px; margin-left: 3px; float: left;" />'}if(O){L+='<img src="images/iconBulletin.png" class="has-bulletins" style="margin-top: 5px; margin-left: 5px; float: left;"/>'}if(N||O){L+='<span class="hidden row-id">'+nf.Common.escapeHtml(J.id)+"</span>"}return L};var I=function(Q,K,P,L,J){var M;if(!nf.Common.isEmpty(J.validationErrors)){M="Invalid"}else{if(P==="STOPPED"){M="Stopped"}else{if(P==="RUNNING"){M="Running"}else{M="Disabled"}}}var O="";if(nf.Common.isDefinedAndNotNull(J.activeThreadCount)&&J.activeThreadCount>0){O="("+J.activeThreadCount+")"}var N='<div class="'+nf.Common.escapeHtml(M.toLowerCase())+'" style="margin-top: 3px;"></div>';return N+'<div class="status-text" style="margin-top: 2px; margin-left: 4px; float: left;">'+nf.Common.escapeHtml(M)+'</div><div style="float: left; margin-left: 4px;">'+nf.Common.escapeHtml(O)+"</div>"};var G=function(O,K,N,M,J){var L="";if(nf.Common.isDFM()){if(J.state==="RUNNING"){L+='<img src="images/iconStop.png" title="Stop" class="pointer stop-reporting-task" style="margin-top: 2px;" />'}else{if(J.state==="STOPPED"||J.state==="DISABLED"){L+='<img src="images/iconEdit.png" title="Edit" class="pointer edit-reporting-task" style="margin-top: 2px;" />';if(J.state==="STOPPED"&&nf.Common.isEmpty(J.validationErrors)){L+='<img src="images/iconRun.png" title="Start" class="pointer start-reporting-task" style="margin-top: 2px; margin-left: 3px;"/>'}L+='<img src="images/iconDelete.png" title="Remove" class="pointer delete-reporting-task" style="margin-top: 2px; margin-left: 3px;" />'}}if(J.persistsState===true){L+='<img src="images/iconViewState.png" title="View State" class="pointer view-state-reporting-task" style="margin-top: 2px; margin-left: 3px;" />'}}return L};var D=[{id:"moreDetails",field:"moreDetails",name:"&nbsp;",resizable:false,formatter:H,sortable:true,width:90,maxWidth:90,toolTip:"Sorts based on presence of bulletins"},{id:"name",field:"name",name:"Name",sortable:true,resizable:true},{id:"type",field:"type",name:"Type",sortable:true,resizable:true,formatter:z},{id:"state",field:"state",name:"Run Status",sortable:true,resizeable:true,formatter:I}];if(nf.Canvas.isClustered()){D.push({id:"availability",field:"availability",name:"Availability",formatter:x,sortable:true,resizeable:true})}D.push({id:"actions",name:"&nbsp;",resizable:false,formatter:G,sortable:false,width:90,maxWidth:90});var F=new Slick.Data.DataView({inlineFilters:false});F.setItems([]);y({columnId:"name",sortAsc:true},F);var E=new Slick.Grid("#reporting-tasks-table",F,D,p);E.setSelectionModel(new Slick.RowSelectionModel());E.registerPlugin(new Slick.AutoTooltips());E.setSortColumn("name",true);E.onSort.subscribe(function(K,J){y({columnId:J.sortCol.field,sortAsc:J.sortAsc},F)});E.onClick.subscribe(function(M,K){var L=$(M.target);var N=F.getItem(K.row);if(E.getColumns()[K.cell].id==="actions"){if(L.hasClass("edit-reporting-task")){nf.ReportingTask.showConfiguration(N)}else{if(L.hasClass("start-reporting-task")){nf.ReportingTask.start(N)}else{if(L.hasClass("stop-reporting-task")){nf.ReportingTask.stop(N)}else{if(L.hasClass("delete-reporting-task")){nf.ReportingTask.remove(N)}else{if(L.hasClass("view-state-reporting-task")){var J=N.state==="STOPPED"&&N.activeThreadCount===0;nf.ComponentState.showState(N,J)}}}}}}else{if(E.getColumns()[K.cell].id==="moreDetails"){if(L.hasClass("view-reporting-task")){nf.ReportingTask.showDetails(N)}else{if(L.hasClass("reporting-task-usage")){$("#shell-close-button").click();nf.Shell.showPage("../nifi-docs/documentation?"+$.param({select:nf.Common.substringAfterLast(N.type,".")})).done(function(){nf.Settings.showSettings()})}}}}});F.onRowCountChanged.subscribe(function(K,J){E.updateRowCount();E.render()});F.onRowsChanged.subscribe(function(K,J){E.invalidateRows(J.rows);E.render()});F.syncGridSelection(E,true);$("#reporting-tasks-table").data("gridInstance",E).on("mouseenter","div.slick-cell",function(P){var N=$(this).find("img.has-errors");if(N.length&&!N.data("qtip")){var J=$(this).find("span.row-id").text();var L=F.getItemById(J);var M=nf.Common.formatUnorderedList(L.validationErrors);if(nf.Common.isDefinedAndNotNull(M)){N.qtip($.extend({content:M,position:{target:"mouse",viewport:$(window),adjust:{x:8,y:8,method:"flipinvert flipinvert"}}},nf.Common.config.tooltipConfig))}}var K=$(this).find("img.has-bulletins");if(K.length&&!K.data("qtip")){var J=$(this).find("span.row-id").text();var L=F.getItemById(J);var O=nf.Common.getFormattedBulletins(L.bulletins);var M=nf.Common.formatUnorderedList(O);if(nf.Common.isDefinedAndNotNull(M)){K.qtip($.extend({},nf.Common.config.tooltipConfig,{content:M,position:{target:"mouse",viewport:$(window),adjust:{x:8,y:8,method:"flipinvert flipinvert"}}}))}}})};var t=function(){var F=[];var D=$.ajax({type:"GET",url:B.urls.reportingTasks+"/"+encodeURIComponent(B.node),dataType:"json"}).done(function(G){var H=G.reportingTasks;if(nf.Common.isDefinedAndNotNull(H)){$.each(H,function(I,J){F.push($.extend({bulletins:[]},J))})}});var E=$.Deferred(function(G){if(nf.Canvas.isClustered()){$.ajax({type:"GET",url:B.urls.reportingTasks+"/"+encodeURIComponent(B.ncm),dataType:"json"}).done(function(H){var I=H.reportingTasks;if(nf.Common.isDefinedAndNotNull(I)){$.each(I,function(J,K){F.push(K)})}G.resolve()}).fail(function(){G.reject()})}else{G.resolve()}}).promise();return $.when(D,E).done(function(){var H=$("#reporting-tasks-table");nf.Common.cleanUpTooltips(H,"img.has-errors");nf.Common.cleanUpTooltips(H,"img.has-bulletins");var G=H.data("gridInstance");var I=G.getData();I.setItems(F);I.reSort();G.invalidate()})};return{init:function(){$("#settings-tabs").tabbs({tabStyle:"settings-tab",selectedTabStyle:"settings-selected-tab",tabs:[{name:"General",tabContentId:"general-settings-tab-content"},{name:"Controller Services",tabContentId:"controller-services-tab-content"},{name:"Reporting Tasks",tabContentId:"reporting-tasks-tab-content"}],select:function(){var D=$(this).text();if(D==="General"){$("#new-service-or-task").hide()}else{$("#new-service-or-task").show();$("#new-service-or-task").attr("title",function(){if(D==="Controller Services"){return"Create a new controller service"}else{if(D==="Reporting Tasks"){return"Create a new reporting task"}}});nf.Settings.resetTableSize()}}});$("#settings-refresh-required-icon").qtip($.extend({content:"This flow has been modified by another user. Please refresh."},nf.CanvasUtils.config.systemTooltipConfig));nf.Common.addHoverEffect("#settings-refresh-button","button-refresh","button-refresh-hover").click(function(){if($("#settings-refresh-required-icon").is(":visible")){nf.CanvasHeader.reloadAndClearWarnings()}else{nf.Settings.loadSettings()}});$("#new-service-or-task").on("click",function(){var E=$("li.settings-selected-tab").text();if(E==="Controller Services"){$("#new-controller-service-dialog").modal("show");var D=$("#controller-service-types-table").data("gridInstance");if(nf.Common.isDefinedAndNotNull(D)){D.setSelectedRows([0]);D.resizeCanvas()}$("#controller-service-type-filter").focus()}else{if(E==="Reporting Tasks"){$("#new-reporting-task-dialog").modal("show");var F=$("#reporting-task-types-table").data("gridInstance");if(nf.Common.isDefinedAndNotNull(F)){F.setSelectedRows([0]);F.resizeCanvas()}$("#reporting-task-type-filter").focus()}}});o();v();f()},resetTableSize:function(){var E=$("#controller-services-table").data("gridInstance");if(nf.Common.isDefinedAndNotNull(E)){E.resizeCanvas()}var D=$("#reporting-tasks-table").data("gridInstance");if(nf.Common.isDefinedAndNotNull(D)){D.resizeCanvas()}},showSettings:function(){nf.Shell.showContent("#settings").done(function(){$("#settings-save").mouseout()});nf.Settings.resetTableSize()},loadSettings:function(G){var E=$.ajax({type:"GET",url:B.urls.controllerConfig,dataType:"json"}).done(function(H){if(nf.Common.isDefinedAndNotNull(H.config)){$("#settings-header-text").text(H.config.name+" Settings");$("#settings-last-refreshed").text(H.config.currentTime);if(nf.Common.isDFM()){$("#data-flow-title-field").val(H.config.name);$("#data-flow-comments-field").val(H.config.comments);$("#maximum-timer-driven-thread-count-field").val(H.config.maxTimerDrivenThreadCount);$("#maximum-event-driven-thread-count-field").val(H.config.maxEventDrivenThreadCount)}else{$("#read-only-data-flow-title-field").html(nf.Common.formatValue(H.config.name));$("#read-only-data-flow-comments-field").html(nf.Common.formatValue(H.config.comments));$("#read-only-maximum-timer-driven-thread-count-field").text(H.config.maxTimerDrivenThreadCount);$("#read-only-maximum-event-driven-thread-count-field").text(H.config.maxEventDrivenThreadCount)}}});var D=h();var F=t();return $.when(E,D,F).done(function(){if(G!==false){nf.Canvas.reloadStatus()}}).fail(nf.Common.handleAjaxError)},setBulletins:function(E,K){var D=$("#controller-services-table").data("gridInstance");var J=D.getData();J.beginUpdate();if(!nf.Common.isEmpty(E)){var I=d3.nest().key(function(N){return N.sourceId}).map(E,d3.map);I.forEach(function(P,N){var O=J.getItemById(P);if(nf.Common.isDefinedAndNotNull(O)){J.updateItem(P,$.extend(O,{bulletins:N}))}})}else{var G=J.getItems();$.each(G,function(O,N){J.updateItem(N.id,$.extend(N,{bulletins:[]}))})}J.endUpdate();var F=$("#reporting-tasks-table").data("gridInstance");var L=F.getData();L.beginUpdate();if(!nf.Common.isEmpty(K)){var M=d3.nest().key(function(N){return N.sourceId}).map(K,d3.map);M.forEach(function(O,N){var P=L.getItemById(O);if(nf.Common.isDefinedAndNotNull(P)){L.updateItem(O,$.extend(P,{bulletins:N}))}})}else{var H=L.getItems();$.each(H,function(N,O){L.updateItem(O.id,$.extend(O,{bulletins:[]}))})}L.endUpdate()}}}());
nf.GoTo=(function(){var a={urls:{controller:"../nifi-api/controller",processGroups:"../nifi-api/controller/process-groups/"}};var f=function(k){return $.ajax({type:"GET",url:a.urls.processGroups+encodeURIComponent(k),dataType:"json"})};var j=function(k,l){return $.ajax({type:"GET",url:a.urls.processGroups+encodeURIComponent(k)+"/remote-process-groups/"+encodeURIComponent(l),dataType:"json"})};var b=function(l){var k=$('<div class="source-destination-connection"></div>').appendTo("#connections-container");var m;if(l.source.type==="OUTPUT_PORT"){m=c(k,l)}else{if(l.source.type==="REMOTE_OUTPUT_PORT"){m=e(k,l)}else{m=d(k,l)}}m.done(function(){var p=$('<div class="connection-entry"></div>').appendTo(k);var o="";var q=nf.CanvasUtils.formatConnectionName(l);if(q===""){o="unset";q="Connection"}$('<div class="search-result-icon connection-small-icon"></div>').appendTo(p);$('<div class="connection-entry-name go-to-link"></div>').attr("title",q).addClass(o).text(q).on("click",function(){nf.CanvasUtils.showComponent(l.parentGroupId,l.id);$("#connections-dialog").modal("hide")}).appendTo(p);$('<div class="clear"></div>').appendTo(p);var n;if(l.destination.type==="INPUT_PORT"){n=i(k,l)}else{if(l.destination.type==="REMOTE_INPUT_PORT"){n=g(k,l)}else{n=h(k,l)}}n.done(function(){$('<div class="clear"></div>').appendTo(k)})})};var h=function(k,l){return $.Deferred(function(m){var n="";if(l.destination.type==="PROCESSOR"){n="processor-small-icon"}else{if(l.destination.type==="OUTPUT_PORT"){n="output-port-small-icon"}}var o=$('<div class="destination-component"></div>').appendTo(k);$('<div class="search-result-icon"></div>').addClass(n).appendTo(o);$('<div class="destination-component-name go-to-link"></div>').attr("title",l.destination.name).text(l.destination.name).on("click",function(){nf.CanvasUtils.showComponent(l.destination.groupId,l.destination.id);$("#connections-dialog").modal("hide")}).appendTo(o);$('<div class="clear"></div>').appendTo(o);m.resolve()}).promise()};var i=function(k,l){return f(l.destination.groupId).done(function(m){var n=m.processGroup;var p=$('<div class="destination-component"></div>').appendTo(k);$('<div class="search-result-icon process-group-small-icon"></div>').appendTo(p);$('<div class="destination-component-name go-to-link"></div>').attr("title",n.name).text(n.name).on("click",function(){nf.CanvasUtils.showComponent(n.parentGroupId,n.id);$("#connections-dialog").modal("hide")}).appendTo(p);$('<div class="clear"></div>').appendTo(p);var o=$('<div class="destination-input-port"></div>').appendTo(p);$('<div class="search-result-icon input-port-small-icon"></div>').appendTo(o);$('<div class="destination-input-port-name go-to-link"></div>').attr("title",l.destination.name).text(l.destination.name).on("click",function(){nf.CanvasUtils.showComponent(l.destination.groupId,l.destination.id);$("#connections-dialog").modal("hide")}).appendTo(o);$('<div class="clear"></div>').appendTo(p)})};var g=function(k,l){return j(l.parentGroupId,l.destination.groupId).done(function(m){var n=m.remoteProcessGroup;var p=$('<div class="destination-component"></div>').appendTo(k);$('<div class="search-result-icon remote-process-group-small-icon"></div>').appendTo(p);$('<div class="destination-component-name go-to-link"></div>').attr("title",n.name).text(n.name).on("click",function(){nf.CanvasUtils.showComponent(n.parentGroupId,n.id);$("#connections-dialog").modal("hide")}).appendTo(p);$('<div class="clear"></div>').appendTo(p);var o=$('<div class="destination-input-port"></div>').appendTo(p);$('<div class="search-result-icon input-port-small-icon"></div>').appendTo(o);$('<div class="destination-input-port-name"></div>').attr("title",l.destination.name).text(l.destination.name).appendTo(o);$('<div class="clear"></div>').appendTo(p)})};var d=function(k,l){return $.Deferred(function(m){var o="";if(l.source.type==="PROCESSOR"){o="processor-small-icon"}else{if(l.source.type==="INPUT_PORT"){o="input-port-small-icon"}}var n=$('<div class="source-component"></div>').appendTo(k);$('<div class="search-result-icon"></div>').addClass(o).appendTo(n);$('<div class="source-component-name go-to-link"></div>').attr("title",l.source.name).text(l.source.name).on("click",function(){nf.CanvasUtils.showComponent(l.source.groupId,l.source.id);$("#connections-dialog").modal("hide")}).appendTo(n);m.resolve()}).promise()};var c=function(k,l){return f(l.source.groupId).done(function(m){var o=m.processGroup;var n=$('<div class="source-component"></div>').appendTo(k);$('<div class="search-result-icon process-group-small-icon"></div>').appendTo(n);$('<div class="source-component-name go-to-link"></div>').attr("title",o.name).text(o.name).on("click",function(){nf.CanvasUtils.showComponent(o.parentGroupId,o.id);$("#connections-dialog").modal("hide")}).appendTo(n);$('<div class="clear"></div>').appendTo(n);var p=$('<div class="source-output-port"></div>').appendTo(n);$('<div class="search-result-icon output-port-small-icon"></div>').appendTo(p);$('<div class="source-output-port-name go-to-link"></div>').attr("title",l.source.name).text(l.source.name).on("click",function(){nf.CanvasUtils.showComponent(l.source.groupId,l.source.id);$("#connections-dialog").modal("hide")}).appendTo(p)})};var e=function(k,l){return j(l.parentGroupId,l.source.groupId).done(function(m){var o=m.remoteProcessGroup;var n=$('<div class="source-component"></div>').appendTo(k);$('<div class="search-result-icon remote-process-group-small-icon"></div>').appendTo(n);$('<div class="source-component-name go-to-link"></div>').attr("title",o.name).text(o.name).on("click",function(){nf.CanvasUtils.showComponent(o.parentGroupId,o.id);$("#connections-dialog").modal("hide")}).appendTo(n);$('<div class="clear"></div>').appendTo(n);var p=$('<div class="source-output-port"></div>').appendTo(n);$('<div class="search-result-icon output-port-small-icon"></div>').appendTo(p);$('<div class="source-output-port-name"></div>').attr("title",l.source.name).text(l.source.name).appendTo(p)})};return{init:function(){$("#connections-dialog").modal({overlayBackground:false,buttons:[{buttonText:"Close",handler:{click:function(){$("#connections-dialog").modal("hide")}}}],handler:{close:function(){$("#connections-context").empty();$("#connections-container").empty()}}})},showDownstreamFromProcessor:function(k){var l=k.datum();$.ajax({type:"GET",url:a.urls.controller+"/process-groups/"+encodeURIComponent(l.component.parentGroupId)+"/connections",dataType:"json"}).done(function(m){var n=m.connections;$("#connections-context").append('<div class="search-result-icon processor-small-icon"></div>').append($('<div class="connections-component-name"></div>').text(l.component.name)).append('<div class="clear"></div>');$.each(n,function(p,o){if(o.source.id===l.component.id){b(o)}});if($("#connections-container").is(":empty")){$("#connections-container").html('<span class="unset">No downstream components</span>')}$("#connections-dialog").modal("setHeaderText","Downstream Connections").modal("show")}).fail(nf.Common.handleAjaxError)},showUpstreamFromProcessor:function(k){var l=k.datum();$.ajax({type:"GET",url:a.urls.controller+"/process-groups/"+encodeURIComponent(l.component.parentGroupId)+"/connections",dataType:"json"}).done(function(m){var n=m.connections;$("#connections-context").append('<div class="search-result-icon processor-small-icon"></div>').append($('<div class="connections-component-name"></div>').text(l.component.name)).append('<div class="clear"></div>');$.each(n,function(p,o){if(o.destination.id===l.component.id){b(o)}});if($("#connections-container").is(":empty")){$("#connections-container").html('<span class="unset">No upstream components</span>')}$("#connections-dialog").modal("setHeaderText","Upstream Connections").modal("show")}).fail(nf.Common.handleAjaxError)},showDownstreamFromGroup:function(k){var l=k.datum();$.ajax({type:"GET",url:a.urls.controller+"/process-groups/"+encodeURIComponent(l.component.parentGroupId)+"/connections",dataType:"json"}).done(function(m){var n=m.connections;$("#connections-context").append('<div class="search-result-icon process-group-small-icon"></div>').append($('<div class="connections-component-name"></div>').text(l.component.name)).append('<div class="clear"></div>');$.each(n,function(p,o){if(o.source.groupId===l.component.id){b(o)}});if($("#connections-container").is(":empty")){$("#connections-container").html('<span class="unset">No downstream components</span>')}$("#connections-dialog").modal("setHeaderText","Downstream Connections").modal("show")}).fail(nf.Common.handleAjaxError)},showUpstreamFromGroup:function(k){var l=k.datum();$.ajax({type:"GET",url:a.urls.controller+"/process-groups/"+encodeURIComponent(l.component.parentGroupId)+"/connections",dataType:"json"}).done(function(m){var n=m.connections;$("#connections-context").append('<div class="search-result-icon process-group-small-icon"></div>').append($('<div class="connections-component-name"></div>').text(l.component.name)).append('<div class="clear"></div>');$.each(n,function(p,o){if(o.destination.groupId===l.component.id){b(o)}});if($("#connections-container").is(":empty")){$("#connections-container").html('<span class="unset">No upstream components</span>')}$("#connections-dialog").modal("setHeaderText","Upstream Connections").modal("show")}).fail(nf.Common.handleAjaxError)},showDownstreamFromInputPort:function(k){var l=k.datum();$.ajax({type:"GET",url:a.urls.controller+"/process-groups/"+encodeURIComponent(l.component.parentGroupId)+"/connections",dataType:"json"}).done(function(m){var n=m.connections;$("#connections-context").append('<div class="search-result-icon input-port-small-icon"></div>').append($('<div class="connections-component-name"></div>').text(l.component.name)).append('<div class="clear"></div>');$.each(n,function(p,o){if(o.source.id===l.component.id){b(o)}});if($("#connections-container").is(":empty")){$("#connections-container").html('<span class="unset">No downstream components</span>')}$("#connections-dialog").modal("setHeaderText","Downstream Connections").modal("show")}).fail(nf.Common.handleAjaxError)},showUpstreamFromInputPort:function(k){var l=k.datum();$.ajax({type:"GET",url:a.urls.controller+"/process-groups/"+encodeURIComponent(nf.Canvas.getParentGroupId())+"/connections",dataType:"json"}).done(function(m){var n=m.connections;$("#connections-context").append('<div class="search-result-icon process-group-small-icon"></div>').append($('<div class="connections-component-name"></div>').text(nf.Canvas.getGroupName())).append('<div class="clear"></div>').append('<div class="search-result-icon input-port-small-icon" style="margin-left: 20px;"></div>').append($('<div class="connections-component-name"></div>').text(l.component.name)).append('<div class="clear"></div>');$.each(n,function(p,o){if(o.destination.id===l.component.id){b(o)}});if($("#connections-container").is(":empty")){$("#connections-container").html('<span class="unset">No upstream components</span>')}$("#connections-dialog").modal("setHeaderText","Upstream Connections").modal("show")}).fail(nf.Common.handleAjaxError)},showDownstreamFromOutputPort:function(k){var l=k.datum();$.ajax({type:"GET",url:a.urls.controller+"/process-groups/"+encodeURIComponent(nf.Canvas.getParentGroupId())+"/connections",dataType:"json"}).done(function(m){var n=m.connections;$("#connections-context").append('<div class="search-result-icon process-group-small-icon"></div>').append($('<div class="connections-component-name"></div>').text(nf.Canvas.getGroupName())).append('<div class="clear"></div>').append('<div class="search-result-icon output-port-small-icon" style="margin-left: 20px;"></div>').append($('<div class="connections-component-name"></div>').text(l.component.name)).append('<div class="clear"></div>');$.each(n,function(p,o){if(o.source.id===l.component.id){b(o)}});if($("#connections-container").is(":empty")){$("#connections-container").html('<span class="unset">No downstream components</span>')}$("#connections-dialog").modal("setHeaderText","Downstream Connections").modal("show")}).fail(nf.Common.handleAjaxError)},showUpstreamFromOutputPort:function(k){var l=k.datum();$.ajax({type:"GET",url:a.urls.controller+"/process-groups/"+encodeURIComponent(l.component.parentGroupId)+"/connections",dataType:"json"}).done(function(m){var n=m.connections;$("#connections-context").append('<div class="search-result-icon input-port-small-icon"></div>').append($('<div class="connections-component-name"></div>').text(l.component.name)).append('<div class="clear"></div>');$.each(n,function(p,o){if(o.destination.id===l.component.id){b(o)}});if($("#connections-container").is(":empty")){$("#connections-container").html('<span class="unset">No upstream components</span>')}$("#connections-dialog").modal("setHeaderText","Upstream Connections").modal("show")}).fail(nf.Common.handleAjaxError)},showDownstreamFromFunnel:function(k){var l=k.datum();$.ajax({type:"GET",url:a.urls.controller+"/process-groups/"+encodeURIComponent(l.component.parentGroupId)+"/connections",dataType:"json"}).done(function(m){var n=m.connections;$("#connections-context").append($('<div class="connections-component-name"></div>').text("Funnel"));$.each(n,function(p,o){if(o.source.id===l.component.id){b(o)}});if($("#connections-container").is(":empty")){$("#connections-container").html('<span class="unset">No downstream components</span>')}$("#connections-dialog").modal("setHeaderText","Downstream Connections").modal("show")}).fail(nf.Common.handleAjaxError)},showUpstreamFromFunnel:function(k){var l=k.datum();$.ajax({type:"GET",url:a.urls.controller+"/process-groups/"+encodeURIComponent(l.component.parentGroupId)+"/connections",dataType:"json"}).done(function(m){var n=m.connections;$("#connections-context").append($('<div class="upstream-destination-name"></div>').text("Funnel"));$.each(n,function(p,o){if(o.destination.id===l.component.id){b(o)}});if($("#connections-container").is(":empty")){$("#connections-container").html('<span class="unset">No upstream components</span>')}$("#connections-dialog").modal("setHeaderText","Upstream Connections").modal("show")}).fail(nf.Common.handleAjaxError)}}}());
nf.Actions=(function(){var c={urls:{controller:"../nifi-api/controller"}};var b=function(){var e=$("#drop-request-percent-complete").progressbar();$("#drop-request-status-dialog").modal({overlayBackground:false,handler:{close:function(){e.find("div.progress-label").remove();var f=$('<div class="progress-label"></div>').text("0%");e.progressbar("value",0).append(f);$("#drop-request-status-dialog").modal("setButtonModel",[])}}}).draggable({containment:"parent",handle:".dialog-header"})};var d=function(f,g){var e=nf.Client.getRevision();g.version=e.version;g.clientId=e.clientId;return $.ajax({type:"PUT",url:f,data:g,dataType:"json"}).done(function(h){nf.Client.setRevision(h.revision)}).fail(function(j,h,i){if(j.status===400||j.status===404||j.status===409){nf.Dialog.showOkDialog({dialogContent:nf.Common.escapeHtml(j.responseText),overlayBackground:true})}})};var a=function(e){if(nf.Common.isDefinedAndNotNull(e.processGroup)){if(nf.Common.isDefinedAndNotNull(e.processGroup.contents)){var f=e.processGroup.contents;nf.Graph.set(f);$.each(f.processGroups,function(g,i){var h=nf.Connection.getComponentConnections(i.id);$.each(h,function(k,j){nf.Connection.reload(j)})})}}};return{init:function(){b()},enterGroup:function(e){if(e.size()===1&&nf.CanvasUtils.isProcessGroup(e)){var f=e.datum();nf.CanvasUtils.enterGroup(f.component.id)}},leaveGroup:function(){nf.CanvasUtils.enterGroup(nf.Canvas.getParentGroupId())},refreshRemoteFlow:function(f){if(f.size()===1&&nf.CanvasUtils.isRemoteProcessGroup(f)){var i=f.datum();var j=i.component.flowRefreshed;var e=function(k){i.component.flowRefreshed=k;if(f.classed("visible")){f.select("text.remote-process-group-last-refresh").text(function(){return k})}};var h=function(k){$.ajax({type:"GET",url:i.component.uri,dataType:"json"}).done(function(l){var n=l.remoteProcessGroup;if(j===n.flowRefreshed){g(k)}else{nf.RemoteProcessGroup.set(l.remoteProcessGroup);var m=nf.Connection.getComponentConnections(n.id);$.each(m,function(p,o){nf.Connection.reload(o)})}})};var g=function(k){if(k<=32){setTimeout(function(){h(k*2)},k*1000)}else{e(j)}};e("Refreshing...");h(1)}},openUri:function(e){if(e.size()===1&&nf.CanvasUtils.isRemoteProcessGroup(e)){var g=e.datum();var f=g.component.targetUri;if(!nf.Common.isBlank(f)){window.open(encodeURI(f))}else{nf.Dialog.showOkDialog({dialogContent:"No target URI defined."})}}},showSource:function(e){if(e.size()===1&&nf.CanvasUtils.isConnection(e)){var g=e.datum();if(g.component.source.groupId===nf.Canvas.getGroupId()){var f=d3.select("#id-"+g.component.source.id);nf.Actions.show(f)}else{if(g.component.source.type==="REMOTE_OUTPUT_PORT"){var h=d3.select("#id-"+g.component.source.groupId);nf.Actions.show(h)}else{nf.CanvasUtils.showComponent(g.component.source.groupId,g.component.source.id)}}}},showDestination:function(g){if(g.size()===1&&nf.CanvasUtils.isConnection(g)){var h=g.datum();if(h.component.destination.groupId===nf.Canvas.getGroupId()){var e=d3.select("#id-"+h.component.destination.id);nf.Actions.show(e)}else{if(h.component.destination.type==="REMOTE_INPUT_PORT"){var f=d3.select("#id-"+h.component.destination.groupId);nf.Actions.show(f)}else{nf.CanvasUtils.showComponent(h.component.destination.groupId,h.component.destination.id)}}}},showDownstream:function(e){if(e.size()===1&&!nf.CanvasUtils.isConnection(e)){if(nf.CanvasUtils.isProcessor(e)){nf.GoTo.showDownstreamFromProcessor(e)}else{if(nf.CanvasUtils.isFunnel(e)){nf.GoTo.showDownstreamFromFunnel(e)}else{if(nf.CanvasUtils.isInputPort(e)){nf.GoTo.showDownstreamFromInputPort(e)}else{if(nf.CanvasUtils.isOutputPort(e)){nf.GoTo.showDownstreamFromOutputPort(e)}else{if(nf.CanvasUtils.isProcessGroup(e)||nf.CanvasUtils.isRemoteProcessGroup(e)){nf.GoTo.showDownstreamFromGroup(e)}}}}}}},showUpstream:function(e){if(e.size()===1&&!nf.CanvasUtils.isConnection(e)){if(nf.CanvasUtils.isProcessor(e)){nf.GoTo.showUpstreamFromProcessor(e)}else{if(nf.CanvasUtils.isFunnel(e)){nf.GoTo.showUpstreamFromFunnel(e)}else{if(nf.CanvasUtils.isInputPort(e)){nf.GoTo.showUpstreamFromInputPort(e)}else{if(nf.CanvasUtils.isOutputPort(e)){nf.GoTo.showUpstreamFromOutputPort(e)}else{if(nf.CanvasUtils.isProcessGroup(e)||nf.CanvasUtils.isRemoteProcessGroup(e)){nf.GoTo.showUpstreamFromGroup(e)}}}}}}},show:function(e){if(e.size()===1){var f=nf.CanvasUtils.getSelection();f.classed("selected",false);e.classed("selected",true);nf.Actions.center(e)}},select:function(e){e.classed("selected",true)},selectAll:function(){nf.Actions.select(d3.selectAll("g.component, g.connection"))},center:function(g){if(g.size()===1){var h;if(nf.CanvasUtils.isConnection(g)){var e,m;var l=g.datum();if(l.bends.length>0){var f=Math.min(Math.max(0,l.labelIndex),l.bends.length-1);e=l.bends[f].x;m=l.bends[f].y}else{e=(l.start.x+l.end.x)/2;m=(l.start.y+l.end.y)/2}h={x:e,y:m,width:1,height:1}}else{var j=g.datum();var k=j.component.position;h={x:k.x,y:k.y,width:j.dimensions.width,height:j.dimensions.height}}nf.CanvasUtils.centerBoundingBox(h);nf.Canvas.View.refresh({transition:true})}},enable:function(e){var g=nf.CanvasUtils.filterEnable(e);if(g.empty()){nf.Dialog.showOkDialog({dialogContent:"No eligible components are selected. Please select the components to be enabled and ensure they are no longer running.",overlayBackground:true})}else{var f=[];g.each(function(i){var h=d3.select(this);f.push(d(i.component.uri,{state:"STOPPED"}).done(function(j){if(nf.CanvasUtils.isProcessor(h)){nf.Processor.set(j.processor)}else{if(nf.CanvasUtils.isInputPort(h)){nf.Port.set(j.inputPort)}else{if(nf.CanvasUtils.isOutputPort(h)){nf.Port.set(j.outputPort)}}}}))});if(f.length>0){$.when.apply(window,f).always(function(){nf.CanvasToolbar.refresh()})}}},disable:function(f){var e=nf.CanvasUtils.filterDisable(f);if(e.empty()){nf.Dialog.showOkDialog({dialogContent:"No eligible components are selected. Please select the components to be disabled and ensure they are no longer running.",overlayBackground:true})}else{var g=[];e.each(function(i){var h=d3.select(this);g.push(d(i.component.uri,{state:"DISABLED"}).done(function(j){if(nf.CanvasUtils.isProcessor(h)){nf.Processor.set(j.processor)}else{if(nf.CanvasUtils.isInputPort(h)){nf.Port.set(j.inputPort)}else{if(nf.CanvasUtils.isOutputPort(h)){nf.Port.set(j.outputPort)}}}}))});if(g.length>0){$.when.apply(window,g).always(function(){nf.CanvasToolbar.refresh()})}}},openProvenance:function(e){if(e.size()===1){var f=e.datum();nf.Shell.showPage("provenance?"+$.param({componentId:f.component.id}))}},start:function(f){if(f.empty()){d(c.urls.controller+"/process-groups/"+encodeURIComponent(nf.Canvas.getGroupId()),{running:true}).done(a)}else{var g=f.filter(function(h){return nf.CanvasUtils.isRunnable(d3.select(this))});if(g.empty()){nf.Dialog.showOkDialog({dialogContent:"No eligible components are selected. Please select the components to be started and ensure they are no longer running.",overlayBackground:true})}else{var e=[];g.each(function(j){var h=d3.select(this);var i={};if(nf.CanvasUtils.isProcessor(h)||nf.CanvasUtils.isInputPort(h)||nf.CanvasUtils.isOutputPort(h)){i.state="RUNNING"}else{i.running=true}e.push(d(j.component.uri,i).done(function(k){if(nf.CanvasUtils.isProcessor(h)){nf.Processor.set(k.processor)}else{if(nf.CanvasUtils.isProcessGroup(h)){nf.ProcessGroup.set(k.processGroup);var l=nf.Connection.getComponentConnections(k.processGroup.id);$.each(l,function(n,m){nf.Connection.reload(m)})}else{if(nf.CanvasUtils.isInputPort(h)){nf.Port.set(k.inputPort)}else{if(nf.CanvasUtils.isOutputPort(h)){nf.Port.set(k.outputPort)}}}}}))});if(e.length>0){$.when.apply(window,e).always(function(){nf.CanvasToolbar.refresh()})}}}},stop:function(e){if(e.empty()){d(c.urls.controller+"/process-groups/"+encodeURIComponent(nf.Canvas.getGroupId()),{running:false}).done(a)}else{var g=e.filter(function(h){return nf.CanvasUtils.isStoppable(d3.select(this))});if(g.empty()){nf.Dialog.showOkDialog({dialogContent:"No eligible components are selected. Please select the components to be stopped.",overlayBackground:true})}else{var f=[];g.each(function(j){var h=d3.select(this);var i={};if(nf.CanvasUtils.isProcessor(h)||nf.CanvasUtils.isInputPort(h)||nf.CanvasUtils.isOutputPort(h)){i.state="STOPPED"}else{i.running=false}f.push(d(j.component.uri,i).done(function(k){if(nf.CanvasUtils.isProcessor(h)){nf.Processor.set(k.processor)}else{if(nf.CanvasUtils.isProcessGroup(h)){nf.ProcessGroup.set(k.processGroup);var l=nf.Connection.getComponentConnections(k.processGroup.id);$.each(l,function(n,m){nf.Connection.reload(m)})}else{if(nf.CanvasUtils.isInputPort(h)){nf.Port.set(k.inputPort)}else{if(nf.CanvasUtils.isOutputPort(h)){nf.Port.set(k.outputPort)}}}}}))});if(f.length>0){$.when.apply(window,f).always(function(){nf.CanvasToolbar.refresh()})}}}},enableTransmission:function(e){var f=e.filter(function(g){return nf.CanvasUtils.canStartTransmitting(d3.select(this))});f.each(function(g){d(g.component.uri,{transmitting:true}).done(function(h){nf.RemoteProcessGroup.set(h.remoteProcessGroup)})})},disableTransmission:function(f){var e=f.filter(function(g){return nf.CanvasUtils.canStopTransmitting(d3.select(this))});e.each(function(g){d(g.component.uri,{transmitting:false}).done(function(h){nf.RemoteProcessGroup.set(h.remoteProcessGroup)})})},showConfiguration:function(e){if(e.size()===1){if(nf.CanvasUtils.isProcessor(e)){nf.ProcessorConfiguration.showConfiguration(e)}else{if(nf.CanvasUtils.isLabel(e)){nf.LabelConfiguration.showConfiguration(e)}else{if(nf.CanvasUtils.isProcessGroup(e)){nf.ProcessGroupConfiguration.showConfiguration(e)}else{if(nf.CanvasUtils.isRemoteProcessGroup(e)){nf.RemoteProcessGroupConfiguration.showConfiguration(e)}else{if(nf.CanvasUtils.isInputPort(e)||nf.CanvasUtils.isOutputPort(e)){if(nf.Canvas.getParentGroupId()===null&&nf.Canvas.isSecureSiteToSite()){nf.SecurePortConfiguration.showConfiguration(e)}else{nf.PortConfiguration.showConfiguration(e)}}else{if(nf.CanvasUtils.isConnection(e)){nf.ConnectionConfiguration.showConfiguration(e)}}}}}}}},showDetails:function(e){if(e.size()===1){var f=e.datum();if(nf.CanvasUtils.isProcessor(e)){nf.ProcessorDetails.showDetails(nf.Canvas.getGroupId(),f.component.id)}else{if(nf.CanvasUtils.isProcessGroup(e)){nf.ProcessGroupDetails.showDetails(e)}else{if(nf.CanvasUtils.isRemoteProcessGroup(e)){nf.RemoteProcessGroupDetails.showDetails(e)}else{if(nf.CanvasUtils.isInputPort(e)||nf.CanvasUtils.isOutputPort(e)){if(nf.Canvas.getParentGroupId()===null&&nf.Canvas.isSecureSiteToSite()){nf.SecurePortDetails.showDetails(e)}else{nf.PortDetails.showDetails(e)}}else{if(nf.CanvasUtils.isConnection(e)){nf.ConnectionDetails.showDetails(nf.Canvas.getGroupId(),f.component.id)}}}}}}},showUsage:function(e){if(e.size()===1&&nf.CanvasUtils.isProcessor(e)){var f=e.datum();nf.Shell.showPage("../nifi-docs/documentation?"+$.param({select:nf.Common.substringAfterLast(f.component.type,".")}))}},showStats:function(e){if(e.size()===1){var f=e.datum();if(nf.Canvas.isClustered()){if(nf.CanvasUtils.isProcessor(e)){nf.StatusHistory.showClusterProcessorChart(nf.Canvas.getGroupId(),f.component.id)}else{if(nf.CanvasUtils.isProcessGroup(e)){nf.StatusHistory.showClusterProcessGroupChart(nf.Canvas.getGroupId(),f.component.id)}else{if(nf.CanvasUtils.isRemoteProcessGroup(e)){nf.StatusHistory.showClusterRemoteProcessGroupChart(nf.Canvas.getGroupId(),f.component.id)}else{if(nf.CanvasUtils.isConnection(e)){nf.StatusHistory.showClusterConnectionChart(nf.Canvas.getGroupId(),f.component.id)}}}}}else{if(nf.CanvasUtils.isProcessor(e)){nf.StatusHistory.showStandaloneProcessorChart(nf.Canvas.getGroupId(),f.component.id)}else{if(nf.CanvasUtils.isProcessGroup(e)){nf.StatusHistory.showStandaloneProcessGroupChart(nf.Canvas.getGroupId(),f.component.id)}else{if(nf.CanvasUtils.isRemoteProcessGroup(e)){nf.StatusHistory.showStandaloneRemoteProcessGroupChart(nf.Canvas.getGroupId(),f.component.id)}else{if(nf.CanvasUtils.isConnection(e)){nf.StatusHistory.showStandaloneConnectionChart(nf.Canvas.getGroupId(),f.component.id)}}}}}}},remotePorts:function(e){if(e.size()===1&&nf.CanvasUtils.isRemoteProcessGroup(e)){nf.RemoteProcessGroupPorts.showPorts(e)}},reloadStatus:function(){nf.Canvas.reloadStatus()},"delete":function(f){if(nf.Common.isUndefined(f)||f.empty()){nf.Dialog.showOkDialog({dialogContent:"No eligible components are selected. Please select the components to be deleted.",overlayBackground:true})}else{if(f.size()===1){var g=f.datum();var e=nf.Client.getRevision();$.ajax({type:"DELETE",url:g.component.uri+"?"+$.param({version:e.version,clientId:e.clientId}),dataType:"json"}).done(function(i){nf.Client.setRevision(i.revision);nf[g.type].remove(g.component.id);if(nf.CanvasUtils.isConnection(f)===false){var j=nf.Connection.getComponentConnections(g.component.id);if(j.length>0){var k=[];$.each(j,function(m,l){k.push(l.id)});nf.Connection.remove(k)}}nf.Birdseye.refresh();nf.CanvasToolbar.refresh()}).fail(nf.Common.handleAjaxError)}else{var h=nf.Snippet.marshal(f,true);nf.Snippet.create(h).done(function(i){var j=i.snippet;nf.Snippet.remove(j.id).done(function(){var l=d3.map();var k=function(m,n){if(!l.has(m)){l.set(m,[])}l.get(m).push(n)};f.each(function(n){k(n.type,n.component.id);if(n.type!=="Connection"){var m=nf.Connection.getComponentConnections(n.component.id);if(m.length>0){$.each(m,function(p,o){k("Connection",o.id)})}}});l.forEach(function(n,m){if(n!=="Connection"){nf[n].remove(m)}});if(l.has("Connection")){nf.Connection.remove(l.get("Connection"))}nf.Birdseye.refresh();nf.CanvasToolbar.refresh()}).fail(function(m,k,l){nf.Snippet.unlink(j.id).done(function(){nf.Snippet.remove(j.id)});nf.Common.handleAjaxError(m,k,l)})}).fail(nf.Common.handleAjaxError)}}},emptyQueue:function(e){if(e.size()!==1||!nf.CanvasUtils.isConnection(e)){return}nf.Dialog.showYesNoDialog({headerText:"Empty Queue",dialogContent:"Are you sure you want to empty this queue? All FlowFiles waiting at the time of the request will be removed.",overlayBackground:false,noText:"Cancel",yesText:"Empty",yesHandler:function(){var i=e.datum();var m=4;var k=false;var l=null;var h=null;var g=function(p){var q=$("#drop-request-percent-complete");q.find("div.progress-label").remove();var o=$('<div class="progress-label"></div>').text(p+"%");if(p>0){o.css("margin-top","-19px")}q.progressbar("value",p).append(o)};$("#drop-request-status-dialog").modal("setButtonModel",[{buttonText:"Stop",handler:{click:function(){k=true;if(h!==null){clearTimeout(h);f()}}}}]);var f=function(){if(nf.Common.isDefinedAndNotNull(l)){$.ajax({type:"DELETE",url:l.uri,dataType:"json"}).done(function(o){l=o.dropRequest;var r=l.dropped.split(/ \/ /);var q=$("<div></div>");$('<span class="label"></span>').text(r[0]).appendTo(q);$("<span></span>").text(" FlowFiles ("+r[1]+")").appendTo(q);if(l.percentCompleted<100){var p=l.original.split(/ \/ /);$('<span class="label"></span>').text(" out of "+p[0]).appendTo(q);$("<span></span>").text(" ("+p[1]+")").appendTo(q)}$("<span></span>").text(" were removed from the queue.").appendTo(q);if(nf.Common.isDefinedAndNotNull(l.failureReason)){$("<br/><br/><span></span>").text(l.failureReason).appendTo(q)}nf.Dialog.showOkDialog({dialogContent:q,overlayBackground:false})}).always(function(){$("#drop-request-status-dialog").modal("hide")})}else{nf.Dialog.showOkDialog({dialogContent:"No FlowFiles were removed.",overlayBackground:false});$("#drop-request-status-dialog").modal("hide")}};var n=function(o){g(l.percentCompleted);$("#drop-request-status-message").text(l.state);if(nf.Common.isDefinedAndNotNull(i.status)&&nf.Common.isDefinedAndNotNull(l.currentCount)){i.status.queued=l.current;nf.Connection.refresh(i.id)}if(l.finished===true||k===true){f()}else{h=setTimeout(function(){h=null;j(Math.min(m,o*2))},o*1000)}};var j=function(o){$.ajax({type:"GET",url:l.uri,dataType:"json"}).done(function(p){l=p.dropRequest;n(o)}).fail(f)};$.ajax({type:"POST",url:i.component.uri+"/drop-requests",dataType:"json"}).done(function(o){g(0);$("#drop-request-status-dialog").modal("show");l=o.dropRequest;n(1)}).fail(f)}})},listQueue:function(f){if(f.size()!==1||!nf.CanvasUtils.isConnection(f)){return}var e=f.datum();nf.QueueListing.listQueue(e)},viewState:function(f){if(f.size()!==1||!nf.CanvasUtils.isProcessor(f)){return}var e=f.datum();nf.ComponentState.showState(e.component,nf.CanvasUtils.supportsModification(f))},fillColor:function(g){if(nf.CanvasUtils.isColorable(g)){var e=nf.CanvasUtils.isProcessor(g);var f;if(e){f=nf.Processor.defaultColor()}else{f=nf.Label.defaultColor()}if(g.size()===1){var h=g.datum();if(nf.Common.isDefinedAndNotNull(h.component.style["background-color"])){f=h.component.style["background-color"]}}$("#fill-color").minicolors("value",f);if(e){$("#fill-color-processor-preview").show();$("#fill-color-label-preview").hide()}else{$("#fill-color-processor-preview").hide();$("#fill-color-label-preview").show()}$("#fill-color-dialog").modal("show")}},group:function(){var e=nf.CanvasUtils.getSelection();if(e.empty()){return}$.when(nf.CanvasUtils.eligibleForMove(e)).done(function(){var f=nf.CanvasUtils.getOrigin(e);var g={x:f.x,y:f.y};$.when(nf.CanvasToolbox.promptForGroupName(g)).done(function(h){var i=d3.select("#id-"+h.id);nf.CanvasUtils.moveComponents(e,i)})})},moveIntoParent:function(){var e=nf.CanvasUtils.getSelection();if(e.empty()){return}nf.CanvasUtils.moveComponentsToParent(e)},template:function(){var e=nf.CanvasUtils.getSelection();if(e.empty()){e=d3.selectAll("g.component, g.connection")}if(e.empty()){nf.Dialog.showOkDialog({dialogContent:"The current selection is not valid to create a template.",overlayBackground:false});return}e=nf.CanvasUtils.trimDanglingEdges(e);if(e.empty()){nf.Dialog.showOkDialog({dialogContent:"The current selection is not valid to create a template.",overlayBackground:false});return}$("#new-template-dialog").modal("setButtonModel",[{buttonText:"Create",handler:{click:function(){$("#new-template-dialog").modal("hide");var f=$("#new-template-name").val();var h=$("#new-template-description").val();var g=nf.Snippet.marshal(e,false);nf.Snippet.create(g).done(function(i){var j=i.snippet;$.ajax({type:"POST",url:c.urls.controller+"/templates",data:{name:f,description:h,snippetId:j.id},dataType:"json"}).done(function(){nf.Dialog.showOkDialog({dialogContent:"Template '"+nf.Common.escapeHtml(f)+"' was successfully created.",overlayBackground:false})}).always(function(){nf.Snippet.remove(j.id);$("#new-template-name").val("");$("#new-template-description").val("")}).fail(nf.Common.handleAjaxError)}).fail(nf.Common.handleAjaxError)}}},{buttonText:"Cancel",handler:{click:function(){$("#new-template-dialog").modal("hide")}}}]).modal("show");$("#new-template-name").focus()},copy:function(f){if(f.empty()){return}var e=nf.CanvasUtils.getOrigin(f);nf.Clipboard.copy({snippet:nf.Snippet.marshal(f,false),origin:e})},paste:function(l,m){if(nf.Common.isDefinedAndNotNull(m)){var g=nf.Canvas.View.scale();var e=nf.Canvas.View.translate();var h=m.pageX;var f=m.pageY-nf.Canvas.CANVAS_OFFSET;var k=(h/g)-(e[0]/g);var j=(f/g)-(e[1]/g);var i={x:k,y:j}}nf.Clipboard.paste().done(function(o){var n=$.Deferred(function(p){var q=function(t,r,s){p.reject(t.responseText)};nf.Snippet.create(o.snippet).done(function(t){var u=t.snippet;var s=i;var r=o.origin;if(!nf.Common.isDefinedAndNotNull(s)){r.x+=25;r.y+=25;s=r}nf.Snippet.copy(u.id,nf.Canvas.getGroupId(),s).done(function(w){var v=w.contents;nf.Graph.add(v,true);nf.Canvas.View.updateVisibility();nf.Birdseye.refresh();nf.Snippet.remove(u.id).fail(q)}).fail(function(){nf.Canvas.reload().done(function(){nf.Canvas.View.updateVisibility();nf.Birdseye.refresh()})}).fail(q)}).fail(q)}).promise();n.fail(function(q){var p="An error occurred while attempting to copy and paste.";if($.trim(q)!==""){p=q}nf.Dialog.showOkDialog({dialogContent:nf.Common.escapeHtml(p),overlayBackground:true})})})},toFront:function(h){if(h.size()!==1||!nf.CanvasUtils.isConnection(h)){return}var e=h.datum();var g=-1;$.each(nf.Connection.get(),function(j,k){if(e.component.id!==k.component.id&&k.component.zIndex>g){g=k.component.zIndex}});if(g>=0){var i=g+1;var f=nf.Client.getRevision();$.ajax({type:"PUT",url:e.component.uri,data:{version:f.version,clientId:f.clientId,zIndex:i},dataType:"json"}).done(function(j){nf.Connection.set(j.connection);nf.Connection.reorder();nf.Client.setRevision(j.revision)})}}}}());
nf.ContextMenu=(function(){var n=function(E){return nf.Canvas.getParentGroupId()!==null&&E.empty()};var y=function(E){if(E.size()!==1){return false}var F=nf.CanvasUtils.isLabel(E)||nf.CanvasUtils.isProcessGroup(E);if(!F){if(nf.CanvasUtils.isProcessor(E)||nf.CanvasUtils.isInputPort(E)||nf.CanvasUtils.isOutputPort(E)||nf.CanvasUtils.isRemoteProcessGroup(E)||nf.CanvasUtils.isConnection(E)){F=nf.CanvasUtils.supportsModification(E)}}return F&&nf.Common.isDFM()};var b=function(E){if(E.size()!==1){return false}if(nf.Common.isDFM()){if(nf.CanvasUtils.isProcessor(E)||nf.CanvasUtils.isInputPort(E)||nf.CanvasUtils.isOutputPort(E)||nf.CanvasUtils.isRemoteProcessGroup(E)||nf.CanvasUtils.isConnection(E)){return !nf.CanvasUtils.supportsModification(E)}}else{return nf.CanvasUtils.isProcessor(E)||nf.CanvasUtils.isConnection(E)||nf.CanvasUtils.isProcessGroup(E)||nf.CanvasUtils.isInputPort(E)||nf.CanvasUtils.isOutputPort(E)||nf.CanvasUtils.isRemoteProcessGroup(E)}return false};var e=function(E){return nf.Common.isDFM()&&nf.CanvasUtils.isDeletable(E)};var i=function(E){return nf.Common.isDFM()&&nf.CanvasUtils.areRunnable(E)};var d=function(E){return nf.Common.isDFM()&&nf.CanvasUtils.areStoppable(E)};var z=function(E){if(E.size()!==1){return false}return nf.CanvasUtils.isProcessor(E)||nf.CanvasUtils.isProcessGroup(E)||nf.CanvasUtils.isRemoteProcessGroup(E)||nf.CanvasUtils.isConnection(E)};var k=function(E){if(E.size()!==1){return false}return nf.CanvasUtils.isProcessor(E)};var t=function(E){return E.size()===1&&!nf.CanvasUtils.isConnection(E)};var h=function(E){return nf.Common.isDFM()&&nf.CanvasUtils.isCopyable(E)};var x=function(E){return nf.Common.isDFM()&&nf.CanvasUtils.isPastable()};var p=function(E){return E.empty()};var g=function(E){if(E.size()!==1){return false}return nf.Common.isDFM()&&nf.CanvasUtils.isConnection(E)};var r=function(E){return nf.Common.isDFM()&&nf.CanvasUtils.isColorable(E)};var A=function(E){if(E.size()!==1){return false}return nf.CanvasUtils.isConnection(E)};var C=function(E){if(E.size()!==1){return false}return nf.CanvasUtils.isFunnel(E)||nf.CanvasUtils.isProcessor(E)||nf.CanvasUtils.isProcessGroup(E)||nf.CanvasUtils.isRemoteProcessGroup(E)||nf.CanvasUtils.isInputPort(E)||(nf.CanvasUtils.isOutputPort(E)&&nf.Canvas.getParentGroupId()!==null)};var B=function(E){if(E.size()!==1){return false}return nf.CanvasUtils.isFunnel(E)||nf.CanvasUtils.isProcessor(E)||nf.CanvasUtils.isProcessGroup(E)||nf.CanvasUtils.isRemoteProcessGroup(E)||nf.CanvasUtils.isOutputPort(E)||(nf.CanvasUtils.isInputPort(E)&&nf.Canvas.getParentGroupId()!==null)};var c=function(F){if(F.size()!==1){return false}if(nf.Common.isDFM()===false){return false}if(nf.CanvasUtils.isProcessor(F)){var E=F.datum();return E.component.persistsState===true}else{return false}};var q=function(E){if(E.size()!==1){return false}return nf.CanvasUtils.isProcessGroup(E)};var j=function(E){if(E.size()!==1){return false}return !nf.CanvasUtils.isLabel(E)&&!nf.CanvasUtils.isConnection(E)&&!nf.CanvasUtils.isProcessGroup(E)&&!nf.CanvasUtils.isRemoteProcessGroup(E)&&nf.Common.canAccessProvenance()};var D=function(E){if(E.size()!==1){return false}return nf.CanvasUtils.isRemoteProcessGroup(E)};var u=function(E){return nf.Common.isDFM()&&nf.CanvasUtils.canAllStartTransmitting(E)};var o=function(E){return nf.Common.isDFM()&&nf.CanvasUtils.canAllStopTransmitting(E)};var w=function(E){return nf.Common.isDFM()&&A(E)};var a=function(E){return nf.Common.isDFM()&&A(E)};var f=function(E){return !E.empty()&&nf.CanvasUtils.isDisconnected(E)&&nf.Canvas.getParentGroupId()!==null};var m=function(F,H){if(typeof H.click==="function"){var G=$('<div class="context-menu-item"></div>').on("click",H.click).on("contextmenu",function(I){H.click(I);I.preventDefault();I.stopPropagation()}).on("mouseenter",function(){$(this).addClass("hover")}).on("mouseleave",function(){$(this).removeClass("hover")}).appendTo(F);var E=$('<div class="context-menu-item-img"></div>').css("background-image","url("+H.img+")").appendTo(G);if(nf.Common.isDefinedAndNotNull(H.imgStyle)){E.addClass(H.imgStyle)}$('<div class="context-menu-item-text"></div>').text(H.text).appendTo(G);$('<div class="clear"></div>').appendTo(G)}};var v=function(F,E){F.css({left:E.x+"px",top:E.y+"px"}).show()};var s=function(G,F,E){nf.Actions[G](F,E);nf.ContextMenu.hide()};var l=[{condition:p,menuItem:{img:"images/iconRefresh.png",text:"Refresh status",action:"reloadStatus"}},{condition:n,menuItem:{img:"images/iconGoTo.png",text:"Leave group",action:"leaveGroup"}},{condition:y,menuItem:{img:"images/iconConfigure.png",text:"Configure",action:"showConfiguration"}},{condition:b,menuItem:{img:"images/iconConfigure.png",text:"View configuration",action:"showDetails"}},{condition:q,menuItem:{img:"images/iconGoTo.png",text:"Enter group",action:"enterGroup"}},{condition:i,menuItem:{img:"images/iconRun.png",text:"Start",action:"start"}},{condition:d,menuItem:{img:"images/iconStop.png",text:"Stop",action:"stop"}},{condition:D,menuItem:{img:"images/iconRemotePorts.png",text:"Remote ports",action:"remotePorts"}},{condition:u,menuItem:{img:"images/iconTransmissionActive.png",text:"Enable transmission",action:"enableTransmission"}},{condition:o,menuItem:{img:"images/iconTransmissionInactive.png",text:"Disable transmission",action:"disableTransmission"}},{condition:z,menuItem:{img:"images/iconChart.png",text:"Stats",action:"showStats"}},{condition:j,menuItem:{img:"images/iconProvenance.png",imgStyle:"context-menu-provenance",text:"Data provenance",action:"openProvenance"}},{condition:c,menuItem:{img:"images/iconViewState.png",text:"View state",action:"viewState"}},{condition:g,menuItem:{img:"images/iconToFront.png",text:"Bring to front",action:"toFront"}},{condition:A,menuItem:{img:"images/iconGoTo.png",text:"Go to source",action:"showSource"}},{condition:A,menuItem:{img:"images/iconGoTo.png",text:"Go to destination",action:"showDestination"}},{condition:B,menuItem:{img:"images/iconSmallRelationship.png",text:"Upstream connections",action:"showUpstream"}},{condition:C,menuItem:{img:"images/iconSmallRelationship.png",text:"Downstream connections",action:"showDownstream"}},{condition:k,menuItem:{img:"images/iconUsage.png",text:"Usage",action:"showUsage"}},{condition:D,menuItem:{img:"images/iconRefresh.png",text:"Refresh",action:"refreshRemoteFlow"}},{condition:D,menuItem:{img:"images/iconGoTo.png",text:"Go to",action:"openUri"}},{condition:r,menuItem:{img:"images/iconColor.png",text:"Change color",action:"fillColor"}},{condition:t,menuItem:{img:"images/iconCenterView.png",text:"Center in view",action:"center"}},{condition:h,menuItem:{img:"images/iconCopy.png",text:"Copy",action:"copy"}},{condition:x,menuItem:{img:"images/iconPaste.png",text:"Paste",action:"paste"}},{condition:f,menuItem:{img:"images/iconMoveToParent.png",text:"Move to parent group",action:"moveIntoParent"}},{condition:a,menuItem:{img:"images/iconListQueue.png",text:"List queue",action:"listQueue"}},{condition:w,menuItem:{img:"images/iconEmptyQueue.png",text:"Empty queue",action:"emptyQueue"}},{condition:e,menuItem:{img:"images/iconDelete.png",text:"Delete",action:"delete"}}];return{init:function(){$("#context-menu").on("contextmenu",function(E){E.preventDefault();E.stopPropagation()})},show:function(){var G=$("#context-menu").empty();var I=$("#canvas-body").get(0);var F=$("#banner-footer").get(0);var H=nf.CanvasUtils.getSelection();$.each(l,function(J,L){if(L.condition(H)){var K=L.menuItem;m(G,{img:K.img,imgStyle:K.imgStyle,text:K.text,click:function(M){s(K.action,H,M)}})}});var E=d3.mouse(I);if(E[0]+G.width()>I.clientWidth){E[0]=I.clientWidth-G.width()-2}if(E[1]+G.height()>(I.clientHeight-F.clientHeight)){E[1]=I.clientHeight-F.clientHeight-G.height()-2}v(G,{x:E[0],y:E[1]});nf.CanvasToolbar.refresh()},hide:function(){$("#context-menu").hide()},activate:function(E){E.on("contextmenu.selection",function(){nf.ContextMenu.show();d3.event.preventDefault();d3.event.stopPropagation()})}}}());
nf.StatusHistory=(function(){var r={clusterInstanceId:"cluster-instance-id",clusterInstanceLabel:"Cluster",type:{processor:"Processor",inputPort:"Input Port",outputPort:"Output Port",processGroup:"Process Group",remoteProcessGroup:"Remote Process Group",connection:"Connection",funnel:"Funnel",template:"Template",label:"Label"},urls:{processGroups:"../nifi-api/controller/process-groups/",clusterProcessor:"../nifi-api/cluster/processors/",clusterProcessGroup:"../nifi-api/cluster/process-groups/",clusterRemoteProcessGroup:"../nifi-api/cluster/remote-process-groups/",clusterConnection:"../nifi-api/cluster/connections/"}};var p={DURATION:function(s){return nf.Common.formatDuration(s)},COUNT:function(s){if(s%1===0){return nf.Common.formatInteger(s)}else{return nf.Common.formatFloat(s)}},DATA_SIZE:function(s){return nf.Common.formatDataSize(s)}};var h=null;var i=null;var l=null;var a=null;var c=function(u,z,y,t,x){$("#status-history-last-refreshed").text(y.generated);var s={groupId:u,id:z,type:t,clustered:true,instances:[]};var v=null;var w=y.clusterStatusHistory;if(w.statusSnapshots.length>1){if(v===null){v=w.fieldDescriptors;s.details=w.details;s.selectedDescriptor=nf.Common.isUndefined(x)?v[0]:x}s.instances.push({id:r.clusterInstanceId,label:r.clusterInstanceLabel,snapshots:w.statusSnapshots})}$.each(y.nodeStatusHistory,function(C,B){var D=B.node;var A=B.statusHistory;if(A.statusSnapshots.length>1){if(v===null){v=A.fieldDescriptors;s.details=A.details;s.selectedDescriptor=nf.Common.isUndefined(x)?v[0]:x}s.instances.push({id:D.nodeId,label:D.address+":"+D.apiPort,snapshots:A.statusSnapshots})}});if(s.instances.length>0){$("#status-history-dialog").data("status-history",s);m(s,v)}else{e()}};var q=function(u,x,s,t,w){if(s.statusSnapshots.length>1){$("#status-history-last-refreshed").text(s.generated);var v=s.fieldDescriptors;var s={groupId:u,id:x,details:s.details,type:t,clustered:false,selectedDescriptor:nf.Common.isUndefined(w)?v[0]:w,instances:[{id:"",label:"",snapshots:s.statusSnapshots}]};$("#status-history-dialog").data("status-history",s);m(s,v);return}e()};var e=function(){nf.Dialog.showOkDialog({dialogContent:"Insufficient history, please try again later.",overlayBackground:false})};var m=function(s,t){if(a===null){a={}}$.each(s.instances,function(v,u){u.snapshots.forEach(function(y){var x=new Date();var w=x.getTimezoneOffset()*60*1000;y.timestamp=new Date(y.timestamp+w+h)})});f(t,s.selectedDescriptor)};var f=function(u,t){var s=[];$.each(u,function(v,w){s.push({text:w.label,value:w.field,description:nf.Common.escapeHtml(w.description)})});$("#status-history-metric-combo").combo({selectedOption:{value:t.field},options:s,select:function(w){var x=null;$.each(u,function(y,z){if(w.value===z.field){x=z;return false}});if(x!==null){if(l===null||l.field!==x.field){i=null}l=x;var v=$("#status-history-dialog").data("status-history");v.selectedDescriptor=x;$("#status-history-dialog").data("status-history",v);g(v)}}})};var g=function(V){var ab=V.selectedDescriptor;$("#status-history-details").empty();var v=k("Status History");d3.map(V.details).forEach(function(x,y){d(v,x,y)});var z={top:15,right:10,bottom:25,left:75};var S=d3.scale.category10();var u=[];$.each(V.instances,function(y,x){u.push(x.label)});S.domain(u);var al=[];$.each(V.instances,function(y,x){if(nf.Common.isUndefinedOrNull(a[x.id])){a[x.id]=true}al.push({id:x.id,label:x.label,values:$.map(x.snapshots,function(ao){return{timestamp:ao.timestamp,value:ao.statusMetrics[ab.field]}}),visible:a[x.id]===true})});var J=d3.time.format.multi([[":%S.%L",function(x){return x.getMilliseconds()}],[":%S",function(x){return x.getSeconds()}],["%H:%M",function(x){return x.getMinutes()}],["%H:%M",function(x){return x.getHours()}],["%a %d",function(x){return x.getDay()&&x.getDate()!==1}],["%b %d",function(x){return x.getDate()!==1}],["%B",function(x){return x.getMonth()}],["%Y",function(){return true}]]);var ac=$("#status-history-dialog");if(!ac.is(":visible")){ac.modal("show")}var I=$("#status-history-chart-container").empty();if(I.hasClass("ui-resizable")){I.resizable("destroy")}var s=I.width()-z.left-z.right;var t=I.height()-z.top-z.bottom;var Z=d3.time.scale().range([0,s]);var N=d3.svg.axis().scale(Z).ticks(5).tickFormat(J).orient("bottom");var Y=d3.scale.linear().range([t,0]);var A=d3.svg.axis().scale(Y).tickFormat(p[ab.formatter]).orient("left");var B=d3.svg.line().interpolate("monotone").x(function(x){return Z(x.timestamp)}).y(function(x){return Y(x.value)});var H=d3.select("#status-history-chart-container").append("svg").attr("style","pointer-events: none;").attr("width",s+z.left+z.right).attr("height",t+z.top+z.bottom);var C=H.append("defs").append("clipPath").attr("id","clip").append("rect").attr("width",s).attr("height",t);var an=H.append("g").attr("transform","translate("+z.left+", "+z.top+")");var w=d3.min(al,function(x){return d3.min(x.values,function(y){return y.timestamp})});var F=d3.max(al,function(x){return d3.max(x.values,function(y){return y.timestamp})});d(v,"Start",nf.Common.formatDateTime(w));d(v,"End",nf.Common.formatDateTime(F));Z.domain([w,F]);Y.domain([j(al),o(al)]);an.append("g").attr("class","x axis").attr("transform","translate(0, "+t+")").call(N);an.append("g").attr("class","y axis").call(A).append("text").attr("transform","rotate(-90)").attr("y",6).attr("dy",".71em").attr("text-anchor","end").text(ab.label);var W=an.selectAll(".status").data(al).enter().append("g").attr("clip-path","url(#clip)").attr("class","status");W.append("path").attr("class",function(x){return"chart-line chart-line-"+x.id}).attr("d",function(x){return B(x.values)}).attr("stroke",function(x){return S(x.label)}).classed("hidden",function(x){return x.visible===false}).append("title").text(function(x){return x.label});W.each(function(x){var y=d3.select(this).append("g").attr("class",function(){return"mark-group mark-group-"+x.id}).classed("hidden",function(ao){return ao.visible===false});y.selectAll("circle.mark").data(x.values).enter().append("circle").attr("style","pointer-events: all;").attr("class","mark").attr("cx",function(ao){return Z(ao.timestamp)}).attr("cy",function(ao){return Y(ao.value)}).attr("fill",function(){return S(x.label)}).attr("r",1.5).append("title").text(function(ao){return x.label+" -- "+p[ab.formatter](ao.value)})});var M=$("#status-history-chart-control-container").empty();var L=M.height()-z.top-z.bottom;var af=d3.time.scale().range([0,s]);var E=d3.svg.axis().scale(af).ticks(5).tickFormat(J).orient("bottom");var ai=d3.scale.linear().range([L,0]);var ad=d3.svg.axis().scale(ai).tickValues(Y.domain()).tickFormat(p[ab.formatter]).orient("left");var K=d3.svg.line().interpolate("monotone").x(function(x){return af(x.timestamp)}).y(function(x){return ai(x.value)});var aa=d3.select("#status-history-chart-control-container").append("svg").attr("width",s+z.left+z.right).attr("height",L+z.top+z.bottom);var Q=aa.append("g").attr("transform","translate("+z.left+", "+z.top+")");var P=Y.domain();P[1]*=1.04;af.domain(Z.domain());ai.domain(P);Q.append("g").attr("class","x axis").attr("transform","translate(0, "+L+")").call(E);Q.append("g").attr("class","y axis").call(ad);var am=Q.selectAll(".status").data(al).enter().append("g").attr("class","status");am.append("path").attr("class",function(x){return"chart-line chart-line-"+x.id}).attr("d",function(x){return K(x.values)}).attr("stroke",function(x){return S(x.label)}).classed("hidden",function(x){return a[x.id]===false}).append("title").text(function(x){return x.label});var ak=function(x,y){Z.domain(x);Y.domain(y);W.selectAll(".chart-line").attr("d",function(ao){return B(ao.values)});W.selectAll("circle.mark").attr("cx",function(ao){return Z(ao.timestamp)}).attr("cy",function(ao){return Y(ao.value)}).attr("r",function(){return ag.empty()?1.5:4});an.select(".x.axis").call(N);an.select(".y.axis").call(A)};var D=function(){var y,x;if(ag.empty()){var ap=$.grep(al,function(aq){return aq.visible});if(ap.length===0){x=ai.domain()}else{x=[d3.min(ap,function(aq){return d3.min(aq.values,function(ar){return ar.value})}),d3.max(ap,function(aq){return d3.max(aq.values,function(ar){return ar.value})})]}y=af.domain();i=null}else{var ao=ag.extent();y=[ao[0][0],ao[1][0]];x=[ao[0][1],ao[1][1]];i=ao}ak(y,x);G()};var ag=d3.svg.brush().x(af).y(ai).on("brush",D);if(nf.Common.isDefinedAndNotNull(i)){ag=ag.extent(i)}Q.append("g").attr("class","brush").call(ag);Q.select("rect.extent").attr("style","pointer-events: all;").on("dblclick",function(){if(!ag.empty()){var x=ag.extent();var y=ai.domain();ag.extent([[x[0][0],y[0]],[x[1][0],y[1]]]);Q.select(".brush").call(ag);D()}});var G=function(){var at=$.map(al,function(aC){var aA=Z.domain();var aB=Y.domain();var aD=$.extend({},aC);return $.extend(aD,{values:$.grep(aC.values,function(aE){return aE.timestamp.getTime()>=aA[0].getTime()&&aE.timestamp.getTime()<=aA[1].getTime()&&aE.value>=aB[0]&&aE.value<=aB[1]})})});if(V.clustered){var x=$.grep(at,function(aA){return aA.id!==r.clusterInstanceId&&aA.visible&&aA.values.length>0});var ar=x.length===0?"NA":p[ab.formatter](j(x));var ap=x.length===0?"NA":p[ab.formatter](b(x));var y=x.length===0?"NA":p[ab.formatter](o(x));$("#node-aggregate-statistics").text(ar+" / "+y+" / "+ap);var aw=$.grep(at,function(aA){return aA.id===r.clusterInstanceId&&aA.visible&&aA.values.length>0});var ay=aw.length===0?"NA":p[ab.formatter](j(aw));var av=aw.length===0?"NA":p[ab.formatter](b(aw));var ao=aw.length===0?"NA":p[ab.formatter](o(aw));$("#cluster-aggregate-statistics").text(ay+" / "+ao+" / "+av)}else{var ax=$.grep(at,function(aA){return aA.values.length>0});var au=ax.length===0?0:p[ab.formatter](j(ax));var az=ax.length===0?0:p[ab.formatter](b(ax));var aq=ax.length===0?0:p[ab.formatter](o(ax));$("#instance-aggregate-statistics").text(au+" / "+aq+" / "+az)}};if(V.clustered){var X=$.grep(al,function(x){return x.id!==r.clusterInstanceId}).sort(function(y,x){return y.label<x.label?-1:y.label>x.label?1:0});var aj=function(y,x){var ap=$("<div></div>").addClass("legend-label").css("color",S(x.label)).text(x.label).ellipsis();var ao=$('<div class="nf-checkbox"></div>').on("click",function(){var aq=d3.selectAll("path.chart-line-"+x.id);var at=d3.select("g.mark-group-"+x.id);var ar=at.classed("hidden");aq.classed("hidden",function(){return !ar});at.classed("hidden",function(){return !ar});x.visible=ar;a[x.id]=x.visible;D()}).addClass(x.visible?"checkbox-checked":"checkbox-unchecked");$('<div class="legend-entry"></div>').append(ao).append(ap).on("mouseenter",function(){d3.selectAll("path.chart-line-"+x.id).classed("over",true)}).on("mouseleave",function(){d3.selectAll("path.chart-line-"+x.id).classed("over",false)}).appendTo(y)};var U=$.grep(al,function(x){return x.id===r.clusterInstanceId});var ae=k("Cluster");d(ae,"Min / Max / Mean","","cluster-aggregate-statistics");aj(ae,U[0]);if(X.length>0){var T=k("Nodes");d(T,"Min / Max / Mean","","node-aggregate-statistics");$.each(X,function(y,x){aj(T,x)})}}else{d(v,"Min / Max / Mean","","instance-aggregate-statistics")}D();var O,ah,R;I.append('<div class="ui-resizable-handle ui-resizable-se"></div>').resizable({minWidth:425,minHeight:150,handles:{se:".ui-resizable-se"},start:function(ar,aq){var x=aq.helper.offset();var ap=((ac.outerWidth()-ac.width())/2)+3;var y=I.outerWidth()-I.width();O=$(document).width()-x.left-ap-y;var ao=$("#status-history-container").outerHeight(true)-$("#status-history-container").height();ah=$(document).height()-x.top-ap-y-ao-M.outerHeight(true);if(!ag.empty()){R=ag.extent()}},resize:function(y,x){if(x.helper.width()>O){x.helper.width(O)}if(x.helper.height()>ah){x.helper.height(ah)}M.width(I.width());n()},stop:function(){n();s=I.width()-z.left-z.right;t=I.height()-z.top-z.bottom;Z.range([0,s]);Y.range([t,0]);H.attr("width",s+z.left+z.right).attr("height",t+z.top+z.bottom);C.attr("width",s).attr("height",t);an.select(".x.axis").attr("transform","translate(0, "+t+")");L=M.height()-z.top-z.bottom;af.range([0,s]);ai.range([L,0]);aa.attr("width",s+z.left+z.right).attr("height",L+z.top+z.bottom);am.selectAll(".chart-line").attr("d",function(x){return K(x.values)});Q.select(".x.axis").call(E);Q.select(".y.axis").call(ad);if(nf.Common.isDefinedAndNotNull(R)){ag.extent(R)}Q.select(".brush").call(ag);D();R=null}});n()};var j=function(s){return d3.min(s,function(t){return d3.min(t.values,function(u){return u.value})})};var o=function(s){return d3.max(s,function(t){return d3.max(t.values,function(u){return u.value})})};var b=function(t){var u=0;var s=d3.sum(t,function(v){u+=v.values.length;return d3.sum(v.values,function(w){return w.value})});return s/u};var n=function(){var s=$("#status-history-details");var t=s.outerWidth()-s.width();$("#status-history-details").height($("#status-history-container").height()-t)};var k=function(t){var s=$('<div class="status-history-detail"></div>').appendTo("#status-history-details");$('<div class="detail-container-label"></div>').text(t).appendTo(s);return $("<div></div>").appendTo(s)};var d=function(t,v,w,x){var u=$('<div class="detail-item"></div>').appendTo(t);$('<div class="detail-item-label"></div>').text(v).appendTo(u);var s=$('<div class="detail-item-value"></div>').text(w).appendTo(u);if(nf.Common.isDefinedAndNotNull(x)){s.attr("id",x)}};return{init:function(s){h=s;nf.Common.addHoverEffect("#status-history-refresh-button","button-refresh","button-refresh-hover").click(function(){var t=$("#status-history-dialog").data("status-history");if(t!==null){if(t.type===r.type.processor){if(t.clustered===true){nf.StatusHistory.showClusterProcessorChart(t.groupId,t.id,t.selectedDescriptor)}else{nf.StatusHistory.showStandaloneProcessorChart(t.groupId,t.id,t.selectedDescriptor)}}else{if(t.type===r.type.processGroup){if(t.clustered===true){nf.StatusHistory.showClusterProcessGroupChart(t.groupId,t.id,t.selectedDescriptor)}else{nf.StatusHistory.showStandaloneProcessGroupChart(t.groupId,t.id,t.selectedDescriptor)}}else{if(t.type===r.type.remoteProcessGroup){if(t.clustered===true){nf.StatusHistory.showClusterRemoteProcessGroupChart(t.groupId,t.id,t.selectedDescriptor)}else{nf.StatusHistory.showStandaloneRemoteProcessGroupChart(t.groupId,t.id,t.selectedDescriptor)}}else{if(t.clustered===true){nf.StatusHistory.showClusterConnectionChart(t.groupId,t.id,t.selectedDescriptor)}else{nf.StatusHistory.showStandaloneConnectionChart(t.groupId,t.id,t.selectedDescriptor)}}}}}});$("#status-history-dialog").modal({overlayBackground:false,buttons:[{buttonText:"Close",handler:{click:function(){this.modal("hide")}}}],handler:{close:function(){$("#status-history-dialog").removeData("status-history").hide();$("#status-history-chart-container").empty();$("#status-history-chart-control-container").empty();$("#status-history-details").empty();i=null;l=null;a=null}}}).draggable({cancel:"#status-history-chart-container, #status-history-chart-control-container, div.status-history-detail, div.button, div.combo, div.summary-refresh",containment:"parent"})},showClusterConnectionChart:function(s,t,u){$.ajax({type:"GET",url:r.urls.clusterConnection+encodeURIComponent(t)+"/status/history",dataType:"json"}).done(function(v){c(s,t,v.clusterStatusHistory,r.type.connection,u)}).fail(nf.Common.handleAjaxError)},showClusterProcessorChart:function(s,u,t){$.ajax({type:"GET",url:r.urls.clusterProcessor+encodeURIComponent(u)+"/status/history",dataType:"json"}).done(function(v){c(s,u,v.clusterStatusHistory,r.type.processor,t)}).fail(nf.Common.handleAjaxError)},showClusterProcessGroupChart:function(t,s,u){$.ajax({type:"GET",url:r.urls.clusterProcessGroup+encodeURIComponent(s)+"/status/history",dataType:"json"}).done(function(v){c(t,s,v.clusterStatusHistory,r.type.processGroup,u)}).fail(nf.Common.handleAjaxError)},showClusterRemoteProcessGroupChart:function(t,s,u){$.ajax({type:"GET",url:r.urls.clusterRemoteProcessGroup+encodeURIComponent(s)+"/status/history",dataType:"json"}).done(function(v){c(t,s,v.clusterStatusHistory,r.type.remoteProcessGroup,u)}).fail(nf.Common.handleAjaxError)},showStandaloneConnectionChart:function(s,t,u){$.ajax({type:"GET",url:r.urls.processGroups+encodeURIComponent(s)+"/connections/"+encodeURIComponent(t)+"/status/history",dataType:"json"}).done(function(v){q(s,t,v.statusHistory,r.type.connection,u)}).fail(nf.Common.handleAjaxError)},showStandaloneProcessorChart:function(s,u,t){$.ajax({type:"GET",url:r.urls.processGroups+encodeURIComponent(s)+"/processors/"+encodeURIComponent(u)+"/status/history",dataType:"json"}).done(function(v){q(s,u,v.statusHistory,r.type.processor,t)}).fail(nf.Common.handleAjaxError)},showStandaloneProcessGroupChart:function(t,s,u){$.ajax({type:"GET",url:r.urls.processGroups+encodeURIComponent(s)+"/status/history",dataType:"json"}).done(function(v){q(t,s,v.statusHistory,r.type.processGroup,u)}).fail(nf.Common.handleAjaxError)},showStandaloneRemoteProcessGroupChart:function(t,s,u){$.ajax({type:"GET",url:r.urls.processGroups+encodeURIComponent(t)+"/remote-process-groups/"+encodeURIComponent(s)+"/status/history",dataType:"json"}).done(function(v){q(t,s,v.statusHistory,r.type.remoteProcessGroup,u)}).fail(nf.Common.handleAjaxError)}}}());
$(document).ready(function(){if(nf.Canvas.SUPPORTS_SVG){nf.Canvas.init()}else{$("#message-title").text("Unsupported Browser");$("#message-content").text("Flow graphs are shown using SVG. Please use a browser that supports rendering SVG.");$("#message-pane").show();nf.Canvas.hideSplash()}});nf.Canvas=(function(){var p=1;var h=[0,0];var w=1.2;var D=8;var s=0.2;var d=0.6;var t=false;var g=false;var k="root";var n=null;var q=null;var j=false;var b=false;var r=null;var f=null;var u=false;var i=false;var C={urls:{identity:"../nifi-api/controller/identity",authorities:"../nifi-api/controller/authorities",kerberos:"../nifi-api/access/kerberos",revision:"../nifi-api/controller/revision",status:"../nifi-api/controller/status",bulletinBoard:"../nifi-api/controller/bulletin-board",banners:"../nifi-api/controller/banners",controller:"../nifi-api/controller",controllerConfig:"../nifi-api/controller/config",accessConfig:"../nifi-api/access/config",cluster:"../nifi-api/cluster",d3Script:"js/d3/d3.min.js"}};var A=function(F){var E=$('<span class="link"></span>').text(F.name).click(function(){nf.CanvasUtils.enterGroup(F.id)});if(nf.Canvas.getGroupId()===F.id){E.css("font-weight","bold")}if(nf.Common.isDefinedAndNotNull(F.parent)){var G=$("<span>&raquo;</span>").css({color:"#598599",margin:"0 10px"});$("#data-flow-title-container").append(A(F.parent)).append(G)}$("#data-flow-title-container").append(E);return E};var o=function(){return nf.Common.cachedScript(C.urls.d3Script)};var m=function(E){t=true;B(E)};var B=function(E){if(t){y().done(function(){setTimeout(function(){B(E)},E*1000)})}};var a=function(E){g=true;z(E)};var z=function(E){if(g){nf.Canvas.reloadStatus().done(function(){setTimeout(function(){z(E)},E*1000)})}};var y=function(){return $.ajax({type:"GET",url:C.urls.revision,dataType:"json"}).done(function(F){if(nf.Common.isDefinedAndNotNull(F.revision)){var G=F.revision;var K=nf.Client.getRevision();if(G.version>K.version&&G.clientId!==K.clientId){var H=$("#refresh-required-container");var J=$("#settings-refresh-required-icon");if(!H.is(":visible")){$("#stats-last-refreshed").addClass("alert");var I="This flow has been modified by '"+G.lastModifier+"'. Please refresh.";var E=$("#refresh-required-icon");if(E.data("qtip")){E.qtip("option","content.text",I)}else{E.qtip($.extend({content:I},nf.CanvasUtils.config.systemTooltipConfig))}H.show()}if(!J.is(":visible")){$("#settings-last-refreshed").addClass("alert");J.show()}}}}).fail(nf.Common.handleAjaxError)};var l=function(){var K=$("#canvas-container");r=d3.select("#canvas-container").append("svg").on("contextmenu",function(){u=false;nf.CanvasUtils.getSelection().classed("selected",false);nf.ContextMenu.show();d3.event.preventDefault()});var E=r.append("defs");E.selectAll("marker").data(["normal","ghost"]).enter().append("marker").attr({id:function(L){return L},viewBox:"0 0 6 6",refX:5,refY:3,markerWidth:6,markerHeight:6,orient:"auto",fill:function(L){if(L==="ghost"){return"#aaaaaa"}else{return"#000000"}}}).append("path").attr("d","M2,3 L0,6 L6,3 L0,0 z");var H=E.append("linearGradient").attr({id:"process-group-stats-background",x1:"0%",y1:"100%",x2:"0%",y2:"0%"});H.append("stop").attr({offset:"0%","stop-color":"#dedede"});H.append("stop").attr({offset:"50%","stop-color":"#ffffff"});H.append("stop").attr({offset:"100%","stop-color":"#dedede"});var I=E.append("linearGradient").attr({id:"processor-stats-background",x1:"0%",y1:"100%",x2:"0%",y2:"0%"});I.append("stop").attr({offset:"0%","stop-color":"#6f97ac"});I.append("stop").attr({offset:"100%","stop-color":"#30505c"});var J=E.append("linearGradient").attr({id:"port-background",x1:"0%",y1:"100%",x2:"0%",y2:"0%"});J.append("stop").attr({offset:"0%","stop-color":"#aaaaaa"});J.append("stop").attr({offset:"100%","stop-color":"#ffffff"});var G=E.append("linearGradient").attr({id:"expiration",x1:"0%",y1:"0%",x2:"0%",y2:"100%"});G.append("stop").attr({offset:"0%","stop-color":"#aeafb1"});G.append("stop").attr({offset:"100%","stop-color":"#87888a"});f=r.append("g").attr({transform:"translate("+h+") scale("+p+")","pointer-events":"all",id:"canvas"});r.on("mousedown.selection",function(){u=true;if(d3.event.button!==0){d3.event.stopImmediatePropagation();return}if(d3.event.shiftKey){var L=d3.mouse(f.node());f.append("rect").attr("rx",6).attr("ry",6).attr("x",L[0]).attr("y",L[1]).attr("class","selection").attr("width",0).attr("height",0).attr("stroke-width",function(){return 1/nf.Canvas.View.scale()}).attr("stroke-dasharray",function(){return 4/nf.Canvas.View.scale()}).datum(L);d3.event.stopImmediatePropagation();d3.event.preventDefault()}}).on("mousemove.selection",function(){if(d3.event.shiftKey){var M=d3.select("rect.selection");if(!M.empty()){var N=M.datum();var L=d3.mouse(f.node());var O={};if(N[0]<L[0]){O.x=N[0];O.width=L[0]-N[0]}else{O.x=L[0];O.width=N[0]-L[0]}if(N[1]<L[1]){O.y=N[1];O.height=L[1]-N[1]}else{O.y=L[1];O.height=N[1]-L[1]}M.attr(O);d3.event.stopPropagation()}}}).on("mouseup.selection",function(){if(u===false){return}u=false;var L=d3.select("rect.selection");if(!L.empty()){var M={x:parseInt(L.attr("x"),10),y:parseInt(L.attr("y"),10),width:parseInt(L.attr("width"),10),height:parseInt(L.attr("height"),10)};d3.selectAll("g.component").classed("selected",function(N){return d3.select(this).classed("selected")||N.component.position.x>=M.x&&(N.component.position.x+N.dimensions.width)<=(M.x+M.width)&&N.component.position.y>=M.y&&(N.component.position.y+N.dimensions.height)<=(M.y+M.height)});d3.selectAll("g.connection").classed("selected",function(P){var O=[P.start].concat(P.bends,[P.end]);var N=d3.extent(O,function(R){return R.x});var Q=d3.extent(O,function(R){return R.y});return d3.select(this).classed("selected")||N[0]>=M.x&&N[1]<=(M.x+M.width)&&Q[0]>=M.y&&Q[1]<=(M.y+M.height)});L.remove()}else{if(i===false){nf.CanvasUtils.getSelection().classed("selected",false)}}nf.CanvasToolbar.refresh()});var F=function(){var P=$("#banner-footer");var L=0;if(P.is(":visible")){L=P.height()}var N=parseInt(K.css("top"),10);var O=$(window).height();var M=(O-(L+N));K.css({height:M+"px",bottom:L+"px"});r.attr({height:K.height(),width:K.width()});$("#canvas-body").css({height:O+"px",width:$(window).width()+"px"})};$(window).on("resize",function(L){if(L.target===window){F();nf.Settings.resetTableSize()}}).on("keydown",function(L){if($(".dialog").is(":visible")||$("#search-field").is(":focus")){return}var M=nf.CanvasUtils.getSelection();var N=L.ctrlKey||L.metaKey;if(N){if(L.keyCode===82){nf.Actions.reloadStatus()}else{if(L.keyCode===65){nf.Actions.selectAll();nf.CanvasToolbar.refresh();L.preventDefault()}else{if(L.keyCode===67){if(nf.Common.isDFM()&&nf.CanvasUtils.isCopyable(M)){nf.Actions.copy(M);L.preventDefault()}}else{if(L.keyCode===86){if(nf.Common.isDFM()&&nf.CanvasUtils.isPastable()){nf.Actions.paste(M);L.preventDefault()}}}}}}else{if(L.keyCode==8||L.keyCode===46){if(nf.Common.isDFM()&&nf.CanvasUtils.isDeletable(M)){nf.Actions["delete"](M)}}}});$.ajax({type:"GET",url:C.urls.banners,dataType:"json"}).done(function(N){if(nf.Common.isDefinedAndNotNull(N.banners)){if(nf.Common.isDefinedAndNotNull(N.banners.headerText)&&N.banners.headerText!==""){$("#banner-header").addClass("banner-header-background").text(N.banners.headerText)}if(nf.Common.isDefinedAndNotNull(N.banners.footerText)&&N.banners.footerText!==""){var L=$("#banner-footer").text(N.banners.footerText).show();var M=function(O){var P=$("#"+O);P.css("bottom",parseInt(L.css("height"),10)+"px")};M("graph")}}F()}).fail(nf.Common.handleAjaxError)};var c=function(F,H){var E=d3.select("defs");var G=E.selectAll("linearGradient."+H+"-background").data(F,function(J){return J});var I=G.enter().append("linearGradient").attr({id:function(J){return H+"-background-"+J},"class":H+"-background",x1:"0%",y1:"100%",x2:"0%",y2:"0%"});I.append("stop").attr({offset:"0%","stop-color":function(J){return"#"+J}});I.append("stop").attr({offset:"100%","stop-color":"#ffffff"});G.exit().remove()};var e=function(){return $.ajax({type:"GET",url:C.urls.status,dataType:"json"}).done(function(G){if(nf.Common.isDefinedAndNotNull(G.controllerStatus)){var E=G.controllerStatus;$("#active-thread-count").text(E.activeThreadCount);$("#total-queued").text(E.queued);if(nf.Common.isDefinedAndNotNull(E.connectedNodes)){var F=E.connectedNodes.split(" / ");if(F.length===2&&F[0]!==F[1]){$("#connected-nodes-count").addClass("alert")}else{$("#connected-nodes-count").removeClass("alert")}$("#connected-nodes-count").text(E.connectedNodes)}if(nf.Common.isDefinedAndNotNull(E.activeRemotePortCount)){$("#controller-transmitting-count").text(E.activeRemotePortCount)}else{$("#controller-transmitting-count").text("-")}if(nf.Common.isDefinedAndNotNull(E.inactiveRemotePortCount)){$("#controller-not-transmitting-count").text(E.inactiveRemotePortCount)}else{$("#controller-not-transmitting-count").text("-")}if(nf.Common.isDefinedAndNotNull(E.runningCount)){$("#controller-running-count").text(E.runningCount)}else{$("#controller-running-count").text("-")}if(nf.Common.isDefinedAndNotNull(E.stoppedCount)){$("#controller-stopped-count").text(E.stoppedCount)}else{$("#controller-stopped-count").text("-")}if(nf.Common.isDefinedAndNotNull(E.invalidCount)){$("#controller-invalid-count").text(E.invalidCount)}else{$("#controller-invalid-count").text("-")}if(nf.Common.isDefinedAndNotNull(E.disabledCount)){$("#controller-disabled-count").text(E.disabledCount)}else{$("#controller-disabled-count").text("-")}var I=$("#controller-bulletins");var K=I.data("bulletins");if(nf.Common.doBulletinsDiffer(K,E.bulletins)){I.data("bulletins",E.bulletins);var J=nf.Common.getFormattedBulletins(E.bulletins);if(J.length===0){if(I.data("qtip")){I.removeClass("has-bulletins").qtip("api").destroy(true)}I.hide()}else{var H=nf.Common.formatUnorderedList(J);if(I.data("qtip")){I.qtip("option","content.text",H)}else{I.addClass("has-bulletins").qtip($.extend({content:H},nf.CanvasUtils.config.systemTooltipConfig))}I.show()}}nf.Settings.setBulletins(E.controllerServiceBulletins,E.reportingTaskBulletins);if(E.hasPendingAccounts===true){$("#has-pending-accounts").show()}else{$("#has-pending-accounts").hide()}}}).fail(nf.Common.handleAjaxError)};var v=function(E){return $.ajax({type:"GET",url:C.urls.controller+"/process-groups/"+encodeURIComponent(E),data:{verbose:true},dataType:"json"}).done(function(F){nf.Client.setRevision(F.revision);var G=F.processGroup;nf.Canvas.setGroupId(G.id);nf.Canvas.setGroupName(G.name);$("#data-flow-title-container").empty();A(G);if(nf.Common.isDefinedAndNotNull(G.parent)){nf.Canvas.setParentGroupId(G.parent.id)}else{nf.Canvas.setParentGroupId(null)}nf.Graph.removeAll();nf.Graph.add(G.contents,false);nf.CanvasToolbar.refresh()}).fail(nf.Common.handleAjaxError)};var x=function(E){return $.Deferred(function(F){$.ajax({type:"GET",url:C.urls.controller+"/process-groups/"+encodeURIComponent(E)+"/status",data:{recursive:false},dataType:"json"}).done(function(G){if(nf.Common.isDefinedAndNotNull(G.processGroupStatus)){var H=G.processGroupStatus;nf.Graph.setStatus(H);$("#stats-last-refreshed").text(H.statsLastRefreshed)}F.resolve()}).fail(function(I,G,H){if(!nf.Canvas.isClustered()||I.status!==404){nf.Common.handleAjaxError(I,G,H);F.reject()}else{F.resolve()}})}).promise()};return{CANVAS_OFFSET:0,SUPPORTS_SVG:!!document.createElementNS&&!!document.createElementNS("http://www.w3.org/2000/svg","svg").createSVGRect,hideSplash:function(){$("#splash").fadeOut()},stopRevisionPolling:function(){t=false},stopStatusPolling:function(){g=false},reload:function(){return $.Deferred(function(F){nf.ContextMenu.hide();var E=v(nf.Canvas.getGroupId());var H=e();var G=nf.Settings.loadSettings(false);$.when(E,H,G).done(function(K){var O=$("#data-flow-title-container");var I=O.position();var Q=O.outerWidth();var L=I.left+Q;var P=$("#breadcrumbs-right-border").width();var N=$("#data-flow-title-viewport");var M=N.width();var J=M-P;if(L>J){O.css("left",(I.left-(L-J))+"px")}else{O.css("left","10px")}x(nf.Canvas.getGroupId()).done(function(){F.resolve(K)}).fail(function(){F.reject()})})}).promise()},reloadStatus:function(){return $.Deferred(function(E){$.when(x(nf.Canvas.getGroupId()),e(),y()).done(function(){E.resolve()}).fail(function(){E.reject()})}).promise()},init:function(){var F=$.Deferred(function(G){if(nf.Storage.hasItem("jwt")){G.resolve()}else{$.ajax({type:"POST",url:C.urls.kerberos,dataType:"text"}).done(function(J){var I=nf.Common.getJwtPayload(J);var H=parseInt(I.exp,10)*nf.Common.MILLIS_PER_SECOND;nf.Storage.setItem("jwt",J,H);G.resolve()}).fail(function(){G.reject()})}}).promise();var E=$.Deferred(function(G){F.always(function(){var H=$.ajax({type:"GET",url:C.urls.identity,dataType:"json"});var I=$.ajax({type:"GET",url:C.urls.authorities,dataType:"json"});$.when(I,H).done(function(M,K){var L=M[0];var J=K[0];nf.Common.setAuthorities(L.authorities);if(J.identity!=="anonymous"){$("#current-user").text(J.identity).show();if(nf.Storage.getItem("jwt")!==null){$("#logout-link-container").show()}}else{nf.Common.setAnonymousUserLabel()}G.resolve()}).fail(function(L,J,K){if(L.status===401||L.status===403){window.location="/nifi/login"}else{G.reject(L,J,K)}})})}).promise();E.done(function(){var I=$.ajax({type:"GET",url:C.urls.controllerConfig,dataType:"json"});var H=$.ajax({type:"GET",url:C.urls.accessConfig,dataType:"json"});var G=$.Deferred(function(J){$.ajax({type:"HEAD",url:C.urls.cluster}).done(function(L,K,M){b=true;J.resolve(L,K,M)}).fail(function(M,K,L){if(M.status===404){b=false;J.resolve("","success",M)}else{J.reject(M,K,L)}})}).promise();$.when(I,H,E).done(function(M,J){var N=M[0];var L=J[0];var P=$("#canvas-container");nf.Canvas.CANVAS_OFFSET=P.offset().top;var K=N.config;var O=L.config;if(!nf.Common.isBlank(K.contentViewerUrl)){$("#nifi-content-viewer-url").text(K.contentViewerUrl)}G.done(function(){var Q=parseInt(K.autoRefreshIntervalSeconds,10);j=K.siteToSiteSecure;o().done(function(){nf.Storage.init();l();nf.Canvas.View.init();nf.ContextMenu.init();nf.CanvasToolbar.init();nf.CanvasToolbox.init();nf.CanvasHeader.init(O.supportsLogin);nf.GraphControl.init();nf.Search.init();nf.Settings.init();nf.Actions.init();nf.QueueListing.init();nf.ComponentState.init();nf.Draggable.init();nf.Selectable.init();nf.Connectable.init();nf.StatusHistory.init(K.timeOffset);nf.Birdseye.init();nf.ConnectionConfiguration.init();nf.ControllerService.init();nf.ReportingTask.init();nf.ProcessorConfiguration.init();nf.ProcessGroupConfiguration.init();nf.RemoteProcessGroupConfiguration.init();nf.RemoteProcessGroupPorts.init();nf.PortConfiguration.init();nf.SecurePortConfiguration.init();nf.LabelConfiguration.init();nf.ProcessorDetails.init();nf.ProcessGroupDetails.init();nf.PortDetails.init();nf.SecurePortDetails.init();nf.ConnectionDetails.init();nf.RemoteProcessGroupDetails.init();nf.GoTo.init();nf.Graph.init().done(function(){var R=Q/2;m(Q);setTimeout(function(){a(Q)},R*1000);nf.Canvas.hideSplash()}).fail(nf.Common.handleAjaxError)}).fail(nf.Common.handleAjaxError)}).fail(nf.Common.handleAjaxError)}).fail(nf.Common.handleAjaxError)}).fail(nf.Common.handleAjaxError)},defineProcessorColors:function(E){c(E,"processor")},defineLabelColors:function(E){c(E,"label")},isClustered:function(){return b===true},isSecureSiteToSite:function(){return j},setGroupId:function(E){k=E},getGroupId:function(){return k},setGroupName:function(E){n=E},getGroupName:function(){return n},setParentGroupId:function(E){q=E},getParentGroupId:function(){return q},View:(function(){var F=function(){var O=$("#canvas-container");var J=nf.Canvas.View.translate();var K=nf.Canvas.View.scale();J=[J[0]/K,J[1]/K];var G=O.width()/K;var H=O.height()/K;var L=-J[0]-G;var I=-J[1]-H;var Q=L+(G*3);var S=I+(H*3);var N=function(X){if(!nf.Canvas.View.shouldRenderPerScale()){return false}var W=X.component.position.x;var V=X.component.position.y;var U=W+X.dimensions.width;var T=V+X.dimensions.height;return L<U&&Q>W&&I<T&&S>V};var P=function(V){if(!nf.Canvas.View.shouldRenderPerScale()){return false}var T,W;if(V.bends.length>0){var U=Math.min(Math.max(0,V.labelIndex),V.bends.length-1);T=V.bends[U].x;W=V.bends[U].y}else{T=(V.start.x+V.end.x)/2;W=(V.start.y+V.end.y)/2}return L<T&&Q>T&&I<W&&S>W};var M=function(X,T){var V=d3.select("#id-"+X.component.id);var W=T(X);var U=V.classed("visible");V.classed("visible",W).classed("entering",function(){return W&&!U}).classed("leaving",function(){return !W&&U})};var R=nf.Graph.get();$.each(R.processors,function(T,U){M(U,N)});$.each(R.ports,function(T,U){M(U,N)});$.each(R.processGroups,function(T,U){M(U,N)});$.each(R.remoteProcessGroups,function(T,U){M(U,N)});$.each(R.connections,function(T,U){M(U,P)})};var E;return{init:function(){var G;var H=false;E=d3.behavior.zoom().scaleExtent([s,D]).translate(h).scale(p).on("zoomstart",function(){nf.ContextMenu.hide()}).on("zoom",function(){if(H){i=true}else{H=true}var I=d3.event.sourceEvent.type==="wheel"||d3.event.sourceEvent.type==="mousewheel";G=nf.Canvas.View.refresh({persist:false,transition:I,refreshComponents:false,refreshBirdseye:false})}).on("zoomend",function(){if(nf.Common.isDefinedAndNotNull(G)){nf.Canvas.View.updateVisibility();G.done(function(){nf.Birdseye.refresh()});nf.CanvasUtils.persistUserView();G=null}i=false;H=false});r.call(E).on("dblclick.zoom",null)},shouldRenderPerScale:function(){return nf.Canvas.View.scale()>=d},updateVisibility:function(){F();nf.Graph.pan()},translate:function(G){if(nf.Common.isUndefined(G)){return E.translate()}else{E.translate(G)}},scale:function(G){if(nf.Common.isUndefined(G)){return E.scale()}else{E.scale(G)}},zoomIn:function(){var I=nf.Canvas.View.translate();var H=nf.Canvas.View.scale();var L=Math.min(H*w,D);var K=$("#canvas-container");var G=K.width()/H;var J=K.height()/H;nf.Canvas.View.scale(L);nf.CanvasUtils.centerBoundingBox({x:(G/2)-(I[0]/H),y:(J/2)-(I[1]/H),width:1,height:1})},zoomOut:function(){var I=nf.Canvas.View.translate();var H=nf.Canvas.View.scale();var L=Math.max(H/w,s);var K=$("#canvas-container");var G=K.width()/H;var J=K.height()/H;nf.Canvas.View.scale(L);nf.CanvasUtils.centerBoundingBox({x:(G/2)-(I[0]/H),y:(J/2)-(I[1]/H),width:1,height:1})},fit:function(){var I=nf.Canvas.View.translate();var K=nf.Canvas.View.scale();var N;var M=$("#canvas-container");var J=M.width();var L=M.height();var P=d3.select("#canvas").node().getBoundingClientRect();var Q=P.width/K;var H=P.height/K;var O=P.left/K;var G=(P.top-nf.Canvas.CANVAS_OFFSET)/K;if(Q>J||H>L){N=Math.min(J/Q,L/H);N=Math.min(Math.max(N,s),D)}else{N=1;O-=100;G-=50}nf.Canvas.View.scale(N);nf.CanvasUtils.centerBoundingBox({x:O-(I[0]/K),y:G-(I[1]/K),width:J/N,height:L/N})},actualSize:function(){var L=nf.Canvas.View.translate();var K=nf.Canvas.View.scale();var H=nf.CanvasUtils.getSelection();nf.Canvas.View.scale(1);var I;if(!H.empty()){var G=H.node().getBoundingClientRect();I={x:(G.left/K)-(L[0]/K),y:((G.top-nf.Canvas.CANVAS_OFFSET)/K)-(L[1]/K),width:G.width/K,height:G.height/K}}else{var N=$("#canvas-container");var J=N.width()/K;var M=N.height()/K;I={x:(J/2)-(L[0]/K),y:(M/2)-(L[1]/K),width:1,height:1}}nf.CanvasUtils.centerBoundingBox(I)},refresh:function(G){return $.Deferred(function(H){var I=true;var K=false;var J=true;var L=true;if(nf.Common.isDefinedAndNotNull(G)){I=nf.Common.isDefinedAndNotNull(G.persist)?G.persist:I;K=nf.Common.isDefinedAndNotNull(G.transition)?G.transition:K;J=nf.Common.isDefinedAndNotNull(G.refreshComponents)?G.refreshComponents:J;L=nf.Common.isDefinedAndNotNull(G.refreshBirdseye)?G.refreshBirdseye:L}if(J){nf.Canvas.View.updateVisibility()}if(I===true){nf.CanvasUtils.persistUserView()}if(K===true){f.transition().duration(500).attr("transform",function(){return"translate("+E.translate()+") scale("+E.scale()+")"}).each("end",function(){if(L===true){nf.Birdseye.refresh()}H.resolve()})}else{f.attr("transform",function(){return"translate("+E.translate()+") scale("+E.scale()+")"});if(L===true){nf.Birdseye.refresh()}H.resolve()}}).promise()}}}())}}());
nf.Clipboard=(function(){var a="copy";var d="paste";var c=null;var b={};return{addListener:function(f,e){b[f]=e},removeListener:function(e){if(nf.Common.isDefinedAndNotNull(b[e])){delete b[e]}},copy:function(f){c=f;for(var e in b){b[e].call(e,a,c)}},isCopied:function(){return nf.Common.isDefinedAndNotNull(c)},paste:function(){return $.Deferred(function(e){if(nf.Common.isDefinedAndNotNull(c)){var g=c;e.resolve(g);c=null;for(var f in b){b[f].call(f,d,g)}}else{e.reject()}}).promise()}}}());
